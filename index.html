<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>Fanthira Tales: wRight on cue</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.36.1): A free (gratis and libre) story format.

Copyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */
"document"in self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(""===e)throw new c("SYNTAX_ERR","The token must not be empty.");if(/\s/.test(e))throw new c("INVALID_CHARACTER_ERR","The token must not contain space characters.");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+"")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+"",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+"",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&"remove":e!==!1&&"add";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+"");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(" ")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}"replace"in document.createElement("_").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(" "),i=n.indexOf(t+"");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2020 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
/*! jQuery v3.6.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},E=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:f,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=S.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(S.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||S.isPlainObject(n)?n:{},i=!1,a[t]=S.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},S.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?S.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:y}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,S="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),$=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ye(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=S)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return g(t.replace($,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[S]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=S,!C.getElementsByName||!C.getElementsByName(S).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+S+"'></a><select id='"+S+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+S+"-]").length||v.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+S+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&y(p,e)?-1:t==C||t.ownerDocument==p&&y(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&E&&!N[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(B," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[S]||(a[S]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace($,"$1"));return s[S]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[S]||(e[S]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[S]&&(v=Ce(v)),y&&!y[S]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace($,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace($," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[S]?i.push(a):o.push(a);(a=A(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=S.split("").sort(j).join("")===S,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);S.find=d,S.expr=d.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=d.uniqueSort,S.text=d.getText,S.isXMLDoc=d.isXML,S.contains=d.contains,S.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=S.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?S(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),N.test(r[1])&&S.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this)}).prototype=S.fn,D=S(E);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&S(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?S.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(H[r]||S.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(P)||[],function(e,t){n[t]=!0}),n):S.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return S.each(arguments,function(e,t){var n;while(-1<(n=S.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<S.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},S.extend({Deferred:function(e){var o=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),C.setTimeout(t))}}return S.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},s={};return S.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=S.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){C.setTimeout(function(){throw e})};var F=S.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),S.ready()}S.fn.ready=function(e){return F.then(e)["catch"](function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(E,[S])}}),S.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(S.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var $=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)$(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(S(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=S.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||S.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!S.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):$(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),o=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){S.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:S.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=S.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=E.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return S.css(e,t,"")},u=s(),l=n&&n[3]||(S.cssNumber[t]?"":"px"),c=e.nodeType&&(S.cssNumber[t]||"px"!==l&&+u)&&te.exec(S.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)S.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,S.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=S.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}S.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=E.createDocumentFragment().appendChild(E.createElement("div")),(fe=E.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),y.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",y.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?S.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,y.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))S.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+S.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;S.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<S.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ee(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Se(e,i,o){o?(Y.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&S.event.add(e,i,we)}S.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=S.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=S.event.special[d]||{},c=S.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=S.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||S.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)S.event.remove(e,d+t[l],n,r,!0);S.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=S.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=S.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=S.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((S.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(l):S.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Se(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Se(this,e,Ce),!1},trigger:function(){return Se(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return Ee(this,e,t,n,r)},one:function(e,t,n,r){return Ee(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){S.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=S.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=S.map(ve(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=S.clone(u,!0,!0),s&&S.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,S.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&S.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?S._evalUrl&&!u.noModule&&S._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?S.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||S.cleanData(ve(r)),r.parentNode&&(n&&ie(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=S.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),S.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return $(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return $(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),S(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Me=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ie=new RegExp(ne.join("|"),"i");function We(e,t,n){var r,i,o,a,s=e.style;return(n=n||Re(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||ie(e)||(a=S.style(e,t)),!y.pixelBoxStyles()&&Pe.test(a)&&Ie.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Fe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=E.createElement("div"),l=E.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===l.style.backgroundClip,S.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=E.createElement("table"),t=E.createElement("tr"),n=E.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var Be=["Webkit","Moz","ms"],$e=E.createElement("div").style,_e={};function ze(e){var t=S.cssProps[e]||_e[e];return t||(e in $e?e:_e[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Be.length;while(n--)if((e=Be[n]+t)in $e)return e}(e)||e)}var Ue=/^(none|table(?!-c[ea]).+)/,Xe=/^--/,Ve={position:"absolute",visibility:"hidden",display:"block"},Ge={letterSpacing:"0",fontWeight:"400"};function Ye(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Qe(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=S.css(e,"border"+ne[a]+"Width",!0,i))):(u+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=S.css(e,"border"+ne[a]+"Width",!0,i):s+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Je(e,t,n){var r=Re(e),i=(!y.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),o=i,a=We(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||!y.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Qe(e,t,n||(i?"border":"content"),o,r,a)+"px"}function Ke(e,t,n,r,i){return new Ke.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=We(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Xe.test(t),l=e.style;if(u||(t=ze(s)),a=S.cssHooks[t]||S.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(S.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Xe.test(t)||(t=ze(s)),(a=S.cssHooks[t]||S.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=We(e,t,r)),"normal"===i&&t in Ge&&(i=Ge[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),S.each(["height","width"],function(e,u){S.cssHooks[u]={get:function(e,t,n){if(t)return!Ue.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Je(e,u,n):Me(e,Ve,function(){return Je(e,u,n)})},set:function(e,t,n){var r,i=Re(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===S.css(e,"boxSizing",!1,i),s=n?Qe(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Qe(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=S.css(e,u)),Ye(0,t,s)}}}),S.cssHooks.marginLeft=Fe(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(We(e,"marginLeft"))||e.getBoundingClientRect().left-Me(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,o){S.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+o].set=Ye)}),S.fn.extend({css:function(e,t){return $(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Re(e),i=t.length;a<i;a++)o[t[a]]=S.css(e,t[a],!1,r);return o}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=Ke).prototype={constructor:Ke,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(S.cssNumber[n]?"":"px")},cur:function(){var e=Ke.propHooks[this.prop];return e&&e.get?e.get(this):Ke.propHooks._default.get(this)},run:function(e){var t,n=Ke.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ke.propHooks._default.set(this),this}}).init.prototype=Ke.prototype,(Ke.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=S.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[ze(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ke.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=Ke.prototype.init,S.fx.step={};var Ze,et,tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){et&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(ot):C.setTimeout(ot,S.fx.interval),S.fx.tick())}function at(){return C.setTimeout(function(){Ze=void 0}),Ze=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(o,e,t){var n,a,r=0,i=lt.prefilters.length,s=S.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=Ze||at(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:Ze||at(),duration:t.duration,tweens:[],createTween:function(e,t){var n=S.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=lt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(S._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return S.map(c,ut,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),S.fx.timer(S.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}S.Animation=S.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||S.style(e,r)}if((u=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=S.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=S.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===S.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)S.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),o=S.speed(e,n,r),a=function(){var e=lt(this,S.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&it.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,o=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(st(r,!0),e,t,n)}}),S.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(Ze=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),Ze=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){et||(et=!0,ot())},S.fx.stop=function(){et=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},tt=E.createElement("input"),nt=E.createElement("select").appendChild(E.createElement("option")),tt.type="checkbox",y.checkOn=""!==tt.value,y.optSelected=nt.selected,(tt=E.createElement("input")).value="t",tt.type="radio",y.radioValue="t"===tt.value;var ct,ft=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return $(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?S.prop(e,t,n):(1===o&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ft[t]||S.find.attr;ft[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ft[o],ft[o]=r,r=null!=a(e,t,n)?o:null,ft[o]=i),r}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}S.fn.extend({prop:function(e,t){return $(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(S.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,gt(this)))});if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,gt(this)))});if(!arguments.length)return this.attr("class","");if((e=vt(t)).length)while(n=this[u++])if(i=gt(n),r=1===n.nodeType&&" "+ht(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=ht(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,gt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=S(this),r=vt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=gt(this))&&Y.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Y.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ht(gt(n))+" ").indexOf(t))return!0;return!1}});var yt=/\r/g;S.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,S(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=S.map(t,function(e){return null==e?"":e+""})),(r=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=S.valHooks[t.type]||S.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(yt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:ht(S.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=S(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=S.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},y.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};S.extend(S.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,mt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),S.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,xt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,xt),S.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(r,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),y.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){S.event.simulate(r,e.target,S.event.fix(e))};S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var bt=C.location,wt={guid:Date.now()},Tt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(n,e,r,i){var t;if(Array.isArray(e))S.each(e,function(e,t){r||Ct.test(n)?i(n,t):At(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)At(n+"["+t+"]",e[t],r,i)}S.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=E.createElement("a");function It(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Wt(t,i,o,a){var s={},u=t===Pt;function l(e){var r;return s[e]=!0,S.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Ft(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&S.extend(!0,e,r),e}Mt.href=bt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,S.ajaxSettings),t):Ft(S.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=S.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?S(y):S.event,x=S.Deferred(),b=S.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=qt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||bt.href)+"").replace(Ht,bt.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(P)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Mt.protocol+"//"+Mt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=S.param(v.data,v.traditional)),Wt(Ot,v,t,T),h)return T;for(i in(g=S.event&&v.global)&&0==S.active++&&S.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Lt.test(v.type),f=v.url.replace(jt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Nt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Tt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Dt,"$1"),o=(Tt.test(f)?"&":"?")+"_="+wt.guid+++o),v.url=f+o),v.ifModified&&(S.lastModified[f]&&T.setRequestHeader("If-Modified-Since",S.lastModified[f]),S.etag[f]&&T.setRequestHeader("If-None-Match",S.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Rt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Wt(Pt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<S.inArray("script",v.dataTypes)&&S.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(S.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(S.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--S.active||S.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},$t=S.ajaxSettings.xhr();y.cors=!!$t&&"withCredentials"in $t,y.ajax=$t=!!$t,S.ajaxTransport(function(i){var o,a;if(y.cors||$t&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Bt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||S.expando+"_"+wt.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ut,"$1"+r):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||S.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?S(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,zt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((_t=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&S(o).remove(),S.merge([],i.childNodes)));var r,i,o},S.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=ht(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=S.css(e,"position"),c=S(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=S.css(e,"top"),u=S.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,S.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===S.css(e,"position"))e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;S.fn[t]=function(e){return $(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Fe(y.pixelPosition,function(e,t){if(t)return t=We(e,n),Pe.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,s){S.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){S.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return $(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},s,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Xt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||S.guid++,i},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=A,S.isFunction=m,S.isWindow=x,S.camelCase=X,S.type=w,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Xt,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return S});var Vt=C.jQuery,Gt=C.$;return S.noConflict=function(e){return C.$===S&&(C.$=Gt),e&&C.jQuery===S&&(C.jQuery=Vt),S},"undefined"==typeof e&&(C.jQuery=C.$=S),S});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}("undefined"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t="object"==typeof e&&"number"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return"string"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),"function"==typeof t?r=t:i(this.options,t),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */
(function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){"use strict";function b(a,b){return"undefined"==typeof b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function d(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement("a");g=g||b.name||"download",j.download=g,j.rel="noopener","string"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target="_blank")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,h){if(g=g||f.name||"download","string"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement("a");i.href=f,i.target="_blank",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open("","_blank"),g&&(g.document.title=g.document.body.innerText="downloading..."),"string"==typeof b)return c(b,d,e);var h="application/octet-stream"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&"undefined"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof module&&(module.exports=g)});
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:500000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url('data:application/octet-stream;base64,d09GRgABAAAAADLAAA8AAAAAWHgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY+IEkIY21hcAAAAdgAAAG8AAAF3rob9jFjdnQgAAADlAAAABMAAAAgBtX/BGZwZ20AAAOoAAAFkAAAC3CKkZBZZ2FzcAAACTgAAAAIAAAACAAAABBnbHlmAAAJQAAAI6gAADv+gJOpzGhlYWQAACzoAAAAMwAAADYY1IZaaGhlYQAALRwAAAAgAAAAJAfCBClobXR4AAAtPAAAAJEAAAFMBfb/0WxvY2EAAC3QAAAAqAAAAKhjiHI5bWF4cAAALngAAAAgAAAAIAFjDA9uYW1lAAAumAAAAY0AAAL94+zEpHBvc3QAADAoAAACHAAAA11cG/YjcHJlcAAAMkQAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZNZgnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4vGF4EMgf9z2KIYg5imAYUZgTJAQDSIQumAHic7dTVbltRAETR7dpNCikzQ8rMzMxt/M39mHnsU1/TfZz5jFpaV7pXJunMDLAZmOqaZjD5y4Tx+uPTyeL5lG2L5zN+L94zG8+ztr7ulXH1fra4bvK9M79xiWW2sNXPbWeFHexkF7vZw172sZ8DHOQQhznCUY5xnBOc5BSnOcNZVjnHeS5wkUtc5gpX/f3r3OAmt7jNHe5yj/s84CGPeMwTnvKM57zgJa94zRve8o73fOAjn/jMF77yje/84Ce/WGPun1zi/2tlXKbp3Xyc44bFyZanSWokJDXOOjXSk/LUSXn+pEwCKTNBaqQqZU5IjX+XMjukTBEp80TKZJEyY6RMGylzR8oEkjKLpEwlKfNJyqSSMrOkTC8pc0zKRJMy26RMOSnzTsrkk7IDpGwDKXtByoaQsiukbA0p+0PKJpGyU6RsFyl7RmosQcrukbKFpOwjKZtJyo6Ssq2k7C0pG0zKLpOy1aTsNymbTsrOk7L9pNwBUi4CKbeBlCtByr0g5XKQckNIuSak3BVSLgwpt4aUq0PK/SHlEpFyk0i5TqTcKVIuFim3i5QrRso9I+WykXLjXOYNzP8BuAPUwHicY2BAAxIQyBz0PwuEARJsA90AeJytVml300YUHXlJnIQsJQstamHExGmwRiZswYAJQbJjIF2crZWgixQ76b7xid/gX/Nk2nPoN35a7xsvJJC053Cak6N3583VzNtlElqS2AvrkZSbL8XU1iaN7DwJ6YZNy1F8KDt7IWWKyd8FURCtltq3HYdERCJQta6wRBD7HlmaZHzoUUbLtqRXTcotPekuW+NBvVXffho6yrE7oaRmM3RoPbIlVRhVokimPVLSpmWo+itJK7y/wsxXzVDCiE4iabwZxtBI3htntMpoNbbjKIpsstwoUiSa4UEUeZTVEufkigkMygfNkPLKpxHlw/yIrNijnFawS7bT/L4vead3OT+xX29RtuRAH8iO7ODsdCVfhFtbYdy0k+0oVBF213dCbNnsVP9mj/KaRgO3KzK90IxgqXyFECs/ocz+IVktnE/5kkejWrKRE0HrZU7sSz6B1uOIKXHNGFnQ3dEJEdT9kjMM9pg+Hvzx3imWCxMCeBzLekclnAgTKWFzNEnaMHJgJWWLKqn1rpg45XVaxFvCfu3a0ZfOaONQd2I8Ww8dWzlRyfFoUqeZTJ3aSc2jKQ2ilHQmeMyvAyg/oklebWM1iZVH0zhmxoREIgIt3EtTQSw7saQpBM2jGb25G6a5di1apMkD9dyj9/TmVri501PaDvSzRn9Wp2I62AvT6WnkL/Fp2uUiRen66Rl+TOJB1gIykS02w5SDB2/9DtLL15YchdcG2O7t8yuofdZE8KQB+xvQHk/VKQlMhZhViFZAYq1rWZbJ1awWqcjUd0OaVr6s0wSKchwXx76Mcf1fMzOWmBK+34nTsyMuPXPtSwjTHHybdT2a16nFcgFxZnlOp1mW7+s0x/IDneZZntfpCEtbp6MsP9RpgeVHOh1jeUELmnTfwZCLMOQCDpAwhKUDQ1hegiEsFQxhuQhDWBZhCMslGMLyYxjCchmGsLysZdXUU0nj2plYBmxCYGKOHrnMReVqKrlUQrtoVGpDnhJulVQUz6p/ZaBePPKGObAWSJfIml8xzpWPRuX41hUtbxo7V8Cx6m8fjvY58VLWi4U/Bf/V1lQlvWLNw5Or8BuGnmwnqjapeHRNl89VPbr+X1RUWAv0G0iFWCjKsmxwZyKEjzqdhmqglUPMbMw8tOt1y5qfw/03MUIWUP34NxQaC9yDTllJWe3grNXX27LcO4NyOBMsSTE38/pW+CIjs9J+kVnKno98HnAFjEpl2GoDrRW82ScxD5neJM8EcVtRNkja2M4EiQ0c84B5850EJmHqqg3kTuGGDfgFYW7BeSdconqjLIfuRezzKKT8W6fiRPaoaIzAs9kbYa/vQspvcQwkNPmlfgxUFaGpGDUV0DRSbqgGX8bZum1Cxg70Iyp2w7Ks4sPHFveVkm0ZhHykiNWjo5/WXqJOqtx+ZhSX752+BcEgNTF/e990cZDKu1rJMkdtA1O3GpVT15pD41WH6uZR9b3j7BM5a5puuiceel/TqtvBxVwssPZtDtJSJhfU9WGFDaLLxaVQ6mU0Se+4BxgWGNDvUIqN/6v62HyeK1WF0XEk307Ut9HnYAz8D9h/R/UD0Pdj6HINLs/3mhOfbvThbJmuohfrp+g3MGutuVm6BtzQdAPiIUetjrjKDXynBnF6pLkc6SHgY90V4gHAJoDF4BPdtYzmUwCj+Yw5PsDnzGHQZA6DLeYw2GbOGsAOcxjsMofBHnMYfMGcdYAvmcMgZA6DiDkMnjAnAHjKHAZfMYfB18xh8A1z7gN8yxwGMXMYJMxhsK/p1jDMLV7QXaC2QVWgA1NPWNzD4lBTZcj+jheG/b1BzP7BIKb+qOn2kPoTLwz1Z4OY+otBTP1V050h9TdeGOrvBjH1D4OY+ky/GMtlBr+MfJcKB5RdbD7n74n3D9vFQLkAAQAB//8AD3icrXsLcFzlleZ//v+++nb37dfte/VotVrdrW5JltuKpO6WJVluPyXbsmOEbGRjO4KVjWPZlsM4QIU4IYGlgCE2yxqKIQkJg2GreKQCTCZb1CZkiswjzOwOmSTATNVWTZLdDUwSMrVDsomD23vOf69assFAqgbk+773P4//nPOdc/5mwNjFl8WjosbaWblmxiOmIlTGYXzb11M7Z2ohAMbZCcZ5iG9prZl4whfwGju05xtttitUdwXYEUgkbQtWga5lC+XBaqJI285qpb8dVEc8Gnm5L5QM/f58yAlB399a7dD0mWAmdAqaMvBmKPKX9TdDwSjod9yhx03FAPcvI6Gk2lV33XoXUtKgL8C6Wa0WSzXbVjhg6JoqIPShCK0FOvOuE48K1V4B1VUQAVevugmP7Fz2CmTzW5/8+ZGP/+Kp7h/8oI4MuOZ7M5B9IvujH2Wf+PnCAjzn8ZK6AieMKRcvXnxWWSWCzGARlPcqtqs21WZzEBFgYIVDAYWzVJIrXBlH+hXGlWNM00GAJmYZ8sKBzTJFVZVppijqDFMVdTIWLa0o5JrdaHusPZGIG1IjFhQGK2mAZEe56kJnR1bTY7ZT7eivFGODBTdma3pHtlCNDVbwmgMHx/aO4R8ffeet5/ZCG6TfuV03IaSJU3oIzKsGO9+5PV+BwU5xqnOQx1aO8fW71yvD9fPn55/fA22PmsaFvfSgwZ8wzPiFvZ2DUMnzJ2hHVDMmHucPsSRrq7UQo4DMAV/AW7CANw/Zru3NIx20bBEpXwukArlxxOPReibaG63/SyQyiftzcBy3k1HuOHgjEgFHnkYfh4VodDJC4138Ff8hv5PlWbrWmm2O6grNEgGNCWGnbFtRm1Z04gzQPPWvkqMWF4eWU8DB267Df+gNe84bBvfRpfNI5Ny5yAmHDh5/PPLuByMlekDS9DsRR73nWHetwBShSO5PqCBQONO4E2wGlSvYZG6gMzeQ09SWFZC0tWION3oOVVXGTbGM+hrAzQj0O25yoN8R8YzzRsaZdzLwhpsGPEm783hAJ9+kq286eDX5pn/VydDjvk7i8EuchU21JJ3DNOqFzeABmywPcNXxhu/wB+3whrqwVw7Cn1j8vPfdDH6O7PR3fDV/Cb85wua/waSit309grZJHHOhHEQ9CA7zTGVCUb0ZvXzc1lrRe5Af+4An0aSL9op0IU9y6vRFtAYGKy7KJGFbQrdg2dXqGAwWilld0zUy9xLqd6A/zeFuy7gzYFmBOwOhZ6NNhZakm8YTI7S1pyM1mM032V26qevXGlzZ8+TKvROlB/BBkO9ACDalB7OZuBnuC5tRcAItpalENNOfhajVH1A2a1HjbHZ4N4r54oWLz4qPoe4jrMo2sonapm5QRQBQ3XycKVxwRRxjQuVCnWc6mrzOZ5FvBiraOmia5FubYRpok8n0ioRTKOQMNbWiszxYWAFZrQ1sB+dDJTFYghzyiBN3oB857ndIAha4Se/+YGUtjAkXXUO2xPE2eoe3TWPeMOXmzNi+j9w1HghvVbSAmu4c6nFac6MgbzXFU2baDr1241+98TfHtU/9t7df+MzU4msmfPYj06Wbw8Gqohda0/FkSyiyvtPGG/FsMKq1pLqmPvndkye/+y+08eYIHEJZpFmJra2Nop/VWuKcCwPvgRhnGlOFps6iIdAEmFVAKh53jblZyBU6nAFdbfX03tGwioZ9oGnEyDSWTQCyFzhoR+s/jdjgWLmc3L2K21zEmXCsM5aDm4g9Ny5v0PZVb+dY9Rcd/sl5eTiPj0nTaeiU+BhhW2qbuzJcUy2Nc2gCrjBkxWCqZiArGgOuwSzjAlDb5L91XfpvfYbpij6ZRIUWYoVcLqC2+UqNLddsMrekY3GZztVl2uQjpl4xjedIM+Uybc/r5viShuHgcgXuwQtpuoMHz8utCe/s8S+Y/7xMaYu2DX1yDrez3lp3cyyKdop+HLcLi878Uh9SKOSlj73cOIUFRVKVKHhaSS9JP452RCcYoJ3w85bz8Ckp9VN4xeZj9atpH4FnPCV4OtiDNIVYCrWwsbauK81VxUlaQnA+riFBisoUsiU0LbQpASCmmRAwg1MNJoH19uQ6WpriUV1jIQjphA5QjosiTfiy1tF+kPJKMTFYpAu6lkx40odnTv7VjYtC/QtTJyGH9HmMnKamGrcaqmaagRsMUwR9WeLmwsQREvIRevSvYa8uVFXo9Sc0w5A8/Rp5+jcxhXLuYAOIx/pbY+ggFp0FV8lNoLNAEQvyDkwBZR9T1ZC6xR0qFgsybix3DJcR7iIGwCsCHHQM0nYKVSBXQZPnqG7KDZiqrn8K524gpN9ghAx42k4GsvF3nohnA0kbnglkC9mrl7h4Db2TommKcVE1QOPRd97K5WJxsKO5nIjHbHtx/og3kK8iWys1he/EkKlqCbFOB6iKQp5Q5Yp6DB0AsjmPvHEFSGsoFraPaVpI2zLc2lmudErjJ/eeQwbKPoRBZulcwhwXYc6i1SdiEpiCF+KrFOIrAzKaHdhQ79tw4MAGuJv4rt8sQQu80jloGnnDfNVJBa+vn1WjSg1d8NHrg44FbTgdJ5+T77yy/gDI5wY7633yTbI7+CdyMDyEL2paDd0BvZjyfIYXH2/H+aqjDfXUisgnk3rFYMePoyZBegWanQpM5hKdlUSU1JnoQH2iG1d90IYADi0JPV2/oxMEeB7apm+aBngFw/ObMjzHzv7dgzyOh48fHZnmO9c8Wv+2RAGwHiP20UNnzx46mvYxyaMixDpZX22lQqQgRDqG4kYcMo92cpypAOo0Ti+iSYXJRGc5l8wvQhPfqpE0SYa7nDwkeQyh26OOlbecqVumoCwJ8+mDm+9/5T4eOyOt+4wk8WjavYTIG+7nD5Li2cWv8zGkMYoz51q2u3Y1JQSwfcumSn9JUxW0CZIWQ5isqKCo8zoGFPybx/lyHD2w4AaCBw7Ap1HIxAaHyZlr1tXG1owMt7h5Ox5QmxF4Iv6vDhaQoTFAYADuYIlnLa7b7RwtiOBDtVK1dbyCMXXxn5azOIIKfLFKaQP9K3HKIMYEQosvhkIWH23TQ9wIpCq9M4WxycnJsQIUYrEJ/bPGuOZohfHVzdmMaAmHm418c7DU3xdoyYPebFktPJtpHu7fefjw4R0VHiNTa06ZUTPe09a1sdTUVNrYtbo3nth11VW7tBa1d/U1a1t71rdG2u1IJNkWDYdbUs0pnnFT+OloWzISsdsjqVpvy9prqrNjed41POfPx2+J7TIXaWP5Wgf5bvToBEvpppQYOXPOJoda4gTQE6TsNK8sAvUSSHBFygfnfM9wL+8aK/Bddv0tZ8SufyKZ7ml7s20iCWdsPpPu4YVaXuur/2M6WX8riReTE21vtPUAnn4iyTxdf0vJ+/QM0pwsUL4D5BmUBQEeXpaU4W6RtExzN1In7eT9qHPpIoUdqAzSrdyHIPo1JNRps1uioCWJyIm2U/JG8oO4aZMXozF8b4RupRd5JJv7Nn8ZeUyxjlrakhJHcwO2gHMUDgGLR0MmS0GrIoMRWos0K81LUnPZYgmkw6sM8HtCoQTaT9y0Wu3f/MZuCYfijhMPhUVQNdL2hY8kMroS/8UvEqqeSfC/xzPV07k3vsqyrL+2ykYnhJjEz45OLIdbu4ncrbrWhImzltU7oqqaXAEdMWiHxPsSdvuF70K6/xf6FejjL13YBvFVP+UXrkwnyelZjBcltoLypQIoEmsoiDUw4C2QFS/I/J6yx5ybWOOqaMad0kJlKo+ElAdLqvRTMqOsgucuM64j3hgHU1H1mIkQ084Oje3eXT1lZwL1nwaD0BZMNfFTcHpv+sf7v6LEo4oZMlRbFNqH9tb60nEN0UkQ0mYawZNpR878eFuD1lWsl/Jb9J5iMbPlDKnkh3raBmS66U1M9Jm5rKUmMel1dKLOcxrVSgf5dJqU4o0g0pJyTlV37x4bytpCATOG8VUT4+m9cPoURiakE34ZMes/wbB0Roun+2p7h9oLSlwzQqZq2eIr+xe2/Rhp5QF8hHn5Hh/FfM9ibs32UrNG+l22ZbrnJ8N+fERAcD6YCp6nuPc2Aq/vWXiMfzKaye/BDfzTLPwe33MT8ns4P/y0uiLBdyZw3qRvNvGZegjF6H+escXvreOnkD7zm7IkADTbJEkU4sdw1jmwzpTj42smHLB82ijenjfx9YsXkccR+B5+I1azGtQk+4maTpnLlsBL75E7O1IPea+mzfPmUwQt00FJoG+nPxN/zruZzZprTljyx2GpXiHdYWBZtcINeB+2xVP16/GT9euDwf00TbqgK5gK7QvCmfp/wPn15WDa3BcM1l/Hy8F9wZQ31nf4Q2IjjrXyG+BnzXnMmqXiTuB5CLa01gINjvb8mesSTwHuSAEtzm8anp+uvwbdprkfhUs0wCNIxH6TP1l/vf6aPDThK0TXI5I+tjj+SX/8wIcaPxWX4y+CqsCiEIiAIzhsKrgfh+6qv+4L4RETPl6/zqMKukki9AA96OseZb3Zk7UKVKxZKt65tpR1J9p1sTGgP5Z4ah+KEzl73R/xEfr+I8H5fchlN/Jr0n0c3fSGkrz+vbhd5m2ZWltThDeKUaKh3WTZXWauS+WomBdMkjGvOCRuT9YfcIZxk0x24/5cT3q8redxe8TpTsLn03b9LIaFo/I0eQ7uxtjQm6rffI4elnTcJfbwX/qRFyG+Vw+SaJdyFIpugk0WXCcnaZFo1323viNAWHZPvk1+ugfjTf2sbcPR5LDT442bhwPj6Z5z9qi9wr8B85Ji51yXb3tISxlpSUtaZEYnFX8ZbHI6C8vk4ll2h5/YdRQbM0CUbSmXHsd5rH5zWz7fBnc/5iA1NLANwyQZ2+5JjiYfQ4mle+BxJA1prT9g+770dv4zTz9RnTPp+JlY4DJKoroOucmyT4fnsGIeFC3H9EtmB+qnGyP6413tPvs4BhIwipskDKakeIg+KKTgbl92JBkkHn1J3c8t+9ia2vBKhMFkGBJtEjrGDIzKE1SeAgTJiDAVRYpKmSGwMlksJor5gUWgjKlXYS0gurS4neaYflXJnaWBUjDKNAVhkWoF1WhHz7uJ2PapE8NHJkulySPD62/qVmLapMq10a997JqvnphQarc8dO3UQ2smYr38pfOWszK6fTs+eBKfHy4j8t2uWNrWnbDx5CNfe+TkxrHVE/EEW4ynxM9H2FhtpAeE2tnGFUH1J4xXChxD5hACLNXbLgOA3WU353rI37Y44SipbwdxwED/mEC0rOmuIzmlGkw7SBzNxZ6NN3519+zXRhV1Uosp3TdtGD68s4eXJo8uzHVtjyXc85gC9MYmRh+euuaRk+vhAG43Tm3RLGW7Clp52Oesq3N7dKVjnW9KxCdWjyFvi/nUs+Ja5CnPxtn+2t4NnVwLrELw76JqDMz1MacMGJoR0I5RVsA1lR/DLEdonLJLQWnOMcSamKlrszLnWWZ3mzcVOjsrnYWynTfVNmQ6aQFxrWtL9SQtgjqsojbxf5lp+qquSF1rVGyk02qZZEEKRkPdlv9ff3LVQ6MTFMas8xSft3fNVbd+vqg1KaF5w7RwBsirUye24UVXDS3oIcj/nz+56mF6qQlUAQ++gGoNytcxFG7P98DWMXMoHIL/6l/Z7p1riv8ko2oiyiru129WsSrmUjO1XdtWc0Pr7miOoWOV9YUQ07WQPmsCisWYDge5puAUAI3NIk6EQACmaQ+BGRaAwOSemV1TH90+vnlDrZBNFOi/nEUlLL96lYx5VZLqB5zDQLFQzGm6KuUX89L6YqxRuaPsCwXYTlJE1EVJt9ycWTo8bereoW7Wv38ewfOzmgI/N42Kn53LatjTxUCv85zbEyg+Y5hTcDddq99M2ysc8/51lABfjZ++8KvSxvUlnpCj7U+mIG3vR8yhXSbXEbaB3cDmatdds4lrhi9Z8hskNo2hkI+RQHWN6fMIUwKGFZiNhDmCNq6BoR1gejCoTzNdD86woB6cPDh33YFr91w99dHJLePr1tp525NylKZkzJtthLplN+ADzhOxjpiN1trRPwb/vhKfqIcMg8Mr3DDqd38o4cM36y9KWa+Tsn7v4/ocj134Vcg2TZsf/ABFKH4tYwrtObZYYxoF3QiQC+PjATwUho5+W8MkQlOOqUDxnlMNjZpsfB8zjJCxZe2afKeTjXeuboqT2XcOlsACB6XROFhWch7AeNy/VsZfx4fO5Aj8EjTVRPjLdtrmTS1NX7Azce6kmjZnnHf+1iuBiG0duzsmQTiZPzfjEoTGAqZ7xqt/nmmai8gXOWb0/sG9z8vyyPNOZjKDf9DlRgmQR93keVlHOU/9RTkfH8W8ieTQzWpsc21DGRM0Xw4soAUWDEDPtMB0oS9I5qeXC0PhMySPyTWjuYFctn9JEgWLp6FSXdz71TeSgzuQBmnXVHPXGqWhIhXkF+H2lQXxVqiSO5OthN9CQQSazmBOhdycwSgoZRJvQ28Yz8SVltDiwd3PUxMLN9De1dWehinH5783RvA9xhpyoHgnWAfGvE3sqtqOFT25rGIoMB4GBa0NAaepg2KYyiwVijQqFKGtopEeUFFYgQCboj0jZ8cCk7U1Q2W3MBBLjMRi0SCKxO0od6gD6Muon6Q35JGLDZS9DEpfLNZTA4aqrmrD0rwHCAO8Cs/Ur4a3J0Lql9WU4RfBJiYySfg+cviqaczLvipt59LuhbjXflPdSuRLUUd/9VV422jRv6SF/NbehYrcQ1p2AZ6jd80L5+kSRwE3WV+OVGTs9GvnU6yLDbJsrZ2aE+iijskqPtuHgTAktgz0r+xtaUaslZRRH6FKlRJrBwO9bK+lef8YXipg7j8GSJjM+GRPmSApRv6n//T4VrH3qqbRaNxoqoxSNMfwD6MV18yPulftrX+xZ7gXeka7vMCPgf2aQ8+N4bPuaKz7lg2LIGjjTT3x4T4jvubPYKL+cFtPTxscwm0DA+yVNaMjbFNt/cE9k+sUpoxgas8Gu1qjhG7GqUu+oAFel8B2gTDcgt+54If2XXv1VVsmVvRkM4m4TnnrYCGLtt5foc4F2rWO/NrIbxENvBHUy0WJBYqEg8hbyklAxoATvupfHMCZ3wAHaASEAFz/Y7pUPh+ZumWK7z65G1KGftgMJro0NbIzrOvbm1sCuhL9tBGKtrof1aLaZkdRjS4zYhzSDTDVw4bldnrPGtubWgKGiH0adR1JuR9VI/qErSgB72HMk0emp2+anr6F7kfTydZ+zdKSO0EdDRuTqaip3xAIjapaLa1aWqg/kmqNQEiXzza3ZFbqId3euezR4Iiqbkj5j7ZEIeTX7X4n9vLvLmKL2mAXILVUp0WPoyLCVJVGQ+/yNlGhjP8PNLq4y9vNy9rPrn+eW36OaPmdX0nTF7EIpu9XPlvW1XMgOiHbSHIL1ji1nsbpBdbAyXtlTRwjSHuCqyJvkjfAVEiMe317oeLEURlNKa/CI7tfVLxLp5qb4tFwUFVYJ3R6/STHqy1Xi1R9RLvvd6lSPIba14rZoo6zwa3w/7L18OGzRwC+N7B52+HD2zYPfA8OP3iIH9kyjkd4Fdwj9x85skUPzfXhQd9cSN96mB+97yjgoYUXvZ7kxYu/UW7mL7Eo+rwKK9byTKWsSWWz6N8VBaZxB5ShgDJZHerscm0J6L1at2fNGPH4CqQNZ+gAGTeaPZVNBB52IJ7nt/uI3N/B0707Do+8vmEH37rpdTLX8eEDd47Xr564Y3aIj+67azM8Q4dwYHjpHbJoOu1/8OkH++lk4s59Y2Lo+tsevG1ukA/N3uHb9f9TbkFebNRET61I/GEuOEtdCkxKcdfISpPptmSn01kdVNF4Y4NjHF1rWnh0cxWZKImsJdKcKPPIkZR5RIoYkcJ7dh665dDOHqV/4jgc2ILXkYz77zgwypGsH1zKst/L+ir6nJVsPdtR2zaC4aQTZC9CR4p0jigDQ6gmexJcUeeXdbS0xY7WslzDdpPF8uryAPX0L+tqoVNFD5QrFi7rbKGXwYnkJGCpwra4XMZe1th6JZcOCL0VgV445HepqL+l5jVdKMHP1VeH89a/WtYaK2/9Z/g4noyFYduzjf6WpSS0FIKDRovrC4aaQ9ZArQ9b1r/K58P0Yhi/4Msl4WPhFbUuzCTBb1OitsjmCVsAn+Qs3eokTJ1FeEQlI1nGXNlfnbS8tcc/sYz4wU8vsbd+lr/UII5u7mncOYBJ+WKc+5jsETe/L03AXCfmN4IlTVnCOYiVSxyWr5h45up7d/Lpu568c7ey4zRcu6yjzk9P3Xvu3im5qb9yaf98ab2AwZIsy0Zrq6nXxkG22zi121ScGiC71IoiZwcZqlAmzUCmvaU5GgkkzaQfoNCjlKimWnxvGhtR5b4r0roYFX59BZLFsvVB5NMRIVAGQ65bJoBsRuaFbLJM/0n3nZCLlZaWYKj+efWy88WezKv+yiG5dKnN23mX2uUJbi5bY+Rc4XgxBrHXGnlYb637gwLPEuXVBmD1ViiIyzgRfl5f9NddvfoB9NDxw0clWD9KV0FbdhMMjzfc+H7uJXEG8fo6Ns4O1q5fU+KCCq16PhXG3JuJcczFw6GwEaLSBXkQwNwF4DgLs1AgHDqA2FToAXEgCDpj+jTudDaDgUmnGsaG9bWx1UOVctJGzBlDf2HJWgZyh1HHkeV53RK5WC6Gc8fr45AzKSByxwlWHShTsxydSgfVLhALUZsXOiS8w0TlVOdJ006bC4ZayA43j7cN9WCqeCgYDTvGJzKnKG0Jn7ou6KSC18Frs8FUk2Jch1frv65/kWLdMMbf2fWfDKac4HFdaYpb8HY9ZDXZhnEylEgHP7t2L6YMcO46M22b111HA113zoFBDJQUpy/WLx6B36K+MxQdmlHBKerm0BIJKqUu68GgoLY0VSpexdChJiDC1WpC9qwK1cQYpS7U0BW0JAzeMrX6P+hRI2Dy4z/hqqmb4gS3jG8GLT77P1Ue5E4wfOFTFoioAS8NYVYZhv9umJapaPV6hct6wHdkHiowcqVYnvUivt5Qa+3vK/X2dBXy2Uy6pclBE4pR4XkwxWHTtq93vH+tv0l2U6pFvbNRePWrv51uBFbBWmgHbw/upXv+0LnRc1AxL/RjLrVgmvx/yP0Fq1KJxarV2A+PHct2HDvWwbvxJIYX60/THfzHrcdGH7shQm/iC2l6E/fXRumtaPU/ybeyx+p34UkVL0LJv9PAUHOomzL1w8q9uZaYoV3SIOoujHBKKii60eKMxhJHXUMgTQW0InVqqErq22AbYN6BHOMkFCMtlpWLDDc/0NM23tYLZ1uGMX5ZrWfPtkQj+chQ61lZiH+gZSiai0Sbz4JhDbeswXd2PSVr8E/twqtr8KXdu690Q2KpI6jHMMuhBjdRdbG9iQslEae6YVhDV7gBdOiHgK4iKtSERkv4yOpAP8ZMpimmNqtSRuUFG50FDD2AeaYRNrasGS0P2LTwuGDncpRJNtZ5Fpev85SVhMY6T3ewBJrtjAFIs8XZi95eSXOXLJkW75wKaXmE7afkst1TsjBDJxP3v3I//kG6Z9R+ce7WnfcfrvHRo6fPnT46CpteTMJZ7yXKMb2XTlHieMpspgUYLz+k3UsJV/LFTWNH7vvT08eHlfWHHtx+69yLSbZMRhHWhDn2SG0oYCC3qE/B0qAKuZqPg+b5XkErlwWmYkKlMkNY2eLmUAqF3OJinmKjrPIhuK1/W/IJ6z8kh5K1D2aK+/UTWqOzkz1fC4xVOgKKKqgjZqKV9nhTGGOgUGnZjiK4Mq8jJFKOMwJ0UxSLdlO/Ymvrtq8H3/UG+nBNcG0e7Vh79xt/yOf37KklDMPYaeyc3LZ1y8hwT671KoP8BApooL9agOqYUm2FATeRptTcdeQGxexmC3pWyw2u5ZSr4l9xsLCKW+DaaeqxVskXZql+XdTggY9NDrcHk331MoTzqZSj3fGlCe3GxJQT6IsGjeBkQOGQO53v+VKSb9E1EVMQ5vKs2/R7axiimWAmiVCh4/MZ1eYrecvvMWx9oa71KppmNkVhBs6G6m+veHkw8amOFi0QFY4pTI7RrikRxSd1jgBaCeytDEHmYSsUN/HTEEyqQVQ6ppY4937ER/nPmMXaWK6W8TvQy1cj+s28wcIlS70LHqQsSoS5rB18abP70ubwv0VMqrRhJALnb2SJXZ76vg7pAPc9++oF2+s8XzLyZUMt/3ajhy35encPGy4n+lIy4Xvvou1JERMJFmTa8zqHldSwlaBa9k6VC63heDzM/3cYttfndDMiKlbIwCN7eV2F8FS61toUNZhCzHltUoKChwg/yah6WVnr8jIXJer+ultoizj14CWn/GfvvEU5uIjTdtnx8nw86K1TlzWF5QsXBhYXGlw+3rLk/5IB/G8+gzZuYUagPa8ByoUaWfiRIuA35I4CrJOMVariLtOCaKD+Ryq3gvWTwSDci1AAfVtQi7zzsmWE4F5Vq/+RPKDe8714vX5SVSVGuXjxa2K/iCyN42qyOkbLkXwt6FIjmt5sRsHC11VB2yANZQl1HL+GWjFC9Em4Vx7Q2oKTeB2+oKkeL3xEkBU015zWlri4VEBrpICIlwZ7Eso2mgSVKs8GLeJN5YsLnmn7Lh7/45KS6ncSg5I/Por8NcaWi7UW27Te2JeyTGPqPg3VS9j2CzJyeznjn1qaGXCrpsq8ro655n7+1zi3WwkBRkGuRl5e3eMyi6L0TvDJcnYwTnM14fWG5Xyh5nXVLya56BmNJRUi25oYoiGRJBGXdaO+Rb1Y9R861mlZYzodsf21K8/wZ1mC8I75Hr9viTsF+fsW5BzxTSO1IFQNz6DJvnC/lPv9L6Ab4KcvfJU6gC94y9NfMP31s7i5XY5RIn6LJqKRxjAKDuOVppiQA65ycUhaEvVeQya8dVuF6uCYKClVFADVGd5FyGt9RTWAAgg50ahiNFm2YkcCarHv3QTW/6Jna0TY0VA0FEpnMkbciKJ0RGSrrMN/XzzKfy7p3saOsq21cUl7FVQ2Dboqxg8D38S4hnxooL2bGRU1qurqAtP1Q1M7xzd3Sd4MKlx9aN7cxtWq/1OQAi25ohrK0s0ilVHwbgmKVNGWD1T/IMmcmd2u68h5MhPsLpW6Mf7ZEUPfceC+0zfhdXy9uTm5cQffujnZrMQFzmZdv+n0HyDOnl33Z4RjOcFoIL338N50IIpBxBEd9+2+7fV+vGGHQ5Y18NCTDw1EwkITYRu/JwZe9fPMI+IfxFUsyjbSqvKhAcwt168pdedsTBbTzZxTnRzRxQyV/if8uggP8y2VcpqWw7iyTmgJOy3GuEu5oK35P5xC0L6GZFag308hopD9/6r3KyoE7rKG5Tqi3D9z8s6TM/3+7mEeeCxiPDanxdWDjxmRxwKIeebmVFVePajGtTl5VaWLcGDdLdMVpbTvxD0n9pWUyvQtew1RfioQFOU/1vU/Lotg4KmyMEz9nnuM2OINTVu8ETPuuUeXPuNZUcFYEmd9rFRbYSxfVUjLiN9dFerqyvd2yKWFBEEB548Fup3m1PWnBQHUERnjyKYur0O1v1pBfvl30u2Hnj4EwydOw/CBOyd23vd4+YefpuUbvHb84elmO9HXD1P3Tq1f48YM5VZ17msH5/d1fPtmWQndeOwTd1EnZNeXbtwsoBRbcbJ29T3T0GbGDO+3J95aen6KxViWDVCHL8i5wsPAxPLfE1FDb55RmQnmCYgrEoijOyX+6KeDoE66Tt5ONjkSgheKBA9LqL6qpqchU0E7QaSYtJ3+irSVimrrmpLJU3ej0gsK6vTRXbdlEXtnb9u17Z9B+Un9m9Hg5rmoE93YF4zCPwZ31H9b/6f6b3cEgzvAgAIYO4IwfMe64Q03nOX3fXzD8Lo7brzrLtiCz85tCkajwb6N0b9LJD738MOfSxTs2x7mj3yGsEgjzzBYB9Xw2hGCYAZOzYWG2uR6nFlvxlJeEZfO732ziNsX84be4ffMGz7/gRmQb1dyTX8Q/dtArU8Hb8Wybmgod53NBlQOilxbg9mPCIstK3sTAzE7O5BMJuTKkvJgwfulBskXM0CBMymXLQrpkSoDMVmJ6aA2QjGG4SJkRk38g5sd61dtYGoQ4St+jHY+U23r4aVWOEjtseoMnDgvfwCEm2+hp6r/X91AK4zYkU3HMVEaxnR3qBfqPzn+/wHPnsOreJxjYGRgYABi1vIsoXh+m68M3MwvgCIMt5YoxkDp2P9f/2exVDAHAbkcDEwgUQAz1Qu/AHicY2BkYGAO+p/FwMBS9v/r/68sFQxAERQQDACh8QbyeJxdT0sVwzAMy49AkAxAkbT3UQiAITGAISmAYQiA9th4ttUs7Q568UeSlVidiwSkB3PUPg+ESd6ZD/+8v7HyrtzwghY89ZB6BcyrYqc6RZhw48YhaA1Wc/v1PQtdeXJ/HppUmFM597nvBVK7D+Z+E8/uQZLBgDyaz3Llvxx02S3c/Hv813JrznryZP4F+6lSfQAAAAAAAAAAUAC2ATABaAGyAfoCJAKwAzYDmgQSBFwExgUyBbQF/AZOBvwHRAe2B/YISgigCPIJGglCCWQJignACgAKQAp2CroLAAtGC4oL8gxcDPINng5iDuYPag/6EF4RIBGGEeQSShKYEyQTbhOyFAoUYhS+FVoVphYoFooXHBeGGFoYnhjGGOwZChlOGXgZrBneGhwaWhqgGtIbLhvyHHQc2B1QHZ4d/wABAAAAUwBtAAYAAAAAAAIAIAAwAHMAAAB2C3AAAAAAeJx1kN9q2zAUh39q0441YxcbjN3tXJWWEcc1lEGvWkLbXZeSu8JUV/6T2VKQlY48w95ifYa9zt6jd/vFESUUYiP5O5/O8ZEE4AP+QWH9nHKsWeEdozXv4A0uIu/Sf488IN9G3sMQPyLv0/+MfICv+BV5iI/4wz+owVtGM/yNrPBZfYm8g/fqW+Rd+svIA/Jd5D18UovI+/S/Ix9gqp4iD3GoniduvvR1WQU5mhxLlmap3C/FUdVWN6IXoXK+k3MpnA2maVySuza0ZlToUZ07292YctFov6k2eWp8VzsrJ0m6qa+NNV4H87Dq1j2WWQiFFN61chX7yNy7mclDUoUwPxuPN/tjAoc5lvCoUaJCgOCI9pjfDGk/BPfMEGaus2pYaDQ0GgtWVP1Kx/ico2BkaQ0zGnKCnHNL09KNuK451721rLqhLfmfht5vzdrmp7Sr3nUfC07YL92afU1r+wrd7/Dh5WwdHrmLjDawanUK3+9acPXqPML7Wq3NaHL6pL+1QHuGMd8t5/8PvPGO3QAAAHicbZLnlpswEIV9DRiwvZtseu89Ib333vvmBWRZYMVC0pHEEufpg8BO/kTncOfTaLgMOtPr97o17P1/baKPACEiDBAjQYohRhhjDevYhu3YwA7sxC7sxh7sxT7sxwEcxCEcxhEcxTEcxwmcxCmcxhmcxTmcxwVcxCVkuIwruIpruI4buIlbuI07uIt7uI8HeIhHeIwneIpneI4XeIlXeI03eIt3eI8P+IhP+Iwv+Ipv+I5N/OiF1hEz9JKxUrtFrDl1lWF9NR9QIikToRaVjUouKxvOmNBjLxnlhgo2DbnM1djLKrNGnGPScSUzItzGv93yPP2bSQSX84z9cqFQdJ56yZRmMhW8mLlJJSaBI0XYPDaZKDUviZmvr6DrNjJMi0WcK1MTM02mqpbZlJtEsNx5SI238jSodJtoS7qv+BpPw67IY9xU+dg5TXjROTWwdGrIOzWhT+uA0jolxqjaZrSOnCF2Nmq16651EYpMm1fakAul9SJQeR5QVYQlk1VkZ8SwoVNFIVjWnKQrlBGdMToftdoZjrs77DajqXKrS02YEFxbbtdWkG0x44JJVUS5aBqKSlJwmhDrmOF2Hv9Wqsy4TNqoKhfmSrrQKuNSL5nvPG6p0s0AkEWkSWVZMy1Kx3ljk03qLuZ14lTmB8gNGmByGrGfjLrhlhJV2f7SaIneNF1ypQNbybBUSgZswQaWEUNngeay1/sD4l/60HicY/DewXAiKGIjI2Nf5AbGnRwMHAzJBRsZWJ02MTAyaIEYm7mYGDkgLD4GMIvNaRfTAaA0J5DN7rSLwQHCZmZw2ajC2BEYscGhI2Ijc4rLRjUQbxdHAwMji0NHckgESEkkEGzmYWLk0drB+L91A0vvRiYGFwAMdiP0AAA=') format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-webkit-transition:none!important;-o-transition:none!important;transition:none!important}:-webkit-full-screen{height:100%;width:100%}:-ms-fullscreen{height:100%;width:100%}:fullscreen{height:100%;width:100%}body::-ms-backdrop{background:0 0}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111;overflow:auto}a{cursor:pointer;color:#68d;text-decoration:none;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0\00a0"}[data-icon-after]:after{content:"\00a0\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}@media (prefers-reduced-motion:reduce){.passage{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}</style>
<style id="style-core-macro" type="text/css">@-webkit-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes cursor-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-webkit-transition:opacity .4s ease-in;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}.macro-type-cursor:after{-webkit-animation:cursor-blink 1s infinite;-o-animation:cursor-blink 1s infinite;animation:cursor-blink 1s infinite;content:"\2590";opacity:1}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-webkit-transition:visibility .2s step-end,opacity .2s ease-in;-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-webkit-transition:opacity .2s ease-in;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{-webkit-box-sizing:border-box;box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}@media (prefers-reduced-motion:reduce){#ui-overlay.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-overlay:not(.open){-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}#ui-dialog.open{-webkit-transition:opacity 0s;-o-transition:opacity 0s;transition:opacity 0s}}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-webkit-transition:margin-left .2s ease-in;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-webkit-transition:left .2s ease-in;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-webkit-transition:visibility .2s step-end;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}@media (prefers-reduced-motion:reduce){#story{-webkit-transition:margin-left 0s;-o-transition:margin-left 0s;transition:margin-left 0s}#ui-bar{-webkit-transition:left 0s;-o-transition:left 0s;transition:left 0s}}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons!important;font-style:normal;font-weight:900;font-variant:normal;line-height:1;speak:never;text-rendering:auto;text-transform:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript must be enabled to play.</noscript></div>
		<div id="init-lacking"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<!-- UUID://68BE25DE-5D15-41E0-9742-697E02B66E82// --><tw-storydata name="Fanthira Tales: wRight on cue" startnode="93" creator="Tweego" creator-version="2.1.1+81d1d71" ifid="68BE25DE-5D15-41E0-9742-697E02B66E82" zoom="0.6" format="SugarCube" format-version="2.36.1" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* twine-user-stylesheet #1: "_fonts.css" */
@font-face {
	font-family: VT323;
  	src: url("fonts/VT323-Regular.ttf");
}

@font-face {
	font-family: Stgotic;
  	src: url("fonts/Stgotic-W00-Regular.ttf");
}

@font-face {
	font-family: SUPERSCR;
  	src: url("fonts/SUPERSCR.TTF");
}




/* tw-passage { //CODE FOR CHANGING FONT FAMILY through all game
	font-family: Verdana, Arial, sans-serif;
   } */
/* twine-user-stylesheet #2: "_initial.css" */
:root {
	--quest-color: #ffdd40;
	--task-color: #009CCF;
    --green: #90ee90 !important;
	--green-t6: #2ade2a !important;	
    --black: #111;
	--red: red;
}

body, tw-story {
    color: #BBBBBB;  
  	font-family: serif;
}


p, h1, h2, h3, h4, h5, h6, span, a, button, input{
  	margin: 0;
	font-family: 'VT323';
}

p, span, a, button, input {
	font-size: 1.125rem;
}

small *{
	font-size: 1rem;
}

.flx-c {
	display: flex;
	align-items: center;
	justify-content: center;
}

#ui-dialog.open {
  	min-width: 500px;
}

#menu {
  	margin-bottom: 20px;
}

#saves-list > tbody > tr:first-child  {
	border-bottom: 10px solid transparent;
}

#passages {
	max-width: initial; 
   	margin: 0;
}

#passages >*:not(.constructor) {
	margin-left: 25px;

}

a.link-external:after {
	content: ""
}

/* @media only screen and (min-width: 1367px) {
	#passages {
	 	max-width: max-content; 
		margin: 0;
	}
} */

/* @media only screen and (min-width: 1600px) {
	#passages {
	 	max-width: fit-content; 
	}
} */
 
#ui-bar {
    width: 20em;
}

img {
    width: 85%;
    max-width: 600px;
    max-height: 300px;
}

@media only screen and (min-width: 1367px) {
    img {
        max-width: 750px;
        max-height: 360px;
    }
}

img#story{
    width:100%;
    height:auto;
}

#story-title {
    margin: 14px auto;
    width: 200px;
    line-height: 24px;
    color: var(--green);
}

.story-title,
.story-title * {
    line-height: 24px !important;
    color: var(--green) !important;
}

#story {
	margin-left: calc(20em + 20px);
}

#ui-bar.stowed~#story {
    margin-left: calc(4.5em + 20px);
}


body.nosave #menu-item-saves {
  	display: none;
}


.link-unavailable {
	color: grey;
}

.link-unavailable:hover {
	text-decoration: none;
	cursor: default;
	color: grey;
}

.sidebar-signature {
	margin: 0 auto !important;
}



/* 
tw-link:before {
    content: «[»;
}

tw-link:after {
    content: «]»;
} */
/* twine-user-stylesheet #3: "bars.css" */
.progress-bar {
    width: 100%;
  	background-color: #000;
  	height: 8px;
    border-radius: 3px;
}

.progress-bar-line {
  	display: block;
  	height: 8px;
    border-radius: 3px;
  	z-index: 1;
}

.progress-bar-container {
	display: block;
	position: relative;
    padding-bottom: 16px;
	padding-top: 20px;
	margin-bottom: 4px;
}


.progress-bar-container .sidebar__numbers {
	position: absolute;
    bottom: 0px;
    right: 2px;
    font-size: 0.4rem;
}


.progress-bar-container .sidebar__text {
	position: absolute;
    top: -6px;
    left: 42px;
	color: #ccc;
	font-size: 1rem;
}
/* twine-user-stylesheet #4: "button_apply.css" */


.custom-btn {    
    margin: 20px;
    outline: none;
    width: 130px;
    height: 40px;
    padding: 10px 25px;
    border: 2px solid #000;
    font-weight: 500;
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: inline-block;

    font-family: 'VT323', monospace;    
    font-size: 20px;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.custom-btn:hover {
    background: transparent;
    color: #000;
    border-color: #000;
}


.btn-apply {
    line-height: 39px;
    padding: 0;
    margin: 0;
    margin-top: 10px;
    width: fit-content; 
    box-shadow: 2px 4px 20px 5px #1b2042;
    height: auto;
}

.btn-apply p,
.btn-apply span {
    padding: 0 1.5rem;
    font-size: 1.5rem;
    font-style: normal;
}

.btn-apply:hover{
    background-color: transparent;
    background-color: #fff;
    color: #000;
    box-shadow: 2px 4px 20px 5px #fff;
}
.btn-apply a {
    position: relative;
    display: block;
    width: 100%;
    height: 100%;
}
.btn-apply:before,
.btn-apply:after {
    position: absolute;
    content: "";
    left: 0;
    top: 0;
    background: #000;
    transition: all 0.3s ease;
}
.btn-apply:before {
    height: 0%;
    width: 2px;
}
.btn-apply:after {
    width: 0%;
    height: 2px;
}
.btn-apply:hover:before {
    height: 100%;
}
.btn-apply:hover:after {
    width: 100%;
}
.btn-apply a:before,
.btn-apply a:after {
    position: absolute;
    content: "";
    right: 0;
    bottom: 0;
    background: #000;
    transition: all 0.3s ease;
}
.btn-apply a:before {
    width: 2px;
    height: 0%;
}
.btn-apply a:after {
    width: 0%;
    height: 2px;
}
.btn-apply a:hover:before {
    height: 100%;
}
.btn-apply a:hover:after {
    width: 100%;
}



.buttons_container {
    display: flex;
    align-items: center;
}

.buttons_container__end {
    display: flex;
    align-items: center;
    justify-content: flex-end;
}


/* twine-user-stylesheet #5: "characters.css" */
.npc_text {
    font-weight: bold;
    font-size: 20px;
    text-decoration: underline;
    color: #ddd;
    letter-spacing: 0.5px;
}


.mc {
    color: #c5eff7;
}

.mc *{
    color: #c5eff7;
}


.melissa {
    color: #e97d7d;
}

.alura {
    color: #c7b1d2;
}

.barret {
    color: #002bffd6;
}

.savia {
    color: #ffffcc;
}

.witch {
    color: darkslateblue;
}

.father {
    color: blue;
}

.mother {
    color: brown;
}

.sekhmau {
    color: #e6ccb3;
}

.lazar {
    color: grey;
}

.odo {
    color: grey;
}
/* twine-user-stylesheet #6: "constructor_table.css" */
.constructor-table {
    width: 100%;
    display: table;
    width: 100%;
    border: 1px solid blue;
    border-collapse: collapse;
    table-layout: fixed;
    overflow-wrap: break-word;
}


.constructor-table th {
    border: 2px solid blue; 
    background-color: white;
    text-transform: capitalize;
    text-align: left;
    vertical-align: middle;
    padding: 0 10px;
}

.constructor-table__port-cell {
    width: 150px;
}

.constructor-table td {
    border: 2px solid blue; 
    text-align: center;
    vertical-align: middle;
}


.localization-table__textarea {
    resize: both;
    min-width: 160px;
    font-size: 14px;
    min-height: 60px;
}

input[type=text].localization-table__input {
    width: 230px;
    width: -moz-fit-content;
    width: -webkit-fit-content;
    width: fit-content;
    min-width: 230px;
    /* min-width: -moz-fit-content; */
    /* min-width: -webkit-fit-content; */
    /* min-width: fit-content; */
}

th.localization-table__header-idn {
    width: 240px;
}

.localization-table__header-remove {
    width: 60px;
}

.localization-table__input--temp {    
    color: grey;
    outline: 2px solid red;
}

.localization-table__textarea--empty {
    outline: 3px dashed orange;
}

.form-tip {
    margin-top: 6px;
    font-size: 12px;
    font-style: italic;
}

.search-container {
    margin-top: 20px;
    width: fit-content;
}

.search-container input[type=search] {
    min-width: 300px;
}
/* twine-user-stylesheet #7: "dialog.css" */

.speech__character-image:hover {
    z-index: 44;
}


.speech__name {
    width: fit-content;
    font-weight: bold;
    text-transform: capitalize;
}

.speech__container.speech-style--0 {
    display: flex;
    color: white;
    position: relative;
    background-color: #222222;
    border: 2px solid white;
    border-radius: 5px;
    padding: 8px;
    box-shadow: 5px 5px 3px black;
    margin-bottom: 5px;
    min-height: 94px;
    cursor: default;
}

.speech-style--0 .speech__character-image {
    display: block;
    position: absolute;
    height: 92px;
    width: 92px;
    float: left;
    margin-right: 10px;
    border: 2px solid white;
    border-radius: 5px;
}

.speech-style--0 .speech__character-image:hover {
    transform: scale(2); 
    left: 24px;
    top: 12px;
    height: auto;
}

.speech-style--0 .speech__image-placeholder {
    display: block;
    height: 92px;
    width: 92px;
    float: left;
    margin-right: 10px;
}

.speech-style--0 .speech__name {
    font-size: 20px;
}

.speech-style--0 hr {
    margin: .5em 0;
}






.speech__container.speech-style--1 {
    display: block;
    position: relative;
    color: white;
    background-color: #222222;
    border: 2px solid white;
    border-radius: 5px;
    padding: 0 8px;
    box-shadow: 5px 5px 3px black;
    margin-bottom: 5px;
    min-height: 76px;
    cursor: default;
}

.speech-style--1 .speech__character-image {
    display: block;
    position: absolute;
    top: -30px;
    left: -15px;
    height: 92px;
    width: 92px;
    min-height: 92px;
    min-width: 92px;
    margin-right: 10px;
    border: 2px solid white;
    border-radius: 50%;
}

.speech-style--1 .speech__character-image:hover {
    transform: scale(3); 
    height: auto;
    width: auto;
    z-index: 3;
    position: absolute;
    top: 14px;
    left: 60px;
    max-height: 70px;
    border-radius: 10px;
}

.speech-style--1 .speech__name {
    font-size: 20px;
    margin-top: -4px;
    margin-bottom: -4px;
    padding-left: calc(73px + 10px);
}

.speech-style--1 .speech__line {
    margin: 0;
}

.speech-style--1 .speech__image-placeholder {
    display: block;
    height: 58px;
    width: 62px;
    float: left;
    margin-right: 10px;
}

.speech-style--1 .speech__text {
    padding: 2px 0 6px;
}
/* twine-user-stylesheet #8: "fight.css" */
#passage-fight {
    margin-right: -2em;
}

.fight__area {
    display: flex;
    justify-content: space-between;
    width: 100%;
}

/* .fight__area p {
    margin: 0;
} */

.fight__side {
    width: 374px;
    flex-flow: column nowrap;
}

.fight__participant {
    display: flex;
    position: relative;
    border: 2px solid white;
    margin-bottom: 10px;
    user-select: none;
    min-height: 140px;
    /* box-shadow: 10px 5px 5px red; */
    /* padding: 8px 15px 12px; */
}

.fight__participant--hero {
    border: 2px solid green;
}

.fight__participant--enemy {
    border: 2px solid red;    
    cursor: not-allowed;
}

.fight__participant--available {
    border: 8px solid red;    
    cursor: pointer;    
}


.fight__participant--out {
    border-color: grey;
}

.fight__participant--out > .fight__participant-out-image {
    display: block !important;
}

.fight__participant.fight__participant--target {
    border: 10px solid blue;
    cursor: progress;
}

.fight__participant-image {
    max-width: 100px;
    max-height: 100px;
}

.fight__participant-info {
    display: flex;
    flex-direction: column;
    padding-left: 8px;
    padding-right: 12px;
    width: 100%;
}

.fight__participant-info-header {
    display: flex;
    align-items: center;
    width: 100%;
    justify-content: space-between;
}

.fight__participant-name {
    font-weight: bold;
    text-transform: capitalize;
    font-size: 18px;
}

.fight__participant-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    margin-top: 8px;
}

.fight__participant--animation {
    animation-name: attack;
    animation-duration: 2s;
}

@keyframes attack {
    from {
        box-shadow: none;
    }
    to {
        box-shadow: rgba(255, 0, 0, 0.4) -5px 5px, rgba(255, 0, 0, 0.3) -10px 10px, rgba(255, 0, 0, 0.2) -15px 15px, rgba(255, 0, 0, 0.1) -20px 20px, rgba(255, 0, 0, 0.05) -25px 25px;
    }
}

.fight__participant-out-image {
    display: none;
    position: absolute;
    width: 138px;
    left: 2px;
}


.fight__action-block {
    display: none;
}

#heroTurn {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;    
    gap: 30px 0;
    width: 60%;
}

#heroTurn > button {
    width: 140px;
    height: 40px;
    padding: 0 10px;
}
/* twine-user-stylesheet #9: "form.css" */

.form-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0 0;
    margin: 0;
}

.form-block > label {
    font-size: 20px;
    font-weight: bold;
    margin-top: 15px;
}

.form-block-section-wrapper > .form-blocks-row > .form-block:first-child > label  {
    margin-top: 5px;
}

.form-block > input {
    min-width: 260px;
}

.form-block .form-block__input--small {
    min-width: unset;
    width: 60px;
}

.form-block .form-block__input--large {
    min-width: unset;
    width: 400px;
}

.form-block > select {
    min-width: 120px;
}

.form-block > textarea {
    min-height: 120px;
    min-width: 28rem;
    resize: both;
}

.form-row {
    display: flex;
    align-items: baseline;
    gap: 0 20px;
    margin-bottom: 10px;
    justify-content: flex-start;
}

.form-blocks-row {
    display: flex;
    gap: 0 20px;
    flex-wrap: wrap;
    flex-direction: row;
}

.form-blocks-row input[type="number"] {
    min-width: 60px;
    width: 60px;
    -moz-appearance: textfield;
}

.form-blocks-row input[type="number"]::-webkit-outer-spin-button,
.form-blocks-row input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.form-blocks-row--once {
    width: 100%;
}

.form-blocks-row--borderline {
    width: 100%;
    padding-bottom: 10px;
    border-bottom: 1px solid #fff;
    align-items: center;
}

.form-block-section {
    margin-bottom: 25px;
    position: relative;
}

.form-block-section-wrapper {
    padding: 0 40px;
    border: 1px solid #fff;
    border-top: none; 
    position:relative;
    overflow:hidden;
    padding-bottom: 20px;
}

.form-block-section-wrapper:after {
    content: "";
    position:absolute;
    right: 0;
    margin:-20px;
    width:50px;
    height:70px;
    transform:rotate(45deg);
    background-color:transparent; 
    box-shadow: 0 0 0 30px #fff;
}

.form-block-section-wrapper--small {
    min-width: 600px;
    margin-bottom: -20px;
}

.form-block-section-wrapper--small:after {
    bottom: 0px;
    margin: -32px;
    box-shadow: 0 0 0 20px #fff;
}

.form-block-section__header {
    cursor: pointer;
    overflow: hidden;
    text-align: left;
    margin-bottom: -8px;
}

.form-block-section__header:after {
    background-color: #fff;
    content: "";
    display: inline-block;
    height: 1px;
    position: relative;
    vertical-align: middle;
    width: 100%;
    
}

.form-block-section__header:after {
    left: 15px;
    margin-right: -50%;
}


.form-block-section__header:hover {
    color: blue;
    text-decoration: underline;
}


.form_add {
    min-width: 80px;
    margin-top: 20px;
    margin-bottom: 5px;
    height: 34px;
}

.form_remove {
    align-self: flex-end;
    background-color: red;     
    padding: 6px 10px 6px;
    font-size: 12px; 
    white-space: nowrap;
}

.form_remove:hover {
    background-color:#8b0000;
}

.form_remove--left {
    float: right;
    margin-top: 10px;
}

.form-save {
    display: flex;
    margin-top: 100px;
    padding: 10px 30px;
    margin-left: auto;
    font-size: 18px;
}



.type-select__block {
    display: none;
}

#subjects_list_block {
    display: none;
}

.type-select__block[style*='display: block'],
#subjects_list_block[style*='display: block'] {
    display: flex !important;
}

.type-select__block > input[type=radio] ~ label {
    padding-left: 8px;
    font-size: 16px;
}

.add_task {
    margin-left: 20px;
    align-self: end;
    max-height: 30px;
}




#constructor-table__container {
    display: flex;
    flex-direction: column;
}

.constructor-table__add-btn {
    width: 100px;
    color: #fff ;
}

.constructor-table__header {
    display:flex; 
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 30px;
    margin-top: 20px;
}
/* twine-user-stylesheet #10: "general.css" */


.deadend *{
    color: red;
    font-size: 100px;
    text-transform: uppercase;
    font-weight: bold;
    cursor: default;
    font-family: 'VT323';
    letter-spacing: 2px;
    margin-top: -12px;
    margin-bottom: -12px;
}



.text__small {
    font-size: 12px;
}

.text__large {
    font-size: 20px;
}


.text__large-bold {
    font-size: 20px;
    font-weight: bold;
}

.footer__location {
    margin-top: 30px;
}


.passage-list > *:last-child {
    margin-bottom: 20px;
}
/* twine-user-stylesheet #11: "images.css" */

.location-image { 
    display: block;
    width: auto;
    height: auto;
    min-width: 320px;
    max-width: 80%;
    max-height: 320px;
    border-radius: 2px;
    border: 2px solid #444;
}

.location-image.location-image--mirror {
    min-width: auto;
    max-width: 220px;
    max-height: none;
}
/* twine-user-stylesheet #12: "index.css" */
.disclaimer-header *{
    font-size: 72px;
    font-weight: bold;
    color: #fff;
    font-family: sans-serif;
}

.disclaimer-title *{
    display: inline-block;
    font-size: 1.625rem;
    color: #fff;
    font-style: italic;
    font-family: sans-serif;
}

.disclaimer-subtitle *{ 
    color: rgb(255 255 255 / 90%);
    font-size: 1.25rem;
    font-family: sans-serif;
}
/* twine-user-stylesheet #13: "interface description.css" */
.interface-desc__image {
    width: auto;
    border: 1px solid #fff;
}
/* twine-user-stylesheet #14: "inventory.css" */

.table-items {
    display: table;
    width: 100%;
    border: 1px solid green;
    border-collapse: collapse;
    table-layout: fixed;
    overflow-wrap: break-word;
}

.table-items th {
    border: 2px solid green; 
    background-color: white;
    text-transform: capitalize;
    text-align: left;
    vertical-align: middle;
    padding: 0 10px;
}

.table-items td {
    border: 2px solid green; 
    text-align: center;
    vertical-align: middle;
}

.table-items__image {
    width: 80px;
}
/* twine-user-stylesheet #15: "levels.css" */
.level-container {
    display: flex;
  	align-items: center;
  	gap: 4px;
}

.level-line {
    width: 100%;
    position: relative;
}

#level-bar {
    background-color: #87cefa;
}

.level-info {
    margin-bottom: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
}

.level-info-next {
    position: absolute;
    top: 36px;
    right: -4px;
    display: flex;
    gap: 6px;
    align-items: center;
}

.level-round {
  	padding: 4px;
    min-width: 30px;
    height: 30px;
    background-color: #377094;
    color: white;
    border-radius: 50%;
    text-align: center;
    font-family: sans-serif;
    font-size: 20px;
}

.level-round--next {
    background-color: #e99d00;
}

#next-level.lvl-animate {
	  background-color: red;
	  margin-top: 20px;
    transform: translateX(-250%) scale(2);
    transition-property: all;
    transition-duration: 1s;    
}

#next-level.lvl-animate-2 {
	  background-color: #377094;
    transform: translateX(calc(13px - 500%)) scale(1);
    transition-property: all;
    transition-duration: 1s;    
}
/* twine-user-stylesheet #16: "rpg-awesome.css" */
@charset "UTF-8";
/*!
 * RPG Awesome 0.0.2 by Daniela Howe, Ivan Montiel
 * License - https://github.com/nagoshiashumari/Rpg-Awesome/blob/master/LICENSE.md
 * (Font: SIL OFL 1.1, CSS: MIT License)
 */
/* FONT PATH
 * -------------------------- */
@font-face {
  font-family: 'RPGAwesome';
  src: url("fonts/rpgawesome-webfont.eot?v=0.1.0");
  src: url("fonts/rpgawesome-webfont.eot?#iefix&v=0.1.0") format("embedded-opentype"), 
      url("fonts/rpgawesome-webfont.woff?v=0.1.0") format("woff"), 
      url("fonts/rpgawesome-webfont.ttf?v=0.1.0") format("truetype"), 
      url("fonts/rpgawesome-webfont.svg?v=0.1.0#rpg-awesome") format("svg");
  font-weight: normal;
  font-style: normal;
}

.ra {
  font-family: RPGAwesome;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-style: normal;
  font-variant: normal;
  font-weight: normal;
  line-height: 1;
  speak: none;
  text-transform: none;
}

/* makes the font 33% larger relative to the icon container */
.ra-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -15%;
}

.ra-2x {
  font-size: 2em;
}

.ra-3x {
  font-size: 3em;
}

.ra-4x {
  font-size: 4em;
}

.ra-5x {
  font-size: 5em;
}

.ra-fw {
  text-align: center;
  width: 1.2857142857em;
}

.ra-ul {
  list-style-type: none;
  margin-left: 2.1428571429em;
  padding-left: 0;
}
.ra-ul > li {
  position: relative;
}

.ra-li {
  left: -2.1428571429em;
  position: absolute;
  text-align: center;
  top: 0.1428571429em;
  width: 2.1428571429em;
}
.ra-li.ra-lg {
  left: -1.8571428571em;
}

.ra-border {
  border: solid 0.08em #eee;
  border-radius: .1em;
  padding: .2em .25em .15em;
}

.pull-right {
  float: right;
}

.pull-left {
  float: left;
}

.ra.pull-left {
  margin-right: .3em;
}
.ra.pull-right {
  margin-left: .3em;
}

.ra-spin {
  -webkit-animation: ra-spin 2s infinite linear;
  animation: ra-spin 2s infinite linear;
}

@-webkit-keyframes ra-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
@keyframes ra-spin {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(359deg);
    transform: rotate(359deg);
  }
}
.ra-rotate-90 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);
  -webkit-transform: rotate(90deg);
  -ms-transform: rotate(90deg);
  transform: rotate(90deg);
}

.ra-rotate-180 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=2);
  -webkit-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  transform: rotate(180deg);
}

.ra-rotate-270 {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
  -webkit-transform: rotate(270deg);
  -ms-transform: rotate(270deg);
  transform: rotate(270deg);
}

.ra-flip-horizontal {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=0);
  -webkit-transform: scale(-1, 1);
  -ms-transform: scale(-1, 1);
  transform: scale(-1, 1);
}

.ra-flip-vertical {
  filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=2);
  -webkit-transform: scale(1, -1);
  -ms-transform: scale(1, -1);
  transform: scale(1, -1);
}

:root .ra-rotate-90,
:root .ra-rotate-180,
:root .ra-rotate-270,
:root .ra-flip-horizontal,
:root .ra-flip-vertical {
  filter: none;
}

.ra-stack {
  display: inline-block;
  height: 2em;
  line-height: 2em;
  position: relative;
  vertical-align: middle;
  width: 2em;
}

.ra-stack-1x, .ra-stack-2x {
  left: 0;
  position: absolute;
  text-align: center;
  width: 100%;
}

.ra-stack-1x {
  line-height: inherit;
}

.ra-stack-2x {
  font-size: 2em;
}

.ra-inverse {
  color: #fff;
}

.ra-acid:before {
  content: "";
}

.ra-zigzag-leaf:before {
  content: "";
}

.ra-archer:before {
  content: "";
}

.ra-archery-target:before {
  content: "";
}

.ra-arena:before {
  content: "";
}

.ra-aries:before {
  content: "";
}

.ra-arrow-cluster:before {
  content: "";
}

.ra-arrow-flights:before {
  content: "";
}

.ra-arson:before {
  content: "";
}

.ra-aura:before {
  content: "";
}

.ra-aware:before {
  content: "";
}

.ra-axe:before {
  content: "";
}

.ra-axe-swing:before {
  content: "";
}

.ra-ball:before {
  content: "";
}

.ra-barbed-arrow:before {
  content: "";
}

.ra-barrier:before {
  content: "";
}

.ra-bat-sword:before {
  content: "";
}

.ra-battered-axe:before {
  content: "";
}

.ra-batteries:before {
  content: "";
}

.ra-battery-0:before {
  content: "";
}

.ra-battery-25:before {
  content: "";
}

.ra-battery-50:before {
  content: "";
}

.ra-battery-75:before {
  content: "";
}

.ra-battery-100:before {
  content: "";
}

.ra-battery-black:before {
  content: "";
}

.ra-battery-negative:before {
  content: "";
}

.ra-battery-positive:before {
  content: "";
}

.ra-battery-white:before {
  content: "";
}

.ra-batwings:before {
  content: "";
}

.ra-beam-wake:before {
  content: "";
}

.ra-bear-trap:before {
  content: "";
}

.ra-beer:before {
  content: "";
}

.ra-beetle:before {
  content: "";
}

.ra-bell:before {
  content: "";
}

.ra-biohazard:before {
  content: "";
}

.ra-bird-claw:before {
  content: "";
}

.ra-bird-mask:before {
  content: "";
}

.ra-blade-bite:before {
  content: "";
}

.ra-blast:before {
  content: "";
}

.ra-blaster:before {
  content: "";
}

.ra-bleeding-eye:before {
  content: "";
}

.ra-bleeding-hearts:before {
  content: "";
}

.ra-bolt-shield:before {
  content: "";
}

.ra-bomb-explosion:before {
  content: "";
}

.ra-bombs:before {
  content: "";
}

.ra-bone-bite:before {
  content: "";
}

.ra-bone-knife:before {
  content: "";
}

.ra-book:before {
  content: "";
}

.ra-boomerang:before {
  content: "";
}

.ra-boot-stomp:before {
  content: "";
}

.ra-bottle-vapors:before {
  content: "";
}

.ra-bottled-bolt:before {
  content: "";
}

.ra-bottom-right:before {
  content: "";
}

.ra-bowie-knife:before {
  content: "";
}

.ra-bowling-pin:before {
  content: "";
}

.ra-brain-freeze:before {
  content: "";
}

.ra-brandy-bottle:before {
  content: "";
}

.ra-bridge:before {
  content: "";
}

.ra-broadhead-arrow:before {
  content: "";
}

.ra-sword:before,
.ra-broadsword:before {
  content: "";
}

.ra-broken-bone:before {
  content: "";
}

.ra-broken-bottle:before {
  content: "";
}

.ra-broken-heart:before {
  content: "";
}

.ra-broken-shield:before {
  content: "";
}

.ra-broken-skull:before {
  content: "";
}

.ra-bubbling-potion:before {
  content: "";
}

.ra-bullets:before {
  content: "";
}

.ra-burning-book:before {
  content: "";
}

.ra-burning-embers:before {
  content: "";
}

.ra-burning-eye:before {
  content: "";
}

.ra-burning-meteor:before {
  content: "";
}

.ra-burst-blob:before {
  content: "";
}

.ra-butterfly:before {
  content: "";
}

.ra-campfire:before {
  content: "";
}

.ra-cancel:before {
  content: "";
}

.ra-cancer:before {
  content: "";
}

.ra-candle:before {
  content: "";
}

.ra-candle-fire:before {
  content: "";
}

.ra-cannon-shot:before {
  content: "";
}

.ra-capitol:before {
  content: "";
}

.ra-capricorn:before {
  content: "";
}

.ra-carrot:before {
  content: "";
}

.ra-castle-emblem:before {
  content: "";
}

.ra-castle-flag:before {
  content: "";
}

.ra-cat:before {
  content: "";
}

.ra-chain:before {
  content: "";
}

.ra-cheese:before {
  content: "";
}

.ra-chemical-arrow:before {
  content: "";
}

.ra-chessboard:before {
  content: "";
}

.ra-chicken-leg:before {
  content: "";
}

.ra-circle-of-circles:before {
  content: "";
}

.ra-circular-saw:before {
  content: "";
}

.ra-circular-shield:before {
  content: "";
}

.ra-cloak-and-dagger:before {
  content: "";
}

.ra-clockwork:before {
  content: "";
}

.ra-clover:before {
  content: "";
}

.ra-clovers:before {
  content: "";
}

.ra-clovers-card:before {
  content: "";
}

.ra-cluster-bomb:before {
  content: "";
}

.ra-coffee-mug:before {
  content: "";
}

.ra-cog:before {
  content: "";
}

.ra-cog-wheel:before {
  content: "";
}

.ra-cold-heart:before {
  content: "";
}

.ra-compass:before {
  content: "";
}

.ra-corked-tube:before {
  content: "";
}

.ra-crab-claw:before {
  content: "";
}

.ra-cracked-helm:before {
  content: "";
}

.ra-cracked-shield:before {
  content: "";
}

.ra-croc-sword:before {
  content: "";
}

.ra-crossbow:before {
  content: "";
}

.ra-crossed-axes:before {
  content: "";
}

.ra-crossed-bones:before {
  content: "";
}

.ra-crossed-pistols:before {
  content: "";
}

.ra-crossed-sabres:before {
  content: "";
}

.ra-crossed-swords:before {
  content: "";
}

.ra-crown:before {
  content: "";
}

.ra-crown-of-thorns:before {
  content: "";
}

.ra-crowned-heart:before {
  content: "";
}

.ra-crush:before {
  content: "";
}

.ra-crystal-ball:before {
  content: "";
}

.ra-crystal-cluster:before {
  content: "";
}

.ra-crystal-wand:before {
  content: "";
}

.ra-crystals:before {
  content: "";
}

.ra-cubes:before {
  content: "";
}

.ra-cut-palm:before {
  content: "";
}

.ra-cycle:before {
  content: "";
}

.ra-daggers:before {
  content: "";
}

.ra-daisy:before {
  content: "";
}

.ra-dead-tree:before {
  content: "";
}

.ra-death-skull:before {
  content: "";
}

.ra-decapitation:before {
  content: "";
}

.ra-defibrillate:before {
  content: "";
}

.ra-demolish:before {
  content: "";
}

.ra-dervish-swords:before {
  content: "";
}

.ra-desert-skull:before {
  content: "";
}

.ra-diamond:before {
  content: "";
}

.ra-diamonds:before {
  content: "";
}

.ra-diamonds-card:before {
  content: "";
}

.ra-dice-five:before {
  content: "";
}

.ra-dice-four:before {
  content: "";
}

.ra-dice-one:before {
  content: "";
}

.ra-dice-six:before {
  content: "";
}

.ra-dice-three:before {
  content: "";
}

.ra-dice-two:before {
  content: "";
}

.ra-dinosaur:before {
  content: "";
}

.ra-divert:before {
  content: "";
}

.ra-diving-dagger:before {
  content: "";
}

.ra-double-team:before {
  content: "";
}

.ra-doubled:before {
  content: "";
}

.ra-dragon:before {
  content: "";
}

.ra-dragon-breath:before {
  content: "";
}

.ra-dragon-wing:before {
  content: "";
}

.ra-dragonfly:before {
  content: "";
}

.ra-drill:before {
  content: "";
}

.ra-dripping-blade:before {
  content: "";
}

.ra-dripping-knife:before {
  content: "";
}

.ra-dripping-sword:before {
  content: "";
}

.ra-droplet:before {
  content: "";
}

.ra-droplet-splash:before {
  content: "";
}

.ra-droplets:before {
  content: "";
}

.ra-duel:before {
  content: "";
}

.ra-egg:before {
  content: "";
}

.ra-egg-pod:before {
  content: "";
}

.ra-eggplant:before {
  content: "";
}

.ra-emerald:before {
  content: "";
}

.ra-energise:before {
  content: "";
}

.ra-explosion:before {
  content: "";
}

.ra-explosive-materials:before {
  content: "";
}

.ra-eye-monster:before {
  content: "";
}

.ra-eye-shield:before {
  content: "";
}

.ra-eyeball:before {
  content: "";
}

.ra-fairy:before {
  content: "";
}

.ra-fairy-wand:before {
  content: "";
}

.ra-fall-down:before {
  content: "";
}

.ra-falling:before {
  content: "";
}

.ra-fast-ship:before {
  content: "";
}

.ra-feather-wing:before {
  content: "";
}

.ra-feathered-wing:before {
  content: "";
}

.ra-fedora:before {
  content: "";
}

.ra-fire:before {
  content: "";
}

.ra-fire-bomb:before {
  content: "";
}

.ra-fire-breath:before {
  content: "";
}

.ra-fire-ring:before {
  content: "";
}

.ra-fire-shield:before {
  content: "";
}

.ra-fire-symbol:before {
  content: "";
}

.ra-fireball-sword:before {
  content: "";
}

.ra-fish:before {
  content: "";
}

.ra-fizzing-flask:before {
  content: "";
}

.ra-flame-symbol:before {
  content: "";
}

.ra-flaming-arrow:before {
  content: "";
}

.ra-flaming-claw:before {
  content: "";
}

.ra-flaming-trident:before {
  content: "";
}

.ra-flask:before {
  content: "";
}

.ra-flat-hammer:before {
  content: "";
}

.ra-flower:before {
  content: "";
}

.ra-flowers:before {
  content: "";
}

.ra-fluffy-swirl:before {
  content: "";
}

.ra-focused-lightning:before {
  content: "";
}

.ra-food-chain:before {
  content: "";
}

.ra-footprint:before {
  content: "";
}

.ra-forging:before {
  content: "";
}

.ra-forward:before {
  content: "";
}

.ra-fox:before {
  content: "";
}

.ra-frost-emblem:before {
  content: "";
}

.ra-frostfire:before {
  content: "";
}

.ra-frozen-arrow:before {
  content: "";
}

.ra-gamepad-cross:before {
  content: "";
}

.ra-gavel:before {
  content: "";
}

.ra-gear-hammer:before {
  content: "";
}

.ra-gear-heart:before {
  content: "";
}

.ra-gears:before {
  content: "";
}

.ra-gecko:before {
  content: "";
}

.ra-gem:before {
  content: "";
}

.ra-gem-pendant:before {
  content: "";
}

.ra-gemini:before {
  content: "";
}

.ra-glass-heart:before {
  content: "";
}

.ra-gloop:before {
  content: "";
}

.ra-gold-bar:before {
  content: "";
}

.ra-grappling-hook:before {
  content: "";
}

.ra-grass:before {
  content: "";
}

.ra-grass-patch:before {
  content: "";
}

.ra-grenade:before {
  content: "";
}

.ra-groundbreaker:before {
  content: "";
}

.ra-guarded-tower:before {
  content: "";
}

.ra-guillotine:before {
  content: "";
}

.ra-halberd:before {
  content: "";
}

.ra-hammer:before {
  content: "";
}

.ra-hammer-drop:before {
  content: "";
}

.ra-hand:before {
  content: "";
}

.ra-hand-emblem:before {
  content: "";
}

.ra-hand-saw:before {
  content: "";
}

.ra-harpoon-trident:before {
  content: "";
}

.ra-health:before {
  content: "";
}

.ra-health-decrease:before {
  content: "";
}

.ra-health-increase:before {
  content: "";
}

.ra-heart-bottle:before {
  content: "";
}

.ra-heart-tower:before {
  content: "";
}

.ra-heartburn:before {
  content: "";
}

.ra-hearts:before {
  content: "";
}

.ra-hearts-card:before {
  content: "";
}

.ra-heat-haze:before {
  content: "";
}

.ra-heavy-fall:before {
  content: "";
}

.ra-heavy-shield:before {
  content: "";
}

.ra-helmet:before {
  content: "";
}

.ra-help:before {
  content: "";
}

.ra-hive-emblem:before {
  content: "";
}

.ra-hole-ladder:before {
  content: "";
}

.ra-honeycomb:before {
  content: "";
}

.ra-hood:before {
  content: "";
}

.ra-horn-call:before {
  content: "";
}

.ra-horns:before {
  content: "";
}

.ra-horseshoe:before {
  content: "";
}

.ra-hospital-cross:before {
  content: "";
}

.ra-hot-surface:before {
  content: "";
}

.ra-hourglass:before {
  content: "";
}

.ra-hydra:before {
  content: "";
}

.ra-hydra-shot:before {
  content: "";
}

.ra-ice-cube:before {
  content: "";
}

.ra-implosion:before {
  content: "";
}

.ra-incense:before {
  content: "";
}

.ra-insect-jaws:before {
  content: "";
}

.ra-interdiction:before {
  content: "";
}

.ra-jetpack:before {
  content: "";
}

.ra-jigsaw-piece:before {
  content: "";
}

.ra-kaleidoscope:before {
  content: "";
}

.ra-kettlebell:before {
  content: "";
}

.ra-key:before {
  content: "";
}

.ra-key-basic:before {
  content: "";
}

.ra-kitchen-knives:before {
  content: "";
}

.ra-knife:before {
  content: "";
}

.ra-knife-fork:before {
  content: "";
}

.ra-knight-helmet:before {
  content: "";
}

.ra-kunai:before {
  content: "";
}

.ra-lantern-flame:before {
  content: "";
}

.ra-large-hammer:before {
  content: "";
}

.ra-laser-blast:before {
  content: "";
}

.ra-laser-site:before {
  content: "";
}

.ra-lava:before {
  content: "";
}

.ra-leaf:before {
  content: "";
}

.ra-leo:before {
  content: "";
}

.ra-level-four:before {
  content: "";
}

.ra-level-four-advanced:before {
  content: "";
}

.ra-level-three:before {
  content: "";
}

.ra-level-three-advanced:before {
  content: "";
}

.ra-level-two:before {
  content: "";
}

.ra-level-two-advanced:before {
  content: "";
}

.ra-lever:before {
  content: "";
}

.ra-libra:before {
  content: "";
}

.ra-light-bulb:before {
  content: "";
}

.ra-lighthouse:before {
  content: "";
}

.ra-lightning:before {
  content: "";
}

.ra-lightning-bolt:before {
  content: "";
}

.ra-lightning-storm:before {
  content: "";
}

.ra-lightning-sword:before {
  content: "";
}

.ra-lightning-trio:before {
  content: "";
}

.ra-lion:before {
  content: "";
}

.ra-lit-candelabra:before {
  content: "";
}

.ra-load:before {
  content: "";
}

.ra-locked-fortress:before {
  content: "";
}

.ra-love-howl:before {
  content: "";
}

.ra-maggot:before {
  content: "";
}

.ra-magnet:before {
  content: "";
}

.ra-mass-driver:before {
  content: "";
}

.ra-match:before {
  content: "";
}

.ra-meat:before {
  content: "";
}

.ra-meat-hook:before {
  content: "";
}

.ra-medical-pack:before {
  content: "";
}

.ra-metal-gate:before {
  content: "";
}

.ra-microphone:before {
  content: "";
}

.ra-mine-wagon:before {
  content: "";
}

.ra-mining-diamonds:before {
  content: "";
}

.ra-mirror:before {
  content: "";
}

.ra-monster-skull:before {
  content: "";
}

.ra-mountains:before {
  content: "";
}

.ra-moon-sun:before {
  content: "";
}

.ra-mp5:before {
  content: "";
}

.ra-muscle-fat:before {
  content: "";
}

.ra-muscle-up:before {
  content: "";
}

.ra-musket:before {
  content: "";
}

.ra-nails:before {
  content: "";
}

.ra-nodular:before {
  content: "";
}

.ra-noose:before {
  content: "";
}

.ra-nuclear:before {
  content: "";
}

.ra-ocarina:before {
  content: "";
}

.ra-ocean-emblem:before {
  content: "";
}

.ra-octopus:before {
  content: "";
}

.ra-omega:before {
  content: "";
}

.ra-on-target:before {
  content: "";
}

.ra-ophiuchus:before {
  content: "";
}

.ra-overhead:before {
  content: "";
}

.ra-overmind:before {
  content: "";
}

.ra-palm-tree:before {
  content: "";
}

.ra-pawn:before {
  content: "";
}

.ra-pawprint:before {
  content: "";
}

.ra-perspective-dice-five:before {
  content: "";
}

.ra-perspective-dice-four:before {
  content: "";
}

.ra-perspective-dice-one:before {
  content: "";
}

.ra-perspective-dice-random:before {
  content: "";
}

.ra-perspective-dice-six:before {
  content: "";
}

.ra-perspective-dice-two:before {
  content: "";
}

.ra-perspective-dice-three:before {
  content: "";
}

.ra-pill:before {
  content: "";
}

.ra-pills:before {
  content: "";
}

.ra-pine-tree:before {
  content: "";
}

.ra-ping-pong:before {
  content: "";
}

.ra-pisces:before {
  content: "";
}

.ra-plain-dagger:before {
  content: "";
}

.ra-player:before {
  content: "";
}

.ra-player-despair:before {
  content: "";
}

.ra-player-dodge:before {
  content: "";
}

.ra-player-king:before {
  content: "";
}

.ra-player-lift:before {
  content: "";
}

.ra-player-pain:before {
  content: "";
}

.ra-player-pyromaniac:before {
  content: "";
}

.ra-player-shot:before {
  content: "";
}

.ra-player-teleport:before {
  content: "";
}

.ra-player-thunder-struck:before {
  content: "";
}

.ra-podium:before {
  content: "";
}

.ra-poison-cloud:before {
  content: "";
}

.ra-potion:before {
  content: "";
}

.ra-pyramids:before {
  content: "";
}

.ra-queen-crown:before {
  content: "";
}

.ra-quill-ink:before {
  content: "";
}

.ra-rabbit:before {
  content: "";
}

.ra-radar-dish:before {
  content: "";
}

.ra-radial-balance:before {
  content: "";
}

.ra-radioactive:before {
  content: "";
}

.ra-raven:before {
  content: "";
}

.ra-reactor:before {
  content: "";
}

.ra-recycle:before {
  content: "";
}

.ra-regeneration:before {
  content: "";
}

.ra-relic-blade:before {
  content: "";
}

.ra-repair:before {
  content: "";
}

.ra-reverse:before {
  content: "";
}

.ra-revolver:before {
  content: "";
}

.ra-rifle:before {
  content: "";
}

.ra-ringing-bell:before {
  content: "";
}

.ra-roast-chicken:before {
  content: "";
}

.ra-robot-arm:before {
  content: "";
}

.ra-round-bottom-flask:before {
  content: "";
}

.ra-round-shield:before {
  content: "";
}

.ra-rss:before {
  content: "";
}

.ra-rune-stone:before {
  content: "";
}

.ra-sagittarius:before {
  content: "";
}

.ra-sapphire:before {
  content: "";
}

.ra-satellite:before {
  content: "";
}

.ra-save:before {
  content: "";
}

.ra-scorpio:before {
  content: "";
}

.ra-scroll-unfurled:before {
  content: "";
}

.ra-scythe:before {
  content: "";
}

.ra-sea-serpent:before {
  content: "";
}

.ra-seagull:before {
  content: "";
}

.ra-shark:before {
  content: "";
}

.ra-sheep:before {
  content: "";
}

.ra-sheriff:before {
  content: "";
}

.ra-shield:before {
  content: "";
}

.ra-ship-emblem:before {
  content: "";
}

.ra-shoe-prints:before {
  content: "";
}

.ra-shot-through-the-heart:before {
  content: "";
}

.ra-shotgun-shell:before {
  content: "";
}

.ra-shovel:before {
  content: "";
}

.ra-shuriken:before {
  content: "";
}

.ra-sickle:before {
  content: "";
}

.ra-sideswipe:before {
  content: "";
}

.ra-site:before {
  content: "";
}

.ra-skull:before {
  content: "";
}

.ra-skull-trophy:before {
  content: "";
}

.ra-slash-ring:before {
  content: "";
}

.ra-small-fire:before {
  content: "";
}

.ra-snail:before {
  content: "";
}

.ra-snake:before {
  content: "";
}

.ra-snorkel:before {
  content: "";
}

.ra-snowflake:before {
  content: "";
}

.ra-soccer-ball:before {
  content: "";
}

.ra-spades:before {
  content: "";
}

.ra-spades-card:before {
  content: "";
}

.ra-spawn-node:before {
  content: "";
}

.ra-spear-head:before {
  content: "";
}

.ra-speech-bubble:before {
  content: "";
}

.ra-speech-bubbles:before {
  content: "";
}

.ra-spider-face:before {
  content: "";
}

.ra-spikeball:before {
  content: "";
}

.ra-spiked-mace:before {
  content: "";
}

.ra-spiked-tentacle:before {
  content: "";
}

.ra-spinning-sword:before {
  content: "";
}

.ra-spiral-shell:before {
  content: "";
}

.ra-splash:before {
  content: "";
}

.ra-spray-can:before {
  content: "";
}

.ra-sprout:before {
  content: "";
}

.ra-sprout-emblem:before {
  content: "";
}

.ra-stopwatch:before {
  content: "";
}

.ra-suckered-tentacle:before {
  content: "";
}

.ra-suits:before {
  content: "";
}

.ra-sun:before {
  content: "";
}

.ra-sun-symbol:before {
  content: "";
}

.ra-sunbeams:before {
  content: "";
}

.ra-super-mushroom:before {
  content: "";
}

.ra-supersonic-arrow:before {
  content: "";
}

.ra-surveillance-camera:before {
  content: "";
}

.ra-syringe:before {
  content: "";
}

.ra-target-arrows:before {
  content: "";
}

.ra-target-laser:before {
  content: "";
}

.ra-targeted:before {
  content: "";
}

.ra-taurus:before {
  content: "";
}

.ra-telescope:before {
  content: "";
}

.ra-tentacle:before {
  content: "";
}

.ra-tesla:before {
  content: "";
}

.ra-thorn-arrow:before {
  content: "";
}

.ra-thorny-vine:before {
  content: "";
}

.ra-three-keys:before {
  content: "";
}

.ra-tic-tac-toe:before {
  content: "";
}

.ra-toast:before {
  content: "";
}

.ra-tombstone:before {
  content: "";
}

.ra-tooth:before {
  content: "";
}

.ra-torch:before {
  content: "";
}

.ra-tower:before {
  content: "";
}

.ra-trail:before {
  content: "";
}

.ra-trefoil-lily:before {
  content: "";
}

.ra-trident:before {
  content: "";
}

.ra-triforce:before {
  content: "";
}

.ra-trophy:before {
  content: "";
}

.ra-turd:before {
  content: "";
}

.ra-two-dragons:before {
  content: "";
}

.ra-two-hearts:before {
  content: "";
}

.ra-uncertainty:before {
  content: "";
}

.ra-underhand:before {
  content: "";
}

.ra-unplugged:before {
  content: "";
}

.ra-vase:before {
  content: "";
}

.ra-venomous-snake:before {
  content: "";
}

.ra-vest:before {
  content: "";
}

.ra-vial:before {
  content: "";
}

.ra-vine-whip:before {
  content: "";
}

.ra-virgo:before {
  content: "";
}

.ra-water-drop:before {
  content: "";
}

.ra-wifi:before {
  content: "";
}

.ra-wireless-signal:before {
  content: "";
}

.ra-wolf-head:before {
  content: "";
}

.ra-wolf-howl:before {
  content: "";
}

.ra-wooden-sign:before {
  content: "";
}

.ra-wrench:before {
  content: "";
}

.ra-wyvern:before {
  content: "";
}

.ra-x-mark:before {
  content: "";
}

.ra-zebra-shield:before {
  content: "";
}

.ra-arcane-mask:before {
  content: "";
}

.ra-aquarius:before {
  content: "";
}

.ra-apple:before {
  content: "";
}

.ra-anvil:before {
  content: "";
}

.ra-ankh:before {
  content: "";
}

.ra-angel-wings:before {
  content: "";
}

.ra-anchor:before {
  content: "";
}

.ra-ammo-bag:before {
  content: "";
}

.ra-alligator-clip:before {
  content: "";
}

.ra-all-for-one:before {
  content: "";
}

.ra-alien-fire:before {
  content: "";
}

.ra-acorn:before {
  content: "";
}

/*# sourceMappingURL=rpg-awesome.css.map */
/* twine-user-stylesheet #17: "rpg-awesome.custom.css" */

.ra-location:before {
    content: url("media/icons/location.png");
}
  
.link-icon:hover .ra-location:before {
    content: url("media/icons/location-hover.png");
}

.ra {
    max-height: 16px;
}
/* twine-user-stylesheet #18: "select2.custom.css" */


.form-block .select2 {
    width: 140px;
}

.select2-container--default .select2-selection--single {
    background: none !important;
}

.select2-dropdown {
    background-color: #444 !important;
}

.select2 *, .select2-container *{
    /* background: none !important; */
    /* color: none !important; */
    
    color: #fff !important; 
}

.select2-container--default .select2-results > .select2-results__options {
    max-height: 300px !important;
}

.select2--large {
    width: 260px !important;
}

.select2-multiple ~ span{
    min-width: 300px;
    max-width: 400px;
}

.select2-multiple ~ span .select2-selection--multiple {
    background-color: #222 !important;
}

.select2-selection__choice {
    background-color: #444 !important;
}

/* twine-user-stylesheet #19: "select2.min.css" */
.select2-container{box-sizing:border-box;display:inline-block;margin:0;position:relative;vertical-align:middle}.select2-container .select2-selection--single{box-sizing:border-box;cursor:pointer;display:block;height:28px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--single .select2-selection__rendered{display:block;padding-left:8px;padding-right:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-selection--single .select2-selection__clear{position:relative}.select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered{padding-right:8px;padding-left:20px}.select2-container .select2-selection--multiple{box-sizing:border-box;cursor:pointer;display:block;min-height:32px;user-select:none;-webkit-user-select:none}.select2-container .select2-selection--multiple .select2-selection__rendered{display:inline-block;overflow:hidden;padding-left:8px;text-overflow:ellipsis;white-space:nowrap}.select2-container .select2-search--inline{float:left}.select2-container .select2-search--inline .select2-search__field{box-sizing:border-box;border:none;font-size:100%;margin-top:5px;padding:0}.select2-dropdown{background-color:white;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;display:block;position:absolute;left:-100000px;width:100%;z-index:1051}.select2-results{display:block}.select2-results__options{list-style:none;margin:0;padding:0}.select2-results__option{padding:6px;user-select:none;-webkit-user-select:none}.select2-results__option[aria-selected]{cursor:pointer}.select2-container--open .select2-dropdown{left:0}.select2-container--open .select2-dropdown--above{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--open .select2-dropdown--below{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-search--dropdown{display:block;padding:4px}.select2-search--dropdown .select2-search__field{padding:4px;width:100%;box-sizing:border-box}.select2-search--dropdown.select2-search--hide{display:none}.select2-close-mask{border:0;margin:0;padding:0;display:block;position:fixed;left:0;top:0;min-height:100%;min-width:100%;height:auto;width:auto;opacity:0;z-index:99;background-color:#fff;filter:alpha(opacity=0)}.select2-hidden-accessible{border:0 !important;clip:rect(0 0 0 0) !important;-webkit-clip-path:inset(50%) !important;clip-path:inset(50%) !important;height:1px !important;overflow:hidden !important;padding:0 !important;position:absolute !important;width:1px !important;white-space:nowrap !important}.select2-container--default .select2-selection--single{background-color:#fff;border:1px solid #aaa;border-radius:4px}.select2-container--default .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--default .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold}.select2-container--default .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--default .select2-selection--single .select2-selection__arrow{height:26px;position:absolute;top:1px;right:1px;width:20px}.select2-container--default .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--default.select2-container--disabled .select2-selection--single{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--default .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text}.select2-container--default .select2-selection--multiple .select2-selection__rendered{box-sizing:border-box;list-style:none;margin:0;padding:0 5px;width:100%}.select2-container--default .select2-selection--multiple .select2-selection__rendered li{list-style:none}.select2-container--default .select2-selection--multiple .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-top:5px;margin-right:10px;padding:1px}.select2-container--default .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove{color:#999;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover{color:#333}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice,.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-search--inline{float:right}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--default.select2-container--focus .select2-selection--multiple{border:solid black 1px;outline:0}.select2-container--default.select2-container--disabled .select2-selection--multiple{background-color:#eee;cursor:default}.select2-container--default.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--default.select2-container--open.select2-container--above .select2-selection--single,.select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple{border-top-left-radius:0;border-top-right-radius:0}.select2-container--default.select2-container--open.select2-container--below .select2-selection--single,.select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--default .select2-search--dropdown .select2-search__field{border:1px solid #aaa}.select2-container--default .select2-search--inline .select2-search__field{background:transparent;border:none;outline:0;box-shadow:none;}.select2-container--default .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--default .select2-results__option[role=group]{padding:0}.select2-container--default .select2-results__option[aria-disabled=true]{color:#999}.select2-container--default .select2-results__option[aria-selected=true]{background-color:#ddd}.select2-container--default .select2-results__option .select2-results__option{padding-left:1em}.select2-container--default .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--default .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--default .select2-results__option--highlighted[aria-selected]{background-color:#5897fb;color:white}.select2-container--default .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic .select2-selection--single{background-color:#f7f7f7;border:1px solid #aaa;border-radius:4px;outline:0;background-image:-webkit-linear-gradient(top, #fff 50%, #eee 100%);background-image:-o-linear-gradient(top, #fff 50%, #eee 100%);background-image:linear-gradient(to bottom, #fff 50%, #eee 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic .select2-selection--single:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--single .select2-selection__rendered{color:#444;line-height:28px}.select2-container--classic .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:bold;margin-right:10px}.select2-container--classic .select2-selection--single .select2-selection__placeholder{color:#999}.select2-container--classic .select2-selection--single .select2-selection__arrow{background-color:#ddd;border:none;border-left:1px solid #aaa;border-top-right-radius:4px;border-bottom-right-radius:4px;height:26px;position:absolute;top:1px;right:1px;width:20px;background-image:-webkit-linear-gradient(top, #eee 50%, #ccc 100%);background-image:-o-linear-gradient(top, #eee 50%, #ccc 100%);background-image:linear-gradient(to bottom, #eee 50%, #ccc 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFCCCCCC', GradientType=0)}.select2-container--classic .select2-selection--single .select2-selection__arrow b{border-color:#888 transparent transparent transparent;border-style:solid;border-width:5px 4px 0 4px;height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__clear{float:left}.select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__arrow{border:none;border-right:1px solid #aaa;border-radius:0;border-top-left-radius:4px;border-bottom-left-radius:4px;left:1px;right:auto}.select2-container--classic.select2-container--open .select2-selection--single{border:1px solid #5897fb}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow{background:transparent;border:none}.select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #888 transparent;border-width:0 4px 5px 4px}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--single{border-top:none;border-top-left-radius:0;border-top-right-radius:0;background-image:-webkit-linear-gradient(top, #fff 0%, #eee 50%);background-image:-o-linear-gradient(top, #fff 0%, #eee 50%);background-image:linear-gradient(to bottom, #fff 0%, #eee 50%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--single{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0;background-image:-webkit-linear-gradient(top, #eee 50%, #fff 100%);background-image:-o-linear-gradient(top, #eee 50%, #fff 100%);background-image:linear-gradient(to bottom, #eee 50%, #fff 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFFFFFFF', GradientType=0)}.select2-container--classic .select2-selection--multiple{background-color:white;border:1px solid #aaa;border-radius:4px;cursor:text;outline:0}.select2-container--classic .select2-selection--multiple:focus{border:1px solid #5897fb}.select2-container--classic .select2-selection--multiple .select2-selection__rendered{list-style:none;margin:0;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__clear{display:none}.select2-container--classic .select2-selection--multiple .select2-selection__choice{background-color:#e4e4e4;border:1px solid #aaa;border-radius:4px;cursor:default;float:left;margin-right:5px;margin-top:5px;padding:0 5px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove{color:#888;cursor:pointer;display:inline-block;font-weight:bold;margin-right:2px}.select2-container--classic .select2-selection--multiple .select2-selection__choice__remove:hover{color:#555}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice{float:right;margin-left:5px;margin-right:auto}.select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove{margin-left:2px;margin-right:auto}.select2-container--classic.select2-container--open .select2-selection--multiple{border:1px solid #5897fb}.select2-container--classic.select2-container--open.select2-container--above .select2-selection--multiple{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.select2-container--classic.select2-container--open.select2-container--below .select2-selection--multiple{border-bottom:none;border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--classic .select2-search--dropdown .select2-search__field{border:1px solid #aaa;outline:0}.select2-container--classic .select2-search--inline .select2-search__field{outline:0;box-shadow:none}.select2-container--classic .select2-dropdown{background-color:#fff;border:1px solid transparent}.select2-container--classic .select2-dropdown--above{border-bottom:none}.select2-container--classic .select2-dropdown--below{border-top:none}.select2-container--classic .select2-results>.select2-results__options{max-height:200px;overflow-y:auto}.select2-container--classic .select2-results__option[role=group]{padding:0}.select2-container--classic .select2-results__option[aria-disabled=true]{color:grey}.select2-container--classic .select2-results__option--highlighted[aria-selected]{background-color:#3875d7;color:#fff}.select2-container--classic .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--classic.select2-container--open .select2-dropdown{border-color:#5897fb}
/* twine-user-stylesheet #20: "links.css" */
:root {
    --link-width: 2px;
    --link-color: var(--green);
    --link-color-hover: var(--green-t6);
    --link-bg: var(--black);
}

.link-contents {
    position: relative;
	display: inline-block;
}

.link-icon {
	display: inline-block;
    text-align: left;
	vertical-align: middle;
	line-height: 16px;
	text-decoration: none;
    color: var(--green);
	letter-spacing: 0.1em;
	font-size: 1rem;
}

.link-icon__container--disabled {
    cursor: not-allowed;
}

.link-icon__container--disabled > .link-icon  {
    filter: grayscale(1);
    cursor: not-allowed;
    opacity: 0.5;
    pointer-events: none;
}

.link-icon__container {
    display: flex;
    align-items: baseline;
    gap: 6px;
    width: fit-content;
}

.link-icon__container:last-child {
    margin-bottom: 50px;
}


.link-underline:hover {
	color: var(--green-t6);
	text-decoration: none;
}

.link-underline .link-underline-container {
    position: relative;
}

.link-underline .link-underline-container::after {
	width: 0%;
	height: 2px;
	display: block;
	background-color: var(--green);
	content: " ";
	position: absolute;
	top: 18px;
	left: 50%;
	transition: left 0.4s cubic-bezier(0.215, 0.61, 0.355, 1), width 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
}
	
.link-underline:hover .link-underline-container::after {
	width: 100%;
	height: 2px;
	display: block;
	background-color: var(--green-t6);
	content: " ";
	position: absolute;
	top: 18px;
	left: 0;
}


.link-content-container {
    display: inline-flex;
    align-items: center;
    gap: 0 3px;
	width: fit-content;
}

.link-icon .link-content-wrapper {

    margin-top: -20px;
    margin-bottom: -18px;
    margin-left: -16px;
    margin-right: -14px;
    padding-top: 16px;
    padding-bottom: 18px;
    padding-left: 16px;
    padding-right: 16px;

    margin-top: calc(-5*var(--link-width));
    margin-bottom: calc(-2px - 4*var(--link-width));
    margin-left: calc(-5*var(--link-width));
    margin-right: calc(2px + -5*var(--link-width));
    padding-top: calc(4*var(--link-width) + 2px);
    padding-bottom: calc(2px + 3*var(--link-width));
    padding-left: calc(5*var(--link-width));
    padding-right: calc(5*var(--link-width));

    
}


.link-pixel-border {
    
    transition: transform 0.3s;

    min-width: 100px;
    padding: 0px;
    margin: calc(7*var(--link-width)) calc(5*var(--link-width)) calc(7*var(--link-width));

    box-shadow: 
        calc(4*var(--link-width)) 0 var(--link-bg), 
        calc(-4*var(--link-width)) 0 var(--link-bg), 
        0 calc(-4*var(--link-width)) var(--link-bg), 
        0 calc(4*var(--link-width)) var(--link-bg),
        
        calc(0px + var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-bg),
        calc(0px - var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-bg),
        0 calc(0px - var(--link-width)) 0 calc(2*var(--link-width)) var(--link-bg),
        0 var(--link-width) 0 calc(2*var(--link-width)) var(--link-bg),
        
        calc(5*var(--link-width)) 0 var(--link-color), 
        calc(0px - 5*var(--link-width)) 0 var(--link-color),
        0 calc(0px - 5*var(--link-width)) var(--link-color), 
        0 calc(5*var(--link-width)) var(--link-color),
        
        0 0 0 calc(3*var(--link-width)) var(--link-color),
        0 calc(2*var(--link-width)) 0 calc(2*var(--link-width)) var(--link-color),
        0 calc(0px - 2*var(--link-width)) 0 calc(2*var(--link-width)) var(--link-color),
        calc(2*var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-color),
        calc(0px - 2*var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-color);
      
}

.link-pixel-border:hover {
    transform: translateX(8px);
    box-shadow: 
        calc(4*var(--link-width)) 0 var(--link-bg), 
        calc(-4*var(--link-width)) 0 var(--link-bg), 
        0 calc(-4*var(--link-width)) var(--link-bg), 
        0 calc(4*var(--link-width)) var(--link-bg),
        
        calc(0px + var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-bg),
        calc(0px - var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-bg),
        0 calc(0px - var(--link-width)) 0 calc(2*var(--link-width)) var(--link-bg),
        0 var(--link-width) 0 calc(2*var(--link-width)) var(--link-bg),
        
        calc(5*var(--link-width)) 0 var(--link-color-hover), 
        calc(0px - 5*var(--link-width)) 0 var(--link-color-hover),
        0 calc(0px - 5*var(--link-width)) var(--link-color-hover), 
        0 calc(5*var(--link-width)) var(--link-color-hover),
        
        0 0 0 calc(3*var(--link-width)) var(--link-color-hover),
        0 calc(2*var(--link-width)) 0 calc(2*var(--link-width)) var(--link-color-hover),
        0 calc(0px - 2*var(--link-width)) 0 calc(2*var(--link-width)) var(--link-color-hover),
        calc(2*var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-color-hover),
        calc(0px - 2*var(--link-width)) 0 0 calc(2*var(--link-width)) var(--link-color-hover);
}




.task-link {
    align-items: center;
    color: #009CCF;
    display: flex;
    gap: 8px;
    border: 1px solid #009CCF;
    border-radius: 4px;
    padding-left: 6px;
    padding-right: 12px;
    transition: none;
    min-height: 34px;
    width: fit-content;
    min-width: 124px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.task-link:hover {
    color: #1ec8ff;
    border: 1px solid #1ec8ff;
    text-decoration: none;
    padding-right: 24px;
    padding-left: 12px;
    transition: .5s ease;
    transform: translateX(8px);
}

.task-link__icon {
    width: 26px;
    height: 26px;
}

.task-link:hover .task-link__icon {
    display: none;
}

.task-link:hover .task-link__icon--hover {
    display: block;
}

.task-link__icon--hover {
    width: 26px;
    height: 26px;
    display: none;
}



.task-link--fake {    
    cursor: not-allowed;
    filter: grayscale(80%);
}

.task-link--fake:hover {
    padding-left: 6px;
    padding-right: 12px;
    color: #eeeeee66;
    border: 1px solid #eeeeee66;
    filter: grayscale(100%);
    transition: none;
    transform: none;
}

.task-link--fake *{
    cursor: not-allowed;
}

.link-fake__tip-text {
    display: none;
    color: #fff;
    border: 1px solid #fff;
    border-radius: 10px;
    min-width: 300px;
    top: -36px;
    left: 46px;
    z-index: 5;
    background-color: var(--black);
    padding-left: 10px;
}

.task-link--fake:hover .link-fake__tip-text {
    display: block;
    position: absolute;
}

.task-link--fake:hover .task-link__icon {
    display: block;
}




 /* Workaround for _content in 'passage' widget*/

.link-content-wrapper * {
    pointer-events: none;
}

.link-contents .macro-linkreplace {
    position: absolute;
    opacity:0;
}

.link-icon .macro-linkreplace {
    z-index: 999;
    min-width: 100px;
    right: -2px;
    top: 0px;

    margin-top: -20px;
    margin-bottom: -18px;
    margin-left: -16px;
    margin-right: -14px;
    padding-top: 16px;
    padding-bottom: 18px;
    padding-left: 16px;
    padding-right: 16px;

    margin-top: calc(-5*var(--link-width));
    margin-bottom: calc(-2px - 4*var(--link-width));
    margin-left: calc(-5*var(--link-width));
    margin-right: calc(2px + -5*var(--link-width));
    padding-top: calc(4*var(--link-width) + 2px);
    padding-bottom: calc(8px + 3*var(--link-width));
    padding-left: calc(21px + 5*var(--link-width));
    padding-right: calc(5*var(--link-width));
}


.link-activity {
    color: #eeeeeeaa;
    border: 1px solid #eeeeeeaa;
    padding: 0px 18px;
    transition: all 0.3s ease;
    margin-bottom: 10px;
    min-width: 40px;
    width: fit-content;
}


.link-activity:hover {
    color: #eeeeeeff;
    border: 1px solid #eeeeeeff;
    padding-right: 30px;
    padding-left: 20px;
    transition: .5s ease;
    text-decoration: none;
    transform: translateX(10px);
}

.link-activity--fake {
    color: #eeeeee33;
    border: 1px solid #eeeeee33;
    cursor: not-allowed;
}

.link-activity--fake:hover {
    padding: 0px 18px;
    color: #eeeeee22;
    border: 1px solid #eeeeee22;
    transform: none;
    cursor: not-allowed;
}



.talk-link__type-1__link {
    display: flex;
    gap: 8px;
    margin-bottom: 5px;
    text-decoration: none;
    color: #333;
    font-weight: bold;
    transition: color 0.3s;
}
  
.talk-link__type-1__link:hover {
    text-decoration: none;
}


.talk-link__type-1__link .talk-link__type-1__name {
    color: #eee;
}
  
.talk-link__type-1__image {
    width: 52px;
    height: 52px;
    vertical-align: middle;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-radius: 25px;
}
  
.talk-link__type-1__name {
    font-size: 14px;
    font-weight: bold;
    margin-top: -5px;
    margin-left: -2px;
}
  
.talk-link__type-1 div {
    height: 0;
}

.talk-link__type-1__lower-block {
    display: flex;
    gap: 12px;
    justify-content: space-between;
}
  
.talk-link__type-1 {
    margin-bottom: 15px;
    padding: 8px 10px 8px;
    width: fit-content;
    min-width: 180px;
    border-radius: 8px;
    background-color: transparent;
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
    border: 2px solid #333;
    text-align: left;
      
}
  
.talk-link__type-1:hover {
    transform: translateX(8px);
}

.talk-link__type-1__talk {
    font-size: 1.25rem;
    text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.4);
    margin-top: -4px;
}

.talk-link__type-1__talk:hover {
    text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.6);
}

.talk-link--unavailable .talk-link__type-1__talk {
    color: #ccc;
    text-shadow: 3px 3px 4px #666;
    font-size: 1.25rem;
}

.talk-link__type-1__activity {
    font-size: 1.25rem;
    text-shadow: 2px 2px 4px #444;
}


.talk-link__type-2 {
    display: flex;
    width: fit-content;
    align-items: baseline;
    position: relative;
}

.talk-link__type-2__link {
    display: flex;
}

.talk-link__type-2__image {
    display: none;
    position: absolute;
    border: 2px solid #444;
    border-radius: 4px;
    width: 80px;
    height: 80px;
    bottom: 28px;
    left: 12px;
}
  
.talk-link__type-2__link:hover .talk-link__type-2__image {
    display: block;
}


.talk-link__type-2 .state-mark__svg {
    width: 10px;
    height: 10px;
    margin-bottom: -4px;
}




.talk-link--unavailable {
    position: relative;
    transform: none !important;
    cursor: not-allowed;
}

.talk-link--unavailable *{
    color: #444;
    cursor: not-allowed;
    filter: grayscale(100%);
}

.talk-link__na-tip {
    display: none;
    position: absolute;
    padding: 3px 6px 2px;
    min-width: 160px;
    max-width: 320px;
    width: max-content;
}

.talk-link__type-2 .talk-link__na-tip {
    top: -28px;
    left: 32px;
}

.talk-link__type-1 .talk-link__na-tip {
    top: -40px;
    left: 40px;
}

.talk-link--unavailable:hover .talk-link__na-tip {
    display: block;
}






.choice-link:first-of-type {
    margin-top: 20px;
}

.choice-link span{
    font-size: 20px;
}

.choice-link--default {
	display: flex;
    color: #d0ecff;
    font-size: 20px;
    cursor: pointer;
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 12px;
    padding-right: 16px;
    border: 1px solid #d0ecffcc;
    transition: all 0.5s;
    border-radius: 6px;
    position: relative;
    width: fit-content;
    min-width: 46px;
    text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.6);

    margin-bottom: 12px;
}

.choice-link--default::after {
    content: "\e81e\00a0";
    font-family: tme-fa-icons;
    font-weight: 400;
    position: absolute; 
    font-size: 15px;
    right: 8px;
    bottom: 5px;
    opacity: 0;
}

.choice-link--default:hover {
    transition: all 0.5s;
    border-radius: 8px;
    color: #30abff;
    box-shadow: 0px 6px 15px #0065a9;
    padding-left: 16px;
    padding-right: 32px;
    /* text-decoration: none; */
    transform: translateX(12px);
}

.choice-link--default:hover::after {
    opacity: 1;
    transition: padding 0.3s;
}

.deadend-link {
    display: flex;
    align-items: center;
    border-radius: 6px;
    color: #ae0000;
    font-size: 20px;
    border: 1px solid #6c0000;
    position: relative;
    min-width: 40px;
    margin-bottom: 10px;
    width: fit-content;
    padding-top: 2px;
    padding-bottom: 2px;
    padding-left: 12px;
    padding-right: 0;
    text-shadow: 2px 2px 4px rgb(255 0 0 / 70%);
    transition: padding 0.5s, transform 0.5s, color 0.1s steps(20, end);
}

.deadend-link:hover {
    border-radius: 8px;
    color:#e70000;
    padding-left: 16px;
    padding-right: 16px;
    text-decoration: none;
    border-color: #ca0000;
    box-shadow: 0px 6px 15px #9b00007d;
    transform: translateX(12px);
}

.deadend-link img {
    display: inline-block;
    width: 20px;
    height: fit-content;
    opacity: 0;
    vertical-align: text-bottom;
    transition: all 0.5s;
    padding-left: 8px;
    margin-right: -20px;    
    transition: opacity .3s;  /* on unhover */
    
}

.deadend-link:hover img {
    opacity: 1;
    margin-right: 0;
    transition: opacity 0.7s;  
}





.chat-link {
    display: flex;
    gap: 5px;
    width: fit-content;
    align-items: center;
    border-radius: 6px;
    font-size: 20px;
    position: relative;
    min-width: 40px;
    border: 1px solid #cad4e4;
    color: #cad4e4;
    padding: 4px 8px 3px;
    transition: all 0.5s;
}

.chat-link:hover {
    transition: all 0.5s;
    transform: translateX(12px);
    color: #cad4e4;
}

.chat-link__img {
    display: inline-block;
    width: 22px;
    margin-top: -5px;
}

.chat-link__img--medium {
    width: 24px;
    margin-top: -3px;
    margin-right: 2px;

}

.chat-link--blocked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.chat-link--blocked:hover {
    transform: none;
    text-decoration: none;
    color: unset;
}


.general-chat-link {
    gap: 8px;
    font-size: 22px;    
    padding-top: 4px;
    padding-bottom: 2px;
    padding-left: 10px;
    padding-right: 14px;
}

.personal-chat-link {
    padding-top: 4px;
    padding-bottom: 2px;
    padding-left: 8px;
    padding-right: 12px;
    margin-bottom: 10px;
}

.chat-link .state-mark {
    padding-left: 8px;
    padding-right: 4px;
    padding-bottom: 3px;
}

.chat-link .state-mark .state-mark__svg {
    padding: 3px;
}


.passage-special--mirror {
    display: flex;
    gap: 8px;     
    text-decoration: none;
    align-items: center;
    border: 1px solid #eee;
    border-radius: 4px;
    padding: 4px 8px;
    padding-left: 8px;
    padding-right: 12px;
    width: fit-content;
    text-decoration: none;
    color: #eeeeeecc;
}

.passage-special--mirror span{
    font-size: 1.25rem;
}

.passage-special--mirror img {
    width: 28px;
    height: 28px;
}

.passage-special--mirror:hover {
    transition: .5s ease;
    border-color: #ffffffee;
    transform: translateX(10px);
    padding-right: 20px;
    padding-left: 14px;
    cursor: pointer;
    color: #eeeeee;
    text-decoration: none;
}


.passage-special .state-mark {
    padding-left: 6px;
    padding-right: 2px;
}

.passage-special:hover .state-mark {
    padding-left: 8px;
    padding-right: 0;
    transition: .5s ease;
}
/* twine-user-stylesheet #21: "list_arrows.css" */


.list-arrow__container {
    display: flex;
    position: relative;
    padding-left: 12px;
    margin-bottom: 12px;
    transition: all 0.5s ease;
    width: fit-content;
}

:not(.list-arrow__container--disabled).list-arrow__container:hover {
    padding-right: 40px;
    padding-left: 20px;
    transform: translateX(12px);
}

:not(.list-arrow__container--disabled).list-arrow__container:hover .list-arrow__body {
    background-color: #666;
}
:not(.list-arrow__container--disabled).list-arrow__container:hover .list-arrow__arrow-down {
    border-top-color: #666;
}
:not(.list-arrow__container--disabled).list-arrow__container:hover .list-arrow__arrow-up {
    border-bottom-color: #666;
}
:not(.list-arrow__container--disabled).list-arrow__container:hover .list-arrow__arrow-right {
    border-left-color: #666;
}


:not(.list-arrow__container--disabled).list-arrow__container a, 
:not(.list-arrow__container--disabled).list-arrow__container a>span {
    font-size: 1.5rem;
    color: #68d;
    cursor: pointer;
}


.list-arrow__container span  {
    color: #888;
}

.list-arrow__container a:hover {
    text-decoration: none;
}

:not(.list-arrow__container--disabled).list-arrow__container a:hover span {
    color: #8af;
}

.list-arrow__container span {
    cursor: default;
}

.list-arrow__container--disabled, 
.list-arrow__container--disabled span,
.list-arrow__container--disabled a {
    color: #888;
    cursor: not-allowed;
}


.list-arrow__start {
    margin-left: -12px;
    position: absolute;
}

.list-arrow__arrow-down {
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 12px solid #222;
}

.list-arrow__arrow-up {
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 12px solid #222;
}

.list-arrow__arrow-right {
    border-top: 12px solid transparent;
    border-bottom: 12px solid transparent;
    border-left: 12px solid #222;
} 

.list-arrow__body {
    display: flex;
    align-items: center;
    width: fit-content;
    background-color: #222;
    height: 24px;
    padding-left: 8px;
    padding-right: 6px;
    gap: 6px;
}
/* twine-user-stylesheet #22: "macro_notify.css" */
#notify {
    position : fixed;
    display : block;
    width : 16em;
    right : -20em; 
    top : 2em;
    padding : 0.5em;
    background-color : #fff;
    color : #000;
    -webkit-transition : right 0.3s;
    -moz-transition : right 0.3s;
    -o-transition : right 0.3s;
    transition : right 0.3s;
}

#notify.open { 
    right : 0; 
}
/* twine-user-stylesheet #23: "macro_toggle.css" */

label.toggle-button input[type="checkbox"] {
    display: none;
}

label.toggle-button input[type="checkbox"]:not(:checked) ~ span::after {
    font-family: tme-fa-icons;
    font-style: normal;
    font-weight: 400;
    font-variant: normal;
    text-transform: none;
    content: "\00a0\00a0\e830";
}

label.toggle-button input[type="checkbox"]:checked ~ span::after {
    font-family: tme-fa-icons;
    font-style: normal;
    font-weight: 400;
    font-variant: normal;
    /* color: #4a4; */
    color: #68d;
    text-transform: none;
    content: "\00a0\00a0\e831";
}

label.toggle-button span:hover {
    background-color: #333;
    border-color: #eee;
}

label.toggle-button span {
    display: inline-block;
    border-radius: 4px;
    cursor: pointer;
    color: #eee;
    background-color: transparent;
    border: 1px solid #444;
    line-height: normal;
    padding: .4em;
    margin-top: 2px;
    margin-bottom: 2px;
    -webkit-transition-duration: .2s;
    -o-transition-duration: .2s;
    transition-duration: .2s;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
/* twine-user-stylesheet #24: "party.css" */
.party-member__block {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
}

.party-member__block img {
    width: 120px;
}
/* twine-user-stylesheet #25: "questlog.css" */
#questlog-container {
    padding: 10px 4px;
    border: 2px solid red;
}

.questlog__quest {
    display: block;
}

.quest__main {
    display: flex;
    justify-content: space-between;
    color: black;
    cursor: pointer;
    padding-left: 10px;
    font-size: 24px;
    font-family: 'VT323', monospace;   
    background-color: #fff;
    border: 2px solid orange;
}

.quest__main--current {
    background-color: brown;
}

.quest__detail {
    background-color: #fff;
    color: black;
    display: none;
    margin-left: 20%;
    padding: 10px;
}

.quest__choose-btn {
    margin-top: 10px;
}

.quest__main-chosen {
    margin-right: 40px;
    font-style: 12px;
}
/* twine-user-stylesheet #26: "menu.css" */
#menu {
  display: none;
}

/* #menu-story > li > a:before{
  font-family: tme-fa-icons;
}

#menu-story > li:nth-child(1) > a:before{
  content: "\e812\00a0";
}

#menu-story > li:nth-child(2) > a:before{
  content: "\e800\00a0";
}

#menu-story > li:nth-child(3) > a:before{
  content: "\e82e\00a0";
}

#menu-story > li:nth-child(4) > a:before{
  content: "\e809\00a0";
}

#menu-story > li:nth-child(5) > a:before{
  content: "\e811\00a0";
}

#menu-story > li:nth-child(6) > a:before{
  content: "\e838\00a0";
} */

#menu li a {
  display: flex;
  padding: 0.25em 0.75em;
  align-items: center;
  border: 1px solid transparent;
  justify-content: center;
  color: #eee;
  text-transform: uppercase;
  gap: 2px;
}

/* #menu li:not(:first-child) {
  border-top: none;
}

#menu li:not(:first-child) a {
  border-top: 1px solid #444;
}

#menu li:not(:first-child) a:hover {
  border-top: 1px solid #eee;
} */


.language-select__container {
  display: inline-flex;
  gap: 8px;
  align-items: center;
}

.language-select__imaged-option {
  display: flex;
  align-items: center;
  gap: 4px;
  width: fit-content;
}

.language-select__imaged-option img {
  width: 22px;
  border: 1px solid #22222280;
  border-radius: 2px;
}

  

/* #menu a {
    -webkit-user-select: auto !important;
    -moz-user-select: auto !important;
    -ms-user-select: auto !important;
    user-select: auto !important;
}
   */


.menu-story {  
  margin: 1em 0 0;
  padding: 0;
  list-style: none;
  border: 1px solid #444;
}   

.menu-story__link {
  display: flex;
  padding: 0.3em 0.75em;
  align-items: center;
  border: 1px solid #444;
  justify-content: center;
  color: #eee;
  text-transform: uppercase;
  gap: 6px;
}

.menu-story__link:hover {
  background-color: #444;
  color: #fff;
  border: 1px solid #eee;
}

.menu-story__icon {
  width: 18px;
}

.menu-core {
  margin-top: 24px;
  margin-bottom: 12px;
}
/* twine-user-stylesheet #27: "misc.css" */
.refresh-link {
    display: inline-block;
    width: fit-content;
    height: fit-content;
    line-height: 1;
}

.refresh-icon {
    width: 20px;
    height: 20px;
    transition: transform .7s ease-in-out;
}

.refresh-link:hover .refresh-icon {
    transform: rotate(180deg);
}
/* twine-user-stylesheet #28: "modal.css" */
.modal {
    display: none; 
    position: fixed;
    justify-content: center;
    z-index: 50;
    padding-top: 5em; 
    left: 0;
    top: 0;
    min-width: 320px;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgb(0,0,0); 
    background-color: rgba(0,0,0,0.4); 
}

.modal--ml {
    animation-name: animateMarginLeft;
    animation-duration: .2s;
    margin-left: 0;
}

.modal--ml-back {
    animation-name: animateMarginLeftBack;
    animation-duration: .2s;
}

/* Modal Content */
.modal-content {
    display: none;
    position: absolute; 
    border: 1px solid #000;
    background-color: transparent;
    padding: 0;
    box-shadow: 0 4px 8px 0 #222,0 6px 20px 0 #222;
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 1.5s;
    animation-name: animatetop;
    animation-duration: 1.5s;
    margin-left: 25em;
    margin-right: 5em;
}


.modal.modal--ml .modal-content {
    margin-right: clamp(75px, 20em, calc(20em - 75px));
    margin-left: clamp(75px, 20em, calc(20em - 75px));
}


@media only screen and (min-width: 1440px) {
    .modal.modal--ml .modal-content {
        margin-right: clamp(75px, 50px, calc(35em - 75px));
        margin-left: clamp(75px, 20em, calc(20em - 75px));
    }
}

@media only screen and (min-width: 1200px) {
    .modal.modal--ml .modal-content {
        margin-right: auto;
        margin-left: auto;
    }
}



/* Add Animation */
@-webkit-keyframes animatetop {
    from {
        top:-300px; 
        opacity:0;
    } 
    to {
        top:100px; 
        opacity:1;
    }
}

@keyframes animatetop {
    from {
        top:-300px; 
        opacity:0;
    }
    to {
        top:100px; 
        opacity:1;
    }
}


@keyframes animateMarginLeft {
    from {
        margin-left: 20em;
    }
    to {
        margin-left: 0;
    }
}

@keyframes animateMarginLeftBack {
    from {
        margin-left: 0;
    }
    to {
        margin-left: 20em;
    }
}

/* The Close Button */
.close {
    display: block;
    color: #fff;
    font-size: 40px;
    font-weight: bold;
    max-height: 50px;
    margin-top: -12px;
    padding-left: 6px;
    padding-right: 6px;
    padding-bottom: 6px;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

.modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
    border-radius: 2px;
    
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-body {
    background-color: black;
    padding: 8px 16px;
}

.modal-footer {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
    border-radius: 2px;
}

.modal__buttons {
    display: flex;
    justify-content: flex-end;
    align-items: center;
}

.modal-header__title {
    text-shadow: 2px 2px 0 #222;
    letter-spacing: 1px;
    font-size: 1.75em;
}








.multiselect-container {
    display: flex;
    padding: 12px 0;
    width: 100%;
    height: 400px;
}

.multiselect-block {
    width: 300px;
    border: 1px solid green;
    padding: 12px;
}

.multiselect__move {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
}

.multiselect-option {
    cursor: pointer;
    border: 1px solid grey;
    margin-bottom: 12px;
    padding-left: 6px;
}

.multiselect-option:hover {
    background-color: grey;
    color: black;
}

.multiselect-option.multiselect-option--selected {
    background-color: yellow;
    color: black;
}

.highlight-bold {
    color: red;
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
}
/* twine-user-stylesheet #29: "on_hold.css" */
:root {
    --onholdHeight: 100px;
    --onholdWidth: 100px;
}


.onhold-block {
    position: relative;
    background-color: #fff;
    left: 0px;
    top: 30px;
    width: var(--onholdWidth);
    height: var(--onholdHeight);
    margin: 5px;
    z-index: 1;
}

.onhold-image {
    width: var(--onholdWidth);
    height: var(--onholdHeight);
    z-index: 2;
}

.onhold-layer {
    position: absolute;
    border-top: 0px solid teal;
    background-color: powderblue;
    z-index: 3;
    width: inherit;
    height: 0px;
    bottom: 0px;
    opacity: .4;
}
/* twine-user-stylesheet #30: "passage-list.css" */
.passage-list:first-child {
    margin-bottom: 20px;
}
/* twine-user-stylesheet #31: "popup.css" */
:root {
    --popupHeight: 30px;
    --popupWidth: 320px;
}

.popup-container {
    display: flex;
    flex-direction: column;
    position: fixed;
    right: 0px;
    top: 15px;
    width: var(--popupWidth);
    z-index: 33;
}

.popup {
    align-items: center;
    background-color: #fff;
    border: 4px solid transparent;
    border-radius: 1px;
    color: #263238;
    display: flex;
    font-size: 16px;
    font-weight: bold;
    height: var(--popupHeight);
    justify-content: flex-start;
    gap: 0 6px;
    letter-spacing: -1px;
    line-height: 16px;
    margin-bottom: 15px;
    outline: 4px solid #fff;
    padding: 6px 4px 4px 4px;
    position: relative;
    right: calc(-10px - var(--popupWidth));
    transition-property: right;
    z-index: 33;
    box-shadow: 2px 4px 20px 5px #fff;
    cursor: default;
}

.popup-icon {
    width: 28px;
    height: 28px;
}

.popup.popup--opened {
    right: 20px;
}


.popup--quest_start,
.popup--quest_complete {
    border-color: var(--quest-color);
}

.popup--quest_fail {
    border-color: var(--red);
}

.popup--task_created {
    border-color: #1e58ff;
}

.popup--quest_next_state {
    border-color: lightblue;
}

.popup--task_fail {
    border-color: red;
}

.popup--health_low,
.popup--stamina_low,
.popup--mana_low {
    border-color: moccasin;
}

.popup--stamina_not_enough {
    border-color: darkorange;
}

.popup--add_party{
    border-color: palegreen;
}

.popup--remove_party {
    border-color: peachpuff;
}

.popup--task_gather,
.popup--task_escort_finished,
.popup--task_escort_location {
    border-color: gainsboro;
}

/* twine-user-stylesheet #32: "port_data.css" */

.port__import-input {
    display: none;
}

.port__import-label {
    padding: 0px 8px;
    background-color: mintcream;
    cursor: pointer;
    display: block;
    border: 4px solid blue;
}

.port__import-label--item {
    width: auto;
    height: auto; 
    padding: 0 16px;
}

.port__import-text {
    font-size: 20px;
    color: black;
    text-align: center;
}

.port__import-label--item .port__import-text {
    font-size: 14px;
}

.port__export-link:after {
    content: none !important;
}

.port__table-container {
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 20px;
}

.port__container {
    display: flex;
    align-items: center;    
    gap: 20px; 
    margin-left: auto;
}
/* twine-user-stylesheet #33: "quest-btn.css" */

.quest-btn {
    align-items: center;
    background-color: transparent;
    cursor: pointer;
    display: flex;
    font-family: 'VT323', monospace;    
    font-weight: 500;
    gap: 0 14px;
    min-height: 40px;
    outline: none;
    padding: 4px 12px;
    position: relative;
    text-transform: uppercase;
    transition: all 0.3s ease;    
    border: 1px solid var(--quest-color);
    border-radius: 4px;
    margin-bottom: 12px;
    width: fit-content;
    min-width: 160px;
    padding-right: 18px;
}

.quest-btn:hover {
    border: 1px solid darkorange;
    background-color: #000;
    text-decoration: none;
    padding-right: 40px;
    padding-left: 20px;
    transform: translateX(12px);
    box-shadow: 2px 4px 12px darkorange;
}

.quest-btn:hover * {
    text-decoration: none;
}

.quest-btn * {
    color: var(--quest-color);
}

.quest-btn:hover * {
    color: darkorange;
}

.quest-btn:hover .state-mark[data-state="quest"] {
    --glow-color: darkorange;
}

.quest-btn:hover .state-mark[data-state="quest"] .state-mark__svg :nth-child(1),
.quest-btn:hover .state-mark[data-state="quest"] .state-mark__svg :nth-child(4){
    stroke: darkorange;
}


.state-mark .state-mark__svg {
    animation: logglow 1.25s ease infinite alternate;
    border-radius: 50%;
    padding: 5px;
}


.state-mark[data-state="quest"] {
    --glow-color: var(--quest-color);
}

.state-mark[data-state="quest"] .state-mark__svg path {
    stroke: var(--quest-color);
}


.state-mark[data-state="task"] {
    --glow-color: var(--task-color);
}

.state-mark[data-state="task"] .state-mark__svg path {
    stroke: var(--task-color);
}

.state-mark .state-mark__svg :nth-child(1) {
    stroke-width: 14;
    d: path("M40, 0 Q39, 60 50, 70");
}

.state-mark .state-mark__svg :nth-child(2) {
    stroke-width: 20;
    d: path("M33, 0 Q50, 0 67, 0");
}

.state-mark .state-mark__svg :nth-child(3) {
    stroke-width: 14;
    d: path("M60, 0 Q59, 60 50, 70");
}

.state-mark .state-mark__svg :nth-child(4) {
    stroke-width: 24;
    stroke-linecap: round;
    d: path("M50, 93 Q50, 95 50, 98");
}


.state-mark__svg {
    width: 16px;
    height: 16px;
    overflow: visible;
    display: block;
}

.state-mark__svg path {
    fill: none;
    stroke-width: 8;
    stroke: white;
    transition: 0.4s;
}

@keyframes logglow {
	 100% {
		 box-shadow: 0 0 8px 4px var(--glow-color);
	}
}


/* twine-user-stylesheet #34: "rarity.css" */
.defective {
    font-weight: bold;
    color: #534936;
}

.junk {
    font-weight: bold;
    color: lightsteelblue;
}

.common {
    font-weight: bold;
    color: mintcream;
}

.uncommon {
    font-weight: bold;
    color: mediumseagreen;
}

.rare {
    font-weight: bold;
    color: lightskyblue;
}

.epic {
    font-weight: bold;
    color: mediumpurple;
}

.legendary {
    font-weight: bold;
    color: chocolate;
}

.artifact {
    font-weight: bold;
    color: #EFFC31;
}

.divine {
    font-weight: bold;
    color: red;
}

/* twine-user-stylesheet #35: "scrolls.css" */
::-webkit-scrollbar {
    width: 12px;
}
  
::-webkit-scrollbar-track {
    box-shadow: inset 0 0 6px whitesmoke;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background-color: #a9a9a9;
    outline: 1px solid slategrey;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #c3c3c3; 
}
  


#ui-bar-body::-webkit-scrollbar {
    width: 6px;
}

#ui-bar-body::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
}

::-webkit-scrollbar-thumb:hover {
    background-color: #cfcfcf;
}
/* twine-user-stylesheet #36: "shadowed_img.css" */
.shadowed-img__container {
    width: fit-content;
    position: relative;
    overflow: hidden;
    max-width: 420px;
    max-height: 300px;
}
  
.shadowed-img__img-1 {
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 2;   
}
  
.shadowed-img__overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 4;
}
  
.shadowed-img__img-2 {
    position: absolute;
    width: 100%;
    height: 84%;
    top: 8%;
    left: 0;
    border-radius: 30%;
    object-fit: cover;
    z-index: 6;
}
/* twine-user-stylesheet #37: "sidebar.css" */
.sidebar-icon {
    width: 24px;
    height: auto;
    vertical-align: sub;
    margin-right: 2px;
}

.sidebar__time-hours  {
    margin-top: 10px;
}

.sidebar_xp-text {
    margin-bottom: -2px;
}

.sidebar__stats-player-name {
    font-family: 'RPGAwesome';
    font-size: 1.5rem;
    letter-spacing: 1px;
    cursor: default;
}

.sidebar__stats-money-text {
    font-family: 'Stgotic';
    font-size: 0.7rem;
    letter-spacing: 1px;
    color: #F3E7A7;
    cursor: default;
}

.sidebar__text {
    display: inline-block;
    font-family: 'SUPERSCR';
    letter-spacing: 2px;
    height: auto;
	transform: scaleY(1.25);
    vertical-align: bottom;
    font-size: 1rem;
    color: #ccc;
    cursor: default;
}

.sidebar__text--small {
    font-size: 0.75rem;
}

.sidebar__numbers {
    display: inline-block;
    font-family: 'Stgotic';
    font-size: 0.65rem;
    height: auto;
    color: #eee;
    cursor: default;
}

.sidebar__numbers--small {
    font-size: 0.45rem;
}

.sidebar__stats-container,
#sidebar__time-container {
    display: block;
    width: fit-content;
    margin: auto;
}
/* twine-user-stylesheet #38: "sketch.css" */

.text {
    font-weight: 400;
}

.text--gesture {
    font-size: 20px;
    color: yellowgreen;
    display: flex;
    justify-content: center;
}

.text--thought {
    font-style: italic;
    color: lightslategray;
    font-weight: bold;
}

.sketch__image {
    display: flex;
    position: relative;
    max-width: 300px;
    max-height: 360px;
    min-height: 212px;
    min-width: 212px;
    margin: auto; 
    border-radius: 10px;
    padding: 3px;
    border: 1px solid #303030;
    background-color: #ddd;
    z-index: 9;
}

.sketch__image:hover {
    transform: scale(1.5);
    box-shadow: 1px 1px 10px 4px rgb(232 232 232 / 30%);
    z-index: 12;
}

.sketch__video {
    max-width: 300px;
    max-height: 300px;
    min-height: 212px;
    min-width: 212px;
    display: flex;
    margin: auto; 
    border-radius: 10px;
    padding: 3px;
    border: 1px solid #303030;
    background-color: #ddd;
}

.sketch__video:hover {
    box-shadow: 1px 1px 10px 4px rgb(232 232 232 / 30%);
}

.sketch__image-files {
    display: flex;
}

.sketch__media-files-demo {
    display: none;
    min-width: 280px;
    padding: 10px;
    border: 1px solid #fff;
    margin-top: 15px;
}

#constructor .sketch-page .remove_sketch-page {
    display: none;
}

#constructor .sketch-page:last-of-type .remove_sketch-page {
    display: block;
}



.sketch-element-up, 
.sketch-element-down {
    position: absolute;
    height: 18px;
    left: -20px;
    font-size: 12px;
    padding: 0 3px;
}

.sketch-element-up {
    top: 8px;
}

.sketch-element-down { 
    top: 30px;
}

#constructor .sketch-element:first-of-type .sketch-element-up,
#constructor .sketch-element:last-of-type .sketch-element-down {
    display: none;    
}




.text-block { 
    display: inline-flex;
    padding-left: 4em;
}

@media only screen and (min-width: 480px) {
	.text-block {
        padding-left: 2em;
	}
}

@media only screen and (min-width: 400px) {
	.text-block {
        padding-left: 1em;
	}
}


.gesture-block {
    position: relative;
    border: 2px solid #20b2aa66;
    border-radius: 15px;
    gap: 0 8px;
    align-items: center;
    padding: 6px 20px;
    width: fit-content;
}

.gesture-block_img {
    position: absolute;
    border-radius: 50%;
    width: 40px;
    top: -18px;
    left: -14px;
    padding-left: 10px;
    padding-right: 8px;
    margin: 0;
    background-color: var(--black);
    z-index: 1;
    cursor: pointer;
}

.gesture-block_text {
    font-size: 20px;
    padding-left: 14px;
    color: #9bb4b3;
    text-shadow: 2px 2px 10px #dadadacc;
}


.thought-block {
    position: relative;
    border: 1px solid #5D435D99;
    border-radius: 15px;
    gap: 0 8px;
    align-items: baseline;
    padding: 6px 10px 2px;
}

.thought-block_img {
    position: absolute;
    width: 34px;
    top: -20px;
    left: -10px;
    padding-bottom: 2px;
    padding-left: 10px;
    padding-right: 8px;
    background-color: var(--black);
    border-radius: 50px;
    border-bottom-left-radius: 0px;
    margin: 0;
    z-index: 1;
    cursor: pointer;
}

.thought-block_text {
    padding-left: 10px;
    padding-right: 20px;
    color: #b4aab4;
    text-shadow: 2px 2px 10px #dadadacc;
    z-index: 2;
    position: relative;
}


.narration-block {
    position: relative;
    border: 1px solid #dadada;
    border-radius: 15px;
    gap: 0 8px;
    align-items: baseline;
    padding: 6px 10px;
}

.narration-block_img {
    position: absolute;
    width: 30px;
    top: -20px;
    left: -6px;
    padding-bottom: 2px;
    padding-left: 10px;
    padding-right: 8px;
    background-color: var(--black);
    border-radius: 50px;
    border-bottom-left-radius: 0px;
    margin: 0;
    z-index: 1;
    cursor: pointer;
}

.narration-block_text {
    font-style: italic;
    font-size: 22px;
    color: #a4a4a4;
    padding-left: 10px;
    padding-right: 20px;
    text-shadow: 2px 2px 10px #dadada;
}
/* twine-user-stylesheet #39: "socials.css" */
.social_link {
    display: flex !important;
    gap: 5px;
    align-items: center;
    width: auto;
}

.social_link__icon {
    height: 48px;
    width: 160px;
}
/* twine-user-stylesheet #40: "store.css" */
.store-item__image {
    width: 80px;
    height: 80px;
}

.store_item {
    display: flex;
    flex-direction: column;
    margin-bottom: 30px;
}

.store-item__underlevel {
    color: red;
    font-weight: bold;
}
/* twine-user-stylesheet #41: "tabs.css" */
.menu-tabs {
    overflow-x: auto;
    border: 1px solid #ccc;
    background-color: #222;
    width: fit-content;
    display: flex;
    justify-content: start;
    margin: 0;
    border-radius: 2px;
}

.menu-tabs a {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 20px;
    margin: 0;
    min-width: 70px;
    max-width: 100px;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
}

.menu-tabs a:not(:last-child) {
    border-right: 1px solid #444;
    
}

.menu-tabs a:hover {
    background-color: #444;
    border-color: #eee;
}

.menu-tabs .menu-tabs__item--active {
    background-color: #666;
    color: #eee;
    text-decoration: underline;
}
  
/* twine-user-stylesheet #42: "talk_menu.css" */
.talk-menu__item {
    margin-bottom: 30px;
}

.talk-menu__main-info {
    display: flex;
    gap: 8px;
}

.talk-menu__name {
    font-size: 2rem;
    letter-spacing: 1px;
    font-weight: bold;
    margin-top: -18px;
    margin-bottom: -10px;
}

.talk-menu__portrait {
    width: 160px;
    border-radius: 4px;
    border: 1px solid #222;
}
/* twine-user-stylesheet #43: "thelper.css" */
.thelper-message {
    display: block !important;
    position: absolute;
}

.thelper-message--style {
    display: none;
    color: #ccc;
    border: 1px solid #eee;
    border-radius: 4px;
    background-color: #222;
    padding: 5px 8px 3px;
    font-size: 0.875rem;
    position: absolute;
    text-wrap: nowrap;
    width: fit-content;
    z-index: 91;
    line-height: 14px;
    height: fit-content;
    letter-spacing: normal;
    text-transform: none;
}

.btn-thelper {
    position: relative;
}

.thelper-message--style p,
.thelper-message--style span {
    font-size: 0.875rem;
    padding: 0;
}

.btn-thelper:hover .thelper-message--style {
    display: block;
    bottom: 46px;
    left: 46px;
    padding: 2px 10px 4px;
    animation: fadeIn 1.2s ease-in-out;
}


@keyframes fadeIn {
    from { opacity: 0; }
      to { opacity: 1; }
}
/* twine-user-stylesheet #44: "tips.css" */


.tip_gen {
    cursor: default;
    border-radius: 8px;
    padding: 0px 10px;
    color: #fff;
    
    border: 1px solid #eee;
    background-color: #000;
    text-shadow: 1px 1px 0 #999;
}

.info_tip-wrapper {
    display: inline-flex;
    margin-left: 8px;
    margin-right: 6px;
    transition: all 0.5s;
}

.info_tip-container {
    display: inline-flex;
    position: relative;
    vertical-align: baseline;
    box-shadow: 0px 0px 8px #eeeeee66;
    border-radius: 50%;
    cursor: pointer;
    height: fit-content;
}

.info_tip-text {
    display: none;
    position: absolute;
    top: -20px;
    left: 30px;
    padding: 3px 6px 2px;
    min-width: 200px;
    max-width: 360px;
    width: max-content;
    background-color: #111;
}

@media screen and (max-width: 768px){
    .info_tip-text {
        width: fit-content;
        min-width: 160px;
        max-width: 180px;
    }
}

.info_tip-icon {
    width: 26px;
    height: 26px;
}

.info_tip-icon--hover {
    display: none;
    width: 26px;
    height: 26px;
}

.info_tip-container:hover  {
    box-shadow: 0px 0px 15px #eee;
}


.info_tip-container:hover .info_tip-text {
    display: block;
    z-index: 7;
}


.info_tip-container--large .info_tip-text {
    max-width: calc(72vw - 320px - 40px);
}

.info_tip-container:hover .info_tip-icon--hover {
    display: block;
}

.info_tip-container:hover .info_tip-icon {
    display: none;
}

.link-fake__tip-text {
    display: none;
    color: #fff;
    min-width: 300px;
    top: -36px;
    left: 46px;
    z-index: 5;
    padding-left: 10px;
}

.link-activity--fake:hover .link-fake__tip-text {
    display: block;
    position: absolute;
}




.tip-wrapper__text {
    display: flex;
    gap: 4px;
    position: relative;
    align-items: baseline;
}

.tip-wrapper__link {
    display: flex;
    gap: 4px;
    transition: all 0.5s;
    position: relative;
    width: fit-content;
}


.tip-wrapper__link:hover > * {    
    transition: all 0.5s;
    transform: translateX(12px);
}
    
.tip-wrapper__link:hover > .chat-link--blocked,
.tip-wrapper__link:hover > .chat-link--blocked ~ * {
    transform: none; 
}
</style><script role="script" id="twine-user-script" type="text/twine-javascript">/* twine-user-script #1: "_func_localization.js" */


const localization_system_text = {};
const localization_text = {};

// Updating l10nString strings.
$(document).on(":passageinit", function () {
    const lang = State.variables.settings.lang ?? 'en';
    const getl10nStringFunctions = {
        en: changel10nStrings_en,
        ua: changel10nStrings_ua,
        ru: changel10nStrings_ru,
        fr: changel10nStrings_fr
    };

    const changel10nStrings = getl10nStringFunctions[lang];
    changel10nStrings();
});


function updateClassObjects() {
    try {
        updateCharactersName();
    } catch (err) {
        alert(`Error has occurred during updateCharactersName!`); 
        console.error(err);
    }

    try {
        updateQuestlogDescription();
    } catch (err) {
        alert(`Error has occurred during updateQuestlogDescription!`); 
        console.error(err);
    }
}


function getLocalizedText(text_idn, lang=State.variables.settings.lang, error_txt) { 
    const error_def_msg = `"ERROR TEXT LINE: "${text_idn}" line for "${lang}" language !!!"`; 

    let placeholder_text = error_def_msg;
    if (error_txt) placeholder_text = error_txt; // check if received error_txt
    if ((!error_txt) && (localization_text['en'][text_idn])) placeholder_text = localization_text['en'][text_idn]; // check if there are 'en' text as placeholder

    const unified_localization_list = { ...localization_text[lang] ,  ...State.variables.temp.localization_text[lang] }; // concat system localization and created temporary localizations
    const text = unified_localization_list[text_idn] ?? placeholder_text;

    return text;
}


function getLocalizedSystemText(list, item, lang=State.variables.settings.lang) {
    const placeholder_text = `No translation of "${item}" in "${list}" for '${lang}'`;
    const localized_list = localization_system_text[lang][list];
    if (!localized_list) {
        console.error(`Localization list '${list}' does not exist. Lang: '${lang}'`);
        alert(`Localization list '${list}' does not exist`);
    } 
    const localized_text = localization_system_text[lang][list][item];

    return localized_text ?? placeholder_text;
}


function getLocalizedEntityText(task_idn, type, prop, lang=State.variables.settings.lang, error_txt) {        
    return getLocalizedText(`${type}_${task_idn}_${prop}`, lang, error_txt); 
}

// Check of localized text exists and is not empty
function hasNonEmptyLocalizedText(text_idn, type=false, prop=false) {
    const lang = State.variables.settings.lang;
    const unfound_err_msg = 'unfound'; // set error message if such text_idn is not exists
    const text = type ? 
        getLocalizedEntityText(text_idn, type, prop, lang, unfound_err_msg) :
        hasNonEmptyLocalizedText(text_idn, lang, unfound_err_msg);
    
    const result = ((text == unfound_err_msg) || (text == "")) ? false : true;
    return result;
}



function updateCharactersName() {   
    const characters = State.variables.characters;
    
    $.each(characters, function (index, character) {   
        const character_name = getLocalizedText[`characters_${character.id_name}_name`];

        State.variables.characters[character.id_name]['name'] = character_name;
    });
}

function updateQuestlogDescription() {    
    // const lang = State.variables.settings.lang;
    // const quests = State.variables.quests;
    
    // $.each(quests, function (index, quest) {   
    //     const quest_name = localization_quests[lang][quest.id_name];
    //     const quest_description = localization_quests[lang][`${quest.id_name}_${quest.status.id}`];

    //     State.variables['quests'][quest.id_name]['name'] = quest_name;
    //     State.variables['quests'][quest.id_name]['status']['description'] = quest_description;
    // });
}

function addLocalizationText(idn, value, lang) {
    const lang_lists = { ...localization_text,  ...State.variables.temp.localization_text};
    $.each(lang_lists, function (lang, lang_list) {  
        const lang_en_and_no_record = ((lang == 'en') && (!lang_list[idn]));
        const lang_en_and_has_record = ((lang == 'en') && (lang_list[idn]));
        const lang_not_en_and_no_record = ((lang !== 'en') && (!lang_list[idn]));
        const lang_not_en_and_has_record = ((lang !== 'en') && (lang_list[idn]));

        if (lang_en_and_no_record)      lang_list[idn] = value;
        if (lang_en_and_has_record)     lang_list[idn] = value;
        if (lang_not_en_and_no_record)  lang_list[idn] = value;
        // if (lang_not_en_and_has_record)  // do nothing

    });
}



function getLocalizedItemName(item) {
    const rarity_list = State.variables.lists.rarity_list;
    const cur_rarity = rarity_list[item.rarity_id];
    const localized_item_name = (item.sub_category) ? getLocalizedSystemText('item_list', item.sub_category) : getLocalizedSystemText('item_list', item.category);
    const special = (item.special) ? 'special' : '';
    const cracked = (item.cracked) ? 'cracked' : '';

    const name = `${cur_rarity} ${localized_item_name} ${special} ${cracked}`;

    return name;
}


    
$(document).on(":passagestart", function () {
    if (passage() == 'Menu_Settings' || passage() == 'index') {
        $(document).ready(function(){
            const cur_lang = State.variables.settings.lang;
            const lang_list = ['en', 'ua']; 

            const content = `
                <select id="language-select">
                    ${lang_list.map(lang => `
                        <option value="${lang}" ${(cur_lang === lang) ? 'selected' : ''}>
                            ${getLocalizedSystemText('lang_list', lang)}
                        </option>
                    `).join('\n')}
                </select>
            `;

            async function addLangSelect() { 
                $('.language-select__container').append(content);
            }

            addLangSelect().then( () => {
            $("#language-select").select2({
                    width: '140px',
                    templateSelection: langSelectFormated,
                    templateResult: langSelectFormated
                });
            });
            
        });
    }
});

function addRefreshButton() {
    const content = `
        <a data-passage=${passage()} class="refresh-link" data-thelper="refresh">
            <img src="media/icons/refresh.png" class="refresh-icon" alt="refresh-link" data-thelper="refresh"/>
        </a>
    `;
    $('.language-select__container').wiki(nobr(content))
}

function langSelectFormated (state) {
    if (!state.id) { return state.text; }
    let $state = $(
        `<span class="language-select__imaged-option"><img src="media/icons/countries/${state.id}.png" />${state.text}</span>`
    );
    return $state;
}


$(document).on('change', '#language-select', function() {
    const selected_lang = this.value;
    const cur_lang = $(this).closest('.language-select__container').data('lang');
    
    const refresh_elem = $(this).closest('.language-select__container').find('.refresh-link');
    const is_refresh_btn_existed = !!(refresh_elem[0]);
    if (is_refresh_btn_existed) refresh_elem.remove()

    if (selected_lang != cur_lang) {
        changeLanguage(selected_lang);
    
        addRefreshButton();
    }
});

function changeLanguage(new_lang=State.variables.settings.lang) {
    State.variables.settings.lang = new_lang;
    console.log(`language_changed to ${new_lang}`);

    $.each(localization_system_text[new_lang], (list_name, list) => State.variables.lists[list_name]=list ); //Updating lists (like month names, day names, etc.)
    
    updateClassObjects();     
}
/* twine-user-script #2: "content_en.js" */
localization_text['en'] = {
  "sk_sketch_warning_p_1_el_1_text": "Certain issues appeared. You should not see it. Please contact developers.",
  "setting_debug_mode_text": "Hello, I haven't seen you for a while. Will you help out in the pastures?",
  "test_quest_01": "Let`s start quest!",
  "test_quest_02": "Yeah, sure!",
  "test_quest_03": "But what is that quest about?",
  "test_quest_04": "Gather socks and shirts",
  "test_quest_05": "...",
  "test_quest_06": "No!",
  "test_quest_07": "Pretty please!",
  "test_quest_08": "Fine, but only because it`s a test quest.",
  "test_quest_1": "Please go to the forest and get me 3 branches.",
  "test_quest_2": "...",
  "test_quest_3": "...",
  "test_quest_4": "Why should I even do this?",
  "test_quest_5": "Because you are the main hero and you ave to do a lot of stupid errands to get experience.",
  "test_quest_6": "Ahh.. Fine!",
  "test_quest_7": "I was wondering if one of you kind people might direct me to the castle?",
  "test_quest_8": "Aaah... Shit... Monster is here! Kill him! Kiiill!",
  "quest_test": "Test Quest Name",
  "quest_test_1": "1)You've started Test Quest.",
  "quest_test_2": "2)This is test description line for simple localized text",
  "characters_alura_description": "Your childhood friend. Her family is poor. Her mother was low noble. She married Alura father and he left them",
  "characters_sekhmau_description": "Strong regeneration, need a master to protect, have no mercy, lightheaded on drinking, easy to get bored",
  "characters_mc_name": "Agnes",
  "characters_melissa_name": "Melissa",
  "characters_witch_name": "Witch",
  "characters_alura_name": "Alura",
  "characters_barret_name": "Barret",
  "characters_savia_name": "Savia",
  "characters_sekhmau_name": "Sekhmau",
  "characters_kalithara_name": "Kalithara",  
  "characters_mother_name": "Mother",
  "characters_father_name": "Father",
  "characters_mr_smith_name": "Mr. Smith",
  "characters_mrs_smith_name": "Mrs. Smith",
  "characters_ms_taylor_name": "Ms. Taylor",
  "characters_amelina_name": "Amelina",
  "characters_wizard_name": "Wizard",
  "characters_eredira_name": "Eredira",
  "characters_sextom_name": "Mr. Sexton",
  "characters_test_npc_name": "Test NPC",
  "characters_unknown_woman_name": "Unknown woman",
  "characters_tall_man_name": "Tall man",
  "characters_jovan_name": "Jovan Astalribe",
  "characters_unknown_man_name": "Unknown man",
  "characters_void_woman_name": "Familiar Void Woman",
  "quests_quest_tzmplate_name": "Quest tzmplate",
  "quests_initial_name": "Initial",
  "quests_fight_test_name": "fight_test",
  "quests_sketch_test_name": "Sketch Quest",
  "quests_eliminate_test_name": "eliminate Quest",
  "quests_search_test_name": "search Quest",
  "quests_escort_test_name": "escort Quest",
  "quests_escort_test_2_name": "escort Quest_2",
  "quests_gather_test_name": "gather Quest",
  "quests_distribute_test_name": "distribute Quest",
  "quests_quest_tzmplate_start_text": "tzmplate",
  "quests_fight_test_start_text": "fight quest",
  "quests_sketch_test_start_text": "sketch Quest",
  "quests_eliminate_test_start_text": "eliminate Quest",
  "quests_search_test_start_text": "search Quest",
  "quests_escort_test_start_text": "escort Quest",
  "quests_escort_test_2_start_text": "escort Quest_2",
  "quests_gather_test_start_text": "gather Quest",
  "quests_distribute_test_start_text": "distribute Quest",
  "task_quest_tzmplate_1_description": "",
  "task_quest_tzmplate_1_name": "Distribute Daggers",
  "task_quest_tzmplate_2_description": "",
  "task_quest_tzmplate_2_name": "Talk to Melissa",
  "task_quest_initial_description": "",
  "task_quest_initial_name": "Talk to Melissa (initial)",
  "task_quest_fight_test_1_description": "",
  "task_quest_fight_test_1_name": "Defeat 3 goblins",
  "task_quest_fight_test_2_description": "",
  "task_quest_fight_test_2_name": "Talk to Melissa (after defeating Goblin)",
  "task_sketch_task_description": "",
  "task_sketch_task_name": "Test Sketch",
  "task_quest_eliminate_test_1_description": "",
  "task_quest_eliminate_test_1_name": "Eliminate 3 goblins",
  "task_quest_eliminate_test_2_description": "",
  "task_quest_eliminate_test_2_name": "quest_eliminate_test_2",
  "task_quest_search_test_1_description": "",
  "task_quest_search_test_1_name": "Search twice",
  "task_quest_search_test_2_description": "",
  "task_quest_search_test_2_name": "Search once (optional)",
  "task_quest_search_test_3_description": "",
  "task_quest_search_test_3_name": "Talk to Melissa after search",
  "task_quest_escort_test_1_name": "Escort Melissa to Hallway",
  "task_quest_escort_test_1_description": "",
  "task_escort_gather_socks_name": "Optional Sock gathering",
  "task_escort_gather_socks_description": "",
  "task_escort_test_2_name": "Escort Alura (with Melissa)",
  "task_escort_test_2_description": "",
  "task_gather_socks_name": "Gather 3 Socks (optional)",
  "task_gather_socks_description": "",
  "task_gather_keys_name": "Gather 2 keys (optional)",
  "task_gather_keys_description": "",
  "task_gather_stage_2_name": "Talk to Melissa after gathering",
  "task_gather_stage_2_description": "",
  "task_distribute_gather_socks_name": "Gather for distr",
  "task_distribute_gather_socks_description": "",
  "task_distribute_gather_keys_name": "Gather keys for distr",
  "task_distribute_gather_keys_description": "",
  "task_distribute_socks_name": "Distribute socks",
  "task_distribute_socks_description": "",
  "task_distribute_keys_name": "Distribute keys",
  "task_distribute_keys_description": "",
  "task_distribute_dagger_name": "Distribute dagger",
  "task_distribute_dagger_description": "",
  "task_test_gather_socks_name": "Test socks gather 4",
  "task_test_gather_socks_description": "",
  "task_test_gather_keys_name": "Test Keys gather 4",
  "task_test_gather_keys_description": "",
  "task_quest_test_sketch_1_name": "Sketch",
  "task_quest_test_sketch_1_description": "",
  "task_quest_test_fight_1_name": "Fight Test",
  "task_quest_test_fight_1_description": "",
  "quests_quest_tzmplate_description": "",
  "quests_initial_description": "",
  "quests_initial_start_text": "Initial",
  "quests_fight_test_description": "",
  "quests_sketch_test_description": "",
  "quests_eliminate_test_description": "",
  "quests_search_test_description": "",
  "quests_escort_test_description": "",
  "quests_escort_test_2_description": "",
  "quests_gather_test_description": "",
  "quests_distribute_test_description": "Gather and distribute",
  "sk_sketch_demo_1_p_1_el_1_text": "You Should Not See That Text.",
  "sk_sketch_demo_1_p_1_el_3_text": "Default text",
  "sk_sketch_demo_1_p_1_el_4_text": "Thought text",
  "sk_sketch_demo_1_p_1_el_5_text": "Gesture text",
  "sk_sketch_demo_1_p_1_el_8_text": "Choice 8(to page 2)",
  "sk_sketch_demo_1_p_1_el_9_text": "Choice 9(to forest)",
  "sk_sketch_demo_1_p_1_el_10_text": "Choice 10(to bedroom)",
  "sk_sketch_demo_1_p_2_el_1_text": "Speech 2 (from melissa)",
  "sk_sketch_demo_1_p_2_el_5_text": "Choice 5 (to kitchen)",
  "sk_sketch_demo_2_p_1_el_1_text": "Speech 1(mc)",
  "sk_sketch_demo_2_p_1_el_2_text": "Choice 2 (to test1 passage)",
  "sk_sketch_demo_2_p_1_el_3_text": "Choice 3 (to page 2)",
  "sk_sketch_demo_2_p_2_el_1_text": "Text gesture (page 2)",
  "sk_test_quest_1_p_1_el_1_text": "Though text 1",
  "sk_test_quest_1_p_1_el_2_text": "Choice 2(to home kitchen)",
  "items_test_quest_item_2_name": "Test dagger 2",
  "items_test_quest_item_2_description": "",
  "items_test_quest_item_1_name": "Test Key",
  "items_test_quest_item_1_description": "",
  "items_test_weapon_1_name": "Test stiletto 1",
  "items_test_weapon_1_description": "",
  "sk_skip_passage_sketch_p_1_el_1_text": "Move to 'After Prologue'",
  "sk_prologue_loc_1_p_1_el_1_text": "You open your eyes and see a familiar ceiling you see each day. ",
  "sk_prologue_loc_1_p_1_el_3_text": "You yawn and close your eyes again. ",
  "sk_prologue_loc_1_p_1_el_4_text": "Well, so what should I do today? ",
  "sk_prologue_loc_1_p_1_el_5_text": "Hm, I guess I'll start with grabbing some chicken salad from yesterday and go visit... ",
  "sk_prologue_loc_1_p_1_el_6_text": "Suddenly the stream of your thoughts is interrupted by the subtle creaking of the floor. ",
  "sk_prologue_loc_1_p_1_el_7_text": "You turn towards that sound and see that your sister sits on her bed staring at you while fidgeting with her blanket.",
  "sk_prologue_loc_1_p_1_el_8_text": "She's dressed up, it doesn't look like she just woke up.",
  "sk_prologue_loc_1_p_1_el_9_text": "Ah, now I see, I know that look of her..",
  "sk_prologue_loc_1_p_1_el_11_text": "It is clear that she needs something and sits there in anticipation to ask me about it.",
  "sk_prologue_loc_1_p_1_el_12_text": "Greet your sister",
  "sk_prologue_sk_1_p_1_el_1_text": "Good Morning.",
  "sk_prologue_sk_1_p_1_el_2_text": "Hm.. morning..",
  "sk_prologue_sk_1_p_1_el_3_text": "With these words, she began to gingerly approach you.",
  "sk_prologue_sk_1_p_1_el_4_text": "So? What do you need?",
  "sk_prologue_sk_1_p_1_el_5_text": "Just wanted to say good morning to my wonderful brother.",
  "sk_prologue_sk_1_p_1_el_6_text": "She came close to you and put the brightest smile she has.",
  "sk_prologue_sk_1_p_1_el_7_text": "It seemed like her eyes and aura around her sparkled.",
  "sk_prologue_sk_1_p_1_el_9_text": "Darn, she can be so cute when she wants...",
  "sk_prologue_sk_1_p_1_el_10_text": "Since you had to use max of your charms, you must really want something from me. ",
  "sk_prologue_sk_1_p_1_el_11_text": "So stop trying to butter me up and just spill the beans.",
  "sk_prologue_sk_1_p_1_el_12_text": "As expected of my brother, the level of your insight is high as ever!",
  "sk_prologue_sk_1_p_1_el_13_text": "You roll your eyes.",
  "sk_prologue_sk_1_p_1_el_14_text": "Okay, okay, I'll stop.",
  "sk_prologue_sk_1_p_1_el_15_text": "As for the thing I want to ask... well...",  
  "sk_prologue_sk_1_p_1_el_16_text": "She sighs heavily.",
  "sk_prologue_sk_1_p_1_el_17_text": "...today I woke up early in the morning, took mom's fancy brooch, a nice pair of outfits and went for a walk by the lake...",
  "sk_prologue_sk_1_p_1_el_18_text": "And.. umm.. I accidentally dropped the brooch into the lake.",
  "sk_prologue_sk_1_p_1_el_19_text": "...",
  "sk_prologue_sk_1_p_1_el_20_text": "For a few seconds, there's a brief silence in the room.",
  "sk_prologue_sk_1_p_1_el_21_text": "Why did you take all of that stuff in the first place?",
  "sk_prologue_sk_1_p_1_el_22_text": "Well, it's a bit embarrassing...",
  "sk_prologue_sk_1_p_1_el_23_text": "You silently gaze at her, waiting for her to explain.",
  "sk_prologue_sk_1_p_1_el_24_text": "Ah, sometimes in the morning, I borrow mom's most beautiful things and go to the lake to pretend I'm some popular girl at a fancy event. ",
  "sk_prologue_sk_1_p_1_el_25_text": "While making poses and looking at the water, I imagine myself at different places from the books.",
  "sk_prologue_sk_1_p_1_el_26_text": "Hmm.. I see.. But isn't it a bit early for you to be thinking about things like that?",
  "sk_prologue_sk_1_p_1_el_27_text": "No, it's not!",
  "sk_prologue_sk_1_p_1_el_28_text": "Melissa looks a bit offended now.",
  "sk_prologue_sk_1_p_1_el_29_text": "She will not let it go easily, so I guess I don't have much of a choice.",
  "sk_prologue_sk_1_p_1_el_30_text": "Agree to find the brooch",
  "sk_prologue_sk_1_p_2_el_1_text": "Ugh, fine, I'll find this brooch.",
  "sk_prologue_sk_1_p_2_el_2_text": "Melissa practically jumps on you and hugs you.",
  "sk_prologue_sk_1_p_2_el_3_text": "Thank you a lot!",
  "sk_prologue_sk_1_p_2_el_5_text": "This little girl surely knows how to use her charms against me.",
  "sk_prologue_sk_1_p_2_el_6_text": "I'll return outfits to parents room and hang around here to make up an excuse in case someone asks where you went.",
  "sk_prologue_sk_1_p_2_el_7_text": "And please try to find it quickly, I've been so worried. ",
  "sk_prologue_sk_1_p_2_el_8_text": "You should really learn how to swim already. ",
  "sk_prologue_sk_1_p_2_el_9_text": "Yeah, yeah, we can discuss it when you're back.",
  "sk_prologue_sk_1_p_2_el_10_text": "I hope everything will go smoothly and I can return quickly.",
  "sk_prologue_sk_1_p_2_el_11_text": "Go to the lake",
  "quests_q_search_brooch_name": "Find the brooch",
  "quests_q_search_brooch_description": "Need to help my sister.",
  "quests_q_search_brooch_start_text": "Get 'Find the brooch' Quest",
  "task_prologue_search_name": "Search for the brooch",
  "task_prologue_search_description": "Need to find the brooch that Melissa lost.",
  "task_prologue_search_2_name": "Search again",
  "task_prologue_search_2_description": "Need to find the brooch that Melissa lost.",
  "task_prologue_gather_name": "Grab the brooch",
  "task_prologue_gather_description": "A shinny object I saw could be a brooch I'm looking for.",
  "sk_prologue_loc_2_p_1_el_2_text": "You arrived at the lake. \n The atmosphere is incredibly serene and peaceful. ",
  "sk_prologue_loc_2_p_1_el_3_text": "It's really peaceful and chill here.",
  "sk_prologue_loc_2_p_1_el_4_text": "Need to come here more often.",
  "sk_prologue_loc_2_p_1_el_5_text": "You've been diving in search of anything that matches the description of the brooch your sister gave you. \n However, you haven't had any luck so far.",
  "sk_prologue_loc_2_p_1_el_6_text": "I'm really tired. I should take a break before I continue.",
  "sk_prologue_loc_2_p_1_el_7_text": "I should definitely teach Melissa how to swim.\n It'd be good if she could manage things like this herself next time.",
  "sk_prologue_loc_2_p_1_el_8_text": "I need to keep searching for that brooch.",
  "sk_prologue_loc_2_p_1_el_9_text": "But maybe I could use a bit more rest.",
  "sk_prologue_loc_3_p_1_el_2_text": "The last time I dived, I caught a glimpse of something glowing off to my left.",
  "sk_prologue_loc_3_p_1_el_3_text": "I should dive over there again and get whatever it is.",
  "sk_prologue_loc_3_p_1_el_4_text": "Even if it's not the brooch, it might still be something valuable.\n It could be a piece of jewelry that I could sell or give as a gift.",
  "sk_prologue_sk_2_p_1_el_1_text": "Diving near that spot, you found out that it is indeed the brooch you were looking for.",
  "sk_prologue_sk_2_p_1_el_3_text": "However, there is something else present as well.",
  "sk_prologue_sk_2_p_1_el_4_text": "You attempt to grasp it too.",
  "sk_prologue_sk_2_p_1_el_6_text": "The moment you lay hands on that object, your body becomes paralyzed.",
  "sk_prologue_sk_2_p_1_el_7_text": "A vivid, multicolored canvas unfolds before your eyes.",
  "sk_prologue_sk_2_p_1_el_9_text": "Your chest tightens, and instinctively, you open your mouth as if to take a breath, forgetting you're underwater.", 
  "sk_prologue_sk_2_p_1_el_10_text": "Choking and losing focus, your awareness starts to fade.",
  "sk_prologue_sk_2_p_1_el_11_text": "Pass out",
  "sk_prologue_sk_3_p_1_el_1_text": "During an uncertain state, you see some odd images.",
  "sk_prologue_sk_3_p_1_el_2_text": "...",
  "sk_prologue_sk_3_p_1_el_4_text": "I have a feeling like she is someone I've known for a long time... <br> But who is she?",
  "sk_prologue_sk_3_p_1_el_5_text": "...",
  "sk_prologue_sk_3_p_1_el_7_text": "This looks like capital... in flames...",
  "sk_prologue_sk_3_p_1_el_8_text": "...",
  "sk_prologue_sk_3_p_1_el_10_text": "Another woman that feels familiar... <br> What is she doing?",
  "sk_prologue_sk_3_p_1_el_11_text": "...",
  "sk_prologue_sk_3_p_1_el_12_text": "And then you wake up",
  "sk_prologue_sk_4_p_1_el_2_text": "You awaken, your vision clearing as you find yourself in an unfamiliar location.",
  "sk_prologue_sk_4_p_1_el_4_text": "You see a woman standing nearby. ",
  "sk_prologue_sk_4_p_1_el_5_text": "She notices your return to consciousness and gives you a worried look.",
  "sk_prologue_sk_4_p_1_el_6_text": "Hello, my dear.",
  "sk_prologue_sk_4_p_1_el_7_text": "Her words hang in the air as you find yourself trying to piece together the puzzle of your situation.",
  "sk_prologue_sk_4_p_1_el_8_text": "She continues, her voice laced with a sense of urgency.",
  "sk_prologue_sk_4_p_1_el_9_text": "I sensed a surge of magical energy through my enchantments and hurried to investigate.",
  "sk_prologue_sk_4_p_1_el_10_text": "That's when I found you at the bottom of the lake. <br> You were on the brink of death, but I managed to bring you back using a special potion.",
  "sk_prologue_sk_4_p_1_el_11_text": "I think you touched something you shouldn't have. ", 
  "sk_prologue_sk_4_p_1_el_12_text": "But that's not the matter now, we needed to finish your curing quickly!",
  "sk_prologue_sk_4_p_1_el_13_text": "Wait a second, I have a question.",
  "sk_prologue_sk_4_p_1_el_14_text": "Was that object something of such value that it had its own protection?",
  "sk_prologue_sk_4_p_1_el_15_text": "Did I inflicted a curse or something like that by touching that object?",
  "sk_prologue_sk_4_p_2_el_1_text": "Yes, you're right about that one. This object is the cause of what happened.",
  "sk_prologue_sk_4_p_2_el_2_text": "It looks like you've discovered an object from one ancient tale.",
  "sk_prologue_sk_4_p_2_el_3_text": "According to it, you can be a hero that finds this mythical item, gains big power and leads nations to a new age.",
  "sk_prologue_sk_4_p_2_el_4_text": "However, as you can see, it's not something anyone can easily obtain.",
  "sk_prologue_sk_4_p_2_el_5_text": "We need to perform a ritual to activate the abilities and adapt your body to it, otherwise it could become a huge problem for your health and life. So it's better to act quickly!",
  "sk_prologue_sk_4_p_2_el_6_text": "But why the artifact would kill its hero?",
  "sk_prologue_sk_4_p_2_el_7_text": "Only those who are worthy can obtain such strength.",
  "sk_prologue_sk_4_p_2_el_8_text": "Also, you know what they say: great power, great consequences.",
  "sk_prologue_sk_4_p_2_el_9_text": "So what should we do?",
  "sk_prologue_sk_4_p_3_el_1_text": "Yes, you're right about that one. This object is the cause of what happened.",
  "sk_prologue_sk_4_p_3_el_2_text": "It seems that you've discovered a cursed artifact, and it's quite powerful.",
  "sk_prologue_sk_4_p_3_el_3_text": "It is making you sick and ill, and if we don't take action, it will ultimately lead to your demise.",
  "sk_prologue_sk_4_p_3_el_4_text": "We only have a limited amount of time to extract it from your body to make sure you stay alive and prevent permanent damage.",
  "sk_prologue_sk_4_p_3_el_5_text": "What the hell did I get myself into?",
  "sk_prologue_sk_4_p_3_el_6_text": "What can we do?",
  "sk_prologue_sk_4_p_4_el_1_text": "I've prepared all the necessary equipment and gotten the spell ready before you woke up.",
  "sk_prologue_sk_4_p_4_el_2_text": "Drink these potions first. ",
  "sk_prologue_sk_4_p_4_el_3_text": "Then lie down, relax and do not resist.",
  "sk_prologue_sk_4_p_4_el_4_text": "It would be painful, but you need to overcome it.",
  "sk_prologue_sk_4_p_4_el_5_text": "All of this rush so quickly.",
  "sk_prologue_sk_4_p_4_el_6_text": "You can call it your first task as a hero!",
  "sk_prologue_sk_4_p_4_el_7_text": "If we don't do this now, it's gonna get a lot worse. You must endure it for a short while!",
  "sk_prologue_sk_4_p_4_el_8_text": "Trust",
  "sk_prologue_sk_4_p_4_el_9_text": "Refuse",
  "sk_prologue_sk_4_p_5_el_1_text": "Her face began to show signs of annoyance.",
  "sk_prologue_sk_4_p_5_el_2_text": "But she continued with a composed and inquisitive tone. ",
  "sk_prologue_sk_4_p_5_el_3_text": "We have to rescue you!",
  "sk_prologue_sk_4_p_5_el_4_text": "If you didn't catch something, I can explain it again later. ",
  "sk_prologue_sk_4_p_5_el_5_text": "But right now, time is our most prioritized resource.",
  "sk_prologue_sk_4_p_5_el_6_text": "Agree to her proposal",
  "sk_prologue_sk_4_p_5_el_7_text": "Refuse",
  "sk_prologue_sk_4_p_6_el_1_text": "After about half an hour.",
  "sk_prologue_sk_4_p_6_el_2_text": "It hurts so much! Please stop!",
  "sk_prologue_sk_4_p_6_el_3_text": "We can't! It will be even worse if we pause this now.",
  "sk_prologue_sk_4_p_6_el_4_text": "I feel like my life is getting drained!",
  "sk_prologue_sk_4_p_6_el_5_text": "That just means it's working!",
  "sk_prologue_sk_4_p_6_el_6_text": "You're replacing your current peasant life source with a heroic one.",
  "sk_prologue_sk_4_p_6_el_7_text": "Try your best to suppress your inner resistance! It'll be over faster then.",
  "sk_prologue_sk_4_p_6_el_8_text": "Fuck, it's painful!",
  "sk_prologue_sk_4_p_6_el_9_text": "Trust her anyway",
  "sk_prologue_sk_4_p_6_el_10_text": "Stop this torture ",
  "sk_prologue_sk_4_p_7_el_1_text": "After about an hour.",
  "sk_prologue_sk_4_p_7_el_2_text": "Stop! I can't bear it anymore!",
  "sk_prologue_sk_4_p_7_el_3_text": "You feel like you're on the verge of dying because of unbearable pain.",
  "sk_prologue_sk_4_p_7_el_4_text": "You must overcome it! Embrace the feeling! Do not struggle!",
  "sk_prologue_sk_4_p_7_el_5_text": "Ahhh! I feel like dying!",
  "sk_prologue_sk_4_p_7_el_6_text": "You will feel that way, but then you'll be reborn!  ",
  "sk_prologue_sk_4_p_7_el_7_text": "Now, all you can do is emit gagging sounds.",
  "sk_prologue_sk_4_p_7_el_8_text": "Just a little left!",
  "sk_prologue_sk_4_p_7_el_9_text": "Give up to the feeling of death",
  "sk_prologue_sk_4_p_7_el_10_text": "Take all your will and stop it",
  "sk_prologue_sk_de_1_p_1_el_2_text": "You were overwhelmed with agony and despair.",
  "sk_prologue_sk_de_1_p_1_el_5_text": "Barely able to recognize anything, you heard:",
  "sk_prologue_sk_de_1_p_1_el_8_text": "Ah! Yes!",
  "sk_prologue_sk_de_1_p_1_el_11_text": "... ",
  "sk_prologue_sk_de_1_p_1_el_14_text": "..orked!",
  "sk_prologue_sk_de_1_p_1_el_17_text": " ... ",
  "sk_prologue_sk_de_1_p_1_el_20_text": "..nally got the first one!",
  "sk_prologue_sk_de_1_p_1_el_23_text": "Those were the last words you heard before your life was swallowed by the darkness.",
  "sk_prologue_sk_de_1_p_1_el_26_text": "...",
  "sk_prologue_sk_5_p_1_el_1_text": "With great effort you stand up, breaking the current spell.",
  "sk_prologue_sk_5_p_1_el_2_text": "But if...",
  "sk_prologue_sk_5_p_1_el_3_text": "This is too much!",
  "sk_prologue_sk_5_p_1_el_4_text": "I will not do it! I've made up my mind!",
  "sk_prologue_sk_5_p_1_el_5_text": "The witch is clearly furious.",
  "sk_prologue_sk_5_p_1_el_6_text": "I appreciate you trying to help, but this is way over the top!",
  "sk_prologue_sk_5_p_1_el_7_text": "You probably are trying to help, but the decision is still mine.",
  "sk_prologue_sk_5_p_1_el_8_text": "I'd better see how things will play out first.",
  "sk_prologue_sk_5_p_1_el_9_text": "You ungrateful fool!",
  "sk_prologue_sk_5_p_1_el_10_text": "You should've just endured it a little longer, you little shrimp!",
  "sk_prologue_sk_5_p_1_el_11_text": "You didn't even try, you little shrimp!",
  "sk_prologue_sk_5_p_1_el_12_text": "The witch casts a restriction spell on you.",
  "sk_prologue_sk_5_p_1_el_13_text": "What the hell?",
  "sk_prologue_sk_5_p_1_el_14_text": "The witch attempts to perform the ritual without your consent. ",
  "sk_prologue_sk_5_p_1_el_15_text": "I've got my doubts whether she really intended to help me with the artifact, if this even was an artifact at all.",
  "sk_prologue_sk_5_p_1_el_16_text": "I doubt she ever really tried to lift the curse, if there even was one.",
  "sk_prologue_sk_5_p_1_el_17_text": "You only feel a bit more tired and dizzy.",
  "sk_prologue_sk_5_p_1_el_18_text": "It seems like without my consent, it's not going to work!",
  "sk_prologue_sk_5_p_1_el_19_text": "Shut your damn mouth!",
  "sk_prologue_sk_5_p_1_el_20_text": "In a fit of rage, she tries to cast something else. <br> But the mana around becomes visibly unstable and then... ",
  "sk_prologue_sk_5_p_1_el_21_text": "...you're consumed by the void...",
  "sk_prologue_sk_5_p_1_el_22_text": "...",
  "sk_prologue_sk_5_p_2_el_1_text": "Suddenly, you feel like you've fallen from a small height.",
  "sk_prologue_sk_5_p_2_el_2_text": "Ouch!",
  "sk_prologue_sk_5_p_2_el_3_text": "As your vision clears, you take a look around and realize that you're somewhere in the middle of a dense forest.",
  "sk_prologue_sk_5_p_2_el_4_text": "I need to return to the village!",
  "sk_prologue_sk_5_p_2_el_5_text": "...",
  "sk_prologue_sk_5_p_2_el_6_text": "After some amount of time wading through the forest, you see familiar landscape.",
  "sk_prologue_sk_5_p_2_el_8_text": "Phew, I finally see the outskirts of my village.",
  "sk_prologue_sk_5_p_2_el_9_text": "As you look at the village, you lean against a nearby tree. <br> The events of the recent past swirl in your mind.",
  "sk_prologue_sk_5_p_2_el_10_text": "Was all of that even real?",
  "sk_prologue_sk_5_p_2_el_11_text": "You feel your knees start trembling and your head begins to spin.",
  "sk_prologue_sk_5_p_2_el_12_text": "Never mind for now, I have to make it home while I still have some powers left.",
  "sk_prologue_sk_5_p_2_el_13_text": "Gathering the last of your strength and consciousness, you set your course towards...",
  "sk_prologue_sk_5_p_2_el_14_text": "...home",
  "sk_prologue_sk_6_p_1_el_1_text": "As time passes, you awaken in an oddly familiar void, regaining your consciousness bit by bit.",
  "sk_prologue_sk_6_p_1_el_2_text": "Huh? What happened?",
  "sk_prologue_sk_6_p_1_el_3_text": "The last thing I remember, I saw the door of my home.",
  "sk_prologue_sk_6_p_1_el_4_text": "You attempt to orient yourself in the surroundings, but it's just darkness everywhere.",
  "sk_prologue_sk_6_p_1_el_5_text": "Hm, this feels similar to when I was drowning. ",
  "sk_prologue_sk_6_p_1_el_6_text": "But now my mind is less hazy.",
  "sk_prologue_sk_6_p_1_el_7_text": "Gradually, you start to see faint pieces of an uncertain scene.",
  "sk_prologue_sk_6_p_1_el_8_text": "I feel I'm able to make it more clear.",
  "sk_prologue_sk_6_p_1_el_9_text": "You spend some time focusing on gaining control over that feeling.",
  "sk_prologue_sk_6_p_1_el_10_text": "A few minutes later, you feel like you can not only make it clear but also immerse yourself in it.",
  "sk_prologue_sk_6_p_1_el_11_text": "Maybe this will help me to get back to wherever I am in reality right now.",
  "sk_prologue_sk_6_p_1_el_12_text": "You concentrate hard on the image you've encountered and...",
  "sk_prologue_sk_6_p_1_el_13_text": "...immerse yourself in it.",
  "sk_prologue_sk_6_p_2_el_1_text": "After a few moments of complete darkness, you find yourself face to face with the woman from your previous void experience.",
  "sk_prologue_sk_6_p_2_el_3_text": "However, this time you're seeing through her eyes as she peers at her own reflection in the mirror.",
  "sk_prologue_sk_6_p_2_el_4_text": "Would you please stop admiring yourself?", 
  "sk_prologue_sk_6_p_2_el_5_text": "You know how I enjoy viewing beautiful things, don't you?",
  "sk_prologue_sk_6_p_2_el_6_text": "From within the void woman's perspective, which you currently share, you see the gaze turns to the person who asked a question first.",
  "sk_prologue_sk_6_p_2_el_8_text": "It's that damn witch, even though she looks younger.",
  "sk_prologue_sk_6_p_2_el_9_text": "Now isn't the time for jokes, Kalithara!",
  "sk_prologue_sk_6_p_2_el_10_text": "You called me by name, so it has to be serious.",
  "sk_prologue_sk_6_p_2_el_11_text": "Yes, it will be goddamn serious, if we're going to start it!",
  "sk_prologue_sk_6_p_2_el_12_text": "You understand just how challenging this will be, the dangers that lie ahead, and how slim our chances are!",
  "sk_prologue_sk_6_p_2_el_13_text": "Having second thoughts?",
  "sk_prologue_sk_6_p_2_el_14_text": "It's not that, I'm fully committed to achieving of what we must!",
  "sk_prologue_sk_6_p_2_el_15_text": "However, you seem strangely relaxed about something of such scale that we must put in motion next month already!",
  "sk_prologue_sk_6_p_2_el_16_text": "It's just looks as if you aren't taking it serious enough, while I can't stop being on edge and that's what pisses me off so much!",
  "sk_prologue_sk_6_p_2_el_17_text": "For me it's just inevitable. We will persist for as long as it takes and wipe out anyone or anything that stands in our way!" ,
  "sk_prologue_sk_6_p_2_el_18_text": "As for the rest, whatever will happen, will happen.",
  "sk_prologue_sk_6_p_2_el_19_text": "Thus, I'm not overwhelmed by it.",
  "sk_prologue_sk_6_p_2_el_20_text": "If it eases your mind,  just remember that I'll be right there with you all the way, and together, we'll gain the power that could end the world as we know it.",
  "sk_prologue_sk_6_p_2_el_21_text": "The witch appears somewhat calmer and more relaxed after these words.",
  "sk_prologue_sk_6_p_2_el_22_text": "Yeah, I guess you're right. I just got nervous. Uh, I still have much to learn from you.",
  "sk_prologue_sk_6_p_2_el_23_text": "You watch as Kalithara shifts her focus back to the mirror.",
  "sk_prologue_sk_6_p_2_el_24_text": "You notice a subtle, mischievous smile forming on her lips as she gazes directly into her own eyes in the reflection.",
  "sk_prologue_sk_6_p_2_el_25_text": "Wait, does she...",
  "sk_prologue_sk_6_p_2_el_26_text": "Suddenly, an immense force throws you out of that place.",
  "sk_prologue_sk_6_p_2_el_27_text": "...",
  "sk_prologue_loc_4_p_1_el_1_text": "You wake up abruptly, automatically lifting your upper body while still lying down.",
  "sk_prologue_loc_4_p_1_el_2_text": "Did she see me? Did she know I was watching?",
  "sk_prologue_loc_4_p_1_el_3_text": "You feel cold sweat all over your body.",
  "sk_prologue_loc_4_p_1_el_4_text": "Well, my usual feelings are back. And I'm no longer in that void.",
  "sk_prologue_loc_4_p_1_el_5_text": "After rubbing your eyes, you look around.",
  "sk_prologue_loc_4_p_1_el_6_text": "You find yourself in your room with your sister sleeping by your bed.",
  "sk_prologue_loc_4_p_1_el_8_text": "I don't know what happened yesterday, but at least I'm back home.",
  "sk_prologue_loc_4_p_1_el_9_text": "You look out of a window and see that it's already daytime.",
  "sk_prologue_loc_4_p_1_el_10_text": "I need to wake her up and find out what happened while I was out.",
  "sk_prologue_loc_4_p_1_el_11_text": "Awaken her",
  "sk_prologue_loc_4_p_2_el_1_text": "You gently start to shake her shoulder.",
  "sk_prologue_loc_4_p_2_el_2_text": "She starts to open her sleepy eyes, while looking in your direction.",
  "sk_prologue_loc_4_p_2_el_4_text": "You see her starting to realize that you're looking at her.",
  "sk_prologue_loc_4_p_2_el_5_text": "Then she jumps to hug you straightaway and starts crying.",
  "sk_prologue_loc_4_p_2_el_6_text": "Thanks god you're okay!",
  "sk_prologue_loc_4_p_2_el_7_text": "I was s-so scared you wouldn't wake up.",
  "sk_prologue_loc_4_p_2_el_8_text": "Hey, hey, you'll choke me like that.",
  "sk_prologue_loc_4_p_2_el_9_text": "She lets go of you.",
  "sk_prologue_loc_4_p_2_el_11_text": "She's sobbing.",
  "sk_prologue_loc_4_p_2_el_12_text": "Before saying anything about what I've experienced, I better get to know what she saw yesterday.",
  "sk_prologue_loc_4_p_2_el_13_text": "I want to ask you about what happened yesterday. I don't remember how I got here.",
  "sk_prologue_loc_4_p_2_el_14_text": "She tries to stop sobbing ...",
  "sk_prologue_loc_4_p_2_el_15_text": "... and starts to speak",
  "sk_prologue_loc_4_p_3_el_1_text": "Yesterday, you disappeared for the whole day.",
  "sk_prologue_loc_4_p_3_el_2_text": "In the evening, I became worried and asked a few people if they saw you, but none of them did. <br> I wanted to go to the lake myself, but it was getting too dark, and you know how clumsy I can be in the dark. <br> Besides, parents could have found out something was wrong.",
  "sk_prologue_loc_4_p_3_el_3_text": "Only now I see that these were just stupid excuses. I should've gone there anyway and not sit and wait.",
  "sk_prologue_loc_4_p_3_el_4_text": "Her face became very gloomy for a few moments due to the feeling of guilt.",
  "sk_prologue_loc_4_p_3_el_5_text": "I waited for you all night, and when you came back early in the morning, you looked like a dead man with a lifeless gaze. <br> You completely ignored me, stumbled to the bed, and passed out.",
  "sk_prologue_loc_4_p_3_el_6_text": "In your sleep, you tossed and turned a lot, sweated, and had weak breathing.",
  "sk_prologue_loc_4_p_3_el_7_text": "She starts crying again.",
  "sk_prologue_loc_4_p_3_el_8_text": "I.. I.. I didn't know what happened to you! I.. I thought you were going to pass away on me!",
  "sk_prologue_loc_4_p_3_el_9_text": "I wiped you with a w-wet towel, ch-checked your breath and changed your p-pillows that became wet.",
  "sk_prologue_loc_4_p_3_el_10_text": "Then it l-looked like you stabilized, so I r-relaxed a bit and fell asleep.",
  "sk_prologue_loc_4_p_3_el_11_text": "Don't worry, it's alright now.",
  "sk_prologue_loc_4_p_3_el_12_text": "You put on a subtle smile for her.",
  "sk_prologue_loc_4_p_3_el_13_text": "No, it's not! You fell ill because of me! B-Because of that stupid brooch!",
  "sk_prologue_loc_4_p_3_el_14_text": "She began to look more angry rather than sad.",
  "sk_prologue_loc_4_p_3_el_15_text": "I could've done a lot more! I could have stopped our parents from leaving for the city before you returned! And calling a doctor just slipped my mind! And-and.. I fell asleep when you became only just a bit better!",
  "sk_prologue_loc_4_p_3_el_16_text": "Look like she's on edge, I guess I need to try to embrace her and calm her down.",
  "sk_prologue_loc_4_p_3_el_18_text": "She starts to break out, but you hold your effort to keep her in your hug and she eventually gives up.",
  "sk_prologue_loc_4_p_3_el_19_text": "Listen, I'm fine now. ",
  "sk_prologue_loc_4_p_3_el_20_text": "I promise to be more careful from now on.",
  "sk_prologue_loc_4_p_3_el_21_text": "I'm just never been s-so scared in my life.",
  "sk_prologue_loc_4_p_3_el_22_text": "You feel that she has almost calmed down.",
  "sk_prologue_loc_4_p_3_el_23_text": "But now it's over. It hurts to see you like that. Please return to the cheerful bratty sister I know.",
  "sk_prologue_loc_4_p_3_el_24_text": "Heh.. Am I that bratty?",
  "sk_prologue_loc_4_p_3_el_25_text": "She asks with small innocent smile, while wiping away tears.",
  "sk_prologue_loc_4_p_3_el_26_text": "Sometimes you are.",
  "sk_prologue_loc_4_p_3_el_27_text": "You answer while patting her head.",
  "sk_prologue_loc_4_p_3_el_29_text": "Then you both distance yourselves a bit. ",
  "sk_prologue_loc_4_p_3_el_30_text": "So, what the hell had happened to you?",  
  "sk_prologue_loc_4_p_3_el_31_text": "Should I be open about all that happened? <br> Or is it better not to risk and see how it'll go for now?",
  "sk_prologue_loc_4_p_3_el_32_text": "Tell her everything about your bizarre adventure",
  "sk_prologue_loc_4_p_3_el_33_text": "Tell her that you don't remember clearly",
  "sk_prologue_loc_4_p_4_el_1_text": "I don't want to lie, but it could be dangerous and I'd rather not involve her in it.",
  "sk_prologue_loc_4_p_4_el_2_text": "Well, I have nothing interesting to tell, really.",
  "sk_prologue_loc_4_p_4_el_3_text": "I've dived by the shore until I had to rest. And then repeated until I found some shining item. <br> I remember I wanted to grab it, and after that everything is blurry. Only some fragments of dreams, uncertain images and my thoughts about returning home. ",
  "sk_prologue_loc_4_p_4_el_4_text": "Is that really all?",
  "sk_prologue_loc_4_p_4_el_5_text": "And did you expect me to go through a big epic quest like the heroes of those adventure tales? ",
  "sk_prologue_loc_4_p_4_el_6_text": "I must've hit my head while diving or been bitten by some kind of viper.",
  "sk_prologue_loc_4_p_4_el_7_text": "Hmm, fishy, I expected something more than concussion after diving, counting all that emotional stress and your late condition.",
  "sk_prologue_loc_4_p_4_el_8_text": "Well, yeah, no wonder she doubts the story. It does sound like crap.",
  "sk_prologue_loc_4_p_4_el_9_text": "I have to concentrate to, at least, sound convincing.",  
  "sk_prologue_loc_4_p_4_el_10_text": "As I've said, I remember only some fragments and fuzzy images, there is nothing to add. <br> And I named the possible reasons. <b>There is nothing more to it</b>.",
  "sk_prologue_loc_4_p_4_el_11_text": "Hmm, okay. Probably some of that could be the reason.",  
  "sk_prologue_loc_4_p_4_el_12_text": "Huh? That easy? I expected a lot more resistance.",
  "sk_prologue_loc_4_p_4_el_13_text": "But if you remember anything, you better tell me.",
  "sk_prologue_loc_4_p_4_el_14_text": "Sure.",  
  "sk_prologue_loc_4_p_4_el_15_text": "She didn't buy my half-truth completely, but it's still strange. <br> Usually, if she grabs onto something, she will not let go even days after. <br> And this was a serious matter for her.",
  "sk_prologue_loc_4_p_4_el_16_text": "Was I really that good at convincing?",
  "sk_prologue_loc_4_p_4_el_17_text": "Anyway, it's better the way it is now. <br> She's too overstressed already to listen about strange visions, dangerous artifact and wicked witch.",
  "sk_prologue_loc_4_p_4_el_18_text": "Try to stand up",
  "sk_prologue_loc_4_p_5_el_1_text": "You tried to stand up but wobbled and almost fell.",
  "sk_prologue_loc_4_p_5_el_2_text": "Melissa looked at you with worry. ",
  "sk_prologue_loc_4_p_5_el_3_text": "How are you? Can you move?",
  "sk_prologue_loc_4_p_5_el_4_text": "I feel a bit weaker and lighter.",
  "sk_prologue_loc_4_p_5_el_5_text": "Not that I needed a diet before.",
  "sk_prologue_loc_4_p_5_el_6_text": "Well, you sweated a lot during sleep.",
  "sk_prologue_loc_4_p_5_el_7_text": "Do you need help to move?",
  "sk_prologue_loc_4_p_5_el_8_text": "No, no. I will be fine in a minute, I assure you. <br> You can stop worrying and return to your deals.",
  "sk_prologue_loc_4_p_5_el_9_text": "After those words she looks more relieved.",
  "sk_prologue_loc_4_p_5_el_10_text": "Now I'm just gonna check myself in the mirror and plan the day.",
  "sk_prologue_loc_4_p_5_el_11_text": "You surely like to linger in front of the mirror.",
  "sk_prologue_loc_4_p_5_el_12_text": "It just helps me reflect on my thoughts.",
  "sk_prologue_loc_4_p_5_el_13_text": "It's okay until you start to try on my dresses.",
  "sk_prologue_loc_4_p_5_el_14_text": "She grinned cheekily.",  
  "sk_prologue_loc_4_p_5_el_16_text": "If that happens, I suppose I'll also have to start looking for a candidate who can dive for my new hairpin in the nearest pond.",
  "sk_prologue_loc_4_p_5_el_17_text": "You see her smile turn into a sorrowful face back again.",
  "sk_prologue_loc_4_p_5_el_18_text": "I guess it was way too soon.",
  "sk_prologue_loc_4_p_5_el_19_text": "Yeah..",
  "sk_prologue_loc_4_p_5_el_20_text": "..mm, well, I do have some things to do.",
  "sk_prologue_loc_4_p_5_el_21_text": "Kay.",
  "sk_prologue_loc_4_p_5_el_22_text": "She went to the door, but before opening it she stopped.",
  "sk_prologue_loc_4_p_5_el_23_text": "Ah, almost forgot. Barret came in yesterday, he wanted to find you and talk about something.",
  "sk_prologue_loc_4_p_5_el_24_text": "And... if you remember anything or just want to spend time together, just come.",
  "sk_prologue_loc_4_p_5_el_25_text": "She left the room and closed the door.",
  "sk_prologue_loc_4_p_5_el_26_text": "Go to the mirror",  
  "sk_prologue_sk_de_2_melissa_p_1_el_1_text": "After listening to your story, she remains silent for half a minute, lost in her thoughts.",
  "sk_prologue_sk_de_2_melissa_p_1_el_2_text": "I.. I believe you need to go and talk to the wizard...",
  "sk_prologue_sk_de_2_melissa_p_1_el_3_text": "After another short silent pause, she continues in a more confident tone.",
  "sk_prologue_sk_de_2_melissa_p_1_el_4_text": "Yeah, you should do it right now! And I'll accompany you in order to be sure!",
  "sk_prologue_sk_de_2_melissa_p_1_el_5_text": "Might it be that you are overreacting a bit?",
  "sk_prologue_sk_de_2_melissa_p_1_el_6_text": "Maybe it was just a hallucination after hurting my head.",
  "sk_prologue_sk_de_2_melissa_p_1_el_7_text": "No, I will not leave it like this! I will not leave things to chance again! <br> Either we go and talk with him now or I'll tell our parents first, and afterward we'll still head to the wizard regardless!",
  "sk_prologue_sk_de_2_melissa_p_1_el_8_text": "Looks like she made up her mind and, knowing her, now her decision is unwavering.",
  "sk_prologue_sk_de_2_melissa_p_1_el_9_text": "Then her expression softens from stern to just sad.",
  "sk_prologue_sk_de_2_melissa_p_1_el_10_text": "It's just that I'm too worried about you.",
  "sk_prologue_sk_de_2_melissa_p_1_el_11_text": "Somehow I'm certain that it was not just a hallucination and something bad may happen again.",
  "sk_prologue_sk_de_2_melissa_p_1_el_12_text": "Then maybe we just can wait and see how it goes.",
  "sk_prologue_sk_de_2_melissa_p_1_el_13_text": "No! If you can get up, we go straight away, as maybe it is only now that we can reverse negative consequences.",
  "sk_prologue_sk_de_2_melissa_p_1_el_14_text": "Well, I think I can move fine enough.",
  "sk_prologue_sk_de_2_melissa_p_1_el_15_text": "Then let's go now!",
  "sk_prologue_sk_de_2_melissa_p_1_el_16_text": "Go to wizard",
  // "sk_prologue_sk_de_2_melissa_p_2_el_1_text": "", // image
  "sk_prologue_sk_de_2_melissa_p_2_el_2_text": "You find the wizard in his dwelling.",
  "sk_prologue_sk_de_2_melissa_p_2_el_3_text": "He sets aside a book he was reading and approaches you.",
  // "sk_prologue_sk_de_2_melissa_p_2_el_4_text": "", // image
  "sk_prologue_sk_de_2_melissa_p_2_el_5_text": "Hello, what brings you here today?",
  "sk_prologue_sk_de_2_melissa_p_2_el_6_text": "You hesitate to say something for a few seconds. <br> Melissa encourages you to speak by pulling down your sleeve.",
  "sk_prologue_sk_de_2_melissa_p_2_el_7_text": "Well.. um.. something very strange happened yesterday...",
  "sk_prologue_sk_de_2_melissa_p_2_el_8_text": "Another brief pause.",
  "sk_prologue_sk_de_2_melissa_p_2_el_9_text": "Just go ahead, tell him what you told me.",
  "sk_prologue_sk_de_2_melissa_p_2_el_10_text": "She definitely can't let it go... ", 
  "sk_prologue_sk_de_2_melissa_p_2_el_11_text": "...and I'm already here...",
  "sk_prologue_sk_de_2_melissa_p_2_el_12_text": "..might as well get it over with!",
  "sk_prologue_sk_de_2_melissa_p_2_el_13_text": "You narrate the strange and dangerous adventure that befell you recently.",  
  "sk_prologue_sk_de_2_melissa_p_2_el_14_text": "...",
  "sk_prologue_sk_de_2_melissa_p_2_el_15_text": "After finishing your story, you observe the wizard's reaction, noting his astonishment tinged with a hint of skepticism.",
  "sk_prologue_sk_de_2_melissa_p_2_el_16_text": "Are you completely certain that it wasn't merely a dream or hallucination?",
  "sk_prologue_sk_de_2_melissa_p_2_el_17_text": "Well, I can't say for sure.",
  "sk_prologue_sk_de_2_melissa_p_2_el_18_text": "Yesterday he came all pale, like a deadman, and paid no attention to anything, not even to my cries.",
  "sk_prologue_sk_de_2_melissa_p_2_el_19_text": "Yes, it's suspicious, to say the least. I'll perform an examination with a magic circle and a few spells to check if there's anything unusual within you at the moment.",
  "sk_prologue_sk_de_2_melissa_p_2_el_20_text": "You'll need to wait here quietly for some time, so feel free to pick up and read any book from the shelves to your right.",
  "sk_prologue_sk_de_2_melissa_p_2_el_21_text": "After an hour of preparation.",
  "sk_prologue_sk_de_2_melissa_p_2_el_22_text": "Phew, we're ready to start now. Come and stand here, so we can begin.",
  "sk_prologue_sk_de_2_melissa_p_2_el_23_text": "Start the examination",
  "sk_prologue_sk_de_2_melissa_p_3_el_1_text": "Having completed the procedure, he abruptly grabs the crystal used in the process and rechecks something in one of the books on his table. ",
  "sk_prologue_sk_de_2_melissa_p_3_el_2_text": "So this is...",
  "sk_prologue_sk_de_2_melissa_p_3_el_3_text": "He looks startled, then it can't be something good.",
  "sk_prologue_sk_de_2_melissa_p_3_el_4_text": "What did you find?",
  "sk_prologue_sk_de_2_melissa_p_3_el_5_text": "I need to contact them then... Yes, I need to contact the great mages.",
  "sk_prologue_sk_de_2_melissa_p_3_el_6_text": "It feels like he is talking to himself.",
  "sk_prologue_sk_de_2_melissa_p_3_el_7_text": "Is it that serious?",
  "sk_prologue_sk_de_2_melissa_p_3_el_8_text": "I'm not sure... But could it be?",
  "sk_prologue_sk_de_2_melissa_p_3_el_9_text": "What could it be?!",
  "sk_prologue_sk_de_2_melissa_p_3_el_10_text": "You ask loudly, snapping him out of his thoughts.",
  "sk_prologue_sk_de_2_melissa_p_3_el_11_text": "His gaze shifts to you and you see him starting to recognize your presence here back again.",
  "sk_prologue_sk_de_2_melissa_p_3_el_12_text": "Ah, yes, sorry.",
  "sk_prologue_sk_de_2_melissa_p_3_el_13_text": "It is nothing dangerous for you at the moment, but you'll need a checkup from the great mages.",
  "sk_prologue_sk_de_2_melissa_p_3_el_14_text": "As for what it is, I can't say for sure. It resembles something my mage master once mentioned, but that's just an assumption.",
  "sk_prologue_sk_de_2_melissa_p_3_el_15_text": "So what should we do now?",
  "sk_prologue_sk_de_2_melissa_p_3_el_16_text": "Here, wear this amulet for now. I'll use a rare enchanted tool to call high-ranked persons so they could arrive as soon as possible.",
  "sk_prologue_sk_de_2_melissa_p_3_el_17_text": "Could you tell at least something about it?",
  "sk_prologue_sk_de_2_melissa_p_3_el_18_text": "As I've mentioned, I cannot say for sure currently. But it's fortunate that you came quickly, it could become dangerous in the future if one of my theories is correct.",
  "sk_prologue_sk_de_2_melissa_p_3_el_19_text": "But for now you don't need to worry, just stay home for a few days and do not take off the amulet.",
  "sk_prologue_sk_de_2_melissa_p_3_el_20_text": "I'll contact experienced mages and they will provide explanations and determine if there's a problem and how to treat it.",
  "sk_prologue_sk_de_2_melissa_p_3_el_21_text": "It's rather suspicious that he didn't want to share any information about it at all.",
  "sk_prologue_sk_de_2_melissa_p_3_el_22_text": "But I guess there is nothing I can do now except just wait.",
  "sk_prologue_sk_de_2_melissa_p_3_el_23_text": "Wait for a few days",  
  "sk_prologue_sk_de_2_final_p_1_el_1_text": "For the past several days, you simply waited for any news in anxiety. <br> At the wizard's request, you refrained from telling your parents about this.",
  "sk_prologue_sk_de_2_final_p_1_el_2_text": "But living so closely with sister, you couldn't hide your behavior and wizard's amulet from her. <br> You briefly described her your previous and upcoming wizard examination.", // if not 'dead end 2 - Melissa'  
  "sk_prologue_sk_de_2_final_p_1_el_3_text": "...",
  "sk_prologue_sk_de_2_final_p_1_el_4_text": "And then one day, late in the morning, you hear a knock on the door.",
  "sk_prologue_sk_de_2_final_p_1_el_5_text": "It's time. They have arrived. Get dressed and follow me.",
  "sk_prologue_sk_de_2_final_p_1_el_6_text": "Your sister was nearby, she overheard wizard's words and decided to join you.", 
  "sk_prologue_sk_de_2_final_p_1_el_7_text": "After getting dressed, you meet the wizard at the door and depart for a long-waited checkup.",
  "sk_prologue_sk_de_2_final_p_1_el_8_text": "Seeing your sister going to come too, he expressed his dissatisfaction, but didn't say anything.", // if not 'dead end 2 - Melissa' 
  "sk_prologue_sk_de_2_final_p_1_el_9_text": "...",
  "sk_prologue_sk_de_2_final_p_1_el_10_text": "Coming closer to the center of the village you notice several mages, a few templars and about a dozen guards.",
  "sk_prologue_sk_de_2_final_p_1_el_11_text": "I thought that it would be only a few mages to come for my checkup, but now I'm starting to get seriously nervous.",
  "sk_prologue_sk_de_2_final_p_1_el_12_text": "Why so many guards?",
  "sk_prologue_sk_de_2_final_p_1_el_13_text": "Probably, the great mages are very meticulous about sticking to the rules and must have taken this whole thing very seriously.",
  "sk_prologue_sk_de_2_final_p_1_el_14_text": "You sensed the uncertainty in his voice.",
  "sk_prologue_sk_de_2_final_p_1_el_15_text": "Noticing you with the wizard, a tall man in an expensive-looking outfit, reminiscent of a wizard's clothing, begins to approach you.",
  // "sk_prologue_sk_de_2_final_p_1_el_16_text": "", // image
  "sk_prologue_sk_de_2_final_p_1_el_17_text": "Greetings. I am Jovan Astalribe, the high mage. And you must be the boy I was assigned to deliver.",
  "sk_prologue_sk_de_2_final_p_1_el_18_text": "Deliver? Wait a second, do I need to move out somewhere?",
  "sk_prologue_sk_de_2_final_p_1_el_19_text": "Yes, you need to come with us so that our great mages could check your case in detail.",
  "sk_prologue_sk_de_2_final_p_1_el_20_text": "You have no idea how expensive, problematic and time-consuming it is to transport all possible necessary equipment here for you.",
  "sk_prologue_sk_de_2_final_p_1_el_21_text": "So it's much easier to deliver you there instead.",
  "sk_prologue_sk_de_2_final_p_1_el_22_text": "No! There was not even a word about him being taken away!",
  "sk_prologue_sk_de_2_final_p_1_el_23_text": "You see as your sister began to shout at the wilted wizard, while he cannot make up and utter a word in response.",
  "sk_prologue_sk_de_2_final_p_1_el_24_text": "Where do you want to take my child?",
  "sk_prologue_sk_de_2_final_p_1_el_25_text": "Turn around",
  "sk_prologue_sk_de_2_final_p_2_el_1_text": "You see that your parents also came to the center and apparently heard your sister's last phrase.",
  "sk_prologue_sk_de_2_final_p_2_el_2_text": "Ah, so you don't know yet. Then I guess you can ask your village elder for explanations.",
  "sk_prologue_sk_de_2_final_p_2_el_3_text": "I was ordered to complete my mission as soon as possible, thus we're moving out immediately.",
  "sk_prologue_sk_de_2_final_p_2_el_4_text": "You want to just take away my brother into the unknown with that little bit of excuse?! ",
  "sk_prologue_sk_de_2_final_p_2_el_5_text": "You see that people around started loudly rumoring about the current situation.",
  "sk_prologue_sk_de_2_final_p_2_el_6_text": "What a hassle. Okay, then let's do like this. <br> Listen everyone! Please keep calm! This boy could be probably cursed, so I need to get him to the capital, inspect and cure him!",
  "sk_prologue_sk_de_2_final_p_2_el_7_text": "Doesn't sound reassuring, considering I heard similar things from that witch. ",
  "sk_prologue_sk_de_2_final_p_2_el_8_text": "His condition is yet to be inspected, so I cannot rule out the possibility that his state could be dangerous not only for himself, but for the people around him also!  ",
  "sk_prologue_sk_de_2_final_p_2_el_9_text": "Well, shit, I really didn't think about it. ", // if not 'dead end 2 - Barret' 
  "sk_prologue_sk_de_2_final_p_2_el_10_text": "Well, Barret was worried about that too. ", // if 'dead end 2 - Barret' 
  "sk_prologue_sk_de_2_final_p_2_el_11_text": "All detailed explanations I've left to your elder!",
  "sk_prologue_sk_de_2_final_p_2_el_12_text": "All eyes moved to the elder, who is currently having a tough conversation with your father and wizard. ",
  "sk_prologue_sk_de_2_final_p_2_el_13_text": "So there are no space for negotiation here now! He will be delivered to the great mages, guarded by a prepared high-leveled escort.",
  "sk_prologue_sk_de_2_final_p_2_el_14_text": "You see that Barret and Alura have also already joined the commotion at the village center and are currently standing there looking at you with shocked and slightly frightened faces.",
  "sk_prologue_sk_de_2_final_p_2_el_15_text": "And if this can put you at ease, I, as a high mage of Alderia kingdom, can promise to deliver him to the destination point safe and sound!",
  "sk_prologue_sk_de_2_final_p_2_el_16_text": "Hm, great, now someone might think that the travel itself could be dangerous.",
  "sk_prologue_sk_de_2_final_p_2_el_17_text": "Maybe someone can go with him?",
  "sk_prologue_sk_de_2_final_p_2_el_18_text": "On those words, you see Barret starts to move forward, but abrupt answer stops him.",
  "sk_prologue_sk_de_2_final_p_2_el_19_text": "No! We don't know how much time it would take and surely we don't need to be burdened by extra people, who will weigh down and put at risk our mission.",
  "sk_prologue_sk_de_2_final_p_2_el_20_text": "But then how can we contact him at least?",
  "sk_prologue_sk_de_2_final_p_2_el_21_text": "For now, you'd better not do this.",
  "sk_prologue_sk_de_2_final_p_2_el_22_text": "He looks at people's faces still filled with shock, confusion and dissatisfaction because of current mishap and decides to pacify the crowd a little.",
  "sk_prologue_sk_de_2_final_p_2_el_23_text": "Ah, alright, I'll petition the great mages to let him write and receive letters.",
  "sk_prologue_sk_de_2_final_p_2_el_24_text": "Ask your mercer to send and get letters from the post office of the nearest city. I'll leave the contact address with your elder.",
  "sk_prologue_sk_de_2_final_p_2_el_25_text": "You feel lost because of this sudden situation.",
  "sk_prologue_sk_de_2_final_p_2_el_26_text": "All things that are happening seem so rapid and unreal. <br> What should I even say or ask?",
  "sk_prologue_sk_de_2_final_p_2_el_27_text": "Intervening in your attempts to gather your thoughts, the high mage come closer and whispers.",
  "sk_prologue_sk_de_2_final_p_2_el_28_text": "Sorry, boy, you don't have a choice here. We got to move.",
  "sk_prologue_sk_de_2_final_p_2_el_29_text": "Then, he grabs you by the arm and lead you to the carriage.",
  "sk_prologue_sk_de_2_final_p_2_el_30_text": "A shout from Melissa, that sounded like \"sorry\" is the last thing you hear before you...",
  "sk_prologue_sk_de_2_final_p_2_el_31_text": "A shout from Barret, that sounded like \"sorry\" is the last thing you hear before you...",
  "sk_prologue_sk_de_2_final_p_2_el_32_text": "A shout from Alura, that sounded like \"sorry\" is the last thing you hear before you...",
  "sk_prologue_sk_de_2_final_p_2_el_33_text": "...get into the carriage",
  "sk_prologue_sk_de_2_final_p_3_el_1_text": "You've been on the road for almost half a day by now.",
  "sk_prologue_sk_de_2_final_p_3_el_2_text": "Despite your many questions, the high mage dismissed them, promising that the great mages would provide all the necessary explanations.",
  "sk_prologue_sk_de_2_final_p_3_el_3_text": "Uhh, it was only yesterday that I was lying in my bed at home and now I'm on the road to the unknown.",
  "sk_prologue_sk_de_2_final_p_3_el_4_text": "What could await me in the future?",
  "sk_prologue_sk_de_2_final_p_3_el_5_text": "Suddenly, screams pierce the air and your carriage halts.",
  "sk_prologue_sk_de_2_final_p_3_el_6_text": "What's hap...",
  "sk_prologue_sk_de_2_final_p_3_el_7_text": "An earsplitting sound and a shockwave from an explosion shake you.",
  "sk_prologue_sk_de_2_final_p_3_el_8_text": "Shit, we're under attack! <br> What should... ",
  "sk_prologue_sk_de_2_final_p_3_el_9_text": "The next instant the carriage flips from another explosion.",
  "sk_prologue_sk_de_2_final_p_3_el_10_text": "...",
  "sk_prologue_sk_de_2_final_p_3_el_11_text": "An unknown amount of time passes...",
  "sk_prologue_sk_de_2_final_p_3_el_12_text": "Having recovered from the shock, you find yourself alone in the overturned cabin. <br> You start searching for a handy position to stand up.",
  "sk_prologue_sk_de_2_final_p_3_el_13_text": "How long was I out? <br> Well, it doesn't matter right now I guess.",
  "sk_prologue_sk_de_2_final_p_3_el_14_text": "So should I stay inside or..",
  "sk_prologue_sk_de_2_final_p_3_el_15_text": "The door of the carriage opens, interrupting your stream of thoughts.",
  "sk_prologue_sk_de_2_final_p_3_el_16_text": "Looking up at the opened door you see the face of that very same witch.",
  "sk_prologue_sk_de_2_final_p_3_el_18_text": "She looks very pale and exhausted and there is a blood and sorrow on her face.",
  "sk_prologue_sk_de_2_final_p_3_el_19_text": "If it comes down to this, then it's better to end it that way while I still can.",
  "sk_prologue_sk_de_2_final_p_3_el_20_text": "The next moment you see a dazzling light.",
  "sk_prologue_sk_de_2_final_p_3_el_21_text": "...", 
  "sk_prologue_sk_de_2_final_p_3_el_22_text": "...", 
  "sk_prologue_sk_de_2_barret_p_1_el_1_text": "After listening to your story, he remains silent for some time.",
  "sk_prologue_sk_de_2_barret_p_1_el_2_text": "You're not shitting me, are you?",
  "sk_prologue_sk_de_2_barret_p_1_el_3_text": "No, and it was not easy to reveal all of that.",
  "sk_prologue_sk_de_2_barret_p_1_el_4_text": "Damn, I had a feeling something was off about you, but this is just plain crazy.",
  "sk_prologue_sk_de_2_barret_p_1_el_5_text": "Yeah, partially I still feel like it was a dream.",
  "sk_prologue_sk_de_2_barret_p_1_el_6_text": "If that witch is still around, it could be dangerous for the whole village, not only you.",
  "sk_prologue_sk_de_2_barret_p_1_el_7_text": "We need to inform the village elder and probably the wizard too.",
  "sk_prologue_sk_de_2_barret_p_1_el_8_text": "Are you sure that's necessary? Can't we try to handle it between ourselves somehow?",
  "sk_prologue_sk_de_2_barret_p_1_el_9_text": "If things are really as you said, then we definitely need to ask for some help.",
  "sk_prologue_sk_de_2_barret_p_1_el_10_text": "Ugh, okay.",
  "sk_prologue_sk_de_2_barret_p_1_el_11_text": "It's no time to slack, this is too serious!",
  "sk_prologue_sk_de_2_barret_p_1_el_12_text": "Hm.. first of all, let's visit the wizard and examine you to how those events have affected you. ",
  "sk_prologue_sk_de_2_barret_p_1_el_13_text": "Clearly, you should have done it first thing you woke up.",
  "sk_prologue_sk_de_2_barret_p_1_el_14_text": "And you just went asking about whether you have changed or not instead.", // if 'had I changed' Barret complete
  "sk_prologue_sk_de_2_barret_p_1_el_15_text": "You stay silent, unsure of what to say without starting quarrel.",
  "sk_prologue_sk_de_2_barret_p_1_el_16_text": "Well, a lot of time has been wasted already. Let's go!", 
  "sk_prologue_sk_de_2_barret_p_1_el_17_text": "Go to wizard",
  // "sk_prologue_sk_de_2_barret_p_2_el_1_text": "", // image
  "sk_prologue_sk_de_2_barret_p_2_el_2_text": "You find the wizard in his dwelling.",
  "sk_prologue_sk_de_2_barret_p_2_el_3_text": "He puts down the notebook in which he was making some notes and comes up to you.",
  // "sk_prologue_sk_de_2_barret_p_2_el_4_text": "", // image
  "sk_prologue_sk_de_2_barret_p_2_el_5_text": "Hello, what brings you here today?",
  "sk_prologue_sk_de_2_barret_p_2_el_6_text": "You hesitate to say something for a few seconds. <br> Barret encourages you to speak by slightly pushing you forward.",
  "sk_prologue_sk_de_2_barret_p_2_el_7_text": "Well.. um.. something very strange happened recently...",
  "sk_prologue_sk_de_2_barret_p_2_el_8_text": "Another brief pause.",
  "sk_prologue_sk_de_2_barret_p_2_el_9_text": "Just go ahead and tell him.",
  "sk_prologue_sk_de_2_barret_p_2_el_10_text": "Well, I guess there is no turning back already.",
  "sk_prologue_sk_de_2_barret_p_2_el_11_text": "You narrate the strange and dangerous adventure that befell you.",  
  "sk_prologue_sk_de_2_barret_p_2_el_12_text": "...",
  "sk_prologue_sk_de_2_barret_p_2_el_13_text": "After finishing your story, you observe the wizard's reaction, noting his astonishment tinged with a hint of skepticism.",
  "sk_prologue_sk_de_2_barret_p_2_el_14_text": "Are you completely certain that it wasn't merely a dream or hallucination?",
  "sk_prologue_sk_de_2_barret_p_2_el_15_text": "Well, I felt it as real, that's for sure.",
  "sk_prologue_sk_de_2_barret_p_2_el_16_text": "I cannot prove it anyhow now, but I'm fully sure that it's not something he just made up.",
  "sk_prologue_sk_de_2_barret_p_2_el_17_text": "Well, yes, it does sound suspicious. Okay, I'll perform an examination with a magic circle and a few spells to check if there's anything unusual within you at the moment.",
  "sk_prologue_sk_de_2_barret_p_2_el_18_text": "You'll need to wait here quietly for some time, so feel free to pick up and read any book from the shelves to your right.",
  "sk_prologue_sk_de_2_barret_p_2_el_19_text": "Can I assist?",
  "sk_prologue_sk_de_2_barret_p_2_el_20_text": "Hm... you may, yes. But as for him, he should refrain from touching anything until after the examination.",
  "sk_prologue_sk_de_2_barret_p_2_el_21_text": "Okay.",
  "sk_prologue_sk_de_2_barret_p_2_el_22_text": "After about half an hour of preparation.",
  "sk_prologue_sk_de_2_barret_p_2_el_23_text": "Phew, we're ready to start now. Come and stand here, so we can begin.",
  "sk_prologue_sk_de_2_barret_p_2_el_24_text": "Start the examination",
  "sk_prologue_sk_de_2_barret_p_3_el_1_text": "Having completed the procedure, he abruptly grabs the crystal used in the process and rechecks something in one of the books on his table. ",
  "sk_prologue_sk_de_2_barret_p_3_el_2_text": "So this is...",
  "sk_prologue_sk_de_2_barret_p_3_el_3_text": "He looks startled, then it can't be something good.",
  "sk_prologue_sk_de_2_barret_p_3_el_4_text": "What did you find?",
  "sk_prologue_sk_de_2_barret_p_3_el_5_text": "I need to contact them then... Yes, I need to contact the great mages.",
  "sk_prologue_sk_de_2_barret_p_3_el_6_text": "It feels like he is talking to himself.",
  "sk_prologue_sk_de_2_barret_p_3_el_7_text": "So is it dangerous for him? Is it dangerous for the village?", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_8_text": "That shouldn't... But could it be?",
  "sk_prologue_sk_de_2_barret_p_3_el_9_text": "What could it be?!",
  "sk_prologue_sk_de_2_barret_p_3_el_10_text": "You ask loudly, snapping him out of his thoughts.",
  "sk_prologue_sk_de_2_barret_p_3_el_11_text": "His gaze shifts to you and you see him starting to recognize your presence here back again.",
  "sk_prologue_sk_de_2_barret_p_3_el_12_text": "Ah, yes, sorry.",
  "sk_prologue_sk_de_2_barret_p_3_el_13_text": "It is nothing dangerous for you at the moment, but you'll need a checkup from the great mages.",
  "sk_prologue_sk_de_2_barret_p_3_el_14_text": "As for what it is, I can't say for sure. It resembles something my mage master once mentioned, but that's just an assumption.",
  "sk_prologue_sk_de_2_barret_p_3_el_15_text": "So what should we do now?",
  "sk_prologue_sk_de_2_barret_p_3_el_16_text": "Here, wear this amulet for now. I'll use a rare enchanted tool to call high-ranked persons so they could arrive as soon as possible.",
  "sk_prologue_sk_de_2_barret_p_3_el_17_text": "But can you explain it to us, so we could notify the elder?", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_18_text": "As I've mentioned, I cannot say for sure currently. But it's fortunate that you came quickly, it could become dangerous in the future if one of my theories is correct.",
  "sk_prologue_sk_de_2_barret_p_3_el_19_text": "But for now you don't need to worry, just stay home for a few days and do not take off the amulet.",
  "sk_prologue_sk_de_2_barret_p_3_el_20_text": "I'll contact experienced mages and they will provide explanations and determine if there's a problem and how to treat it.",
  "sk_prologue_sk_de_2_barret_p_3_el_21_text": "And I'll notify the elder about it personally.", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_22_text": "It's rather suspicious that he didn't want to share any information about it at all.",
  "sk_prologue_sk_de_2_barret_p_3_el_23_text": "But I guess there is nothing I can do now except just wait.",
  "sk_prologue_sk_de_2_barret_p_3_el_24_text": "Wait for a few days",  
  "sk_prologue_sk_de_2_alura_p_1_el_1_text": "After listening to your story, she looks terrified.",
  "sk_prologue_sk_de_2_alura_p_1_el_2_text": "I hope this is just a bad joke. It's a joke right?",
  "sk_prologue_sk_de_2_alura_p_1_el_3_text": "Unfortunately not.",
  "sk_prologue_sk_de_2_alura_p_1_el_4_text": "Upon hearing that, she leans close to you and hugs you tightly.",
  "sk_prologue_sk_de_2_alura_p_1_el_6_text": "For a moment you felt surprised and confused.",
  "sk_prologue_sk_de_2_alura_p_1_el_7_text": "It must have been so terrible, you suffered a lot.",
  "sk_prologue_sk_de_2_alura_p_1_el_8_text": "While still hugging you, she strokes your back gently.",
  "sk_prologue_sk_de_2_alura_p_1_el_9_text": "I...",
  "sk_prologue_sk_de_2_alura_p_1_el_10_text": "From the unexpected comfort you received, you began to feel defenseless and a lump came to your throat.",
  "sk_prologue_sk_de_2_alura_p_1_el_11_text": "To regain composure and continue the conversation, you slowly break the hug.",
  "sk_prologue_sk_de_2_alura_p_1_el_12_text": "I think it's okay now. I'm safe and sound, so do not worry.",
  "sk_prologue_sk_de_2_alura_p_1_el_13_text": "Seeing her expression, I realize she doesn't fully believe those words.",
  "sk_prologue_sk_de_2_alura_p_1_el_14_text": "No, it's not okay! We must contact someone for help.",
  "sk_prologue_sk_de_2_alura_p_1_el_15_text": "I'm not sure that there is a need for that no...",
  "sk_prologue_sk_de_2_alura_p_1_el_16_text": "There is such a need!",
  "sk_prologue_sk_de_2_alura_p_1_el_17_text": "You need to have a proper check up.", 
  "sk_prologue_sk_de_2_alura_p_1_el_18_text": "And not just asking me about how you changed.", // if 'had I changed' Alura complete
  "sk_prologue_sk_de_2_alura_p_1_el_19_text": "Since you mentioned that magic was involved, let's go to the magician first and hear what he says.",
  "sk_prologue_sk_de_2_alura_p_1_el_20_text": "I believe we shouldn't ru...",
  "sk_prologue_sk_de_2_alura_p_1_el_21_text": "No, there is no room for negotiation! I will not let you get hurt because of my inactivity ever again.",
  "sk_prologue_sk_de_2_alura_p_1_el_22_text": "Ah, I see now why she's reacting this way.",
  "sk_prologue_sk_de_2_alura_p_1_el_23_text": "If you agai...",
  "sk_prologue_sk_de_2_alura_p_1_el_24_text": "We can talk on the way.",
  "sk_prologue_sk_de_2_alura_p_1_el_25_text": "She grabs your hand forcefully and both of you head...",
  "sk_prologue_sk_de_2_alura_p_1_el_26_text": "To the wizard",
    // "sk_prologue_sk_de_2_barret_p_2_el_1_text": "", // image
  "sk_prologue_sk_de_2_alura_p_2_el_2_text": "You find the wizard in his dwelling.",
  "sk_prologue_sk_de_2_alura_p_2_el_3_text": "He puts away the blue necklace that he was looking at closely earlier and walks over to you.",
    // "sk_prologue_sk_de_2_barret_p_2_el_4_text": "", // image
  "sk_prologue_sk_de_2_alura_p_2_el_5_text": "Hello, what brings you here today?",
  "sk_prologue_sk_de_2_alura_p_2_el_6_text": "You hesitate to say something for a few seconds. <br> Alura encourages you to speak by coughing a few times.",
  "sk_prologue_sk_de_2_alura_p_2_el_7_text": "Well.. um.. something very strange happened recently...",
  "sk_prologue_sk_de_2_alura_p_2_el_8_text": "Another brief pause.",
  "sk_prologue_sk_de_2_alura_p_2_el_9_text": "Just go ahead, explain him why we're here.",
  "sk_prologue_sk_de_2_alura_p_2_el_10_text": "Well, I guess there is no turning back already.",
  "sk_prologue_sk_de_2_alura_p_2_el_11_text": "You narrate the strange and dangerous adventure that befell you recently.",  
  "sk_prologue_sk_de_2_alura_p_2_el_12_text": "...",
  "sk_prologue_sk_de_2_alura_p_2_el_13_text": "After finishing your story, you observe the wizard's reaction, noting his astonishment tinged with a hint of skepticism.",
  "sk_prologue_sk_de_2_alura_p_2_el_14_text": "Are you completely certain that it wasn't merely a dream or hallucination?",
  "sk_prologue_sk_de_2_alura_p_2_el_15_text": "Well, I can't say for sure, but it felt too real to be just a dream.",
  "sk_prologue_sk_de_2_alura_p_2_el_16_text": "And even if not all of it occurred in reality, something definitely affected him.",
  "sk_prologue_sk_de_2_alura_p_2_el_17_text": "So it's better to be safe than sorry and do a check-up.",
  "sk_prologue_sk_de_2_alura_p_2_el_18_text": "Yes, the situation is suspicious, to say the least. I'll perform an examination with a magic circle and a few spells to check if there's anything unusual within you at the moment.",
  "sk_prologue_sk_de_2_alura_p_2_el_19_text": "You'll need to wait here quietly for some time, so feel free to pick up and read any book from the shelves to your right.",
  "sk_prologue_sk_de_2_alura_p_2_el_20_text": "Alright, we'll wait.",
  "sk_prologue_sk_de_2_alura_p_2_el_21_text": "After an hour of preparation.",
  "sk_prologue_sk_de_2_alura_p_2_el_22_text": "Phew, we're ready to start now. Come and stand here, so we can begin.",
  "sk_prologue_sk_de_2_alura_p_2_el_23_text": "Start the examination",
  "sk_prologue_sk_de_2_alura_p_3_el_1_text": "Having completed the procedure, he abruptly grabs the crystal used in the process and rechecks something in one of the books on his table. ",
  "sk_prologue_sk_de_2_alura_p_3_el_2_text": "So this is...",
  "sk_prologue_sk_de_2_alura_p_3_el_3_text": "He looks startled, then it can't be something good.",
  "sk_prologue_sk_de_2_alura_p_3_el_4_text": "What did you find?",
  "sk_prologue_sk_de_2_alura_p_3_el_5_text": "I need to contact them then... Yes, I need to contact the great mages.",
  "sk_prologue_sk_de_2_alura_p_3_el_6_text": "It feels like he is talking to himself.",
  "sk_prologue_sk_de_2_alura_p_3_el_7_text": "How bad is it?",
  "sk_prologue_sk_de_2_alura_p_3_el_8_text": "I'm not sure... But could it be?",
  "sk_prologue_sk_de_2_alura_p_3_el_9_text": "What could it be?!",
  "sk_prologue_sk_de_2_alura_p_3_el_10_text": "You ask loudly, snapping him out of his thoughts.",
  "sk_prologue_sk_de_2_alura_p_3_el_11_text": "His gaze shifts to you and you see him starting to recognize your presence here back again.",
  "sk_prologue_sk_de_2_alura_p_3_el_12_text": "Ah, yes, sorry.",
  "sk_prologue_sk_de_2_alura_p_3_el_13_text": "It is nothing dangerous for you at the moment, but you'll need a checkup from the great mages.",
  "sk_prologue_sk_de_2_alura_p_3_el_14_text": "As for what it is, I can't say for sure. It resembles something my mage master once mentioned, but that's just an assumption.",
  "sk_prologue_sk_de_2_alura_p_3_el_15_text": "So what should we do now?",
  "sk_prologue_sk_de_2_alura_p_3_el_16_text": "Here, wear this amulet for now. I'll use a rare enchanted tool to call high-ranked persons so they could arrive as soon as possible.",
  "sk_prologue_sk_de_2_alura_p_3_el_17_text": "Can you tell us more about it? Maybe we need to start some treatment?",
  "sk_prologue_sk_de_2_alura_p_3_el_18_text": "As I've mentioned, I cannot say for sure currently. But it's fortunate that you came quickly, it could become dangerous in the future if one of my theories is correct.",
  "sk_prologue_sk_de_2_alura_p_3_el_19_text": "But for now you don't need to worry, just stay home for a few days and do not take off the amulet.",
  "sk_prologue_sk_de_2_alura_p_3_el_20_text": "I'll contact experienced mages and they will provide explanations and determine if there's a problem and how to treat it.",
  "sk_prologue_sk_de_2_alura_p_3_el_21_text": "And as for treatment, it is not needed for now. Just try not to overstress yourself for a few days.",
  "sk_prologue_sk_de_2_alura_p_3_el_22_text": "It's rather suspicious that he didn't want to share any information about it at all.",
  "sk_prologue_sk_de_2_alura_p_3_el_23_text": "But I guess there is nothing I can do now except just wait.",
  "sk_prologue_sk_de_2_alura_p_3_el_24_text": "Wait for a few days",  
  "task_prologue_talk_brooch_name": "Talk about brooch",
  "task_prologue_talk_brooch_description": "Talk to the Melissa and give her the brooch",
  "task_prologue_talk_brooch_link_title": "Talk about the brooch", 
  "task_prologue_talk_my_changes_melissa": "Changes in me. Melissa view.",
  "task_prologue_talk_my_changes_melissa_description": "I need to talk to Melissa and see if she notices changes in me.",
  "task_prologue_talk_my_changes_melissa_link_title": "Ask about changes in me", 
  "task_prologue_talk_my_changes_barret": "Changes in me. Barret view.",
  "task_prologue_talk_my_changes_barret_description": "I need to talk to Melissa and see if he notices changes in me.",
  "task_prologue_talk_my_changes_barret_link_title": "Ask about changes in me", 
  "task_prologue_talk_my_changes_alura": "Changes in me. Alura view.",
  "task_prologue_talk_my_changes_alura_description": "I need to talk to Melissa and see if she notices changes in me.",
  "task_prologue_talk_my_changes_alura_link_title": "Ask about changes in me", 
  "task_prologue_talk_my_changes_final": "Changes in me. Think about reactions.",
  "task_prologue_talk_my_changes_final_description": "I need to think about changes in me with the new information I've received.",
  "task_prologue_talk_my_changes_final_link_title": "Think about changes in me.", 
  "quests_q_return_brooch_name": "About the brooch..",
  "quests_q_return_brooch_description": "Return ",
  "quests_q_return_brooch_start_text": "About the brooch",
  "task_prologue_talk_barret_name": "Talk with Barret",
  "task_prologue_talk_barret_description": "Talk to Barret",
  "task_prologue_talk_barret_link_title": "Ask why he was looking for you",
  "quests_q_barrets_matters_name": "About Barret..",
  "quests_q_barrets_matters_description": "Talk to Barret about you missing",
  "quests_q_barrets_matters_start_text": "About Barret..",
  "quests_q_swim_melissa_name": "Melissa swimming",
  "quests_q_swim_melissa_description": "Teach Melissa to swim",
  "quests_q_swim_melissa_start_text": "Melissa swimming..",
  "quests_q_had_i_changed_name": "Had I changed?",
  "quests_q_had_i_changed_description": "Inspect myself to see changes.",
  "quests_q_had_i_changed_start_text": "Had I changed?",
  "task_swim_melissa_talk_1_name": "Talk with Melissa",
  "task_swim_melissa_talk_1_description": "Talk with Melissa desc",
  "task_swim_melissa_talk_1_link_title": "Talk about teaching her to swim",
  "sk_sketch_personal_melissa_p_1_el_2_text": "Teach hew to swim",
  "sk_sketch_personal_mc_p_1_el_1_text": "Going outside of the village",
  "sk_sketch_personal_mc_p_1_el_2_text": "Keep silent",
  "sk_sketch_personal_mc_p_1_el_3_text": "Power of my order",
  "sk_sketch_personal_mc_p_1_el_4_text": "About that brooch..",
  "sk_sketch_personal_mc_p_1_el_5_text": "About Barret..",
  "sk_sketch_personal_mc_p_1_el_6_text": "Had I changed?",
  "sk_sketch_personal_mc_locations_limit_p_1_el_1_text": "Regarding the recent events, I will probably refrain from going outside the village for now.",
  "sk_sketch_personal_mc_locations_limit_p_1_el_2_text": "Better wait and see if villagers mention anything suspicious or out of the ordinary happening out there.",
  "sk_sketch_personal_mc_locations_limit_p_1_el_3_text": "Stick with it for now",
  "sk_sketch_personal_mc_keep_silent_p_1_el_1_text": "I think I should keep silent about what happened with me.",
  "sk_sketch_personal_mc_keep_silent_p_1_el_2_text": "Somehow, I feel that it would become much worse if I tell about it to anyone, so in the meantime I'll just wait and observe.",
  "sk_sketch_personal_mc_keep_silent_p_1_el_3_text": "Stick with it for now",
  "sk_sketch_personal_mc_power_of_order_p_1_el_1_text": "Why had my order worked in the conversation with Melissa?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_2_text": "It is definitely not in her nature to drop it like that. \n She would continue regardless of my objections until she finds out everything.",
  "sk_sketch_personal_mc_power_of_order_p_1_el_3_text": "Hm, was she unexpectedly considerate?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_4_text": "Or was it the influence of the recent misadventure?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_5_text": "Or maybe I'm overthinking something insignificant?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_6_text": "Barrett, for example, did not show any kind of extraordinary reaction.",
  "sk_sketch_personal_mc_power_of_order_p_1_el_7_text": "...",
  "sk_sketch_personal_mc_power_of_order_p_1_el_8_text": "Well, who knows the full effect of the latest events, so I guess from now on I will be on the alert to see if anything like that to happen again.",
  "sk_sketch_personal_mc_power_of_order_p_1_el_9_text": "Stick with it for now",
  "sk_sketch_personal_mc_give_brooch_p_1_el_1_text": "I almost forgot to give Melissa the brooch which was the starting point for the recent events.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_2_text": "...those events I'd rather never experience.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_3_text": "But...",
  "sk_sketch_personal_mc_give_brooch_p_1_el_4_text": "Hm... it was rare to see her so genuinely kind and concerned about me.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_5_text": "Maybe I should find artifacts and stand out against witches every now and then to see that again?",
  "sk_sketch_personal_mc_give_brooch_p_1_el_6_text": "You even paused for a second to ponder about it.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_7_text": "Naah... what am I even thinking.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_8_text": "But I still need to give her that brooch back.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_9_text": "Time to bring Melissa the brooch",
  "sk_sketch_personal_mc_give_brooch_p_1_el_10_text": "Return to the mirror",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_1_text": "Looks like Barret wanted to talk with me about something in private.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_2_text": "Otherwise, he would've just left a message via Melissa.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_3_text": "To find out what's on his mind, I need to find him and ask.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_4_text": "He's usually hanging out at his home, which is Smith's house.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_5_text": "Find and ask Barret about his concerns",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_6_text": "Return to the mirror",  
  "sk_sketch_personal_mc_i_changed_p_1_el_1_text": "You look closely in the mirror, checking whether there are any physical changes in your appearance.",
  "sk_sketch_personal_mc_i_changed_p_1_el_2_text": "Damn, not only do I feel different — lighter and weaker, but it seems like I've physically changed too.",
  "sk_sketch_personal_mc_i_changed_p_1_el_3_text": "Initially, I thought I've only lost some weight, but certainly there's more to it.",
  "sk_sketch_personal_mc_i_changed_p_1_el_4_text": "I'm not just skinnier than before, my features have softened and my skin feels smoother.",
  "sk_sketch_personal_mc_i_changed_p_1_el_6_text": "The weirdest thing is that I don't have a scar anymore!",
  "sk_sketch_personal_mc_i_changed_p_1_el_7_text": "Also it's odd that Melissa didn't mention it, but she was probably too nervous to notice.",
  "sk_sketch_personal_mc_i_changed_p_1_el_8_text": "Or... maybe...",
  "sk_sketch_personal_mc_i_changed_p_1_el_9_text": "...there's a chance that I could be imagining things right now. Who knows how this misadventure has affected me.",
  "sk_sketch_personal_mc_i_changed_p_1_el_10_text": "Anyway, I can't hide it if there are severe changes in my appearance.  <br> So it's better not to put it on hold and go talk to some close acquaintances to see if they notice.",
  "sk_sketch_personal_mc_i_changed_p_1_el_11_text": "I guess I'll ask Alura and Barret, and also reask Melissa.  <br> They should be somewhere in the village. After speaking with them, I'll have to return and mull it over.",
  "sk_sketch_personal_mc_i_changed_p_1_el_12_text": "It's time to find them",
  "sk_sketch_personal_mc_i_changed_p_1_el_13_text": "Return to the mirror.",
  "sk_quest_had_i_changed_melissa_p_1_el_1_text": "Ehm, after that unfortunate event I feel weaker. And I thought maybe the trauma and stress had left some mark on me.",
  "sk_quest_had_i_changed_melissa_p_1_el_2_text": "We can still go to the doctor.",
  "sk_quest_had_i_changed_melissa_p_1_el_3_text": "No, no, I just wanted to ask if you have noticed any changes in my appearance?",
  "sk_quest_had_i_changed_melissa_p_1_el_4_text": "Well, you still look somewhat pale and a bit more slender than before. But other than that, probably not.",
  "sk_quest_had_i_changed_melissa_p_1_el_5_text": "What about the scar?",
  "sk_quest_had_i_changed_melissa_p_1_el_6_text": "Ah, the one you got from playing with Alura. Didn't it heal a while ago? And wasn't it small to begin with? ",
  "sk_quest_had_i_changed_melissa_p_1_el_7_text": "Well, I surely didn't think it was that small.",
  "sk_quest_had_i_changed_melissa_p_1_el_8_text": "Why are you asking now? Are you sure you're okay already?",
  "sk_quest_had_i_changed_melissa_p_1_el_9_text": "Yes, it's just it made me think about a lot of things, ones from the past too.",
  "sk_quest_had_i_changed_melissa_p_1_el_10_text": "I see. But in case you need any help, I'm here.",
  "sk_quest_had_i_changed_melissa_p_1_el_11_text": "I know, thank you.",
  "sk_quest_had_i_changed_melissa_p_1_el_12_text": "Ohh, and I have to go now.",
  "sk_quest_had_i_changed_melissa_p_1_el_13_text": "Sure, take care!",
  "sk_quest_had_i_changed_melissa_p_1_el_14_text": "You too!",
  "sk_quest_had_i_changed_melissa_p_1_el_15_text": "Leave ",
  "sk_quest_had_i_changed_barret_p_1_el_1_text": "I wanna ask if I... well... did I change?",
  "sk_quest_had_i_changed_barret_p_1_el_2_text": "Hmm, isn't this one of those questions girls ask? Are you...",
  "sk_quest_had_i_changed_barret_p_1_el_3_text": "You interrupt him with a loud sarcastic laugh, hinting to him not to continue.",
  "sk_quest_had_i_changed_barret_p_1_el_4_text": "Ha-ha. Sorry, sorry.",
  "sk_quest_had_i_changed_barret_p_1_el_5_text": "But really, yes. I cannot describe it clearly, but I feel like you've surely changed.",
  "sk_quest_had_i_changed_barret_p_1_el_6_text": "And, I mentioned this earlier, but you didn't go more into it then.", // (if 'barret matters' complete) 
  "sk_quest_had_i_changed_barret_p_1_el_7_text": "Can you say what you see that has changed, like what about the scar?",
  "sk_quest_had_i_changed_barret_p_1_el_8_text": "That scar? Yeah... you got it ages ago, so it's finally healed, right?",
  "sk_quest_had_i_changed_barret_p_1_el_9_text": "It's very strange, it couldn't have healed so fast and he knows the situation behind it to take it so lightly.",
  "sk_quest_had_i_changed_barret_p_1_el_10_text": "Well, as for changes, apparently except that odd behavior of yours...",
  "sk_quest_had_i_changed_barret_p_1_el_11_text": "He comes a bit closer and starts to examine you closely, intensely looking and searching for any differences.",
  "sk_quest_had_i_changed_barret_p_1_el_12_text": "Such gaze could even burn the hole right through, I would be no suprised.",
  // "sk_quest_had_i_changed_barret_p_1_el_13_text": "", // image 
  "sk_quest_had_i_changed_barret_p_1_el_14_text": "But his menacing look helped us a few even when...",
  "sk_quest_had_i_changed_barret_p_1_el_15_text": "Then suddenly he starts looking baffled and puts a distance between you.",
  "sk_quest_had_i_changed_barret_p_1_el_16_text": "He blushes and tries not to catch your eyes directly.",
  // "sk_quest_had_i_changed_barret_p_1_el_17_text": "", // image
  "sk_quest_had_i_changed_barret_p_1_el_18_text": "That was certainly unexpected.",
  "sk_quest_had_i_changed_barret_p_1_el_19_text": "Hmm, yes, there are a few things I didn't notice before.",
  "sk_quest_had_i_changed_barret_p_1_el_20_text": "Like what?",
  "sk_quest_had_i_changed_barret_p_1_el_21_text": "You look... thinner and... hm... nicer...",
  "sk_quest_had_i_changed_barret_p_1_el_22_text": "Nicer?",
  "sk_quest_had_i_changed_barret_p_1_el_23_text": "Well... I mean... like more expressive eyes and lighter skin.",
  "sk_quest_had_i_changed_barret_p_1_el_24_text": "He now looks even more perplexed and embarrassed.",  
  // "sk_quest_had_i_changed_barret_p_1_el_25_text": "", // image
  "sk_quest_had_i_changed_barret_p_1_el_26_text": "Hm, I see...",
  "sk_quest_had_i_changed_barret_p_1_el_27_text": "Interesting. It's quite rare to see him like this.",  
  "sk_quest_had_i_changed_barret_p_1_el_28_text": "I've heard enough, so we can stop at that.",
  "sk_quest_had_i_changed_barret_p_1_el_29_text": "It was a little awkward for both of us, but it's obvious that his perception of me is not as usual.",
  "sk_quest_had_i_changed_barret_p_1_el_30_text": "I haven't examined you before, yet we have spent a lot of time together and I do not remember seeing such features in your appearance before.", 
  "sk_quest_had_i_changed_barret_p_1_el_31_text": "What are the reason for the changes? Did you use your sister's cosmetic ointments of sorts?",
  "sk_quest_had_i_changed_barret_p_1_el_32_text": "Hah? No, why would I do that?",
  "sk_quest_had_i_changed_barret_p_1_el_33_text": "It's just that my body was overstressed after the incident at the lake, maybe it gave my body some sort of recreational effect.",
  "sk_quest_had_i_changed_barret_p_1_el_34_text": "Incident?", // (if 'barret matters' not complete) 
  "sk_quest_had_i_changed_barret_p_1_el_35_text": "Ah, yes, I'll tell you some other time.", // (if 'barret matters' not complete) 
  "sk_quest_had_i_changed_barret_p_1_el_36_text": "Yeah... maybe.", // (if 'barret matters' complete) 
  "sk_quest_had_i_changed_barret_p_1_el_37_text": "You can see that he is still not happy about you withholding the full details.", // (if 'barret matters' complete) 
  "sk_quest_had_i_changed_barret_p_1_el_38_text": "Anyway, I need to go.",
  "sk_quest_had_i_changed_barret_p_1_el_39_text": "I want to check how Alura is doing.", // (if 'had I changed' Melissa not complete)
  "sk_quest_had_i_changed_barret_p_1_el_40_text": "And talk to my sister.", // (if 'had I changed' Alura not complete)
  "sk_quest_had_i_changed_barret_p_1_el_41_text": "Hm, sure.",
  "sk_quest_had_i_changed_barret_p_1_el_42_text": "Leave",  
  "sk_quest_had_i_changed_alura_p_1_el_1_text": "Haven't seen you for a while. Is everything alright?",
  "sk_quest_had_i_changed_alura_p_1_el_2_text": "Yeah, just been busy and had a small incident at the lake.",
  "sk_quest_had_i_changed_alura_p_1_el_3_text": "Oh my. Do you feel better? Do you need some treatment? Do...",
  "sk_quest_had_i_changed_alura_p_1_el_4_text": "No, no. It's all good now, don't worry.",
  "sk_quest_had_i_changed_alura_p_1_el_5_text": "Actually, I wanted to ask about something... um... have you noticed anything different about me?",
  "sk_quest_had_i_changed_alura_p_1_el_6_text": "Are you sure you're okay?",
  "sk_quest_had_i_changed_alura_p_1_el_7_text": "Yes! I just... just lost some weight and wanted to ask if you noticed.",
  "sk_quest_had_i_changed_alura_p_1_el_8_text": "Hmm, not really. ",
  "sk_quest_had_i_changed_alura_p_1_el_9_text": "Then she shyly glanced all over you and got a little embarrassed.",
  "sk_quest_had_i_changed_alura_p_1_el_10_text": "But, um, probably yes... a bit... I guess.",
  "sk_quest_had_i_changed_alura_p_1_el_11_text": "And what about the scar?",
  "sk_quest_had_i_changed_alura_p_1_el_12_text": "Oh, now that you mention it, yes, you finally managed to cure it. I'm so relieved now.",
  "sk_quest_had_i_changed_alura_p_1_el_13_text": "Did you really still feel responsible for that?",
  "sk_quest_had_i_changed_alura_p_1_el_14_text": "Well, if it weren't for me, you wouldn't have gotten it in the first place.",
  "sk_quest_had_i_changed_alura_p_1_el_15_text": "Ehh, I told you that it's no... whatever, it doesn't matter now, right?",
  "sk_quest_had_i_changed_alura_p_1_el_16_text": "Mm-hmm",
  "sk_quest_had_i_changed_alura_p_1_el_17_text": "Well, thanks anyway. I've got to go now.",
  "sk_quest_had_i_changed_alura_p_1_el_18_text": "As you turn to leave, you feel her grab your hand.",
  // "sk_quest_had_i_changed_alura_p_1_el_19_text": "", // image here 
  "sk_quest_had_i_changed_alura_p_1_el_20_text": "Wait. Is that it? When can we hang around and talk some more?",
  "sk_quest_had_i_changed_alura_p_1_el_21_text": "Uh, at such moments she looks like a lost helpless puppy that you'd want to pet.",  
  // "sk_quest_had_i_changed_alura_p_1_el_22_text": "", // image here 
  "sk_quest_had_i_changed_alura_p_1_el_23_text": "Soon, very soon, I promise. I just need to take care of a few more things.",
  "sk_quest_had_i_changed_alura_p_1_el_24_text": "Oh, okay. ",
  "sk_quest_had_i_changed_alura_p_1_el_25_text": "You see that she is saddened by your words, but still checking you, hoping you might change your mind.",
  "sk_quest_had_i_changed_alura_p_1_el_26_text": "Well, it's typical of her to behave like that when things don't go her way. <br> Still, I cannot go and satisfy all her whims all the time, now especially.",
  "sk_quest_had_i_changed_alura_p_1_el_27_text": "See you, bye.",
  "sk_quest_had_i_changed_alura_p_1_el_28_text": "Hmm, bye.",
  "sk_quest_had_i_changed_alura_p_1_el_29_text": "Leave",
  "sk_quest_had_i_changed_final_p_1_el_1_text": "So, I asked people I usually spend time with about any changes.",
  "sk_quest_had_i_changed_final_p_1_el_2_text": "And, from what I gathered, their perception of me differs.",
  "sk_quest_had_i_changed_final_p_1_el_3_text": "It was difficult for them to notice any difference in me until I asked them to take a closer look.",
  "sk_quest_had_i_changed_final_p_1_el_4_text": "What's especially odd is that they all seemed to forget about the scar I've had for years, and their reaction after I mentioned it.",
  "sk_quest_had_i_changed_final_p_1_el_5_text": "Now, I assume it's not me who just went crazy, but all of that is rather the consequences of the events at the lake.",
  "sk_quest_had_i_changed_final_p_1_el_6_text": "Too bad I can't ask anyone knowledgeable about such matters safely.",
  "sk_quest_had_i_changed_final_p_1_el_7_text": "I don't know the village wizard well enough to approach him directly and trust him on such things easily.",
  "sk_quest_had_i_changed_final_p_1_el_8_text": "And that witch is obviously out of the question.",
  "sk_quest_had_i_changed_final_p_1_el_9_text": "Anyway, I don't see anything I can safely do right now, except continue to keep an eye out for opportunities to discover more about those consequences over time.",
  "sk_quest_had_i_changed_final_p_1_el_10_text": "And if I see things start to worsen, I will go and talk to my parents, the wizard and the village elder.",
  "sk_quest_had_i_changed_final_p_1_el_11_text": "Well, sounds like a plan for now.",
  "sk_quest_had_i_changed_final_p_1_el_12_text": "Leave",
  "sk_quest_melissa_swim_p_1_el_1_text": "Warning! This is a meta-quest. <br> Meta-quests are not a canon and serve as a temporary plug for a real quest that will be implemented later on. ",
  "sk_quest_melissa_swim_p_1_el_2_text": "You need to learn swimming, so next time you could drown yourself instead of drowning me.",
  "sk_quest_melissa_swim_p_1_el_3_text": "Fuck you! I apologized a lot already.",
  "sk_quest_melissa_swim_p_1_el_4_text": "Yeah, but that's not changing the fact that you need to learn swimming.",
  "sk_quest_melissa_swim_p_1_el_5_text": "Okay, so what do you suggest?",
  "sk_quest_melissa_swim_p_1_el_6_text": "We will go to the lake or the river and I will teach you to swim 5 times. <br> Then I will note a record to your profile in my diary that I taught you to swim and you will increase relationship score towards me.",
  "sk_quest_melissa_swim_p_1_el_7_text": "Emm.. What?!",
  "sk_quest_melissa_swim_p_1_el_8_text": "Do not pay attention, it's a half-meta conversation.",
  "sk_quest_melissa_swim_p_1_el_9_text": "Sure, weirdo.",
  "sk_quest_melissa_swim_p_1_el_10_text": "Oh, and we won't go there until later in the game, because right now I'm afraid to go outside the village.",
  "sk_quest_melissa_swim_p_1_el_11_text": "...",
  "sk_quest_melissa_swim_p_1_el_12_text": "Why did you even start that conversation then?",
  "sk_quest_melissa_swim_p_1_el_13_text": "In the future I will change the text or just add new conversation after this one. ",
  "sk_quest_melissa_swim_p_1_el_14_text": "Go get some more sleep and maybe stop taking the unknown herbs.",
  "sk_quest_melissa_swim_p_1_el_15_text": "And then, when you come to your senses, we will talk about it once again.",
  "sk_quest_melissa_swim_p_1_el_16_text": "Affirmative!",
  "sk_quest_melissa_swim_p_1_el_17_text": "Leave",
  "sk_sketch_personal_melissa_swim_p_1_el_1_text": "I think you need to learn how to swim.",
  "sk_sketch_personal_melissa_swim_p_1_el_2_text": "If you want to mention brooch situation again, then do not worry. I'll try to not disturb you again with my screw-ups.",
  "sk_sketch_personal_melissa_swim_p_1_el_3_text": "You do not need to avoid asking for my help, I'm still your brother and carry for you.",
  "sk_sketch_personal_melissa_swim_p_1_el_4_text": "But there are some things that you could learn.",
  "sk_sketch_personal_melissa_swim_p_1_el_5_text": "I see her hesitation.",
  "sk_sketch_personal_melissa_swim_p_1_el_6_text": "Hm, she wants to grow up faster somewhy, so I could try to use it.",
  "sk_sketch_personal_melissa_swim_p_1_el_7_text": "The more thing your able to do, especially base things like swimming, the more you can show off. Adults do this kind of stuff all the time.",
  "sk_sketch_personal_melissa_swim_p_1_el_8_text": "Fine, fine. I'm not against it, but I don't have a swimming attire.",
  "sk_sketch_personal_melissa_swim_p_1_el_9_text": "Well, I may buy it for you then.",
  "sk_sketch_personal_melissa_swim_p_1_el_10_text": "Really?!.",
  "sk_sketch_personal_melissa_swim_p_1_el_11_text": "Images with sparkling eyes",
  "sk_sketch_personal_melissa_swim_p_1_el_12_text": "I'll owe you then. I mean owe you once more.",
  "sk_sketch_personal_melissa_swim_p_1_el_13_text": "Okay, I'll buy it to you.",
  "sk_sketch_personal_melissa_swim_p_1_el_14_text": "I'll come back at it later.",
  "sk_quest_return_brooch_p_1_el_1_text": "About that brooch...",
  "sk_quest_return_brooch_p_1_el_2_text": "Yes, I'm very sorry that my...",
  "sk_quest_return_brooch_p_1_el_3_text": "No, no, stop for a second. I'm not here to guilt you or anything.",
  "sk_quest_return_brooch_p_1_el_4_text": "She falls silent, looking at you intensely.",
  "sk_quest_return_brooch_p_1_el_5_text": "I just found the brooch in my clothes and remembered that I still hadn't returned it to you.",
  "sk_quest_return_brooch_p_1_el_6_text": "Oh, right, I guess I also forgot about it with all that happened.",
  "sk_quest_return_brooch_p_1_el_7_text": "You take her hand and take the brooch out of your pocket.",
  "sk_quest_return_brooch_p_1_el_8_text": "Here it is.",
  "sk_quest_return_brooch_p_1_el_9_text": "Give her the brooch",
  "sk_quest_return_brooch_p_2_el_1_text": "Oh, finally I can put it back! I will definitely not mess up with it again! ",
  "sk_quest_return_brooch_p_2_el_2_text": "Yeah, I wouldn't want to repeat similar events again either.",
  "sk_quest_return_brooch_p_2_el_3_text": "You can see her getting sadder and her eyes starting to express guilt.",
  // "sk_quest_return_brooch_p_2_el_4_text": "", // image
  "sk_quest_return_brooch_p_2_el_5_text": "What can I even possibly do to reciprocate for everything that happened?",
  "sk_quest_return_brooch_p_2_el_6_text": "It's okay, you don't really have to go out of your way.",
  "sk_quest_return_brooch_p_2_el_7_text": "I fee... It's just such jokes of yours feel like small stabs in the heart.",
  "sk_quest_return_brooch_p_2_el_8_text": "Sorry for that, they come out of my mouth on its own because that's how our usual talks were like.",
  "sk_quest_return_brooch_p_2_el_9_text": "I understand, but I'm not feeling like things can simply return to how they were, at least not quickly.",
  "sk_quest_return_brooch_p_2_el_10_text": "That's fine too, then we'll just build new ways of interacting.",
  "sk_quest_return_brooch_p_2_el_11_text": "I feel like now is the time I can show off.",
  "sk_quest_return_brooch_p_2_el_12_text": "We all have our flaws and strengths. My jokes, your clumsiness, my sense of commitment, your charmings, and so on and so on. <br> The main thing is that we should go on living and helping each other to enhance our strengths and cover our weaknesses. ",
  "sk_quest_return_brooch_p_2_el_13_text": "Woah, what a speech. Did you prepare it beforehand to show off in a due time? ",
  "sk_quest_return_brooch_p_2_el_14_text": "She smiles cheerfully.",
  // "sk_quest_return_brooch_p_2_el_15_text": "", // image
  "sk_quest_return_brooch_p_2_el_16_text": "Well, she figured me out.",
  "sk_quest_return_brooch_p_2_el_17_text": "It even seems like you are a caring older brother.",
  "sk_quest_return_brooch_p_2_el_18_text": "But I am.",
  "sk_quest_return_brooch_p_2_el_19_text": "She laughs fondly.",
  "sk_quest_return_brooch_p_2_el_20_text": "Thank you, I feel much better now. ",
  "sk_quest_return_brooch_p_2_el_21_text": "But still, I'll think about it and figure out how to repay for all you've went through cause of me.", 
  "sk_quest_return_brooch_p_2_el_22_text": "And now I'd better rush while I still have time to return this darn brooch unnoticed.",
  "sk_quest_return_brooch_p_2_el_23_text": "Okay, good luck then. Bye!",
  "sk_quest_return_brooch_p_2_el_24_text": "Bye, bye!",
  "sk_quest_return_brooch_p_2_el_25_text": "Leave",
  "sk_quest_barrets_matters_p_1_el_1_text": "I want to ask about...",
  "sk_quest_barrets_matters_p_1_el_2_text": "Interrupting your question, Barret's mother, Mrs. Smith, comes out and says.",
  "sk_quest_barrets_matters_p_1_el_3_text": "Please make sure to clear out the workshop of tools after you finish learning blacksmithing from your father.",
  "sk_quest_barrets_matters_p_1_el_4_text": "Yes, ma'am! I will recheck if we cleared everything from now on.",
  "sk_quest_barrets_matters_p_1_el_5_text": "Eh, sometimes your attitude is more like of a subordinate or soldier of mine, not a son. Your father likes it, but I don't.<br> Thank goodness you have friends your age to hang out with, otherwise I'd be worried.",
  "sk_quest_barrets_matters_p_1_el_6_text": "Then she turns to you.",
  "sk_quest_barrets_matters_p_1_el_7_text": "Please be good friends with him, because he is too serious and rigorous with us. As well as with most other people. And with you he is more easy-going, as he should be at his age.",
  "sk_quest_barrets_matters_p_1_el_8_text": "With those words, she took her leave from the room.",
  "sk_quest_barrets_matters_p_1_el_9_text": "What was that about?",
  "sk_quest_barrets_matters_p_1_el_10_text": "Ahh, don't mind it. She's just a bit more anxious lately. And I'm not sure that I am the real reason for this.",
  "sk_quest_barrets_matters_p_1_el_11_text": "So what did you start saying just then?",
  "sk_quest_barrets_matters_p_1_el_12_text": "I wanted to know what you wished to ask me when you came by last time.",
  "sk_quest_barrets_matters_p_1_el_13_text": "Ahh, I wanted to ask you something about Alura, but you weren't there. Your sister said she asked you to look for something and you're a little busy. But I noticed that she was worried. ",
  "sk_quest_barrets_matters_p_1_el_14_text": "Did something happen to you that day?",
  "sk_quest_barrets_matters_p_1_el_15_text": "It's a chance to count on him and share all of that with someone, but I'm unsure about the consequences.",
  "sk_quest_barrets_matters_p_1_el_16_text": "From the other side, I can play it safe and try to convince him of the version I've told Melissa. After it, she seemed to calm down and at least partially believe it.",
  "sk_quest_barrets_matters_p_1_el_17_text": "Reveal the truth",
  "sk_quest_barrets_matters_p_1_el_18_text": "Tell the safe version",
  "sk_quest_barrets_matters_p_2_el_1_text": "Melissa lost one of her cosmetic things at the lake, so I dove in to get it. <br> It took a while, and in the process, I accidentally bumped my head on a stone underwater. I felt a bit fuzzy-headed and made my way home like that.",
  "sk_quest_barrets_matters_p_2_el_2_text": "Barret appears somewhat surprised and contemplative.",
  "sk_quest_barrets_matters_p_2_el_3_text": "Hmm, I didn't say right away, but I feel something in you is off now, is it just because of a blow to the head?", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_4_text": "So, you say that changes in you, like the ones I've mentioned before, appeared just because of a blow to the head and overstress? ", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_5_text": "Ahh, he is unexpectedly attentive to this.", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_6_text": "Ahh, I involved him already, but still I need him not to pry any further than already is.", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_7_text": "Maybe I could use the persuasion trick I used on Melissa.",
  "sk_quest_barrets_matters_p_2_el_8_text": "Haha, perhaps it was a magic stone. But the headache after hitting it is not so magical.", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_9_text": "Haha, well, perhaps it was a magic stone. This sounds much more realistic, right, ha-ha?", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_10_text": "In any case, I told you what I know and <b>there is nothing more to it</b>.",
  "sk_quest_barrets_matters_p_2_el_11_text": "Somehow I doubt it, but if you want to keep something to yourself, that's your choice.",
  "sk_quest_barrets_matters_p_2_el_12_text": "Damn, that didn't work.",
  "sk_quest_barrets_matters_p_2_el_13_text": "It's just that I wish you not to make up things for me.",
  "sk_quest_barrets_matters_p_2_el_14_text": "He is clearly disappointed about you covering up the whole truth.",
  "sk_quest_barrets_matters_p_2_el_15_text": "If I remember something else, I'll let you know. ",
  "sk_quest_barrets_matters_p_2_el_16_text": "So what about Alura?",
  "sk_quest_barrets_matters_p_3_el_1_text": "You notice that he didn't like the fact that you decided to drop the topic and switch to another one.",
  "sk_quest_barrets_matters_p_3_el_2_text": "About Alura...",
  "sk_quest_barrets_matters_p_3_el_3_text": "He began to hesitate noticeably, his face began to express doubts.",
  "sk_quest_barrets_matters_p_3_el_4_text": "I was wondering if you've noticed that she's been a little sadder the last few days. <br> And I wanted to suggest going camping by the lake, maybe for the whole day or even overnight.",
  "sk_quest_barrets_matters_p_3_el_5_text": "A shiver ran down your spine at the thought of going to the lake to spending the night there.",
  "sk_quest_barrets_matters_p_3_el_6_text": "But I guess now is not the best time for it, given your situation.",
  "sk_quest_barrets_matters_p_3_el_7_text": "Just as he noticed you were hiding something, you also saw signs that he was thinking of saying something else at first. ",
  "sk_quest_barrets_matters_p_3_el_8_text": "Hmm, is that all?",
  "sk_quest_barrets_matters_p_3_el_9_text": "Yes, that's exactly what I wanted to offer and there is nothing more to it.",
  "sk_quest_barrets_matters_p_3_el_10_text": "He teased my with this imitation, such behavior is rare for him. <br> So this situation and words, spoken and unspoken, might have caused a real damage to our friendship.",
  "sk_quest_barrets_matters_p_3_el_11_text": "I see.",
  "sk_quest_barrets_matters_p_3_el_12_text": "I'm curious about what he really wanted to say about Alura, but there is no point in pressuring him now. And I believe I don't have the right either, since I'm also hiding a big part of the story.",
  "sk_quest_barrets_matters_p_3_el_13_text": "Once I recover, I promise us to gather, so we can go and hang out somewhere. But for now, no overnight stays and certainly no lakes.",
  "sk_quest_barrets_matters_p_3_el_14_text": "Okay, sure.",
  "sk_quest_barrets_matters_p_3_el_15_text": "We both need to cool down a bit and de-escalate the tension that is in the air right now.",
  "sk_quest_barrets_matters_p_3_el_16_text": "I guess I'll go now, I still have things to do. And in case you want to tell me anything else, just find me. I'll be at home more now.",
  "sk_quest_barrets_matters_p_3_el_17_text": "Of course, same goes for you.",
  "sk_quest_barrets_matters_p_3_el_18_text": "Yeah... Bye then.",
  "sk_quest_barrets_matters_p_3_el_19_text": "Leave"
}
/* twine-user-script #3: "content_fr.js" */
// Test version 
localization_text['fr'] = {
  "sk_sketch_warning_p_1_el_1_text": "Certain issues appeared. You should not see it.",
  "setting_debug_mode_text": "Bonjour, je ne vous ai pas vu depuis un moment. Allez-vous aider dans les pâturages?",
  "initial_1": "Bone matan!",
  "characters_mc_name": "Agnès",
  "task_quest_tzmplate_1_description": "",
  "task_quest_tzmplate_1_name": "Distribute Daggers",
  "task_quest_tzmplate_2_description": "",
  "task_quest_tzmplate_2_name": "Talk to Melissa",
  "task_quest_initial_description": "",
  "task_quest_initial_name": "Talk to Melissa (initial)",
  "task_quest_fight_test_1_description": "",
  "task_quest_fight_test_1_name": "Defeat 3 goblins",
  "task_quest_fight_test_2_description": "",
  "task_quest_fight_test_2_name": "Talk to Melissa (after defeating Goblin)",
  "task_sketch_task_description": "",
  "task_sketch_task_name": "Test Sketch",
  "task_quest_eliminate_test_1_description": "",
  "task_quest_eliminate_test_1_name": "Eliminate 3 goblins",
  "task_quest_eliminate_test_2_description": "",
  "task_quest_eliminate_test_2_name": "quest_eliminate_test_2",
  "task_quest_search_test_1_description": "",
  "task_quest_search_test_1_name": "Search twice",
  "task_quest_search_test_2_description": "",
  "task_quest_search_test_2_name": "Search once (optional)",
  "task_quest_search_test_3_description": "",
  "task_quest_search_test_3_name": "Talk to Melissa after search",
  "task_quest_escort_test_1_name": "Escort Melissa to Hallway",
  "task_quest_escort_test_1_description": "",
  "task_escort_gather_socks_name": "Optional Sock gathering",
  "task_escort_gather_socks_description": "",
  "task_escort_test_2_name": "Escort Alura (with Melissa)",
  "task_escort_test_2_description": "",
  "task_gather_socks_name": "Gather 3 Socks",
  "task_gather_socks_description": "",
  "task_gather_keys_name": "Gather 2 keys (optional)",
  "task_gather_keys_description": "",
  "task_gather_stage_2_name": "Talk to Melissa after gathering",
  "task_gather_stage_2_description": "",
  "task_distribute_gather_socks_name": "Gather for distr",
  "task_distribute_gather_socks_description": "",
  "task_distribute_gather_keys_name": "Gather keys for distr",
  "task_distribute_gather_keys_description": "",
  "task_distribute_socks_name": "Distribute socks",
  "task_distribute_socks_description": "",
  "task_distribute_keys_name": "Distribute keys",
  "task_distribute_keys_description": "",
  "task_distribute_dagger_name": "Distribute dagger",
  "task_distribute_dagger_description": "",
  "task_test_gather_socks_name": "Test socks gather 4",
  "task_test_gather_socks_description": "",
  "task_test_gather_keys_name": "Test Keys gather 4",
  "task_test_gather_keys_description": "",
  "task_quest_test_sketch_1_name": "Sketch",
  "task_quest_test_sketch_1_description": "",
  "task_quest_test_fight_1_name": "Fight Test",
  "task_quest_test_fight_1_description": "",
  "quests_quest_tzmplate_name": "Quest tzmplate",
  "quests_quest_tzmplate_description": "",
  "quests_quest_tzmplate_start_text": "tzmplate",
  "quests_initial_name": "Initial",
  "quests_initial_description": "",
  "quests_initial_start_text": "Initial",
  "quests_fight_test_name": "fight_test",
  "quests_fight_test_description": "",
  "quests_fight_test_start_text": "fight quest",
  "quests_sketch_test_name": "Sketch Quest",
  "quests_sketch_test_description": "",
  "quests_sketch_test_start_text": "sketch Quest",
  "quests_eliminate_test_name": "eliminate Quest",
  "quests_eliminate_test_description": "",
  "quests_eliminate_test_start_text": "eliminate Quest",
  "quests_search_test_name": "search Quest",
  "quests_search_test_description": "",
  "quests_search_test_start_text": "search Quest",
  "quests_escort_test_name": "escort Quest",
  "quests_escort_test_description": "",
  "quests_escort_test_start_text": "escort Quest",
  "quests_escort_test_2_name": "escort Quest_2",
  "quests_escort_test_2_description": "",
  "quests_escort_test_2_start_text": "escort Quest_2",
  "quests_gather_test_name": "gather Quest",
  "quests_gather_test_description": "",
  "quests_gather_test_start_text": "gather Quest",
  "quests_distribute_test_name": "distribute Quest",
  "quests_distribute_test_description": "Gather and distribute",
  "quests_distribute_test_start_text": "distribute Quest",
  "sk_sketch_demo_1_p_1_el_1_text": "Speech Text",
  "sk_sketch_demo_1_p_1_el_3_text": "Default text",
  "sk_sketch_demo_1_p_1_el_4_text": "Thought text",
  "sk_sketch_demo_1_p_1_el_5_text": "Gesture text",
  "sk_sketch_demo_1_p_1_el_8_text": "Choice 8(to page 2)",
  "sk_sketch_demo_1_p_1_el_9_text": "Choice 9(to forest)",
  "sk_sketch_demo_1_p_1_el_10_text": "Choice 10(to bedroom)",
  "sk_sketch_demo_1_p_2_el_1_text": "Speech 2 (from melissa)",
  "sk_sketch_demo_1_p_2_el_5_text": "Choice 5 (to kitchen)",
  "sk_sketch_demo_2_p_1_el_1_text": "Speech 1(mc)",
  "sk_sketch_demo_2_p_1_el_2_text": "Choice 2 (to test1 passage)",
  "sk_sketch_demo_2_p_1_el_3_text": "Choice 3 (to page 2)",
  "sk_sketch_demo_2_p_2_el_1_text": "Text gestire (page 2)",
  "sk_test_quest_1_p_1_el_1_text": "Though text 1",
  "sk_test_quest_1_p_1_el_2_text": "Choiec 2(to hmoe kitchen)",
  "items_test_quest_item_2_name": "Test dagger 2",
  "items_test_quest_item_2_description": "",
  "items_test_quest_item_1_name": "Test Key",
  "items_test_quest_item_1_description": "",
  "items_test_weapon_1_name": "Test stiletto 1",
  "items_test_weapon_1_description": "",
  "sk_prologue_loc_1_p_1_el_1_text": "When you wake up, you see your sister sitting on her bed and staring at you. ",
  "sk_prologue_loc_1_p_1_el_2_text": "It is already clear that she needs something and she really wants to ask you about it.",
  "sk_prologue_loc_1_p_1_el_4_text": "Talk to sister",
  "sk_prologue_sk_1_p_1_el_1_text": "Good Morning.",
  "sk_prologue_sk_1_p_1_el_2_text": "Hm.. morning..",
  "sk_prologue_sk_1_p_1_el_3_text": "In your eyes I can see that you can't wait to ask for something.",
  "sk_prologue_sk_1_p_1_el_4_text": "As expected of my brother, the level of your insight is high as ever!",
  "sk_prologue_sk_1_p_1_el_5_text": "Her facial expression changed to a more energized.",
  "sk_prologue_sk_1_p_1_el_7_text": "Stop fawning. Come on already spill the beans.",
  "sk_prologue_sk_1_p_1_el_8_text": "I woke up early in the morning, took mother's expensive brooch, a pair of good-looking capes and went for a walk by the lake ...",
  "sk_prologue_sk_1_p_1_el_9_text": "Well .. so .. I dropped the brooch into the lake.",
  "sk_prologue_sk_1_p_1_el_10_text": "...",
  "sk_prologue_sk_1_p_1_el_11_text": "You're both stay quite for few seconds.",
  "sk_prologue_sk_1_p_1_el_12_text": "Why did you take all this in the first place?",
  "sk_prologue_sk_1_p_1_el_13_text": "Well .. it's a bit embarrassing",
  "sk_prologue_sk_1_p_1_el_14_text": "You keep staring at her, expecting for continuation.",
  "sk_prologue_sk_1_p_1_el_15_text": "Ah, sometimes early in the morning I take my mother's most beautiful things and go out to the lake to show off in them. ",
  "sk_prologue_sk_1_p_1_el_16_text": "While looking at the water surface I portray myself as a popular girl at a ball.",
  "sk_prologue_sk_1_p_1_el_17_text": "Isn't it too early for you to think about this?",
  "sk_prologue_sk_1_p_1_el_18_text": "No! It is not!",
  "sk_prologue_sk_1_p_1_el_19_text": "She started to look quite offended.",
  "sk_prologue_sk_1_p_1_el_20_text": "Ugh, fine, I'll find this brooch.",
  "sk_prologue_sk_1_p_1_el_21_text": "Thank you, thank you!",
  "sk_prologue_sk_1_p_1_el_22_text": "She nearly jumps on you and then hug.",
  "sk_prologue_sk_1_p_1_el_24_text": "Try to do it faster please, I've been worried sick. ",
  "sk_prologue_sk_1_p_1_el_25_text": "I'll stay here and think of something if someone ask where you are.",
  "sk_prologue_sk_1_p_1_el_26_text": "Go to the lake",
  "quests_q_search_brooch_name": "Prologue",
  "quests_q_search_brooch_description": "Need to help my sister.",
  "quests_q_search_brooch_start_text": "Get Prologue Quest",
  "task_prologue_search_name": "Search for the brooch",
  "task_prologue_search_description": "Need to find the brooch that Melissa lost.",
  "task_prologue_gather_name": "Grab the brooch",
  "task_prologue_gather_description": "A shinny object I saw could be a brooch I'm looking for.",
  "sk_prologue_loc_2_p_1_el_1_text": "You came to the lake.",
  "sk_prologue_loc_2_p_1_el_2_text": "It's very quiet and calm here.",
  "sk_prologue_loc_2_p_1_el_3_text": "Need to come here more often.",
  "sk_prologue_loc_2_p_1_el_5_text": "You're searching  for anything that looks like the brooch your sister discribed.",
  "sk_prologue_loc_2_p_1_el_6_text": "I'm too tired. I have to have a rest before I can continue.",
  "sk_prologue_sk_4_p_1_el_1_text": "Your openening your eyes and discover that your are in uknnow place.",
  "sk_prologue_sk_4_p_1_el_3_text": "You see a woman near you. ",
  "sk_prologue_sk_4_p_1_el_4_text": "She sees that you get consciousness and have a worried look.",
  "sk_prologue_sk_4_p_1_el_5_text": "Hello, my dear.",
  "sk_prologue_sk_4_p_1_el_6_text": "I've felt vibrance in magic through my appliances. And hurried to take a look",
  "sk_prologue_sk_4_p_1_el_7_text": "There I've found you at the bottom of the lake.",
  "sk_prologue_sk_4_p_1_el_8_text": "You almost died, I put you out coma with special potion(because we need to cure you faster)",
  "sk_prologue_sk_4_p_1_el_9_text": "Ask about what happened",
  "sk_prologue_sk_4_p_2_el_1_text": "1) It's appeared that you found an artifact from the old legend.\n",
  "sk_prologue_sk_4_p_2_el_2_text": "You supposed to be a hero from the prophecy.\n",
  "sk_prologue_sk_4_p_2_el_3_text": "We need to perform ritual to activate the abilities and adapt your body to it, otherwise it could became a huge problem to your health and life. So better to act quickly.\n",
  "sk_prologue_sk_4_p_2_el_4_text": "But why the artifact would kill his hero?\n",
  "sk_prologue_sk_4_p_2_el_5_text": "You know as they said big power big consequnces.\n",
  "sk_prologue_sk_4_p_2_el_6_text": "  2) It's appeared that you found an cursed artifact. It made you seak and ill.\n",
  "sk_prologue_sk_4_p_2_el_7_text": "We have small time to remove it from your body, so you would be alive and without irreversible damage.",
  "sk_prologue_sk_4_p_2_el_8_text": "I've prepared necessary equipment and spell before you woke up.\n\n",
  "sk_prologue_sk_4_p_2_el_9_text": "Drink this potions. Then lay down, relax and do not resist. It would be painfull but you need to overcame it. (You can call it your first task as a hero).",
  "sk_prologue_sk_4_p_2_el_10_text": "Trust",
  "sk_prologue_sk_4_p_2_el_11_text": "Refuse",
  "sk_prologue_sk_4_p_3_el_1_text": "Her face started to have some features of annoyance.\n",
  "sk_prologue_sk_4_p_3_el_2_text": "But she continued with calm and questionable voice.\n ",
  "sk_prologue_sk_4_p_3_el_3_text": "We need to save you. If you didn't cath up something, I can repeat it to you. ",
  "sk_prologue_sk_4_p_3_el_4_text": "But time is the prioritized recource now.",
  "sk_prologue_sk_4_p_3_el_5_text": "Agree to her propose",
  "sk_prologue_sk_4_p_3_el_6_text": "Refuse",
  "sk_prologue_sk_4_p_4_el_1_text": "It's so painful! Please stop!",
  "sk_prologue_sk_4_p_4_el_2_text": "We can't! It will be even worse if we pause this now.\n",
  "sk_prologue_sk_4_p_4_el_3_text": " I feel like my life is being sucked out of you!",
  "sk_prologue_sk_4_p_4_el_4_text": "It just means that it works! You replace our current peasant soucre with a heroic one.\n",
  "sk_prologue_sk_4_p_4_el_5_text": "Try you best to suppress you inner contrmeasure. It would end faster.\n",
  "sk_prologue_sk_4_p_4_el_6_text": "Trust anyway\n",
  "sk_prologue_sk_4_p_4_el_7_text": "Stop this torture ",
  "sk_prologue_sk_4_p_5_el_1_text": "You feel like you're on the verge of death, she repeats it's necessary. \n",
  "sk_prologue_sk_4_p_5_el_2_text": "\t  - Stop I can't take it anymore.\n\t",
  "sk_prologue_sk_4_p_5_el_3_text": "  - You must overcome it! Embrace the feel! Don't struggle!\n",
  "sk_prologue_sk_4_p_5_el_4_text": "\t  - Ahhh! I feel like dying.\n\t",
  "sk_prologue_sk_4_p_5_el_5_text": "  - You will feel like that, but then you'll reborn!\n\n\t  ",
  "sk_prologue_sk_4_p_5_el_6_text": "Now you can only emit gagging sounds,\n",
  "sk_prologue_sk_4_p_5_el_7_text": "Just a little left!",
  "sk_prologue_sk_4_p_5_el_8_text": "Give up to the feeling of death",
  "sk_prologue_sk_4_p_5_el_9_text": "Take all your will and stop it",
  "sk_prologue_sk_4_p_6_el_1_text": "  You said that you don't trust her\n  ",
  "sk_prologue_sk_4_p_6_el_2_text": "(if (witch_trust>1) remember about pain you haid.)\n",
  "sk_prologue_sk_4_p_6_el_3_text": "  You appretiate her hellp but you will look of how deals will go first.\n",
  "sk_prologue_sk_4_p_6_el_4_text": "  The witch look very pissed of. ",
  "sk_prologue_sk_4_p_6_el_5_text": "She cuss you out.\n  ",
  "sk_prologue_sk_4_p_6_el_6_text": " And tries the to perform the ritual without your consent, but the spell don't works as she want, ",
  "sk_prologue_sk_4_p_6_el_7_text": "you only feel a bit more tired and siffed.\n   ",
  "sk_prologue_sk_4_p_6_el_8_text": "Then in rage, she casts a some spell on you.\n ",
  "sk_prologue_sk_4_p_6_el_9_text": "     You're consumed by darkness for a moment and then you feel like you fell from a small height.\n",
  "sk_prologue_sk_4_p_6_el_10_text": "   You look around and find yourself in the forest.\n  ",
  "sk_prologue_sk_4_p_6_el_11_text": "Go to village",
  "sk_prologue_sk_de_1_p_1_el_2_text": "Your were ovehelmed with agony and despair.",
  "sk_prologue_sk_de_1_p_1_el_5_text": "Barely discernible you heard:\n",
  "sk_prologue_sk_de_1_p_1_el_8_text": "Ah! Yes!     \n",
  "sk_prologue_sk_de_1_p_1_el_11_text": "... \n",
  "sk_prologue_sk_de_1_p_1_el_14_text": "..rked!          \n",
  "sk_prologue_sk_de_1_p_1_el_17_text": " ... ",
  "sk_prologue_sk_de_1_p_1_el_20_text": "..nally got the first one!",
  "sk_prologue_sk_de_1_p_1_el_23_text": "It were the last words your here before your life was swallowed up by the abyss of the darkness.\n",
  "sk_prologue_sk_de_1_p_1_el_25_text": "..."
}
/* twine-user-script #4: "content_ru.js" */
// Test version 
localization_text['ru'] = {
  "sk_sketch_warning_p_1_el_1_text": "Certain issues appeared. You should not see it.",
  "setting_debug_mode_text": "Привет, давно не виделись. Не поможешь на пастбищах?",
  "initial_1": "Доброе утро!",
  "initial_2": "мм.. доброе..",
  "characters_mc_name": "Агнесс",
  "test_quest_01": "Давай начнём же квест!",
  "test_quest_02": "Да, давай!",
  "test_quest_03": "Но о чём вообще этот квест?",
  "test_quest_04": "Собрать носки и рубкашки",
  "test_quest_05": "...",
  "test_quest_06": "Ни за что!",
  "test_quest_07": "Ну пожааалуйста!",
  "test_quest_08": "Ладно, но только потому что это тестовый квест.",
  "test_quest_1": "Пожалуйста сходи в лес и достань мне 3 ветки.",
  "test_quest_2": "...",
  "test_quest_3": "...",
  "test_quest_4": "Почему я вообще должен этим заниматься?",
  "test_quest_5": "Потому что ты главный герой и должен делать ного дурацкий вещей, чтобы набрать опыт.",
  "test_quest_6": "Ладно.. Хорошо!",
  "test_quest_7": "О, Добрый Люд, не подскажите ли мне дорогу ко замку?",
  "test_quest_8": "Ааа... Блять... Здесь монстр! Убей его! Убеееей!",
  "quest_test": "Имя Тестового Квеста",
  "quest_test_1": "1)Вы начали тестовый квест.",
  "quest_test_2": "2)Это строка описания теста для простого локализованного текста.",
  "task_quest_tzmplate_1_description": "",
  "task_quest_tzmplate_1_name": "Distribute Daggers",
  "task_quest_tzmplate_2_description": "",
  "task_quest_tzmplate_2_name": "Talk to Melissa",
  "task_quest_initial_description": "",
  "task_quest_initial_name": "Talk to Melissa (initial)",
  "task_quest_fight_test_1_description": "",
  "task_quest_fight_test_1_name": "Defeat 3 goblins",
  "task_quest_fight_test_2_description": "",
  "task_quest_fight_test_2_name": "Talk to Melissa (after defeating Goblin)",
  "task_sketch_task_description": "",
  "task_sketch_task_name": "Test Sketch",
  "task_quest_eliminate_test_1_description": "",
  "task_quest_eliminate_test_1_name": "Eliminate 3 goblins",
  "task_quest_eliminate_test_2_description": "",
  "task_quest_eliminate_test_2_name": "quest_eliminate_test_2",
  "task_quest_search_test_1_description": "",
  "task_quest_search_test_1_name": "Search twice",
  "task_quest_search_test_2_description": "",
  "task_quest_search_test_2_name": "Search once (optional)",
  "task_quest_search_test_3_description": "",
  "task_quest_search_test_3_name": "Talk to Melissa after search",
  "task_quest_escort_test_1_name": "Escort Melissa to Hallway",
  "task_quest_escort_test_1_description": "",
  "task_escort_gather_socks_name": "Optional Sock gathering",
  "task_escort_gather_socks_description": "",
  "task_escort_test_2_name": "Escort Alura (with Melissa)",
  "task_escort_test_2_description": "",
  "task_gather_socks_name": "Gather 3 Socks",
  "task_gather_socks_description": "",
  "task_gather_keys_name": "Gather 2 keys (optional)",
  "task_gather_keys_description": "",
  "task_gather_stage_2_name": "Talk to Melissa after gathering",
  "task_gather_stage_2_description": "",
  "task_distribute_gather_socks_name": "Gather for distr",
  "task_distribute_gather_socks_description": "",
  "task_distribute_gather_keys_name": "Gather keys for distr",
  "task_distribute_gather_keys_description": "",
  "task_distribute_socks_name": "Distribute socks",
  "task_distribute_socks_description": "",
  "task_distribute_keys_name": "Distribute keys",
  "task_distribute_keys_description": "",
  "task_distribute_dagger_name": "Distribute dagger",
  "task_distribute_dagger_description": "",
  "task_test_gather_socks_name": "Test socks gather 4",
  "task_test_gather_socks_description": "",
  "task_test_gather_keys_name": "Test Keys gather 4",
  "task_test_gather_keys_description": "",
  "task_quest_test_sketch_1_name": "Sketch",
  "task_quest_test_sketch_1_description": "",
  "task_quest_test_fight_1_name": "Fight Test",
  "task_quest_test_fight_1_description": "",
  "quests_quest_tzmplate_name": "Quest tzmplate",
  "quests_quest_tzmplate_description": "",
  "quests_quest_tzmplate_start_text": "tzmplate",
  "quests_initial_name": "Initial",
  "quests_initial_description": "",
  "quests_initial_start_text": "Initial",
  "quests_fight_test_name": "fight_test",
  "quests_fight_test_description": "",
  "quests_fight_test_start_text": "fight quest",
  "quests_sketch_test_name": "Sketch Quest",
  "quests_sketch_test_description": "",
  "quests_sketch_test_start_text": "sketch Quest",
  "quests_eliminate_test_name": "eliminate Quest",
  "quests_eliminate_test_description": "",
  "quests_eliminate_test_start_text": "eliminate Quest",
  "quests_search_test_name": "search Quest",
  "quests_search_test_description": "",
  "quests_search_test_start_text": "search Quest",
  "quests_escort_test_name": "escort Quest",
  "quests_escort_test_description": "",
  "quests_escort_test_start_text": "escort Quest",
  "quests_escort_test_2_name": "escort Quest_2",
  "quests_escort_test_2_description": "",
  "quests_escort_test_2_start_text": "escort Quest_2",
  "quests_gather_test_name": "gather Quest",
  "quests_gather_test_description": "",
  "quests_gather_test_start_text": "gather Quest",
  "quests_distribute_test_name": "distribute Quest",
  "quests_distribute_test_description": "Gather and distribute",
  "quests_distribute_test_start_text": "distribute Quest",
  "sk_sketch_demo_1_p_1_el_1_text": "Speech Text",
  "sk_sketch_demo_1_p_1_el_3_text": "Default text",
  "sk_sketch_demo_1_p_1_el_4_text": "Thought text",
  "sk_sketch_demo_1_p_1_el_5_text": "Gesture text",
  "sk_sketch_demo_1_p_1_el_8_text": "Choice 8(to page 2)",
  "sk_sketch_demo_1_p_1_el_9_text": "Choice 9(to forest)",
  "sk_sketch_demo_1_p_1_el_10_text": "Choice 10(to bedroom)",
  "sk_sketch_demo_1_p_2_el_1_text": "Speech 2 (from melissa)",
  "sk_sketch_demo_1_p_2_el_5_text": "Choice 5 (to kitchen)",
  "sk_sketch_demo_2_p_1_el_1_text": "Speech 1(mc)",
  "sk_sketch_demo_2_p_1_el_2_text": "Choice 2 (to test1 passage)",
  "sk_sketch_demo_2_p_1_el_3_text": "Choice 3 (to page 2)",
  "sk_sketch_demo_2_p_2_el_1_text": "Text gestire (page 2)",
  "sk_test_quest_1_p_1_el_1_text": "Though text 1",
  "sk_test_quest_1_p_1_el_2_text": "Choiec 2(to hmoe kitchen)",
  "items_test_quest_item_2_name": "Test dagger 2",
  "items_test_quest_item_2_description": "",
  "items_test_quest_item_1_name": "Test Key",
  "items_test_quest_item_1_description": "",
  "items_test_weapon_1_name": "Test stiletto 1",
  "items_test_weapon_1_description": "",
  "sk_prologue_loc_1_p_1_el_1_text": "When you wake up, you see your sister sitting on her bed and staring at you. ",
  "sk_prologue_loc_1_p_1_el_2_text": "It is already clear that she needs something and she really wants to ask you about it.",
  "sk_prologue_loc_1_p_1_el_4_text": "Talk to sister",
  "sk_prologue_sk_1_p_1_el_1_text": "Good Morning.",
  "sk_prologue_sk_1_p_1_el_2_text": "Hm.. morning..",
  "sk_prologue_sk_1_p_1_el_3_text": "In your eyes I can see that you can't wait to ask for something.",
  "sk_prologue_sk_1_p_1_el_4_text": "As expected of my brother, the level of your insight is high as ever!",
  "sk_prologue_sk_1_p_1_el_5_text": "Her facial expression changed to a more energized.",
  "sk_prologue_sk_1_p_1_el_7_text": "Stop fawning. Come on already spill the beans.",
  "sk_prologue_sk_1_p_1_el_8_text": "I woke up early in the morning, took mother's expensive brooch, a pair of good-looking capes and went for a walk by the lake ...",
  "sk_prologue_sk_1_p_1_el_9_text": "Well .. so .. I dropped the brooch into the lake.",
  "sk_prologue_sk_1_p_1_el_10_text": "...",
  "sk_prologue_sk_1_p_1_el_11_text": "You're both stay quite for few seconds.",
  "sk_prologue_sk_1_p_1_el_12_text": "Why did you take all this in the first place?",
  "sk_prologue_sk_1_p_1_el_13_text": "Well .. it's a bit embarrassing",
  "sk_prologue_sk_1_p_1_el_14_text": "You keep staring at her, expecting for continuation.",
  "sk_prologue_sk_1_p_1_el_15_text": "Ah, sometimes early in the morning I take my mother's most beautiful things and go out to the lake to show off in them. ",
  "sk_prologue_sk_1_p_1_el_16_text": "While looking at the water surface I portray myself as a popular girl at a ball.",
  "sk_prologue_sk_1_p_1_el_17_text": "Isn't it too early for you to think about this?",
  "sk_prologue_sk_1_p_1_el_18_text": "No! It is not!",
  "sk_prologue_sk_1_p_1_el_19_text": "She started to look quite offended.",
  "sk_prologue_sk_1_p_1_el_20_text": "Ugh, fine, I'll find this brooch.",
  "sk_prologue_sk_1_p_1_el_21_text": "Thank you, thank you!",
  "sk_prologue_sk_1_p_1_el_22_text": "She nearly jumps on you and then hug.",
  "sk_prologue_sk_1_p_1_el_24_text": "Try to do it faster please, I've been worried sick. ",
  "sk_prologue_sk_1_p_1_el_25_text": "I'll stay here and think of something if someone ask where you are.",
  "sk_prologue_sk_1_p_1_el_26_text": "Go to the lake",
  "quests_q_search_brooch_name": "Prologue",
  "quests_q_search_brooch_description": "Need to help my sister.",
  "quests_q_search_brooch_start_text": "Get Prologue Quest",
  "task_prologue_search_name": "Search for the brooch",
  "task_prologue_search_description": "Need to find the brooch that Melissa lost.",
  "task_prologue_gather_name": "Grab the brooch",
  "task_prologue_gather_description": "A shinny object I saw could be a brooch I'm looking for.",
  "sk_prologue_loc_2_p_1_el_1_text": "You came to the lake.",
  "sk_prologue_loc_2_p_1_el_2_text": "It's very quiet and calm here.",
  "sk_prologue_loc_2_p_1_el_3_text": "Need to come here more often.",
  "sk_prologue_loc_2_p_1_el_5_text": "You're searching  for anything that looks like the brooch your sister discribed.",
  "sk_prologue_loc_2_p_1_el_6_text": "I'm too tired. I have to have a rest before I can continue.",
  "sk_prologue_sk_4_p_1_el_1_text": "Your openening your eyes and discover that your are in uknnow place.",
  "sk_prologue_sk_4_p_1_el_3_text": "You see a woman near you. ",
  "sk_prologue_sk_4_p_1_el_4_text": "She sees that you get consciousness and have a worried look.",
  "sk_prologue_sk_4_p_1_el_5_text": "Hello, my dear.",
  "sk_prologue_sk_4_p_1_el_6_text": "I've felt vibrance in magic through my appliances. And hurried to take a look",
  "sk_prologue_sk_4_p_1_el_7_text": "There I've found you at the bottom of the lake.",
  "sk_prologue_sk_4_p_1_el_8_text": "You almost died, I put you out coma with special potion(because we need to cure you faster)",
  "sk_prologue_sk_4_p_1_el_9_text": "Ask about what happened",
  "sk_prologue_sk_4_p_2_el_1_text": "1) It's appeared that you found an artifact from the old legend.\n",
  "sk_prologue_sk_4_p_2_el_2_text": "You supposed to be a hero from the prophecy.\n",
  "sk_prologue_sk_4_p_2_el_3_text": "We need to perform ritual to activate the abilities and adapt your body to it, otherwise it could became a huge problem to your health and life. So better to act quickly.\n",
  "sk_prologue_sk_4_p_2_el_4_text": "But why the artifact would kill his hero?\n",
  "sk_prologue_sk_4_p_2_el_5_text": "You know as they said big power big consequnces.\n",
  "sk_prologue_sk_4_p_2_el_6_text": "  2) It's appeared that you found an cursed artifact. It made you seak and ill.\n",
  "sk_prologue_sk_4_p_2_el_7_text": "We have small time to remove it from your body, so you would be alive and without irreversible damage.",
  "sk_prologue_sk_4_p_2_el_8_text": "I've prepared necessary equipment and spell before you woke up.\n\n",
  "sk_prologue_sk_4_p_2_el_9_text": "Drink this potions. Then lay down, relax and do not resist. It would be painfull but you need to overcame it. (You can call it your first task as a hero).",
  "sk_prologue_sk_4_p_2_el_10_text": "Trust",
  "sk_prologue_sk_4_p_2_el_11_text": "Refuse",
  "sk_prologue_sk_4_p_3_el_1_text": "Her face started to have some features of annoyance.\n",
  "sk_prologue_sk_4_p_3_el_2_text": "But she continued with calm and questionable voice.\n ",
  "sk_prologue_sk_4_p_3_el_3_text": "We need to save you. If you didn't cath up something, I can repeat it to you. ",
  "sk_prologue_sk_4_p_3_el_4_text": "But time is the prioritized recource now.",
  "sk_prologue_sk_4_p_3_el_5_text": "Agree to her propose",
  "sk_prologue_sk_4_p_3_el_6_text": "Refuse",
  "sk_prologue_sk_4_p_4_el_1_text": "It's so painful! Please stop!",
  "sk_prologue_sk_4_p_4_el_2_text": "We can't! It will be even worse if we pause this now.\n",
  "sk_prologue_sk_4_p_4_el_3_text": " I feel like my life is being sucked out of you!",
  "sk_prologue_sk_4_p_4_el_4_text": "It just means that it works! You replace our current peasant soucre with a heroic one.\n",
  "sk_prologue_sk_4_p_4_el_5_text": "Try you best to suppress you inner contrmeasure. It would end faster.\n",
  "sk_prologue_sk_4_p_4_el_6_text": "Trust anyway\n",
  "sk_prologue_sk_4_p_4_el_7_text": "Stop this torture ",
  "sk_prologue_sk_4_p_5_el_1_text": "You feel like you're on the verge of death, she repeats it's necessary. \n",
  "sk_prologue_sk_4_p_5_el_2_text": "\t  - Stop I can't take it anymore.\n\t",
  "sk_prologue_sk_4_p_5_el_3_text": "  - You must overcome it! Embrace the feel! Don't struggle!\n",
  "sk_prologue_sk_4_p_5_el_4_text": "\t  - Ahhh! I feel like dying.\n\t",
  "sk_prologue_sk_4_p_5_el_5_text": "  - You will feel like that, but then you'll reborn!\n\n\t  ",
  "sk_prologue_sk_4_p_5_el_6_text": "Now you can only emit gagging sounds,\n",
  "sk_prologue_sk_4_p_5_el_7_text": "Just a little left!",
  "sk_prologue_sk_4_p_5_el_8_text": "Give up to the feeling of death",
  "sk_prologue_sk_4_p_5_el_9_text": "Take all your will and stop it",
  "sk_prologue_sk_4_p_6_el_1_text": "  You said that you don't trust her\n  ",
  "sk_prologue_sk_4_p_6_el_2_text": "(if (witch_trust>1) remember about pain you haid.)\n",
  "sk_prologue_sk_4_p_6_el_3_text": "  You appretiate her hellp but you will look of how deals will go first.\n",
  "sk_prologue_sk_4_p_6_el_4_text": "  The witch look very pissed of. ",
  "sk_prologue_sk_4_p_6_el_5_text": "She cuss you out.\n  ",
  "sk_prologue_sk_4_p_6_el_6_text": " And tries the to perform the ritual without your consent, but the spell don't works as she want, ",
  "sk_prologue_sk_4_p_6_el_7_text": "you only feel a bit more tired and siffed.\n   ",
  "sk_prologue_sk_4_p_6_el_8_text": "Then in rage, she casts a some spell on you.\n ",
  "sk_prologue_sk_4_p_6_el_9_text": "     You're consumed by darkness for a moment and then you feel like you fell from a small height.\n",
  "sk_prologue_sk_4_p_6_el_10_text": "   You look around and find yourself in the forest.\n  ",
  "sk_prologue_sk_4_p_6_el_11_text": "Go to village",
  "sk_prologue_sk_de_1_p_1_el_2_text": "Your were ovehelmed with agony and despair.",
  "sk_prologue_sk_de_1_p_1_el_5_text": "Barely discernible you heard:\n",
  "sk_prologue_sk_de_1_p_1_el_8_text": "Ah! Yes!     \n",
  "sk_prologue_sk_de_1_p_1_el_11_text": "... \n",
  "sk_prologue_sk_de_1_p_1_el_14_text": "..rked!          \n",
  "sk_prologue_sk_de_1_p_1_el_17_text": " ... ",
  "sk_prologue_sk_de_1_p_1_el_20_text": "..nally got the first one!",
  "sk_prologue_sk_de_1_p_1_el_23_text": "It were the last words your here before your life was swallowed up by the abyss of the darkness.\n",
  "sk_prologue_sk_de_1_p_1_el_25_text": "..."
}
/* twine-user-script #5: "content_ua.js" */
localization_text['ua'] = {
  "sk_sketch_warning_p_1_el_1_text": "Виникли певні проблеми. Ви не мусили бачити це.",
  "setting_debug_mode_text": "Привіт, я тебе давно не бачив. Чи не допоможеш на пасовищах?",
  "test_quest_01": "Давайте почнемо квест!",
  "test_quest_02": "Так, звісно!",
  "test_quest_03": "Але про що цей квест?",
  "test_quest_04": "Збирати носки та сорочки",
  "test_quest_05": "...",
  "test_quest_06": "Ні!",
  "test_quest_07": "Ну дуже прошу!",
  "test_quest_08": "Добре, але лише тому, що це тестовий квест.",
  "test_quest_1": "Будь ласка, сходи у ліс та принеси 3 гілки.",
  "test_quest_2": "...",
  "test_quest_3": "...",
  "test_quest_4": "Чому я це мушу робити?",
  "test_quest_5": "Тому що ти головний герой і ти повинен виконувати багато дурних поручень, щоб отримати досвід.",
  "test_quest_6": "Ехх... Добре!",
  "test_quest_7": "Вітаю добрі люди, я хотів би дізнатись чи не будете ви так люб'язні, вказати мені дорогу до замку?",
  "test_quest_8": "Ааа... Чорти б його... Тут монстряка! Заваліть його! Скоріш!",
  "quest_test": "Тестове Ім'я Квесту",
  "quest_test_1": "1) Ви розпочали Тестовий Квест.",
  "quest_test_2": "2) Це рядок опису для звичайного локалізованого тексту",
  "characters_alura_description": "Ваша подруга дитинства. Її сім'я бідна. Її мати була благородною особою низького рангу. Вона вийшла заміж за батька Алури, і він покинув їх",
  "characters_sekhmau_description": "Сильна регенерація, їй потрібен господар, щоб захищати його, не має милосердя, легковажна у вживанні алкоголю, їй легко занудьгувати",
  "characters_mc_name": "Агнес",
  "characters_melissa_name": "Меліса",
  "characters_witch_name": "Відьма",
  "characters_alura_name": "Алура",
  "characters_barret_name": "Баррет",
  "characters_savia_name": "Савія",
  "characters_sekhmau_name": "Секмау",
  "characters_kalithara_name": "Калітара",  
  "characters_mother_name": "Мати",
  "characters_father_name": "Батько",
  "characters_mr_smith_name": "Пан Сміт",
  "characters_mrs_smith_name": "Пані Сміт",
  "characters_ms_taylor_name": "Пані Тейлор",
  "characters_amelina_name": "Амеліна",
  "characters_wizard_name": "Чаклун",
  "characters_eredira_name": "Ередіра",
  "characters_sextom_name": "Пан Секстон",
  "characters_test_npc_name": "Тестовий НіП",
  "characters_unknown_woman_name": "Невідома жінка",
  "characters_tall_man_name": "Високий чоловік",
  "characters_jovan_name": "Йован Астальріб",
  "characters_unknown_man_name": "Невідомий чоловік",
  "characters_void_woman_name": "Знайома жінка з пустоти",
  "quests_quest_tzmplate_name": "Шаблон квесту",
  "quests_initial_name": "Початковий",
  "quests_fight_test_name": "Тест бою",
  "quests_sketch_test_name": "Скетч квест",
  "quests_eliminate_test_name": "Квест знищення",
  "quests_search_test_name": "Квест пошуку",
  "quests_escort_test_name": "Квест супроводу",
  "quests_escort_test_2_name": "Квест супроводу 2",
  "quests_gather_test_name": "Квест збору",
  "quests_distribute_test_name": "Квест доставки",
  "quests_quest_tzmplate_start_text": "шаблон",
  "quests_fight_test_start_text": "бойовий квест",
  "quests_sketch_test_start_text": "Скетч квест",
  "quests_eliminate_test_start_text": "Квест знищення",
  "quests_search_test_start_text": "Квест пошуку",
  "quests_escort_test_start_text": "Квест супроводу",
  "quests_escort_test_2_start_text": "Квест супроводу 2",
  "quests_gather_test_start_text": "Квест збору",
  "quests_distribute_test_start_text": "Квест доставки",
  "task_quest_tzmplate_1_description": "",
  "task_quest_tzmplate_1_name": "Доставити кинджали",
  "task_quest_tzmplate_2_description": "",
  "task_quest_tzmplate_2_name": "Поговорити з Мелісою",
  "task_quest_initial_description": "",
  "task_quest_initial_name": "Поговорити з Мелісою (початковий)",
  "task_quest_fight_test_1_description": "",
  "task_quest_fight_test_1_name": "Перемогти 3 гоблінів",
  "task_quest_fight_test_2_description": "",
  "task_quest_fight_test_2_name": "Поговорити з Мелісою (після перемоги над гоблінами)",
  "task_sketch_task_description": "",
  "task_sketch_task_name": "Тестовий скетч",
  "task_quest_eliminate_test_1_description": "",
  "task_quest_eliminate_test_1_name": "Знищити 3 гоблінів",
  "task_quest_eliminate_test_2_description": "",
  "task_quest_eliminate_test_2_name": "Квест знищення 2",
  "task_quest_search_test_1_description": "",
  "task_quest_search_test_1_name": "Шукати двічі",
  "task_quest_search_test_2_description": "",
  "task_quest_search_test_2_name": "Шукати один раз (опціонально)",
  "task_quest_search_test_3_description": "",
  "task_quest_search_test_3_name": "Поговорити з Мелісою після пошуку",
  "task_quest_escort_test_1_name": "Супровід Меліси до коридору",
  "task_quest_escort_test_1_description": "",
  "task_escort_gather_socks_name": "Опціональне збирання носків",
  "task_escort_gather_socks_description": "",
  "task_escort_test_2_name": "Супровід Алури (з Мелісою)",
  "task_escort_test_2_description": "",
  "task_gather_socks_name": "Зібрати 3 носки (опціонально)",
  "task_gather_socks_description": "",
  "task_gather_keys_name": "Зібрати 2 ключі (опціонально)",
  "task_gather_keys_description": "",
  "task_gather_stage_2_name": "Поговорити з Мелісою після збору",
  "task_gather_stage_2_description": "",
  "task_distribute_gather_socks_name": "Зібрати для доставки",
  "task_distribute_gather_socks_description": "",
  "task_distribute_gather_keys_name": "Зібрати ключі для доставки",
  "task_distribute_gather_keys_description": "",
  "task_distribute_socks_name": "Доставити носки",
  "task_distribute_socks_description": "",
  "task_distribute_keys_name": "Доставити ключі",
  "task_distribute_keys_description": "",
  "task_distribute_dagger_name": "Доставити кинджал",
  "task_distribute_dagger_description": "",
  "task_test_gather_socks_name": "Тестове збирання носків 4",
  "task_test_gather_socks_description": "",
  "task_test_gather_keys_name": "Тестове збирання ключів 4",
  "task_test_gather_keys_description": "",
  "task_quest_test_sketch_1_name": "Скетч",
  "task_quest_test_sketch_1_description": "",
  "task_quest_test_fight_1_name": "Тест бою",
  "task_quest_test_fight_1_description": "",
  "quests_quest_tzmplate_description": "",
  "quests_initial_description": "",
  "quests_initial_start_text": "Початковий",
  "quests_fight_test_description": "",
  "quests_sketch_test_description": "",
  "quests_eliminate_test_description": "",
  "quests_search_test_description": "",
  "quests_escort_test_description": "",
  "quests_escort_test_2_description": "",
  "quests_gather_test_description": "",
  "quests_distribute_test_description": "Збирання та доставка",
  "sk_sketch_demo_1_p_1_el_1_text": "Текст мовлення",
  "sk_sketch_demo_1_p_1_el_3_text": "Текст за замовчуванням",
  "sk_sketch_demo_1_p_1_el_4_text": "Текст думки",
  "sk_sketch_demo_1_p_1_el_5_text": "Текст жесту",
  "sk_sketch_demo_1_p_1_el_8_text": "Вибір 8 (до сторінки 2)",
  "sk_sketch_demo_1_p_1_el_9_text": "Вибір 9 (до лісу)",
  "sk_sketch_demo_1_p_1_el_10_text": "Вибір 10 (до спальні)",
  "sk_sketch_demo_1_p_2_el_1_text": "Мовлення 2 (від Меліси)",
  "sk_sketch_demo_1_p_2_el_5_text": "Вибір 5 (до кухні)",
  "sk_sketch_demo_2_p_1_el_1_text": "Мовлення 1 (mc)",
  "sk_sketch_demo_2_p_1_el_2_text": "Вибір 2 (до test1 passage)",
  "sk_sketch_demo_2_p_1_el_3_text": "Вибір 3 (до сторінки 2)",
  "sk_sketch_demo_2_p_2_el_1_text": "Текст жесту (сторінка 2)",
  "sk_test_quest_1_p_1_el_1_text": "Текст думки 1",
  "sk_test_quest_1_p_1_el_2_text": "Вибір 2 (до дому на кухню)",
  "items_test_quest_item_2_name": "Тестовий кинджал 2",
  "items_test_quest_item_2_description": "",
  "items_test_quest_item_1_name": "Тестовий ключ",
  "items_test_quest_item_1_description": "",
  "items_test_weapon_1_name": "Тестовий стилет 1",
  "items_test_weapon_1_description": "",
  "sk_skip_passage_sketch_p_1_el_1_text": "Перейти до 'Після прологу'",
  "sk_prologue_loc_1_p_1_el_1_text": "Ти відкриваєш очі і бачиш знайому стелю, яку бачиш щодня.",
  "sk_prologue_loc_1_p_1_el_3_text": "Ти позіхаєш і закриваєш очі знов.",
  "sk_prologue_loc_1_p_1_el_4_text": "Так, і що ж мені робити сьогодні?",
  "sk_prologue_loc_1_p_1_el_5_text": "Гм, думаю, що я почну з того, що перекушу вчорашнім курячим салатом і піду навідаю...",
  "sk_prologue_loc_1_p_1_el_6_text": "Раптово потік твоїх думок переривається тонким скрипом підлоги.",
  "sk_prologue_loc_1_p_1_el_7_text": "Ти повертаєшся до того звуку і бачиш, що твоя сестра сидить на своєму ліжку і уважно дивиться на тебе, нервово шарпаючи краєм своєї ковдри.",
  "sk_prologue_loc_1_p_1_el_8_text": "Вона одягнена на вихід. Очевидно, що вона прокинулася не тільки-но.",
  "sk_prologue_loc_1_p_1_el_9_text": "Ага, зрозуміло, я знаю цей її погляд...",
  "sk_prologue_loc_1_p_1_el_11_text": "Неозброєним оком видно, що їй щось потрібно, і вона зараз чекає слушної миті, щоб про це попросити.",
  "sk_prologue_loc_1_p_1_el_12_text": "Привітатися з сестрою",
  "sk_prologue_sk_1_p_1_el_1_text": "Доброго ранку.",
  "sk_prologue_sk_1_p_1_el_2_text": "Гм.. доброго..",
  "sk_prologue_sk_1_p_1_el_3_text": "Сказавши це, вона почала обережно підходити до тебе.",
  "sk_prologue_sk_1_p_1_el_4_text": "Ну і, що тобі потрібно?",
  "sk_prologue_sk_1_p_1_el_5_text": "Просто хотіла побажати доброго ранку моєму чудовому братику.",
  "sk_prologue_sk_1_p_1_el_6_text": "Вона підійшла ще ближче і продемонструвала свою найяскравішу посмішку.",
  "sk_prologue_sk_1_p_1_el_7_text": "Здавалося, наче її очі та аура навколо неї засіяли.",
  "sk_prologue_sk_1_p_1_el_9_text": "Дідько, а вона іноді може бути аж настільки милою, якщо захоче...",
  "sk_prologue_sk_1_p_1_el_10_text": "Оскільки тобі довелося використовувати по максимуму свої чари, це, мабуть, щось справді важливе. ",
  "sk_prologue_sk_1_p_1_el_11_text": "Тому можеш вже припинити підмазуватись та просто розповідай вже.",
  "sk_prologue_sk_1_p_1_el_12_text": "Як і очікувалося від мого братика, рівень твоєї прозорливості як завжди на висоті!",
  "sk_prologue_sk_1_p_1_el_13_text": "Ти закочуєш очі.",
  "sk_prologue_sk_1_p_1_el_14_text": "Добре, добре, я зупинюся.",
  "sk_prologue_sk_1_p_1_el_15_text": "Щодо того, чого я хочу попросити... ну...",
  "sk_prologue_sk_1_p_1_el_16_text": "Вона тяжко зітхає.",
  "sk_prologue_sk_1_p_1_el_17_text": "...сьогодні я рано вранці прокинулась, взяла мамину гарну брошку, кілька предметів з найбільш вишуканого вбрання і пішла прогулятися біля озера...",
  "sk_prologue_sk_1_p_1_el_18_text": "І... емм... я випадково впустила брошку в озеро.",
  "sk_prologue_sk_1_p_1_el_19_text": "...",
  "sk_prologue_sk_1_p_1_el_20_text": "На кілька секунд у кімнаті запанувала тиша.",
  "sk_prologue_sk_1_p_1_el_21_text": "Навіщо ти взагалі взяла все це?",
  "sk_prologue_sk_1_p_1_el_22_text": "Ну, про це трохи ніяково казати...",
  "sk_prologue_sk_1_p_1_el_23_text": "Ти мовчки дивишся на неї, чекаючи, щоб вона врешті пояснила.",
  "sk_prologue_sk_1_p_1_el_24_text": "Ах, іноді вранці я позичаю найкрасивіші мамині речі і йду до озера, щоб уявити, ніби я якась популярна дворянка на шикарному заході. ",
  "sk_prologue_sk_1_p_1_el_25_text": "Роблячи різні пози та дивлячись у воду, я уявляю себе персонажами з книг.",
  "sk_prologue_sk_1_p_1_el_26_text": "Хм... здається розумію... Але тобі хіба не рано думати про таке?",
  "sk_prologue_sk_1_p_1_el_27_text": "Ні, не рано!",
  "sk_prologue_sk_1_p_1_el_28_text": "Меліса зараз виглядає трохи ображеною.",
  "sk_prologue_sk_1_p_1_el_29_text": "Вона не може просто забити на це, тож, мабуть, у мене немає особливого вибору.",
  "sk_prologue_sk_1_p_1_el_30_text": "Погодитися знайти брошку",
  "sk_prologue_sk_1_p_2_el_1_text": "Тц, добре, знайду я тобі ту брошку.",  
  "sk_prologue_sk_1_p_2_el_2_text": "Меліса буквально стрибає на тебе і міцно обіймає.",
  "sk_prologue_sk_1_p_2_el_3_text": "Дякую тобі величезне!",
  "sk_prologue_sk_1_p_2_el_5_text": "Ця маленька дівчинка, безперечно, вміє використовувати свої чари проти мене.",
  "sk_prologue_sk_1_p_2_el_6_text": "Я віднесу вбрання до кімнати батьків і залишуся тут поблизу, щоб придумати виправдання, якщо хтось запитає куди ти дівся.",
  "sk_prologue_sk_1_p_2_el_7_text": "І будь ласка, постарайся знайти її якомога швидше, я дуже переймаюсь.",
  "sk_prologue_sk_1_p_2_el_8_text": "Тобі справді варто вже навчитися плавати.",
  "sk_prologue_sk_1_p_2_el_9_text": "Так, так, так, ми можемо все це обговорити після того, як ти повернешся.",
  "sk_prologue_sk_1_p_2_el_10_text": "Сподіваюся, все пройде гладко, і я зможу швидко розібратись з цим.",
  "sk_prologue_sk_1_p_2_el_11_text": "Йти до озера",  
  "quests_q_search_brooch_name": "Знайти брошку",
  "quests_q_search_brooch_description": "Потрібно допомогти сестрі.",
  "quests_q_search_brooch_start_text": "Знайти брошку",
  "task_prologue_search_name": "Пошукати брошку",
  "task_prologue_search_description": "Потрібно знайти брошку, яку загубила Меліса.",
  "task_prologue_search_2_name": "Пошукати ще раз",
  "task_prologue_search_2_description": "Потрібно знайти брошку, яку загубила Меліса.",
  "task_prologue_gather_name": "Взяти брошку",
  "task_prologue_gather_description": "Блискучий предмет, який я бачив, може бути брошкою, яку я шукаю.",
  "sk_prologue_loc_2_p_1_el_2_text": "Ти прибув до озера. \n Атмосфера дуже тиха та заспокійлива.",
  "sk_prologue_loc_2_p_1_el_3_text": "Тут справді так мирно і спокійно.",
  "sk_prologue_loc_2_p_1_el_4_text": "Було б непогано частіше сюди приходити.",
  "sk_prologue_loc_2_p_1_el_5_text": "Ти пірнав і пірнав, шукаючи щось, що відповідало б опису брошки. \n Однак поки що тобі не поталанило її знайти.",
  "sk_prologue_loc_2_p_1_el_6_text": "Я дуже втомився. Треба зробити перерву, перш ніж продовжувати.",
  "sk_prologue_loc_2_p_1_el_7_text": "Треба вже навчити Мелісу плавати. \n Було б добре, якби наступного разу вона сама могла б впоратися з такими речами.",
  "sk_prologue_loc_2_p_1_el_8_text": "Мені потрібно продовжити шукати цю брошку.",
  "sk_prologue_loc_2_p_1_el_9_text": "Але, можливо, мені потрібен відпочити трохи більше.",
  "sk_prologue_loc_3_p_1_el_2_text": "Останнього разу коли я пірнав, я краєм ока помітив, що ліворуч є щось, що відзеркалює світло.",
  "sk_prologue_loc_3_p_1_el_3_text": "Мені варто знову пірнути туди і взяти ту річ.",
  "sk_prologue_loc_3_p_1_el_4_text": "Навіть якщо це не брошка, це може бути чимось коштовним. \n Це може бути якась прикраса, яку можна було б продати чи подарувати.",
  "sk_prologue_sk_2_p_1_el_1_text": "Пірнувши біля того місця, ти з'ясував, що це і справді та брошка, яку ти шукав.",
  "sk_prologue_sk_2_p_1_el_3_text": "Однак там також є щось інше.",
  "sk_prologue_sk_2_p_1_el_4_text": "Ти намагаєшся схопити і цю річ також.",
  "sk_prologue_sk_2_p_1_el_6_text": "У ту мить, коли ти торкаєшся цього предмета, твоє тіло паралізує.",
  "sk_prologue_sk_2_p_1_el_7_text": "А перед очима з'являється динамічна різнокольорова картина.",
  "sk_prologue_sk_2_p_1_el_9_text": "Грудну клітину здавлює і ти інстинктивно відкриваєш рота, намагаючись зробити подих, забувши, що ти під водою.",
  "sk_prologue_sk_2_p_1_el_10_text": "Задихаючись і втрачаючи концентрацію, твоя свідомість починає згасати.",
  "sk_prologue_sk_2_p_1_el_11_text": "Відрубитись",
  "sk_prologue_sk_3_p_1_el_1_text": "У незрозумілому стані ти починаєш бачити дивні образи.",
  "sk_prologue_sk_3_p_1_el_2_text": "...",
  "sk_prologue_sk_3_p_1_el_4_text": "Мені здається, ніби я її знаю вже давно... <br> Але ким вона може бути?",
  "sk_prologue_sk_3_p_1_el_5_text": "...",
  "sk_prologue_sk_3_p_1_el_7_text": "Це схоже на столицю... у вогні...",
  "sk_prologue_sk_3_p_1_el_8_text": "...",
  "sk_prologue_sk_3_p_1_el_10_text": "Ще одна жінка, яка відчувається знайомою... <br> Що вона робить?",
  "sk_prologue_sk_3_p_1_el_11_text": "...",
  "sk_prologue_sk_3_p_1_el_12_text": "Після цього ти прокидаєшся",
  "sk_prologue_sk_4_p_1_el_2_text": "Ти починаєш приходити до тями, твій зір прояснюється і ти бачиш, що опинився в незнайомому місці.",
  "sk_prologue_sk_4_p_1_el_4_text": "Поруч ти бачиш жінку.",
  "sk_prologue_sk_4_p_1_el_5_text": "Вона помічає, що ти прийшов до тями і починає дивитись на тебе стурбованим поглядом.",
  "sk_prologue_sk_4_p_1_el_6_text": "Вітаю, любчику.",
  "sk_prologue_sk_4_p_1_el_7_text": "Її слова зависають у повітрі, поки ти намагаєшся скласти докупи пазл з останніх подій.",
  "sk_prologue_sk_4_p_1_el_8_text": "Вона продовжує, її голос відчувається сповненим напруженням.",
  "sk_prologue_sk_4_p_1_el_9_text": "Я відчула сплеск магічної енергії через свої зачарування в цій місцевості і поквапилась дослідити джерело.",
  "sk_prologue_sk_4_p_1_el_10_text": "Саме тоді я і знайшла тебе, на дні озера. <br> Ти був на межі смерті, але мені вдалося повернути тебе за допомогою спеціального зілля.",
  "sk_prologue_sk_4_p_1_el_11_text": "Гадаю, ти торкнувся чогось, чого не слід було.",
  "sk_prologue_sk_4_p_1_el_12_text": "Але зараз це неважливо, нам потрібно якнайшвидше завершити твоє лікування!",
  "sk_prologue_sk_4_p_1_el_13_text": "Почекайте хвилиночку, у мене є питання.",
  "sk_prologue_sk_4_p_1_el_14_text": "Чи був цей предмет настільки цінний, що мав власний захист?",
  "sk_prologue_sk_4_p_1_el_15_text": "Чи я наклав на себе прокляття або щось на кшталт, торкнувшись цього предмета?",
  "sk_prologue_sk_4_p_2_el_1_text": "Так, ти правий щодо цього. Цей предмет і є причиною того, що сталося.",
  "sk_prologue_sk_4_p_2_el_2_text": "Схоже, ти знайшов предмет з однієї давньої легенди.",
  "sk_prologue_sk_4_p_2_el_3_text": "Згідно з нею, ти можеш бути тим героєм, який знайшовши цей міфічний предмет, отримає велику силу і поведе нації до нової ери.",
  "sk_prologue_sk_4_p_2_el_4_text": "Однак, як бачиш, все не так просто і це не та річ, яку хтось може легко отримати.",
  "sk_prologue_sk_4_p_2_el_5_text": "Нам потрібно провести ритуал, щоб активувати здібності та адаптувати твоє тіло до них, інакше все це може стати величезною проблемою для твого здоров'я і життя. Тож треба діяти швидко!",
  "sk_prologue_sk_4_p_2_el_6_text": "Але навіщо артефакту вбивати свого героя?",
  "sk_prologue_sk_4_p_2_el_7_text": "Отримати таку силу можуть лише гідні.",
  "sk_prologue_sk_4_p_2_el_8_text": "До того ж, знаєш як кажуть: велика сила — велика відповідальність.",
  "sk_prologue_sk_4_p_2_el_9_text": "То що нам робити?",
  "sk_prologue_sk_4_p_3_el_1_text": "Так, ти маєш рацію щодо цього. Цей предмет і є причиною того, що сталося.",  
  "sk_prologue_sk_4_p_3_el_2_text": "Схоже, ти знайшов проклятий артефакт, і він досить потужний.",
  "sk_prologue_sk_4_p_3_el_3_text": "Він може викликати хворобу, і, якщо ми не вживемо заходів терміново, це призведе до твоєї гибелі.",
  "sk_prologue_sk_4_p_3_el_4_text": "У нас є обмежена кількість часу, щоб витягти прокляття з твого тіла, для того щоб ти залишився живим і запобігти незворотнім пошкодженням.",
  "sk_prologue_sk_4_p_3_el_5_text": "У що я в біса встряг?",
  "sk_prologue_sk_4_p_3_el_6_text": "То що нам робити?",
  "sk_prologue_sk_4_p_4_el_1_text": "Я підготувала все необхідне обладнання і закляття, перш ніж ти прокинувся.",
  "sk_prologue_sk_4_p_4_el_2_text": "Спочатку випий ці зілля.",
  "sk_prologue_sk_4_p_4_el_3_text": "Потім лягай, розслабся і не чини опору.",
  "sk_prologue_sk_4_p_4_el_4_text": "Одразу кажу - це буде боляче, але тобі потрібно це подолати.",
  "sk_prologue_sk_4_p_4_el_5_text": "Все відбувається так швидко.",
  "sk_prologue_sk_4_p_4_el_6_text": "Можеш вважати це своїм першим завданням героя!",  
  "sk_prologue_sk_4_p_4_el_7_text": "Якщо ми не зробимо цього зараз, все стане набагато гірше. Ти повинен будеш витримати це на протязі деякого часу!",
  "sk_prologue_sk_4_p_4_el_8_text": "Довіритись",  
  "sk_prologue_sk_4_p_4_el_9_text": "Відмовитись",  
  "sk_prologue_sk_4_p_5_el_1_text": "На її обличчі почали з'являтися ознаки роздратування.",
  "sk_prologue_sk_4_p_5_el_2_text": "Але вона продовжувала спокійним і настирним тоном.",
  "sk_prologue_sk_4_p_5_el_3_text": "Ми повинні тебе врятувати!",
  "sk_prologue_sk_4_p_5_el_4_text": "Якщо ти щось не зрозумів, я зможу пояснити це пізніше.",
  "sk_prologue_sk_4_p_5_el_5_text": "Але наразі час - це наш першочерговий ресурс.",
  "sk_prologue_sk_4_p_5_el_6_text": "Погодитися на її пропозицію",  
  "sk_prologue_sk_4_p_5_el_7_text": "Відмовитись",   
  "sk_prologue_sk_4_p_6_el_1_text": "Пройшло близько півгодини.",
  "sk_prologue_sk_4_p_6_el_2_text": "Так боляче! Будь ласка досить!",
  "sk_prologue_sk_4_p_6_el_3_text": "Ми не можемо зупинитись! Якщо зараз припинимо, буде куди гірше!",
  "sk_prologue_sk_4_p_6_el_4_text": "Мені здається, що з мене висмоктують життя!",
  "sk_prologue_sk_4_p_6_el_5_text": "Це лише означає, що все працює як треба!",
  "sk_prologue_sk_4_p_6_el_6_text": "Ти замінюєш свою звичайну сутність на геройську.",
  "sk_prologue_sk_4_p_6_el_7_text": "Доклади всі зусилля, щоб подавити свій внутрішній супротив! Тоді швидше закінчиться!",
  "sk_prologue_sk_4_p_6_el_8_text": "Їбись воно вздовж і впоперек, як же боляче!",
  "sk_prologue_sk_4_p_6_el_9_text": "Довіритись її словам",
  "sk_prologue_sk_4_p_6_el_10_text": "Зупинити ці пекельні борошна",  
  "sk_prologue_sk_4_p_7_el_1_text": "Після приблизно години.",
  "sk_prologue_sk_4_p_7_el_2_text": "Все, досить! Я не можу це більше витримувати!",
  "sk_prologue_sk_4_p_7_el_3_text": "Тобі здається, що ти на межі смерті через нестерпний біль.",
  "sk_prologue_sk_4_p_7_el_4_text": "Тобі треба перебороти це! Прийми це почуття! Не борися!",
  "sk_prologue_sk_4_p_7_el_5_text": "Ааа! Я відчуваю, що зараз помру!",
  "sk_prologue_sk_4_p_7_el_6_text": "Так, ти будеш це відчувати, але потім ти народишся знов!",
  "sk_prologue_sk_4_p_7_el_7_text": "Тепер все, що ти можеш робити, це видавати хриплі звуки.",
  "sk_prologue_sk_4_p_7_el_8_text": "Ще трохи, ще трохи!",
  "sk_prologue_sk_4_p_7_el_9_text": "Віддатися почуттю смерті",
  "sk_prologue_sk_4_p_7_el_10_text": "Взяти всю волю, що залишилась і зупинити це",  
  "sk_prologue_sk_de_1_p_1_el_2_text": "Ти був охоплений агонією та відчаєм.",
  "sk_prologue_sk_de_1_p_1_el_5_text": "Ледве в змозі розрізнити що-небудь, ти почув...",
  "sk_prologue_sk_de_1_p_1_el_8_text": "Так!",
  "sk_prologue_sk_de_1_p_1_el_11_text": "... ",
  "sk_prologue_sk_de_1_p_1_el_14_text": ".. вдалося!",
  "sk_prologue_sk_de_1_p_1_el_17_text": " ... ",
  "sk_prologue_sk_de_1_p_1_el_20_text": "...нарешті перший в мене!",
  "sk_prologue_sk_de_1_p_1_el_23_text": "Це були останні слова, які ти почув перед тим, як тебе поглинула темрява.",
  "sk_prologue_sk_de_1_p_1_el_26_text": "...",
  "sk_prologue_sk_5_p_1_el_1_text": "Доклавши неймовірних зусиль ти встаєш, розриваючи поточне заклинання.",
  "sk_prologue_sk_5_p_1_el_2_text": "Зупинись, якщо...",
  "sk_prologue_sk_5_p_1_el_3_text": "Це занадто для мене!",
  "sk_prologue_sk_5_p_1_el_4_text": "Я не робитиму цього! Я вирішив твердо і чітко!",
  "sk_prologue_sk_5_p_1_el_5_text": "Відьма явно розлючена.",
  "sk_prologue_sk_5_p_1_el_6_text": "Я ціную твою спробу допомогти, але це точно занадто!",
  "sk_prologue_sk_5_p_1_el_7_text": "Ти, можливо, намагаєшся допомогти, але рішення все одно за мною.",
  "sk_prologue_sk_5_p_1_el_8_text": "Краще спочатку подивлюся, як все буде складатись.",
  "sk_prologue_sk_5_p_1_el_9_text": "Невдячний дурень!",
  "sk_prologue_sk_5_p_1_el_10_text": "Тобі просто потрібно було трохи більше потерпіти, ти, нікчемна козявка!",
  "sk_prologue_sk_5_p_1_el_11_text": "Ти навіть не намагався, ти, нікчемна козявка!",
  "sk_prologue_sk_5_p_1_el_12_text": "Відьма накладає на тебе обмежувальне закляття.",
  "sk_prologue_sk_5_p_1_el_13_text": "Якого біса?",
  "sk_prologue_sk_5_p_1_el_14_text": "Відьма намагається провести ритуал без твоєї згоди.",
  "sk_prologue_sk_5_p_1_el_15_text": "Тепер не думаю, що вона справді збиралася допомогти мені з артефактом, якщо то взагалі був артефакт.",
  "sk_prologue_sk_5_p_1_el_16_text": "Сумніваюся, що вона взагалі намагалася зняти прокляття, якщо воно взагалі є.",
  "sk_prologue_sk_5_p_1_el_17_text": "Ти лише відчуваєш дещо більшу втому та трохи запаморочення.",
  "sk_prologue_sk_5_p_1_el_18_text": "Здається, без моєї згоди це не спрацює!",
  "sk_prologue_sk_5_p_1_el_19_text": "Завали свою погану ротяку!",
  "sk_prologue_sk_5_p_1_el_20_text": "У нападі люті вона намагається накласти ще якесь закляття. <br> Але мана навколо стає помітно нестабільною, а потім...",
  "sk_prologue_sk_5_p_1_el_21_text": "...тебе поглинає безодня...",
  "sk_prologue_sk_5_p_1_el_22_text": "...",
  "sk_prologue_sk_5_p_2_el_1_text": "Раптом ти відчуваєш, ніби впав із невеликої висоти.",
  "sk_prologue_sk_5_p_2_el_2_text": "Ай!",
  "sk_prologue_sk_5_p_2_el_3_text": "Коли твій зір прояснюється, ти озираєшся навколо і розумієш, що ти десь посеред густого лісу.",
  "sk_prologue_sk_5_p_2_el_4_text": "Мені потрібно повернутися до поселення!",
  "sk_prologue_sk_5_p_2_el_5_text": "...",
  "sk_prologue_sk_5_p_2_el_6_text": "Через деякий час пробираючись лісом, ти бачиш знайомий краєвид.",
  "sk_prologue_sk_5_p_2_el_8_text": "Фух, я нарешті бачу околиці свого поселення.",
  "sk_prologue_sk_5_p_2_el_9_text": "Дивлячись на нього, ти спираєшся на дерево поруч. <br> Події недавнього минулого закружляли у твоїй голові.",
  "sk_prologue_sk_5_p_2_el_10_text": "Чи було все це насправді?",
  "sk_prologue_sk_5_p_2_el_11_text": "Ти відчуваєш, як у тебе починають тремтіти коліна, а голова починає йти обертом.",
  "sk_prologue_sk_5_p_2_el_12_text": "Поки що це не так важливо. Зараз треба потрапити додому, поки в мене ще залишилися якісь сили.",
  "sk_prologue_sk_5_p_2_el_13_text": "Зібравши останні залишки сили та угасаючої свідомості, ти рухаєшся в бік...",
  "sk_prologue_sk_5_p_2_el_14_text": "...дому",
  "sk_prologue_sk_6_p_1_el_1_text": "Через деякий час ти прокидаєшся в дивно знайомій темряві, і починаєш поступово повертатись до тями.",
  "sk_prologue_sk_6_p_1_el_2_text": "Гей, що сталося?",
  "sk_prologue_sk_6_p_1_el_3_text": "Останнє, що я пам'ятаю, я бачив двері свого будинку.",
  "sk_prologue_sk_6_p_1_el_4_text": "Ти намагаєшся зорієнтуватися відносно того де ти і що навколо, але бачиш лише темряву.",
  "sk_prologue_sk_6_p_1_el_5_text": "Мм, це схоже на той стан, коли я тонув.",
  "sk_prologue_sk_6_p_1_el_6_text": "Але я бачу і відчуваю більш чітко.",
  "sk_prologue_sk_6_p_1_el_7_text": "Поступово ти починаєш бачити щось окрім темряви, щось начебто фрагменти до якоїсь сцени.",
  "sk_prologue_sk_6_p_1_el_8_text": "Так, хм, дивно, але я якось відчуваю, що зможу зробити ці фрагменти більш чіткими.",
  "sk_prologue_sk_6_p_1_el_9_text": "Ти якийсь час зосереджуєшся на тому, щоб взяти контроль над цим відчуттям.",
  "sk_prologue_sk_6_p_1_el_10_text": "Кілька хвилин по тому ти відчуваєш, що можеш не тільки зробити фрагменти чіткішими, але й взаємодіяти з ними.",
  "sk_prologue_sk_6_p_1_el_11_text": "Можливо, це допоможе мені повернутися у реальність... де б я зараз не знаходився насправді.",
  "sk_prologue_sk_6_p_1_el_12_text": "Ти сильно зосереджуєшся на тих фрагментах, на які натрапив, і...",
  "sk_prologue_sk_6_p_1_el_13_text": "...поринаєш у них",
  "sk_prologue_sk_6_p_2_el_1_text": "Після кількох хвилин у повній темряві, ти раптово опиняєшься навпроти жінки, образ якої ти бачив, коли уперше був у темряві.",
  "sk_prologue_sk_6_p_2_el_3_text": "Однак цього разу ти бачиш її не зі сторони, а власне через її ж очі, поки вона вдивляється у своє відображення в дзеркалі.",
  "sk_prologue_sk_6_p_2_el_4_text": "Не могли б ти вже перестати красуватися собою перед дзеркалом?",
  "sk_prologue_sk_6_p_2_el_5_text": "Ти знаєш, як я обожнюю вглядатись у прекрасні речі, чи не так?",
  "sk_prologue_sk_6_p_2_el_6_text": "Дивлячись очима цієї жінки, ти бачиш, як її погляд обертається до невідомої людини, яка поставила запитання першою.",
  "sk_prologue_sk_6_p_2_el_8_text": "Це ж та проклята відьма, хоч зараз вона і виглядає молодшою.",
  "sk_prologue_sk_6_p_2_el_9_text": "Зараз не час на жарти, Калітаро!",
  "sk_prologue_sk_6_p_2_el_10_text": "Воу, ти покликала мене за ім'ям, такшо це має бути щось дуже серйозне.",
  "sk_prologue_sk_6_p_2_el_11_text": "Так, це буде не описати наскільки серйозно, якщо ми почнемо це!",
  "sk_prologue_sk_6_p_2_el_12_text": "Ти розумієш, наскільки великим буде цей виклик для нас, які небезпеки чекають, і як малі наші шанси?!",
  "sk_prologue_sk_6_p_2_el_13_text": "Беруть сумніви?",
  "sk_prologue_sk_6_p_2_el_14_text": "Справа не в цьому, я повністю віддана досягненню того, що ми повинні досягнути!",
  "sk_prologue_sk_6_p_2_el_15_text": "Проте, ти якось дивно спокійна стосовно чогось настільки масштабного та важливого, і, того що ми повинні почати вже наступного місяця!",
  "sk_prologue_sk_6_p_2_el_16_text": "Мені здається, ти не дуже серйозно ставишся до цього, тоді як я не можу припинити бути напруженою, і саме це мене дуже дратує!",
  "sk_prologue_sk_6_p_2_el_17_text": "Для мене це просто щось невідворотнє. Ми будемо продовжувати доти, доки потрібно і знищимо кого та що завгодно, що буде стояти на нашому шляху!",
  "sk_prologue_sk_6_p_2_el_18_text": "Що до решти, ну... що буде, то й буде.",
  "sk_prologue_sk_6_p_2_el_19_text": "Тому я й не переймаюся цим.",
  "sk_prologue_sk_6_p_2_el_20_text": "Якщо це заспокоїть тебе, просто пам'ятай, що я буду з тобою весь цей шлях, і наприкінці його ми разом отримаємо силу, яка може покінчити зі світом, яким ми його знаємо зараз.",
  "sk_prologue_sk_6_p_2_el_21_text": "Відьма здається трохи спокійнішою та розслабленішою після цих слів.",
  "sk_prologue_sk_6_p_2_el_22_text": "Так, мабуть, ти права. Я рознервувалась. Ехх, все ще є багато того, чому мені треба в тебе навчитись.",
  "sk_prologue_sk_6_p_2_el_23_text": "Ви спостерігаєте, як Калітара знову переводить свій погляд на дзеркало.",
  "sk_prologue_sk_6_p_2_el_24_text": "Жінка починає дивитися прямо в очі своєму відображенню і ти помічаєш, що на її губах починає формуватися ледь помітна пустотлива посмішка.",
  "sk_prologue_sk_6_p_2_el_25_text": "Зачекайте, чи вона...",
  "sk_prologue_sk_6_p_2_el_26_text": "І тут раптом, сильний натиск викидає тебе з того простору.",
  "sk_prologue_sk_6_p_2_el_27_text": "...",
  "sk_prologue_loc_4_p_1_el_1_text": "Ти приходиш до тями і стрімко піднімаєшься верхньою частиною тіла.",
  "sk_prologue_loc_4_p_1_el_2_text": "Вона мене бачила? Чи вона знала, що я спостерігаю?",
  "sk_prologue_loc_4_p_1_el_3_text": "Холодний піт пробиває все твоє тіло.",
  "sk_prologue_loc_4_p_1_el_4_text": "Хах, я знову відчуваю себе як зазвичай, у нормальному стані. І я більше не в тій темряві.",
  "sk_prologue_loc_4_p_1_el_5_text": "Протерши очі, ти оглядаєшся навколо.",
  "sk_prologue_loc_4_p_1_el_6_text": "Ти бачиш, що знаходишся в своїй кімнаті, а поряд з твоїм ліжком спить твоя сестра.",
  "sk_prologue_loc_4_p_1_el_8_text": "Не знаю, що сталося вчора, але принаймні я вдома.",
  "sk_prologue_loc_4_p_1_el_9_text": "Ти переводиш погляд на вікно і помічаєш, що зараз десь середина дня.",
  "sk_prologue_loc_4_p_1_el_10_text": "Потрібно її розбудити і дізнатися, що сталось поки мене не було.",
  "sk_prologue_loc_4_p_1_el_11_text": "Розбудити її",
  "sk_prologue_loc_4_p_2_el_1_text": "Ти обережно починаєш трясти її за плече.",
  "sk_prologue_loc_4_p_2_el_2_text": "Вона потроху починає відкривати свої сонні очі, з головою повернутою у твій бік.",
  "sk_prologue_loc_4_p_2_el_4_text": "Ти бачиш, як вона починає усвідомлювати, що ти дивишся прямо на неї.",
  "sk_prologue_loc_4_p_2_el_5_text": "Потім вона раптово підскакує, щоб обійняти тебе, і починає плакати.",
  "sk_prologue_loc_4_p_2_el_6_text": "Слава богу, ти цілий!",
  "sk_prologue_loc_4_p_2_el_7_text": "Я т-так боялася, що ти більше не прокинешся.",
  "sk_prologue_loc_4_p_2_el_8_text": "Гей, гей, досить, ти так мене задушиш.",
  "sk_prologue_loc_4_p_2_el_9_text": "Вона неохоче відпускає тебе.",
  "sk_prologue_loc_4_p_2_el_11_text": "Вона схлипує.",
  "sk_prologue_loc_4_p_2_el_12_text": "Перш ніж розповісти про щось з того, що зі мною сталося, краще спочатку дізнатись, що вона бачила вчора.",
  "sk_prologue_loc_4_p_2_el_13_text": "Я хочу запитати тебе про те, що було вчора. Чесно кажучи, я не пам'ятаю як я тут опинився.",
  "sk_prologue_loc_4_p_2_el_14_text": "Вона намагається стримати схлипи...",
  "sk_prologue_loc_4_p_2_el_15_text": "... і починає розповідати",
  "sk_prologue_loc_4_p_3_el_1_text": "Вчора тебе не було цілий день. ",
  "sk_prologue_loc_4_p_3_el_2_text": "Ввечері я почала дуже хвилюватися і запитала кількох людей, чи не бачили вони тебе, але ніхто не бачив. <br> Я вже хотіла сама піти до озера, але вже сутеніло, а ти знаєш наскільки я незграбна у темряві. <br> До того ж батьки могли б дізнатися, що щось не так.",
  "sk_prologue_loc_4_p_3_el_3_text": "Тільки тепер я розумію, що це були просто недолугі виправдання. Мені треба було йти туди, а не сидіти й чекати.",
  "sk_prologue_loc_4_p_3_el_4_text": "На її обличчі можна було прочитати глибокий сум через почуття провини.",
  "sk_prologue_loc_4_p_3_el_5_text": "Я чекала на тебе всю ніч, але коли ти повернувся рано вранці, ти виглядав наче мертвий, і погляд твій був наче ти десь не тут. <br> Не реагуючи на мої слова, ти дібрався до ліжка і знепритомнів.",
  "sk_prologue_loc_4_p_3_el_6_text": "Уві сні ти сильно крутився, пітнів, і твоє дихання сильно ослабло.",
  "sk_prologue_loc_4_p_3_el_7_text": "Вона знову починає схлипувати.",
  "sk_prologue_loc_4_p_3_el_8_text": "Я... я... я не знала, що з тобою! Я... я думала, ти помреш у мене на руках!",
  "sk_prologue_loc_4_p_3_el_9_text": "Я протерла тебе вологою ганчіркою, п-перевірила твоє дихання і поміняла п-подушки, які стали мокрими.",
  "sk_prologue_loc_4_p_3_el_10_text": "Потім почало здаватися, що твій стан стабілізувався, тому я трохи розслабилася і заснула.",
  "sk_prologue_loc_4_p_3_el_11_text": "Не хвилюйся, зараз вже все гаразд.",
  "sk_prologue_loc_4_p_3_el_12_text": "Ти їй легенько посміхаєшся.",
  "sk_prologue_loc_4_p_3_el_13_text": "Ні, не все гаразд! Ти захворів через мене! Ч-через цю дурну брошку!",
  "sk_prologue_loc_4_p_3_el_14_text": "Вона почала виглядати більше розлюченою, ніж сумною.",
  "sk_prologue_loc_4_p_3_el_15_text": "Я могла зробити набагато більше! Я могла зупинити батьків до від'їзду до міста! І викликати лікаря мені навіть на думку не спало! І-і... я заснула, коли тобі стало лише трохи краще!",
  "sk_prologue_loc_4_p_3_el_16_text": "Схоже, вона на межі, думаю, мені потрібно спробувати обійняти її та заспокоїти.",
  "sk_prologue_loc_4_p_3_el_18_text": "Вона починає вириватися, але ви намагаєтесь утримати її в своїх обіймах, і вона зрештою здається.",
  "sk_prologue_loc_4_p_3_el_19_text": "Слухай, зараз зі мною все гаразд.",
  "sk_prologue_loc_4_p_3_el_20_text": "Відтепер я обіцяю бути обережнішим.",
  "sk_prologue_loc_4_p_3_el_21_text": "Мені просто ще ніколи в житті не було так лячно.",
  "sk_prologue_loc_4_p_3_el_22_text": "Ви відчуваєте, що вона майже заспокоїлася.",
  "sk_prologue_loc_4_p_3_el_23_text": "Але тепер ця ситуація закінчилась. Мені боляче бачити тебе такою. Будь ласка, повернися до тої життєрадісної маленької шкідниці, яку я знаю.",
  "sk_prologue_loc_4_p_3_el_24_text": "Хе-хе.. Невже я прям шкідниця?",
  "sk_prologue_loc_4_p_3_el_25_text": "Вона запитує з легкою невинною посмішкою, витираючи сльози.",
  "sk_prologue_loc_4_p_3_el_26_text": "Іноді буваєш такою.",
  "sk_prologue_loc_4_p_3_el_27_text": "Ви відповідаєте, гладячи її по голові.",
  "sk_prologue_loc_4_p_3_el_29_text": "Після цього ви обидва трохи дистанціюєтеся. ",
  "sk_prologue_loc_4_p_3_el_30_text": "То що з тобою там в біса сталося?",
  "sk_prologue_loc_4_p_3_el_31_text": "Чи варто відверто розповісти про все, що трапилося? <br> Або краще не ризикувати одразу й поки обережно дивитись, як все буде йти далі?",
  "sk_prologue_loc_4_p_3_el_32_text": "Розповісти їй все про свою незвичну і нещасливу пригоду",
  "sk_prologue_loc_4_p_3_el_33_text": "Сказати їй, що не пам'ятаєш чітко що трапилось",
  "sk_prologue_loc_4_p_4_el_1_text": "Я не хочу брехати, але наслідки можуть виявитися небезпечними, тому краще не втягувати її в усе це.",
  "sk_prologue_loc_4_p_4_el_2_text": "Ну, в мене так-то нема захоплюючих історій.",
  "sk_prologue_loc_4_p_4_el_3_text": "Я пірнав біля берега, доки не втомлювався і не відпочивав. І повторював так, поки не знайшов якийсь сяючий предмет. <br> Пам'ятаю, як я хотів його схопити, а потім усе наче у тумані. Смутно згадую лише деякі фрагменти, образи і думки про повернення додому.",
  "sk_prologue_loc_4_p_4_el_4_text": "На цьому і справді все?",
  "sk_prologue_loc_4_p_4_el_5_text": "А ти очікувала, що я пережив якусь епічну пригоду, як ті герої в пригодницьких історіях?",
  "sk_prologue_loc_4_p_4_el_6_text": "Мабуть, я просто вдарився головою під час пірнання або мене вкусила якась гадюка.",
  "sk_prologue_loc_4_p_4_el_7_text": "Щось звучить так собі. Я очікувала чогось більшого ніж струс мозку після занурення, враховуючи весь цей емоційний стрес і той твій стан, коли ти повернувся.",
  "sk_prologue_loc_4_p_4_el_8_text": "Так-то так, не дивно, що вона має сумніви. Моє виправдання й справді звучить якось лайняно.",
  "sk_prologue_loc_4_p_4_el_9_text": "Мені потрібно зосередитися, щоб хоча б звучати переконливо.",
  "sk_prologue_loc_4_p_4_el_10_text": "Як я вже сказав, я пам'ятаю лише окремі фрагменти та нечіткі зображення, додати більше мені нічого. <br> І я вже назвав можливі причини. <b>Тут більше нема про що розмовляти</b >.",
  "sk_prologue_loc_4_p_4_el_11_text": "Хм, гаразд. Вірогідно, щось з цього і може бути причиною.",
  "sk_prologue_loc_4_p_4_el_12_text": "Га? Так легко? Я очікував значного супротиву.",
  "sk_prologue_loc_4_p_4_el_13_text": "Проте якщо щось нове згадаєш, будь ласка повідом мені.",
  "sk_prologue_loc_4_p_4_el_14_text": "Звичайно.",
  "sk_prologue_loc_4_p_4_el_15_text": "Думаю, вона не повністю прийняла мою напівправду, але все одно дивно. <br> Зазвичай, якщо вона чіпляється за щось, то не відпустіть навіть через кілька днів. <br> А вся ця ситуація доволі важлива для неї.",
  "sk_prologue_loc_4_p_4_el_16_text": "Чи справді я зміг так добре переконати?",
  "sk_prologue_loc_4_p_4_el_17_text": "У будь-якому разі, нехай буде як склалося. <br> Вона й так вже занадто напружена, щоб слухати ще й про дивні видіння, небезпечний артефакт і злу відьму.",
  "sk_prologue_loc_4_p_4_el_18_text": "Спробувати встати",  
  "sk_prologue_loc_4_p_5_el_1_text": "Намагаючись встати, ти похитнувся і мало не впав.",
  "sk_prologue_loc_4_p_5_el_2_text": "Меліса подивилася на тебе занепокоєно. ",
  "sk_prologue_loc_4_p_5_el_3_text": "Тобі точно нормально вже? Можеш сам йти?",
  "sk_prologue_loc_4_p_5_el_4_text": "Так, я просто відчуваю себе трохи слабшим і легшим ніж зазвичай.",
  "sk_prologue_loc_4_p_5_el_5_text": "І не те, щоб мені я раніше потребував якоїсь дієти.",
  "sk_prologue_loc_4_p_5_el_6_text": "Ну, ти прям таки обливався потом під час сну.",
  "sk_prologue_loc_4_p_5_el_7_text": "Точно не треба допомогти?",
  "sk_prologue_loc_4_p_5_el_8_text": "Ні, ні. Все норм, за хвилину оговтаюсь. <br> Не хвилюйся, можеш вже йти займатись своїми справами.",
  "sk_prologue_loc_4_p_5_el_9_text": "Від цих слів їй трохи полегшало.",
  "sk_prologue_loc_4_p_5_el_10_text": "Я просто приведу себе до ладу перед дзеркалом та спланую день.",
  "sk_prologue_loc_4_p_5_el_11_text": "Та, ти точно любиш милуватися собою перед дзеркалом.",
  "sk_prologue_loc_4_p_5_el_12_text": "То й не те, просто це допомагає мені обмірковувати різні речі.",
  "sk_prologue_loc_4_p_5_el_13_text": "Я і не проти, але тільки поки ти не почнеш приміряти мої сукні.",
  "sk_prologue_loc_4_p_5_el_14_text": "Вона зухвало посміхнулася.",
  "sk_prologue_loc_4_p_5_el_16_text": "Ну, якщо це трапиться, то, я мабуть почну шукати когось, хто міг би пірнути за моєю шпилькою в найближчий ставок.",
  "sk_prologue_loc_4_p_5_el_17_text": "Ти помічаєш, як її посмішка знову перетворюється на скорботне обличчя.",
  "sk_prologue_loc_4_p_5_el_18_text": "Ще зарано для такого.",
  "sk_prologue_loc_4_p_5_el_19_text": "Так.. зарано..",
  "sk_prologue_loc_4_p_5_el_20_text": "..хм, добре, піду-но я по справах.",
  "sk_prologue_loc_4_p_5_el_21_text": "Зрозуміло.",
  "sk_prologue_loc_4_p_5_el_22_text": "Вона підійшла до дверей, але перед тим як відчинити їх, зупинилася.",
  "sk_prologue_loc_4_p_5_el_23_text": "Ах, мало не забула. Баррет приходив учора, він хотів знайти тебе, щоб про щось поговорити.",
  "sk_prologue_loc_4_p_5_el_24_text": "Ну і ще... якщо щось нове згадаєш або просто захочеш провести час разом, просто повідом.",
  "sk_prologue_loc_4_p_5_el_25_text": "Вона вийшла з кімнати та зачинила за собою двері.",
  "sk_prologue_loc_4_p_5_el_26_text": "Підійти до дзеркала",
  "sk_prologue_sk_de_2_melissa_p_1_el_1_text": "Вислухав твою історію, вона мовчки поринула у думки на хвилинку.",
  "sk_prologue_sk_de_2_melissa_p_1_el_2_text": "Я... Я думаю, тобі треба сходити до мага...",
  "sk_prologue_sk_de_2_melissa_p_1_el_3_text": "Зробивши ще одну коротку паузу, вона продовжила вже більш впевненим тоном.",
  "sk_prologue_sk_de_2_melissa_p_1_el_4_text": "Так, це точно треба зробити! І зробити негайно! Я піду з тобою щоб упевнитися в цьому!",
  "sk_prologue_sk_de_2_melissa_p_1_el_5_text": "Може, ти трохи перебільшуєш?",
  "sk_prologue_sk_de_2_melissa_p_1_el_6_text": "Можливо, це була лише галюцинація після удару головою.",
  "sk_prologue_sk_de_2_melissa_p_1_el_7_text": "Ні, я це просто так не залишу! Я не стану покладатися на долю у цій ситуації! <br> Або ми йдемо й говоримо з ним зараз, або я розповім про це спочатку нашим батькам, і після цього ми все одно підемо до мага!",
  "sk_prologue_sk_de_2_melissa_p_1_el_8_text": "Здається, вона вже прийняла рішення, і, знаючи її, тепер її не переконаєш у зворотному.",
  "sk_prologue_sk_de_2_melissa_p_1_el_9_text": "Ти бачиш як її вираз обличчя змінюється з суворого на просто сумний.",
  "sk_prologue_sk_de_2_melissa_p_1_el_10_text": "Зрозумій, я просто дуже хвилююся за тебе.",
  "sk_prologue_sk_de_2_melissa_p_1_el_11_text": "З якоїсь невідомої причини я просто певна в тому, що це не просто галюцинація і щось погане може трапитися знову.",
  "sk_prologue_sk_de_2_melissa_p_1_el_12_text": "Тоді може ми просто зачекаємо і подивимося, що буде?",
  "sk_prologue_sk_de_2_melissa_p_1_el_13_text": "Ні! Якщо ти можеш піднятися, то ми вирушаємо прямо зараз, адже можливо тільки зараз ще є час уникнути негативних наслідків.",
  "sk_prologue_sk_de_2_melissa_p_1_el_14_text": "Ну, гадаю, я вже можу нормально рухатись.",
  "sk_prologue_sk_de_2_melissa_p_1_el_15_text": "Тоді пішли!",
  "sk_prologue_sk_de_2_melissa_p_1_el_16_text": "Піти до мага",
  "sk_prologue_sk_de_2_melissa_p_2_el_2_text": "Ви знаходите мага в його житлі.",
  "sk_prologue_sk_de_2_melissa_p_2_el_3_text": "Він відкладає книгу, яку читав, і підходить до вас.",
  "sk_prologue_sk_de_2_melissa_p_2_el_5_text": "Вітаю, що привело вас сюди сьогодні?",
  "sk_prologue_sk_de_2_melissa_p_2_el_6_text": "Ти вагаєшся перед тим як щось сказати. <br> Меліса підштовхує тебе до розмови, потягнувши за рукав.",
  "sk_prologue_sk_de_2_melissa_p_2_el_7_text": "Ну.. емм.. вчора трапилося дещо дуже дивне...",
  "sk_prologue_sk_de_2_melissa_p_2_el_8_text": "Ще одна коротка пауза.",
  "sk_prologue_sk_de_2_melissa_p_2_el_9_text": "Продовжуй далі, розкажи йому те, що розповів мені.",
  "sk_prologue_sk_de_2_melissa_p_2_el_10_text": "Вона точно не відпустить це... ",
  "sk_prologue_sk_de_2_melissa_p_2_el_11_text": "...ну і в цілому, я вже тут...",
  "sk_prologue_sk_de_2_melissa_p_2_el_12_text": "..так що краще вже не вагатись!",
  "sk_prologue_sk_de_2_melissa_p_2_el_13_text": "Ти розповідаєш про дивну і небезпечну пригоду, яка сталася недавно.",
  "sk_prologue_sk_de_2_melissa_p_2_el_15_text": "Після того як ти завершив свою розповідь, дивлячись на реакцію мага, ти помічаєш його здивування, змішане з скептицизмом.",
  "sk_prologue_sk_de_2_melissa_p_2_el_16_text": "Ти абсолютно певен, що це не були просто сни або галюцинації?",
  "sk_prologue_sk_de_2_melissa_p_2_el_17_text": "Ну, я не можу сказати з цілковитою впевненістю.",
  "sk_prologue_sk_de_2_melissa_p_2_el_18_text": "Вчора він прийшов зовсім блідий, як мертвяк, і не звертав уваги ні на що, навіть на мої крики.",
  "sk_prologue_sk_de_2_melissa_p_2_el_19_text": "Так, це доволі підозріло. Я проведу обстеження за допомогою магічного кола та заклять, щоб перевірити на наявність чогось незвичного.",
  "sk_prologue_sk_de_2_melissa_p_2_el_20_text": "Вам обом доведеться залишитися тут і тихо почекати протягом деякого часу, так що можете вибирати і почитати будь-яку книгу з полиць праворуч.",
  "sk_prologue_sk_de_2_melissa_p_2_el_21_text": "Після години підготовки.",
  "sk_prologue_sk_de_2_melissa_p_2_el_22_text": "Фух, нарешті ми готові починати. Підійди і встань ось тут, щоб ми могли почати.",
  "sk_prologue_sk_de_2_melissa_p_2_el_23_text": "Почати обстеження",
  "sk_prologue_sk_de_2_melissa_p_3_el_1_text": "Завершивши процедуру, він раптово хапає кришталевий прилад, що використовувався у процесі обстеження, і починає перевіряти щось в одній з книг на столі.",
  "sk_prologue_sk_de_2_melissa_p_3_el_2_text": "Значить це...",
  "sk_prologue_sk_de_2_melissa_p_3_el_3_text": "Він виглядає остовпілим, це не обіцяє нічого гарного.",
  "sk_prologue_sk_de_2_melissa_p_3_el_4_text": "Що ви знайшли?",
  "sk_prologue_sk_de_2_melissa_p_3_el_5_text": "Мені потрібно з ними зв'язатися... Так, мені потрібно зв'язатися з великими магами!",
  "sk_prologue_sk_de_2_melissa_p_3_el_6_text": "Здається, він розмовляє сам з собою.",
  "sk_prologue_sk_de_2_melissa_p_3_el_7_text": "Це настільки серйозно?",
  "sk_prologue_sk_de_2_melissa_p_3_el_8_text": "Я не певен... Але чи може це справді бути?",
  "sk_prologue_sk_de_2_melissa_p_3_el_9_text": "Що може бути?!",
  "sk_prologue_sk_de_2_melissa_p_3_el_10_text": "Ви голосно запитуєте, вириваючи його з думок.",
  "sk_prologue_sk_de_2_melissa_p_3_el_11_text": "Його погляд переключається на тебе, і ти помічаєш як він починає усвідомлювати вашу присутність.",
  "sk_prologue_sk_de_2_melissa_p_3_el_12_text": "Ах, так, вибачте.",
  "sk_prologue_sk_de_2_melissa_p_3_el_13_text": "Наразі це не є чимось небезпечним для тебе, але все одне потрібен огляд від великих магів.",
  "sk_prologue_sk_de_2_melissa_p_3_el_14_text": "Що стосується того, що це, то я не можу сказати з цілковитою впевненістю. Це може бути тим, що колись згадував мій майстер, але поки це лише припущення.",
  "sk_prologue_sk_de_2_melissa_p_3_el_15_text": "Тоді що нам зараз робити?",
  "sk_prologue_sk_de_2_melissa_p_3_el_16_text": "Ось, носи поки цей амулет. Я використаю один зі свої чарівних інструментів, щоб викликати високопоставлених осіб і вони могли прибути якомога швидше.",
  "sk_prologue_sk_de_2_melissa_p_3_el_17_text": "Чи можете ви хоча б щось сказати детальніше?",
  "sk_prologue_sk_de_2_melissa_p_3_el_18_text": "Як я вже зазначав, наразі я не можу сказати з упевненістю. Але дуже добре, що ви прийшли вчасно, по одній з моїх теорій, потенційно це може стати небезпечним у майбутньому.",
  "sk_prologue_sk_de_2_melissa_p_3_el_19_text": "Але наразі вам не потрібно хвилюватися, просто побудьте вдома кілька днів і амулет знімати поки теж не варто.",
  "sk_prologue_sk_de_2_melissa_p_3_el_20_text": "Я зв'яжуся з досвідченими магами, і вони нададуть пояснення та визначать, чи все таки є якісь потенційні проблеми і як їх вирішити.",
  "sk_prologue_sk_de_2_melissa_p_3_el_21_text": "Доволі підозріло, що він зовсім не хотів поділитися інформацією.",
  "sk_prologue_sk_de_2_melissa_p_3_el_22_text": "Але, мабуть, зараз вже й нічого не зробиш, залишається лише чекати.",
  "sk_prologue_sk_de_2_melissa_p_3_el_23_text": "Чекати кілька днів",  
  "sk_prologue_sk_de_2_final_p_1_el_1_text": "Кілька останніх днів ти з тривогою чекав будь-яких новин. <br> На прохання чарівника ти утримувався від розповіді батькам про це",
  "sk_prologue_sk_de_2_final_p_1_el_2_text": "Але живучи разом з сестрою, ти не зміг приховати свою незвичну поведінку і амулет чарівника від неї. <br> Ти коротко описав їй свої попередню та майбутню перевірки.", // if not 'dead end 2 - Melissa'  
  "sk_prologue_sk_de_2_final_p_1_el_3_text": "...",
  "sk_prologue_sk_de_2_final_p_1_el_4_text": "І ось одного дня, десь вранці, ти чуєш стукіт у двері.",
  "sk_prologue_sk_de_2_final_p_1_el_5_text": "Цей час настав. Вони прибули. Одягайся і слідуй за мною.",
  "sk_prologue_sk_de_2_final_p_1_el_6_text": "Твоя сестра була поруч в цей час, вона почула слова чарівника і вирішила приєднатися до вас.",
  "sk_prologue_sk_de_2_final_p_1_el_7_text": "Після того, як ви обидва одяглися, ви зустрілися з чарівником біля дверей і вирушили на довгоочікуваний огляд.",
  "sk_prologue_sk_de_2_final_p_1_el_8_text": "Побачивши, що твоя сестра теж йде, на його обличчі з'явилось неприкрите незадоволення, але при цьому він нічого не сказав.", // if not 'dead end 2 - Melissa' 
  "sk_prologue_sk_de_2_final_p_1_el_9_text": "...",
  "sk_prologue_sk_de_2_final_p_1_el_10_text": "Підходячи до центру села, ви помічаєте кількох чарівників, кількох темпларів і приблизно дюжину охоронців.",
  "sk_prologue_sk_de_2_final_p_1_el_11_text": "Я думав, що на мій огляд прийде лише кілька чарівників, але тепер я починаю серйозно нервувати.",
  "sk_prologue_sk_de_2_final_p_1_el_12_text": "Чому стільки охоронців?",
  "sk_prologue_sk_de_2_final_p_1_el_13_text": "Схоже, що великі чарівники дуже ретельно дотримуються правил і дуже серйозно поставилися до цієї справи.",
  "sk_prologue_sk_de_2_final_p_1_el_14_text": "Ти відчув невпевненість в його голосі.",
  "sk_prologue_sk_de_2_final_p_1_el_15_text": "Помітивши тебе з чарівником, високий чоловік у дорогому одязі, схожому на одяг чарівника, попрямував у ваш бік.",
  // "sk_prologue_sk_de_2_final_p_1_el_16_text": "", // image
  "sk_prologue_sk_de_2_final_p_1_el_17_text": "Вітаю. Я - Йован Асталріб, великий чарівник. А ти, мабуть, хлопчик, якого мені доручено доставити.",
  "sk_prologue_sk_de_2_final_p_1_el_18_text": "Доставити? Хвилинку, мені потрібно кудись їхати?",
  "sk_prologue_sk_de_2_final_p_1_el_19_text": "Так, тобі потрібно піти з нами, для того щоб наші великі чарівники могли детально перевірити твою ситуацію.",
  "sk_prologue_sk_de_2_final_p_1_el_20_text": "Ти навіть не уявляєш, наскільки дорого, проблематично та часомістко доставити все можливо необхідне обладнання сюди для твоєї перевірки.",
  "sk_prologue_sk_de_2_final_p_1_el_21_text": "Ось і виходить, що набагато легше тебе привезти туди, де це вже є.",
  "sk_prologue_sk_de_2_final_p_1_el_22_text": "Ні! Ніхто навіть і слова не казав про те, що його можуть забрати!",
  "sk_prologue_sk_de_2_final_p_1_el_23_text": "Ти бачиш, як сестра починає кричати на збентеженого чарівника, тоді як він не може сказати нічого виразного у відповідь.",
  "sk_prologue_sk_de_2_final_p_1_el_24_text": "Куди ви хочете забрати мою дитину?",
  "sk_prologue_sk_de_2_final_p_1_el_25_text": "Озирнутись",
  "sk_prologue_sk_de_2_final_p_2_el_1_text": "Ти помічаєш, що батьки також прийшли до центру і, ймовірно, почули останню фразу сестри.",
  "sk_prologue_sk_de_2_final_p_2_el_2_text": "Ах, так ви ще не знаєте. Тоді, мабуть, ви можете запитати вашого старійшину про пояснення.",
  "sk_prologue_sk_de_2_final_p_2_el_3_text": "Мені наказано завершити своє завдання якомога швидше, тому ми вирушаємо негайно.",
  "sk_prologue_sk_de_2_final_p_2_el_4_text": "Ви хочете просто забрати мого брата в якісь невідомі краї через таке невиразне виправдання?! ",
  "sk_prologue_sk_de_2_final_p_2_el_5_text": "Ти чуєш, як люди навколо почали голосно обговорювати поточну ситуацію.",
  "sk_prologue_sk_de_2_final_p_2_el_6_text": "Який головний біль. Добре, тоді зробимо так. <br> Слухайте всі! Заспокойтесь будь ласка! Є вірогідність що цей хлопець отримав прокляття, тому я повинен доставити його до столиці, оглянути і вилікувати, якщо треба!",
  "sk_prologue_sk_de_2_final_p_2_el_7_text": "Якось не звучить переконливо, адже я вже чув щось схоже від тої відьми. ",
  "sk_prologue_sk_de_2_final_p_2_el_8_text": "Хлопець ще не був належне оглянутий. Тому я не можу виключити можливість, що його стан може бути небезпечним не лише для нього самого, але і для людей навколо нього!  ",
  "sk_prologue_sk_de_2_final_p_2_el_9_text": "Дідько, я дійсно не подумав про це. ", // if not 'dead end 2 - Barret' 
  "sk_prologue_sk_de_2_final_p_2_el_10_text": "Гм, Баррет теж про це казав. ", // if 'dead end 2 - Barret' 
  "sk_prologue_sk_de_2_final_p_2_el_11_text": "Усі детальні пояснення я залишив вашому старійшині!",
  "sk_prologue_sk_de_2_final_p_2_el_12_text": "Всі очі перенеслись на старійшину поселення, який зараз вів важку розмову з вашим батьком і чарівником. ",
  "sk_prologue_sk_de_2_final_p_2_el_13_text": "Як бачите зараз немає часу для довгих дискусій! Він буде доставлений до великих чарівників і його будуть охороняти підготовлений супровід.",
  "sk_prologue_sk_de_2_final_p_2_el_14_text": "Ти помічаєш, що Баррет і Алура також вже приєдналися до цієї метушні в центрі селища і зараз стоять там, дивлячись на тебе з шокованими та трохи переляканими поглядами.",
  "sk_prologue_sk_de_2_final_p_2_el_15_text": "І якщо це зможе вас заспокоїти, я, як великий чарівник королівства Алдерія, можу пообіцяти доставити його до пункту призначення цілим та неушкодженим!",
  "sk_prologue_sk_de_2_final_p_2_el_16_text": "Гм, тепер хтось може подумати, що й сама поїздка може бути небезпечною.",
  "sk_prologue_sk_de_2_final_p_2_el_17_text": "Може хтось поїде разом з ним?",
  "sk_prologue_sk_de_2_final_p_2_el_18_text": "Почувши ці слова, Баррет почав рух у твою сторону, але різка відповідь зупинила його.",
  "sk_prologue_sk_de_2_final_p_2_el_19_text": "Ні! Ми не знаємо, скільки це може зайняти часу, і, безумовно, нам не потрібний додатковий тягар, який буде зважати і ставити під загрозу наше завдання.",
  "sk_prologue_sk_de_2_final_p_2_el_20_text": "Але тоді чи зможемо ми зв'язатися з ним хоча б?",
  "sk_prologue_sk_de_2_final_p_2_el_21_text": "Я вам не рекомендую цього робити.",
  "sk_prologue_sk_de_2_final_p_2_el_22_text": "Подивившись на обличчя людей навколо і побачивши, що їх обличчя повні нерозуміння, здивування та незадоволення, він вирішує трохи заспокоїти натовп.",
  "sk_prologue_sk_de_2_final_p_2_el_23_text": "Ех, добре, я попрошу великих чарівників дозволити йому писати та отримувати листи.",
  "sk_prologue_sk_de_2_final_p_2_el_24_text": "Попросіть вашого купця або перевізника відправляти та отримувати листи у поштовому відділенні найближчого міста. Я залишу адресу для контакту вашому старійшині.",
  "sk_prologue_sk_de_2_final_p_2_el_25_text": "Ти почуваєш себе розгубленим через всю цю несподівану ситуацію.",
  "sk_prologue_sk_de_2_final_p_2_el_26_text": "Поточні обставини, які склалися на цю хвилину, здаються занадто стрімкими і нереальними. <br> Що мені взагалі відповісти на це чи що запитати?",
  "sk_prologue_sk_de_2_final_p_2_el_27_text": "Порушуючи твою спробу зібрати свої думки докупи, великий чарівник підходить ближче і шепоче.",
  "sk_prologue_sk_de_2_final_p_2_el_28_text": "Вибач, хлопче, в тебе тут немає вибору. Ми повинні рушати.",
  "sk_prologue_sk_de_2_final_p_2_el_29_text": "На цих словах він хапає тебе за руку і веде до карети.",
  "sk_prologue_sk_de_2_final_p_2_el_30_text": "Крик Меліси, який пролунав як \"вибач\", - останнє, що ти чуєш перед тим, як...",
  "sk_prologue_sk_de_2_final_p_2_el_31_text": "Крик Баррета, який пролунав як \"вибач\", - останнє, що ти чуєш перед тим, як...",
  "sk_prologue_sk_de_2_final_p_2_el_32_text": "Крик Алури, який пролунав як \"вибач\", - останнє, що ти чуєш перед тим, як...",
  "sk_prologue_sk_de_2_final_p_2_el_33_text": "...сісти до карети",
  "sk_prologue_sk_de_2_final_p_3_el_1_text": "Ви в дорозі вже майже півдня.",
  "sk_prologue_sk_de_2_final_p_3_el_2_text": "Незважаючи на безліч питань від тебе, великий чарівник ухилився від чіткої відповіді на них, обіцяючи, що великі чарівники нададуть всі необхідні пояснення.",
  "sk_prologue_sk_de_2_final_p_3_el_3_text": "Ех, ще вчора я лежав у своєму ліжку, а зараз я на шляху кудись в невідоме.",
  "sk_prologue_sk_de_2_final_p_3_el_4_text": "Що чекає на мене в майбутньому?",
  "sk_prologue_sk_de_2_final_p_3_el_5_text": "Несподівані крики пронизують повітря, і ваша карета зупиняється.",
  "sk_prologue_sk_de_2_final_p_3_el_6_text": "Що відбувається...",
  "sk_prologue_sk_de_2_final_p_3_el_7_text": "Оглушливий звук і ударна хвиля від вибуху зупиняють твоє питання.",
  "sk_prologue_sk_de_2_final_p_3_el_8_text": "Чорти б його, нас атакують! <br> Що треба...",
  "sk_prologue_sk_de_2_final_p_3_el_9_text": "В наступну мить карета перегортається від ще одного вибуху.",
  "sk_prologue_sk_de_2_final_p_3_el_10_text": "...",
  "sk_prologue_sk_de_2_final_p_3_el_11_text": "Пройшла невідома кількість часу...",
  "sk_prologue_sk_de_2_final_p_3_el_12_text": "Після того, як ти оговтався від шоку і оглянувся, ти бачиш, що зараз ти один у перевернутій кареті. <br> Ти починаєш шукати зручне положення, щоб підвестися.",
  "sk_prologue_sk_de_2_final_p_3_el_13_text": "Як довго я був непритомний? <br> Ну що ж, зараз це певно не має значення.",
  "sk_prologue_sk_de_2_final_p_3_el_14_text": "То мені залишитись поки тут чи..",
  "sk_prologue_sk_de_2_final_p_3_el_15_text": "Двері карети відкриваються, перериваючи планування наступних кроків.",
  "sk_prologue_sk_de_2_final_p_3_el_16_text": "Піднявши голову у напрямку щойно відкритої двері, ти бачиш обличчя тої самої відьми.",
  "sk_prologue_sk_de_2_final_p_3_el_18_text": "Вона виглядає дуже блідою та виснаженою. ЇЇ обличчя в крові, але ти розпізнаєш сум та журбу.",
  "sk_prologue_sk_de_2_final_p_3_el_19_text": "Якщо справи прийняли такий напрямок, то краще я завершу все це нехай хоч так, поки я ще спроможна.",
  "sk_prologue_sk_de_2_final_p_3_el_20_text": "В наступну мить ти бачиш осліплююче яскраве світло.",
  "sk_prologue_sk_de_2_final_p_3_el_21_text": "...",
  "sk_prologue_sk_de_2_final_p_3_el_22_text": "...",
  "sk_prologue_sk_de_2_barret_p_1_el_1_text": "Вислухавши твою історію, він мовчить протягом деякого часу.",
  "sk_prologue_sk_de_2_barret_p_1_el_2_text": "Чи це не жарт раптом?",
  "sk_prologue_sk_de_2_barret_p_1_el_3_text": "Ні, ніяких жартів. Знаєш було не легко це розповісти.",
  "sk_prologue_sk_de_2_barret_p_1_el_4_text": "Дідько, я відчував, що з тобою щось не так, але це просто божевілля.",
  "sk_prologue_sk_de_2_barret_p_1_el_5_text": "Так, частково я все ще думаю, що то був сон.",
  "sk_prologue_sk_de_2_barret_p_1_el_6_text": "Якщо та відьма все ще десь навколо, це може бути небезпечно для всього села, а не тільки для тебе.",
  "sk_prologue_sk_de_2_barret_p_1_el_7_text": "Нам потрібно повідомити старійшину села, і можливо чарівника теж.",
  "sk_prologue_sk_de_2_barret_p_1_el_8_text": "Ти впевнений, що це необхідно? Чи не можемо ми спробувати вирішити це без них?",
  "sk_prologue_sk_de_2_barret_p_1_el_9_text": "Якщо справи дійсно такі як ти сказав, то нам однозначно потрібно попросити по допомогу.",
  "sk_prologue_sk_de_2_barret_p_1_el_10_text": "Егхх, ну-у добре.",
  "sk_prologue_sk_de_2_barret_p_1_el_11_text": "Гей, зараз байдикувати точно не на часі, це серйозно!",
  "sk_prologue_sk_de_2_barret_p_1_el_12_text": "Хм.. спочатку давай зайдемо до чарівника і визначимо, як ці події вплинули на тебе.",
  "sk_prologue_sk_de_2_barret_p_1_el_13_text": "І взагалі, ти мав зробити це як тільки прокинувся.",
  "sk_prologue_sk_de_2_barret_p_1_el_14_text": "А ти натомість пішов запитувати, чи ти змінився якось чи ні.", // якщо "змінився чи ні" Barret complete
  "sk_prologue_sk_de_2_barret_p_1_el_15_text": "Ти мовчиш, не впевнений, що сказати, щоб не почати сварку.",
  "sk_prologue_sk_de_2_barret_p_1_el_16_text": "Часу вже втрачено багато. Ну ж бо, йдемо!", 
  "sk_prologue_sk_de_2_barret_p_1_el_17_text": "Піти до мага",
  "sk_prologue_sk_de_2_barret_p_2_el_2_text": "Ви знаходите мага в його житлі.",
  "sk_prologue_sk_de_2_barret_p_2_el_3_text": "Він відкладає записник, у якому він щось записував, і підходить до вас.",
  "sk_prologue_sk_de_2_barret_p_2_el_5_text": "Вітаю, що привело вас сюди сьогодні?",
  "sk_prologue_sk_de_2_barret_p_2_el_6_text": "Ти вагаєшся сказати щось протягом кількох секунд. <br> Баррет змушує тебе почати говорити, штовхаючи вперед.",
  "sk_prologue_sk_de_2_barret_p_2_el_7_text": "Ну.. ем.. нещодавно трапилося щось дуже дивне...",
  "sk_prologue_sk_de_2_barret_p_2_el_8_text": "Ще одна коротка пауза.",
  "sk_prologue_sk_de_2_barret_p_2_el_9_text": "Давай, просто продовжуй і розкажи йому.",
  "sk_prologue_sk_de_2_barret_p_2_el_10_text": "Ну, здається, назад уже дороги немає.",
  "sk_prologue_sk_de_2_barret_p_2_el_11_text": "Ти розповідаєш про дивну і небезпечну пригоду, що трапилася з тобою.",  
  "sk_prologue_sk_de_2_barret_p_2_el_12_text": "...",
  "sk_prologue_sk_de_2_barret_p_2_el_13_text": "Після того як ти завершив свою розповідь, дивлячись на реакцію мага, ти помічаєш його здивування, змішане з скептицизмом.",
  "sk_prologue_sk_de_2_barret_p_2_el_14_text": "Ти абсолютно певен, що це не були просто сни або галюцинації?",
  "sk_prologue_sk_de_2_barret_p_2_el_15_text": "Ну, я відчував це як реальне, це точно можу сказати.",
  "sk_prologue_sk_de_2_barret_p_2_el_16_text": "Я не можу довести це якось зараз, але я абсолютно впевнений, що це не щось, що він просто вигадав.",
  "sk_prologue_sk_de_2_barret_p_2_el_17_text": "Так, це доволі підозріло. Я проведу обстеження за допомогою магічного кола та заклять, щоб перевірити на наявність чогось незвичного.",
  "sk_prologue_sk_de_2_barret_p_2_el_18_text": "Вам обом доведеться залишитися тут і тихо почекати протягом деякого часу, так що можете вибирати і почитати будь-яку книгу з полиць праворуч.",
  "sk_prologue_sk_de_2_barret_p_2_el_19_text": "Чи можу я чимось допомогти?",
  "sk_prologue_sk_de_2_barret_p_2_el_20_text": "Хм... ти можеш, так. Але щодо нього, він повинен утриматися від торкання будь-чого тут до обстеження.",
  "sk_prologue_sk_de_2_barret_p_2_el_21_text": "Добре.",
  "sk_prologue_sk_de_2_barret_p_2_el_22_text": "Після приблизно півгодини підготовки.",
  "sk_prologue_sk_de_2_barret_p_2_el_23_text": "Фух, нарешті ми готові починати. Підійди і встань ось тут, щоб ми могли почати.",
  "sk_prologue_sk_de_2_barret_p_2_el_24_text": "Почати обстеження",
  "sk_prologue_sk_de_2_barret_p_3_el_1_text": "Завершивши процедуру, він раптово хапає кришталевий прилад, що використовувався у процесі обстеження, і починає перевіряти щось в одній з книг на столі.",
  "sk_prologue_sk_de_2_barret_p_3_el_2_text": "Значить це...",
  "sk_prologue_sk_de_2_barret_p_3_el_3_text": "Він виглядає остовпілим, це не обіцяє нічого гарного.",
  "sk_prologue_sk_de_2_barret_p_3_el_4_text": "Що ви знайшли?",
  "sk_prologue_sk_de_2_barret_p_3_el_5_text": "Мені потрібно з ними зв'язатися... Так, мені потрібно зв'язатися з великими магами!",
  "sk_prologue_sk_de_2_barret_p_3_el_6_text": "Здається, він розмовляє сам з собою.",
  "sk_prologue_sk_de_2_barret_p_3_el_7_text": "Це небезпечно для нього? Це небезпечно для поселення?", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_8_text": "Я не певен... Але чи може це справді бути?",
  "sk_prologue_sk_de_2_barret_p_3_el_9_text": "Так що ви знайшли?!",
  "sk_prologue_sk_de_2_barret_p_3_el_10_text": "Ви голосно запитуєте, вириваючи його з думок.",
  "sk_prologue_sk_de_2_barret_p_3_el_11_text": "Його погляд переключається на тебе, і ти помічаєш як він починає усвідомлювати вашу присутність.",
  "sk_prologue_sk_de_2_barret_p_3_el_12_text": "Ах, так, вибачте.",
  "sk_prologue_sk_de_2_barret_p_3_el_13_text": "Наразі це не є чимось небезпечним для тебе, але все одне потрібен огляд від великих магів.",
  "sk_prologue_sk_de_2_barret_p_3_el_14_text": "Що стосується того, що це, то я не можу сказати з цілковитою впевненістю. Це може бути тим, що колись згадував мій майстер, але поки це лише припущення.",
  "sk_prologue_sk_de_2_barret_p_3_el_15_text": "Тоді що нам робити зараз?",
  "sk_prologue_sk_de_2_barret_p_3_el_16_text": "Ось, носи поки цей амулет. Я використаю один з свої чарівних інструментів, щоб викликати високопоставлених осіб і вони могли прибути якомога швидше.",
  "sk_prologue_sk_de_2_barret_p_3_el_17_text": "Але ви можете пояснити нам детальніше, щоб ми могли повідомити старійшину?", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_18_text": "Як я вже зазначав, наразі я не можу сказати з упевненістю. Але дуже добре, що ви прийшли вчасно, по одній з моїх теорій, потенційно це може стати небезпечним у майбутньому.",
  "sk_prologue_sk_de_2_barret_p_3_el_19_text": "Але наразі вам не потрібно хвилюватися, просто побудьте вдома кілька днів і амулет знімати поки теж не варто.",
  "sk_prologue_sk_de_2_barret_p_3_el_20_text": "Я зв'яжуся з досвідченими магами, і вони нададуть пояснення та визначать, чи все таки є якісь потенційні проблеми і як їх вирішити.",
  "sk_prologue_sk_de_2_barret_p_3_el_21_text": "І я повідомлю старійшені особисто, тому за це не хвилюйтесь.", // if 'Barret matters' quest started
  "sk_prologue_sk_de_2_barret_p_3_el_22_text": "Доволі підозріло, що він зовсім не хотів поділитися інформацією.",
  "sk_prologue_sk_de_2_barret_p_3_el_23_text": "Але, мабуть, зараз вже й нічого не зробиш, залишається лише чекати.",
  "sk_prologue_sk_de_2_barret_p_3_el_24_text": "Чекати кілька днів",
  "sk_prologue_sk_de_2_alura_p_1_el_1_text": "Вислухавши твою історію, вона виглядає наляканою.",
  "sk_prologue_sk_de_2_alura_p_1_el_2_text": "Сподіваюся, це просто поганий жарт. Це ж жарт, чи не так?",
  "sk_prologue_sk_de_2_alura_p_1_el_3_text": "На жаль - ні.",
  "sk_prologue_sk_de_2_alura_p_1_el_4_text": "Почувши це, вона підходить ближче до тебе і обіймає тебе міцно.",
  "sk_prologue_sk_de_2_alura_p_1_el_6_text": "На мить ти відчув здивування та розгубленість.",
  "sk_prologue_sk_de_2_alura_p_1_el_7_text": "Це певно було дуже страшно, ти так багато пережив.",
  "sk_prologue_sk_de_2_alura_p_1_el_8_text": "Обіймаючи тебе, вона почала обережно погладжувати тебе по спині.",
  "sk_prologue_sk_de_2_alura_p_1_el_9_text": "Я...",
  "sk_prologue_sk_de_2_alura_p_1_el_10_text": "Від неочікуваної підтримки, яку ти отримав, ти раптово починаєш відчувати себе беззахисним і в горлі з'являється ком.",
  "sk_prologue_sk_de_2_alura_p_1_el_11_text": "Щоб відновити самовладання і продовжити розмову, ти повільно розриваєш обійми.",
  "sk_prologue_sk_de_2_alura_p_1_el_12_text": "Мені здається, що все вже в порядку. Я цілий та наче неушкоджений, тому не хвилюйся.",
  "sk_prologue_sk_de_2_alura_p_1_el_13_text": "Побачивши її вираз обличчя, я розумію, що вона не повністю вірить цим словам.",
  "sk_prologue_sk_de_2_alura_p_1_el_14_text": "Ні, все не в порядку! Нам потрібно звернутися за допомогою.",
  "sk_prologue_sk_de_2_alura_p_1_el_15_text": "Я не впевнений, що це необхідно нар...",
  "sk_prologue_sk_de_2_alura_p_1_el_16_text": "Це дійсно необхідно!",
  "sk_prologue_sk_de_2_alura_p_1_el_17_text": "Тобі потрібно пройти повноцінне обстеження.", 
  "sk_prologue_sk_de_2_alura_p_1_el_18_text": "А не просто питати мене, як ти змінився після всього того.", // if 'had I changed' Alura complete
  "sk_prologue_sk_de_2_alura_p_1_el_19_text": "Оскільки ти зазначив, що там була магія, давай спочатку сходимо до чарівника і дізнаємося, що він скаже.",
  "sk_prologue_sk_de_2_alura_p_1_el_20_text": "Я вважаю, що ми не повинні поспі...",
  "sk_prologue_sk_de_2_alura_p_1_el_21_text": "Ні, зараз не час для суперечок! Я не дозволю, щоб ти постраждав через мою бездіяльність ще раз.",
  "sk_prologue_sk_de_2_alura_p_1_el_22_text": "А, тепер я зрозумів, чому вона так реагує.",
  "sk_prologue_sk_de_2_alura_p_1_el_23_text": "Якщо ти знову...",
  "sk_prologue_sk_de_2_alura_p_1_el_24_text": "Ми можемо обсудити все що завгодно, але вже під час подорожі до мага.",
  "sk_prologue_sk_de_2_alura_p_1_el_25_text": "Вона з силою схоплює твою руку і ви обидва направляєтеся...",
  "sk_prologue_sk_de_2_alura_p_1_el_26_text": "..до чарівника",
  "sk_prologue_sk_de_2_alura_p_2_el_2_text": "Ви знаходите мага в його житлі.",
  "sk_prologue_sk_de_2_alura_p_2_el_3_text": "Він прибирає голубе намисто, на яке раніше уважно дивився, і підходить до вас.",
  "sk_prologue_sk_de_2_alura_p_2_el_5_text": "Вітаю, що привело вас сюди сьогодні?",
  "sk_prologue_sk_de_2_alura_p_2_el_6_text": "Ти вагаєшся сказати щось протягом кількох секунд. <br> Алура підбадьорює тебе до розмови кілька раз прокашлявшись.",
  "sk_prologue_sk_de_2_alura_p_2_el_7_text": "Ну.. ем.. нещодавно трапилося щось дуже дивне...",
  "sk_prologue_sk_de_2_alura_p_2_el_8_text": "Ще одна коротка пауза.",
  "sk_prologue_sk_de_2_alura_p_2_el_9_text": "Не хвилюйся, просто продовжуй, поясни йому, чому ми тут.",
  "sk_prologue_sk_de_2_alura_p_2_el_10_text": "Ну, здається, назад вже дороги немає.",
  "sk_prologue_sk_de_2_alura_p_2_el_11_text": "Ти розповідаєш про дивну і небезпечну пригоду, що трапилася з тобою.",  
  "sk_prologue_sk_de_2_alura_p_2_el_12_text": "...",
  "sk_prologue_sk_de_2_alura_p_2_el_13_text": "Після того як ти завершив свою розповідь, дивлячись на реакцію мага, ти помічаєш його здивування, змішане з скептицизмом.",
  "sk_prologue_sk_de_2_alura_p_2_el_14_text": "Ти абсолютно певен, що це не були просто сни або галюцинації?",
  "sk_prologue_sk_de_2_alura_p_2_el_15_text": "Ну, я не можу точно сказати, але це виглядало занадто реально, щоб бути просто сном.",
  "sk_prologue_sk_de_2_alura_p_2_el_16_text": "І навіть якщо не все з цього сталося насправді, щось точно вплинуло на нього.",
  "sk_prologue_sk_de_2_alura_p_2_el_17_text": "Так що краще бути обережними і провести обстеження.",
  "sk_prologue_sk_de_2_alura_p_2_el_18_text": "Так, це доволі підозріло. Я проведу обстеження за допомогою магічного кола та заклять, щоб перевірити на наявність чогось незвичного.",
  "sk_prologue_sk_de_2_alura_p_2_el_19_text": "Вам обом доведеться залишитися тут і тихо почекати протягом деякого часу, так що можете вибирати і почитати будь-яку книгу з полиць праворуч.",
  "sk_prologue_sk_de_2_alura_p_2_el_20_text": "Добре, ми почекаємо.",
  "sk_prologue_sk_de_2_alura_p_2_el_21_text": "Після години підготовки.",
  "sk_prologue_sk_de_2_alura_p_2_el_22_text": "Фух, нарешті ми готові починати. Підійди і встань ось тут, щоб ми могли почати.",
  "sk_prologue_sk_de_2_alura_p_2_el_23_text": "Почати обстеження",
  "sk_prologue_sk_de_2_alura_p_3_el_1_text": "Завершивши процедуру, він раптово хапає кришталевий прилад, що використовувався у процесі обстеження, і починає перевіряти щось в одній з книг на столі.",
  "sk_prologue_sk_de_2_alura_p_3_el_2_text": "Значить це...",
  "sk_prologue_sk_de_2_alura_p_3_el_3_text": "Він виглядає остовпілим, це не обіцяє нічого гарного.",
  "sk_prologue_sk_de_2_alura_p_3_el_4_text": "Що ви знайшли?",
  "sk_prologue_sk_de_2_alura_p_3_el_5_text": "Мені потрібно з ними зв'язатися... Так, мені потрібно зв'язатися з великими магами!",
  "sk_prologue_sk_de_2_alura_p_3_el_6_text": "Здається, він розмовляє сам з собою.",
  "sk_prologue_sk_de_2_alura_p_3_el_7_text": "Наскільки все погано?", 
  "sk_prologue_sk_de_2_alura_p_3_el_8_text": "Я не певен... Але чи може це справді бути?",
  "sk_prologue_sk_de_2_alura_p_3_el_9_text": "Так що ви знайшли?!",
  "sk_prologue_sk_de_2_alura_p_3_el_10_text": "Ви голосно запитуєте, вириваючи його з думок.",
  "sk_prologue_sk_de_2_alura_p_3_el_11_text": "Його погляд переключається на тебе, і ти помічаєш як він починає усвідомлювати вашу присутність.",
  "sk_prologue_sk_de_2_alura_p_3_el_12_text": "Ах, так, вибачте.",
  "sk_prologue_sk_de_2_alura_p_3_el_13_text": "Наразі це не є чимось небезпечним для тебе, але все одне потрібен огляд від великих магів.",
  "sk_prologue_sk_de_2_alura_p_3_el_14_text": "Що стосується того, що це, то я не можу сказати з цілковитою впевненістю. Це може бути тим, що колись згадував мій майстер, але поки це лише припущення.",
  "sk_prologue_sk_de_2_alura_p_3_el_15_text": "Тоді що нам робити зараз?",
  "sk_prologue_sk_de_2_alura_p_3_el_16_text": "Ось, носи поки цей амулет. Я використаю один з свої чарівних інструментів, щоб викликати високопоставлених осіб і вони могли прибути якомога швидше.",
  "sk_prologue_sk_de_2_alura_p_3_el_17_text": "Чи можете ви розповісти нам більше про це? Можливо нам потрібно розпочати яке-небудь лікування?",
  "sk_prologue_sk_de_2_alura_p_3_el_18_text": "Як я вже зазначав, наразі я не можу сказати з упевненістю. Але дуже добре, що ви прийшли вчасно, по одній з моїх теорій, потенційно це може стати небезпечним у майбутньому.",
  "sk_prologue_sk_de_2_alura_p_3_el_19_text": "Але наразі вам не потрібно хвилюватися, просто побудьте вдома кілька днів і амулет знімати поки теж не варто.",
  "sk_prologue_sk_de_2_alura_p_3_el_20_text": "Я зв'яжуся з досвідченими магами, і вони нададуть пояснення та визначать, чи все таки є якісь потенційні проблеми і як їх вирішити.",
  "sk_prologue_sk_de_2_alura_p_3_el_21_text": "Щодо лікування, зараз це не потрібно. Було б лише добре не перенапружуватися тобі кілька днів, а так поки ніяких порад.",
  "sk_prologue_sk_de_2_alura_p_3_el_22_text": "Доволі підозріло, що він зовсім не хотів поділитися інформацією.",
  "sk_prologue_sk_de_2_alura_p_3_el_23_text": "Але, мабуть, зараз вже й нічого не зробиш, залишається лише чекати.",
  "sk_prologue_sk_de_2_alura_p_3_el_24_text": "Чекати кілька днів",
  "task_prologue_talk_brooch_name": "Розмова про брошку",
  "task_prologue_talk_brooch_description": "Поговорити з Мелісою та віддати їй брошку",
  "task_prologue_talk_brooch_link_title": "Поговорити про брошку", 
  "task_prologue_talk_my_changes_melissa": "Зміни в мені. Думка Меліси.",
  "task_prologue_talk_my_changes_melissa_description": "Мені потрібно поговорити з Мелісою та дізнатися, чи помітила вона зміни в мені.",
  "task_prologue_talk_my_changes_melissa_link_title": "Запитати про зміни в мені", 
  "task_prologue_talk_my_changes_barret": "Зміни в мені. Думка Баррета.",
  "task_prologue_talk_my_changes_barret_description": "Мені потрібно поговорити з Барретом та дізнатися, чи помітив він зміни в мені.",
  "task_prologue_talk_my_changes_barret_link_title": "Запитати про зміни в мені", 
  "task_prologue_talk_my_changes_alura": "Зміни в мені. Думка Алури.",
  "task_prologue_talk_my_changes_alura_description": "Мені потрібно поговорити з Алурою та дізнатися, чи помітила вона зміни в мені.",
  "task_prologue_talk_my_changes_alura_link_title": "Запитати про зміни в мені", 
  "task_prologue_talk_my_changes_final": "Зміни в мені. Обдумати реакції.",
  "task_prologue_talk_my_changes_final_description": "Мені потрібно обдумати зміни в мені з новою інформацією, яку я отримав.",
  "task_prologue_talk_my_changes_final_link_title": "Обдумати зміни в мені.", 
  "quests_q_return_brooch_name": "Про брошку...",
  "quests_q_return_brooch_description": "Повернути ",
  "quests_q_return_brooch_start_text": "Про брошку",
  "task_prologue_talk_barret_name": "Розмова з Барретом",
  "task_prologue_talk_barret_description": "Поговорити з Барретом",
  "task_prologue_talk_barret_link_title": "Запитати, чому він шукав тебе",
  "quests_q_barrets_matters_name": "Про Баррета...",
  "quests_q_barrets_matters_description": "Поговорити з Барретом про те що він хотів, коли ти був відсутній.",
  "quests_q_barrets_matters_start_text": "Про Баррета...",
  "quests_q_swim_melissa_name": "Плавання з Мелісою",
  "quests_q_swim_melissa_description": "Навчити Мелісу плавати",
  "quests_q_swim_melissa_start_text": "Плавання з Мелісою...",
  "quests_q_had_i_changed_name": "Чи змінився я?",
  "quests_q_had_i_changed_description": "Оглянути себе, щоб побачити зміни.",
  "quests_q_had_i_changed_start_text": "Чи змінився я?",
  "task_swim_melissa_talk_1_name": "Поговорити з Мелісою",
  "task_swim_melissa_talk_1_description": "Поговорити з Мелісою про плавання",
  "task_swim_melissa_talk_1_link_title": "Поговорити про навчання її плаванню",
  "sk_sketch_personal_melissa_p_1_el_2_text": "Навчити її плавати",
  "sk_sketch_personal_mc_p_1_el_1_text": "Вихід за межі поселення",
  "sk_sketch_personal_mc_p_1_el_2_text": "Зберігати мовчання",
  "sk_sketch_personal_mc_p_1_el_3_text": "Сила мого наказу",
  "sk_sketch_personal_mc_p_1_el_4_text": "Про ту брошку...",
  "sk_sketch_personal_mc_p_1_el_5_text": "Про Баррета...",
  "sk_sketch_personal_mc_p_1_el_6_text": "Чи змінився я?",
  "sk_sketch_personal_mc_locations_limit_p_1_el_1_text": "Враховуючи недавні події, я мабуть утримаюся від виходу за межі села наразі.",
  "sk_sketch_personal_mc_locations_limit_p_1_el_2_text": "Краще почекати і подивитися, чи будуть жителі розмовляти про щось підозріле або незвичайне.",
  "sk_sketch_personal_mc_locations_limit_p_1_el_3_text": "Дотримуватимусь цього поки що",
  "sk_sketch_personal_mc_keep_silent_p_1_el_1_text": "Я думаю, що мені слід зберігати мовчання про те, що сталося зі мною.",
  "sk_sketch_personal_mc_keep_silent_p_1_el_2_text": "Чомусь мені здається, що стане набагато гірше, якщо я комусь про це розкажу. Тому поки що я просто почекаю і поспостерігаю за оточенням.",
  "sk_sketch_personal_mc_keep_silent_p_1_el_3_text": "Дотримуватимусь цього поки що",
  "sk_sketch_personal_mc_power_of_order_p_1_el_1_text": "Чому мій наказ спрацював у розмові з Мелісою?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_2_text": "Це точно не в її натурі просто так це залишити. Вона продовжувала б, незважаючи на мої заперечення, поки не з'ясувала б усе.",
  "sk_sketch_personal_mc_power_of_order_p_1_el_3_text": "Хм, може вона просто була несподівано чуйною в цей момент?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_4_text": "Або це наслідки недавньої пригоди?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_5_text": "А може, я занадто обдумую щось не настільки вагоме?",
  "sk_sketch_personal_mc_power_of_order_p_1_el_6_text": "Баррет, наприклад, на це ніяк особливо не відреагував.", // if 'q_barrets_matters' квест завершений
  "sk_sketch_personal_mc_power_of_order_p_1_el_7_text": "...",
  "sk_sketch_personal_mc_power_of_order_p_1_el_8_text": "Ну, хто знає що за ефект може бути від останніх подій. Тому, я думаю, що відтепер буду просто уважніше дивитись, якщо щось подібне трапиться знов.",
  "sk_sketch_personal_mc_power_of_order_p_1_el_9_text": "Дотримуватимусь цього поки що",
  "sk_sketch_personal_mc_give_brooch_p_1_el_1_text": "Я майже забув віддати Мелісі брошку, яка була відправною точкою недавніх подій.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_2_text": "...тих подій, в яких я б волів ніколи не приймати участі.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_3_text": "Але...",
  "sk_sketch_personal_mc_give_brooch_p_1_el_4_text": "Хм... було рідкістю бачити її такою відвертою і турботливою щодо мене.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_5_text": "Можливо, мені варто час від часу знаходити артефакти і протистояти відьмам, для того щоб знову зміг це побачити?",
  "sk_sketch_personal_mc_give_brooch_p_1_el_6_text": "Ти навіть на мить зупинився, щоб обдумати це.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_7_text": "Та ні-і-і... про що таке я взагалі думаю.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_8_text": "Але я все одно маю повернути їй ту брошку.",
  "sk_sketch_personal_mc_give_brooch_p_1_el_9_text": "Час віддати Мелісі брошку",
  "sk_sketch_personal_mc_give_brooch_p_1_el_10_text": "Повернутися до дзеркала",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_1_text": "Схоже, Баррет хотів поговорити зі мною про щось наодинці.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_2_text": "Інакше він просто залишив би повідомлення через Мелісу.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_3_text": "Щоб дізнатися, що його турбує, мені потрібно знайти його і запитати.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_4_text": "Зазвичай він знаходиться в себе вдома, в домі сім'ї Смітів.",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_5_text": "Знайти і запитати Баррета про його турботи",
  "sk_sketch_personal_mc_barrets_matters_p_1_el_6_text": "Повернутися до дзеркала",  
  "sk_sketch_personal_mc_i_changed_p_1_el_1_text": "Ти уважно дивишся в дзеркало, перевіряючи, чи є якісь фізичні зміни у твоїй зовнішності.",
  "sk_sketch_personal_mc_i_changed_p_1_el_2_text": "Дідько, я не лише відчуваю себе по-іншому — легшим і слабшим, але, здається, я й фізично змінився.",
  "sk_sketch_personal_mc_i_changed_p_1_el_3_text": "Спочатку я думав, що просто схуд, але це очевидно не єдине.",
  "sk_sketch_personal_mc_i_changed_p_1_el_4_text": "Я не просто схуд, мої риси стали м'якішими, а шкіра гладкішою.",
  "sk_sketch_personal_mc_i_changed_p_1_el_6_text": "А найдивніше те, що в мене більше немає шраму!",
  "sk_sketch_personal_mc_i_changed_p_1_el_7_text": "Дивно також, що Меліса не згадала про це. Хоча, можливо вона була занадто знервована, щоб помітити в той час.",
  "sk_sketch_personal_mc_i_changed_p_1_el_8_text": "Або... може бути...",
  "sk_sketch_personal_mc_i_changed_p_1_el_9_text": "...існує ймовірність, що я можу зараз уявляти собі всі ці речі. Хто знає, як ця пригода вплинула на мене.",
  "sk_sketch_personal_mc_i_changed_p_1_el_10_text": "У будь-якому випадку, я не зможу приховати, якщо є серйозні зміни у моїй зовнішності. <br> Тому краще не відкладати і піти поговорити з деякими близькими знайомими, щоб побачити, чи вони щось помітять.",
  "sk_sketch_personal_mc_i_changed_p_1_el_11_text": "Я думаю, що запитаю Алуру і Баррета, і також перепитаю Мелісу. <br> Вони повинні бути десь у поселені. Після розмови з ними, мабуть повернусь і обміркую результати.",
  "sk_sketch_personal_mc_i_changed_p_1_el_12_text": "Час їх знайти",
  "sk_sketch_personal_mc_i_changed_p_1_el_13_text": "Повернутися до дзеркала.",
  "sk_quest_had_i_changed_melissa_p_1_el_1_text": "Ехм, після тієї нещасливої події я відчуваю себе слабкішим. І також можливо травма та стрес залишили на мені свій відбиток.",
  "sk_quest_had_i_changed_melissa_p_1_el_2_text": "Ми все ще можемо піти до лікаря.",
  "sk_quest_had_i_changed_melissa_p_1_el_3_text": "Ні, ні, я просто хотів запитати, чи помітила ти якісь зміни в моїй зовнішності?",
  "sk_quest_had_i_changed_melissa_p_1_el_4_text": "Ну, ти все ще виглядаєш дещо блідим і трохи більш струнким, ніж раніше. Але окрім цього, напевно, ні.",
  "sk_quest_had_i_changed_melissa_p_1_el_5_text": "А як щодо шраму?",
  "sk_quest_had_i_changed_melissa_p_1_el_6_text": "Ах, той шрам, що ти отримав, граючи з Алурою. Хіба він не зажив вже давно? І хіба він не був незначним від початку?",
  "sk_quest_had_i_changed_melissa_p_1_el_7_text": "Ну, я точно не вважав його незначним.",
  "sk_quest_had_i_changed_melissa_p_1_el_8_text": "Чому ти питаєш за це зараз? Ти певен, що вже все справді гаразд?",
  "sk_quest_had_i_changed_melissa_p_1_el_9_text": "Та так, просто це змусило мене думати про багато речей, про минуле також.",
  "sk_quest_had_i_changed_melissa_p_1_el_10_text": "Зрозуміло. Але якщо тобі потрібна буде допомога, знай я тут.",
  "sk_quest_had_i_changed_melissa_p_1_el_11_text": "Знаю, дякую.",
  "sk_quest_had_i_changed_melissa_p_1_el_12_text": "Ох, мені треба йти зараз.",
  "sk_quest_had_i_changed_melissa_p_1_el_13_text": "Звичайно, бережи себе!",
  "sk_quest_had_i_changed_melissa_p_1_el_14_text": "Ти теж!",
  "sk_quest_had_i_changed_melissa_p_1_el_15_text": "Піти",
  "sk_quest_had_i_changed_barret_p_1_el_1_text": "Я хочу спитати, чи я... ну... чи я змінився?",
  "sk_quest_had_i_changed_barret_p_1_el_2_text": "Гмм, це ж одне з тих питань, які зазвичай ставлять дівчата? Чи ти не...",
  "sk_quest_had_i_changed_barret_p_1_el_3_text": "Ти перебиваєш його гучним саркастичним сміхом, натякаючи йому не продовжувати.",
  "sk_quest_had_i_changed_barret_p_1_el_4_text": "Ха-ха. Вибач, вибач.",
  "sk_quest_had_i_changed_barret_p_1_el_5_text": "Але якщо по правді казати, так. Я не можу це чітко описати, але я відчуваю що зміни точно є.",
  "sk_quest_had_i_changed_barret_p_1_el_6_text": "І я згадував про це раніше, але ти тоді не захотів це обговорювати.", // (якщо 'справи Баррета' завершено)
  "sk_quest_had_i_changed_barret_p_1_el_7_text": "Можеш сказати, що змінилося? Наприклад, що зі шрамом?",
  "sk_quest_had_i_changed_barret_p_1_el_8_text": "Той шрам? Так... ти отримав його давним-давно, то він нарешті загоївся?",
  "sk_quest_had_i_changed_barret_p_1_el_9_text": "Це дуже дивно, він не міг би загоїтись настільки швидко, і він знає ситуацію навколо шраму, щоб так легко це прийняти.",
  "sk_quest_had_i_changed_barret_p_1_el_10_text": "Ну, що стосується змін, то окрім дивної поведінки...",
  "sk_quest_had_i_changed_barret_p_1_el_11_text": "Він підходить трохи ближче і починає ретельно розглядати вас, пильно вдивляючись та шукаючи будь-які відмінності.",
  "sk_quest_had_i_changed_barret_p_1_el_12_text": "Таким поглядом він в мені і дірку пропалить.",
  // "sk_quest_had_i_changed_barret_p_1_el_13_text": "", // image
  "sk_quest_had_i_changed_barret_p_1_el_14_text": "Але його грізний погляд допомагав нам навіть тоді, коли...",
  "sk_quest_had_i_changed_barret_p_1_el_15_text": "Потім раптово він починає виглядати спантеличеним і робить між вами дистанцію.",
  "sk_quest_had_i_changed_barret_p_1_el_16_text": "Він червоніє і намагається не зловити ваш погляд очима.",
  // "sk_quest_had_i_changed_barret_p_1_el_17_text": "", // image
  "sk_quest_had_i_changed_barret_p_1_el_18_text": "Оце ось точно було неочікувано.",
  "sk_quest_had_i_changed_barret_p_1_el_19_text": "Кхм, так, є кілька речей, яких я раніше не помічав.",
  "sk_quest_had_i_changed_barret_p_1_el_20_text": "Наприклад?",
  "sk_quest_had_i_changed_barret_p_1_el_21_text": "Ти виглядаєш... стрункішим і... гм... приємнішим...",
  "sk_quest_had_i_changed_barret_p_1_el_22_text": "Приємнішим?",
  "sk_quest_had_i_changed_barret_p_1_el_23_text": "Ну... я маю на увазі... з більш виразними очима і світлішою шкірою.",
  "sk_quest_had_i_changed_barret_p_1_el_24_text": "Тепер він виглядає ще більш спантеличеним і зніяковілим.",
  // "sk_quest_had_i_changed_barret_p_1_el_25_text": "", // image
  "sk_quest_had_i_changed_barret_p_1_el_26_text": "Гм, розумію...",
  "sk_quest_had_i_changed_barret_p_1_el_27_text": "Цікаво. Доволі рідко можна побачити його таким.",  
  "sk_quest_had_i_changed_barret_p_1_el_28_text": "Я почув достатньо, тому ми можемо на цьому і зупинитися.",
  "sk_quest_had_i_changed_barret_p_1_el_29_text": "Це було трохи ніяково для нас обох, але очевидно, що він сприймає мене не так, як зазвичай.",
  "sk_quest_had_i_changed_barret_p_1_el_30_text": "Я тебе раніше не оглядав прям щоб ретельно, але ми провели багато часу разом, і я не пам'ятаю, щоб бачив у твоїй зовнішності такі риси раніше.", 
  "sk_quest_had_i_changed_barret_p_1_el_31_text": "Але чому ці зміни? Ти використовував якісь косметичні засоби своєї сестри?",
  "sk_quest_had_i_changed_barret_p_1_el_32_text": "Ха? Ні, навіщо мені це робити?",
  "sk_quest_had_i_changed_barret_p_1_el_33_text": "Просто моє тіло було перенапружене після інциденту на озері, можливо, це надало моєму тілу якийсь відновлювальний ефект.",
  "sk_quest_had_i_changed_barret_p_1_el_34_text": "Інцидент?", // (якщо 'справи Баррета' не завершено)
  "sk_quest_had_i_changed_barret_p_1_el_35_text": "Ах, так, я розповім тобі іншим разом.", // (якщо 'справи Баррета' не завершено)
  "sk_quest_had_i_changed_barret_p_1_el_36_text": "Так... можливо.", // (якщо 'справи Баррета' завершено)
  "sk_quest_had_i_changed_barret_p_1_el_37_text": "Видно, що він все ще незадоволений тим, що ти не розповів усіх деталей.", // (якщо 'справи Баррета' завершено)
  "sk_quest_had_i_changed_barret_p_1_el_38_text": "В будь-якому разі, мені треба йти.",
  "sk_quest_had_i_changed_barret_p_1_el_39_text": "Я хочу перевірити як справи у Алури.", // (якщо 'я змінився' з Алурою не завершено)
  "sk_quest_had_i_changed_barret_p_1_el_40_text": "І поговорити зі своєю сестрою.", // (якщо 'я змінився' з Меліссою не завершено) 
  "sk_quest_had_i_changed_barret_p_1_el_41_text": "Гм, звичайно.",
  "sk_quest_had_i_changed_barret_p_1_el_42_text": "Піти",
  "sk_quest_had_i_changed_alura_p_1_el_1_text": "Давно тебе не бачила. Усе гаразд?",
  "sk_quest_had_i_changed_alura_p_1_el_2_text": "Так, просто був зайнятий і зі мною стався невеликий інцидент на озері.",
  "sk_quest_had_i_changed_alura_p_1_el_3_text": "Ох, а зараз вже все нормально? Може тобі треба лікування? Чи...",
  "sk_quest_had_i_changed_alura_p_1_el_4_text": "Ні, ні. Все вже добре, не хвилюйся.",
  "sk_quest_had_i_changed_alura_p_1_el_5_text": "Насправді, я хотів запитати про ось що... ем... чи ти бачиш у мені щось незвичне?",
  "sk_quest_had_i_changed_alura_p_1_el_6_text": "Ти впевнений, що все гаразд?",
  "sk_quest_had_i_changed_alura_p_1_el_7_text": "Так! Я просто... трохи схуд і хотів спитати чи ти помітила.",
  "sk_quest_had_i_changed_alura_p_1_el_8_text": "Гмм, не дуже.",
  "sk_quest_had_i_changed_alura_p_1_el_9_text": "З сором'язливістю вона оглянула тебе.",
  "sk_quest_had_i_changed_alura_p_1_el_10_text": "Але, ем, можливо так... трохи є... я думаю.",
  "sk_quest_had_i_changed_alura_p_1_el_11_text": "А що зі шрамом?",
  "sk_quest_had_i_changed_alura_p_1_el_12_text": "О, тепер коли ти згадав, так. Ти нарешті його вилікував. Я набагато спокійніша тепер.",
  "sk_quest_had_i_changed_alura_p_1_el_13_text": "Ти ще відчуваєш себе відповідальною за це?",
  "sk_quest_had_i_changed_alura_p_1_el_14_text": "Ну, якби не я, ти б його не отримав у першу чергу.",
  "sk_quest_had_i_changed_alura_p_1_el_15_text": "Емм, я тобі казав, що це... неважливо, зараз це вже не має значення, чи не так?",
  "sk_quest_had_i_changed_alura_p_1_el_16_text": "Угу.",
  "sk_quest_had_i_changed_alura_p_1_el_17_text": "Ну, у будь-якому випадку, дякую. Мені час іти.",
  "sk_quest_had_i_changed_alura_p_1_el_18_text": "Коли ти обертаєшся до виходу, ти відчуваєш, що Алура схопила тебе за руку.",
  // "sk_quest_had_i_changed_alura_p_1_el_19_text": "", // image here 
  "sk_quest_had_i_changed_alura_p_1_el_20_text": "Зачекай. Це все? Коли ми зможемо повести час разом і поговорити?",
  "sk_quest_had_i_changed_alura_p_1_el_21_text": "Ех, у такі моменти вона виглядає як заблукане безпорадне цуценя, якого хочеться погладити та заспокоїти.",
  // "sk_quest_had_i_changed_alura_p_1_el_22_text": "", // image here 
  "sk_quest_had_i_changed_alura_p_1_el_23_text": "Незабаром, дуже скоро, я обіцяю. Мені просто треба вирішити ще кілька речей.",
  "sk_quest_had_i_changed_alura_p_1_el_24_text": "Ох, зрозуміло.",
  "sk_quest_had_i_changed_alura_p_1_el_25_text": "Ти бачиш, що твої слова викликали у неї сум. І що вона все ще дивитись на тебе, сподіваючись, що ти можеш змінити своє рішення.",
  "sk_quest_had_i_changed_alura_p_1_el_26_text": "Ну, це доволі типова для неї поведінка, коли щось йде не так, як вона б того хотіла. <br> Однак я не можу постійно вдовольняти всі її забаганки, зараз особливо.",
  "sk_quest_had_i_changed_alura_p_1_el_27_text": "Побачимося, бувай.",
  "sk_quest_had_i_changed_alura_p_1_el_28_text": "Гм, бувай.",
  "sk_quest_had_i_changed_alura_p_1_el_29_text": "Піти",
  "sk_quest_had_i_changed_final_p_1_el_1_text": "Що ж, я запитав людей, з якими зазвичай проводжу час, про будь-які зміни, які вони бачать.",
  "sk_quest_had_i_changed_final_p_1_el_2_text": "І, з того, що я зрозумів, їхнє сприйняття мене різниться.",
  "sk_quest_had_i_changed_final_p_1_el_3_text": "Їм було важко знайти в мені щось незвичне, доки я не просив їх придивитися.",
  "sk_quest_had_i_changed_final_p_1_el_4_text": "Особливо дивно, що всі вони, здавалося, забули про шрам, який у мене був протягом років. До того ж, доволі дивна була їхня реакція після того, як я його згадував.",
  "sk_quest_had_i_changed_final_p_1_el_5_text": "Тепер я вважаю, що це не я просто збожеволів, а все це є скоріш результатом наслідків тих подій біля озера.",
  "sk_quest_had_i_changed_final_p_1_el_6_text": "Шкода, що я не можу безпечно дізнатись більше інформації у когось, хто б знав про такі речі більше.",
  "sk_quest_had_i_changed_final_p_1_el_7_text": "Я не настільки добре знаю мага селища, щоб звернутися і довіритись йому в таких речах.",
  "sk_quest_had_i_changed_final_p_1_el_8_text": "А відьма та точно виключена з розгляду.",
  "sk_quest_had_i_changed_final_p_1_el_9_text": "В будь-якому випадку, я поки не бачу нічого, що я можу зробити зараз безпечно, окрім того, як продовжувати тримати в очі відкритим на випадок нових можливостей дізнатися більше про ці наслідки.",
  "sk_quest_had_i_changed_final_p_1_el_10_text": "І якщо я побачу, що ситуація почне погіршуватися, тоді вже піду й поговорю з батьками, магом селища та старійшеною.",
  "sk_quest_had_i_changed_final_p_1_el_11_text": "Ну, наразі це звучить як який-не-який, а план.",
  "sk_quest_had_i_changed_final_p_1_el_12_text": "Піти",
  "sk_quest_melissa_swim_p_1_el_1_text": "Попередження! Це мета-квест. <br> Мета-квести не є каноном і слугують тимчасовим заміщенням для реального квесту, який буде впроваджено пізніше.",
  "sk_quest_melissa_swim_p_1_el_2_text": "Тобі потрібно навчитись плавати, для того щоб наступного разу ти могла топитись на озері сама, а не втягувати мене.",
  "sk_quest_melissa_swim_p_1_el_3_text": "Та нах*й іди з таким заявами! Скільки можна? Я вже вибачалася купу разів!",
  "sk_quest_melissa_swim_p_1_el_4_text": "Так, але це не змінює того факту, що тобі потрібно навчитись плавати.",
  "sk_quest_melissa_swim_p_1_el_5_text": "Добре, то що ти пропонуєш?",
  "sk_quest_melissa_swim_p_1_el_6_text": "Ми підемо до озера або річки і я 5 разів буду вчити тебе. <br> Потім я занесу запис про це в твій профіль у своєму щоденнику і твій рівень відносин зі мною підвищиться.",
  "sk_quest_melissa_swim_p_1_el_7_text": "Е-мм.. Що?!",
  "sk_quest_melissa_swim_p_1_el_8_text": "Не звертай уваги, це напів-мета-розмова.",
  "sk_quest_melissa_swim_p_1_el_9_text": "Ага, звичайно. Дивак.",
  "sk_quest_melissa_swim_p_1_el_10_text": "О, і ми підемо туди лише пізніше в грі, тому що зараз я боюся виходити за межі села.",
  "sk_quest_melissa_swim_p_1_el_11_text": "...",
  "sk_quest_melissa_swim_p_1_el_12_text": "То чому ти взагалі почав цю розмову?",
  "sk_quest_melissa_swim_p_1_el_13_text": "У майбутньому я зміню текст або просто додам нову розмову після цієї.",
  "sk_quest_melissa_swim_p_1_el_14_text": "Іди проспись і, можливо, перестань приймати невідомі тобі рослини.",
  "sk_quest_melissa_swim_p_1_el_15_text": "Ось тоді, коли ти прийдеш до тями, ми ще раз зможемо поговорити про це.",
  "sk_quest_melissa_swim_p_1_el_16_text": "Так точно!",
  "sk_quest_melissa_swim_p_1_el_17_text": "Піти",
  "sk_sketch_personal_melissa_swim_p_1_el_1_text": "Я думаю, тобі потрібно навчитися плавати.",
  "sk_sketch_personal_melissa_swim_p_1_el_2_text": "Якщо це пов'язано з ситуацією з брошкою, то не хвилюйся. Я буду намагатись не турбувати тебе знову своїми турботами.",
  "sk_sketch_personal_melissa_swim_p_1_el_3_text": "Тобі не потрібно уникати моєї допомоги, я все ще твій брат і турбуюся про тебе.",
  "sk_sketch_personal_melissa_swim_p_1_el_4_text": "Але є дещо, що ти могла би навчитись.",
  "sk_sketch_personal_melissa_swim_p_1_el_5_text": "Я бачу її коливання.",
  "sk_sketch_personal_melissa_swim_p_1_el_6_text": "Гм, на скільки я можу судити, вона хоче швидше подорослішати, тому я можу використати це.",
  "sk_sketch_personal_melissa_swim_p_1_el_7_text": "Чим більше речей ти вмієш робити, особливо таких базових як плавання, тим більшим ти можеш похизуватись. Дорослі це роблять постійно.",
  "sk_sketch_personal_melissa_swim_p_1_el_8_text": "Добре, добре. Я не проти, але у мене немає одягу для плавання.",
  "sk_sketch_personal_melissa_swim_p_1_el_9_text": "Ну, тоді я можу купити його тобі.",
  "sk_sketch_personal_melissa_swim_p_1_el_10_text": "Справді?!",
  "sk_sketch_personal_melissa_swim_p_1_el_11_text": "**Зображення з блискучими очима**",
  "sk_sketch_personal_melissa_swim_p_1_el_12_text": "Якщо справді купиш, буду винна. Точніше ще раз винна.",
  "sk_sketch_personal_melissa_swim_p_1_el_13_text": "Добре, я куплю його тобі.",
  "sk_sketch_personal_melissa_swim_p_1_el_14_text": "Я повернусь до цього пізніше.",
  "sk_quest_return_brooch_p_1_el_1_text": "Щодо тієї брошки...",
  "sk_quest_return_brooch_p_1_el_2_text": "Так, я дуже вибачаюсь за св...",
  "sk_quest_return_brooch_p_1_el_3_text": "Ні, ні, зупинися на секунду. Я зараз не намагаюсь тебе звинувачувати чи щось таке.",
  "sk_quest_return_brooch_p_1_el_4_text": "Вона примовкла, уважно дивлячись на тебе.",
  "sk_quest_return_brooch_p_1_el_5_text": "Я просто знайшов її у себе в одежі і згадав, що так тобі її і не віддав.",
  "sk_quest_return_brooch_p_1_el_6_text": "Ох, точно, я також забула за це переймаючись халепою що сталася з тобою.",
  "sk_quest_return_brooch_p_1_el_7_text": "Ти береш її за долоню і виймаєш брошку зі свого кармана.",
  "sk_quest_return_brooch_p_1_el_8_text": "Ось вона.",
  "sk_quest_return_brooch_p_1_el_9_text": "Віддати брошку",
  "sk_quest_return_brooch_p_2_el_1_text": "Ох, я нарешті зможу її повернути. Що що, але я точно так не облажаюсь більш ніколи! ",
  "sk_quest_return_brooch_p_2_el_2_text": "Агась, я б теж ніколи не хотів повторювати свою так звану пригоду.",
  "sk_quest_return_brooch_p_2_el_3_text": "Ти помічаєш, що її обличчя стає сумнішим і на ньому починає бути помітним відчуття провини.",
  // "sk_quest_return_brooch_p_2_el_4_text": "", // image
  "sk_quest_return_brooch_p_2_el_5_text": "Що я можу зробити, щоб віддячити та спокутувати за все, що сталося з тобою?",
  "sk_quest_return_brooch_p_2_el_6_text": "Все нормально, тобі справді не потрібно за це так перейматись.",
  "sk_quest_return_brooch_p_2_el_7_text": "Я відчуваю що... Просто твої жарти іноді відчуваються як маленькі уколи прям у серце.",
  "sk_quest_return_brooch_p_2_el_8_text": "Вибач, це виходить само собою, просто такими були наші звичайні розмови раніше.",
  "sk_quest_return_brooch_p_2_el_9_text": "Я розумію звичайно, але мені здається, що речі не можуть просто повернутися до того, як вони були. Принаймні не швидко.",
  "sk_quest_return_brooch_p_2_el_10_text": "Це також нормально. Ми просто можемо побудувати нові способи як краще взаємодіяти.",
  "sk_quest_return_brooch_p_2_el_11_text": "Мені здається, що зараз можу повихвалятись заготовленою промовою.",
  "sk_quest_return_brooch_p_2_el_12_text": "У нас у всіх є свої недоліки та свої переваги. Мої жарти, твоя незграбність, моя відданість, твій шарм, і так далі. Головне - ми повинні продовжувати наше звичне життя і допомагати один одному покращувати наші переваги та компенсувати наші слабкі сторони.",
  "sk_quest_return_brooch_p_2_el_13_text": "Вау, яка промова. Ти готував її напередодні, щоб продемонструвати її в потрібний момент?",
  "sk_quest_return_brooch_p_2_el_14_text": "Вона радісно посміхається.",
  // "sk_quest_return_brooch_p_2_el_15_text": "", // image
  "sk_quest_return_brooch_p_2_el_16_text": "Вона мене прорахувала.",
  "sk_quest_return_brooch_p_2_el_17_text": "Навіть здається, що ти турботливий старший брат.",
  "sk_quest_return_brooch_p_2_el_18_text": "Але я такий.",
  "sk_quest_return_brooch_p_2_el_19_text": "Вона щиро сміється",
  "sk_quest_return_brooch_p_2_el_20_text": "Дякую, мені вже краще.",
  "sk_quest_return_brooch_p_2_el_21_text": "Але все одно я подумаю про це і знайду спосіб віддячити тобі за все, що ти переживав через мене.",
  "sk_quest_return_brooch_p_2_el_22_text": "І зараз мені краще поспішити, поки ще є час повернути цю прокляту брошку непомічено.",
  "sk_quest_return_brooch_p_2_el_23_text": "Добре, удачі тоді. Бувай!",
  "sk_quest_return_brooch_p_2_el_24_text": "Бувай!",
  "sk_quest_return_brooch_p_2_el_25_text": "Піти",
  "sk_quest_barrets_matters_p_1_el_1_text": "Я хотів запитати про...", 
  "sk_quest_barrets_matters_p_1_el_2_text": "Перериваючи твоє запитання, мама Баррета, пані Сміт, виходить та каже.",
  "sk_quest_barrets_matters_p_1_el_3_text": "Будь ласка, переконайся, що після занять з ковальства з батьком ти прибрав інструменти з майстерні.",
  "sk_quest_barrets_matters_p_1_el_4_text": "Слухаюсь! Тепер буду ретельніше стежити, щоб інструменти були прибрані.",
  "sk_quest_barrets_matters_p_1_el_5_text": "Ех, іноді твоя поведінка більше схожа на якогось підлеглого чи солдата, ніж на звичайного сина. Твоєму батьку це до вподоби, але мені - ні. Дякувати Богу, у тебе є друзі твого віку, з ким ти проводиш час, інакше я б хвилювалася.",
  "sk_quest_barrets_matters_p_1_el_6_text": "Потім вона повертається до тебе.",
  "sk_quest_barrets_matters_p_1_el_7_text": "Будь ласка, будьте хорошими друзями і надалі, бо наші відносини склались таким чином, що він занадто серйозний з нами. Хоча навіть з більшістю інших людей він такий же. А ось з тобою та Алурою він більш легковажний та розслаблений, яким він і повинен бути у своєму віці.",
  "sk_quest_barrets_matters_p_1_el_8_text": "З цими словами вона виходить з кімнати.",
  "sk_quest_barrets_matters_p_1_el_9_text": "Про що це було взагалі?",
  "sk_quest_barrets_matters_p_1_el_10_text": "Ах, не звертай уваги. Вона просто трошки тривожиться останнім часом. І я не впевнений, що я є справжньою причиною цього.",
  "sk_quest_barrets_matters_p_1_el_11_text": "Так от, що ти там хотів сказати?",
  "sk_quest_barrets_matters_p_1_el_12_text": "Я хотів дізнатись, про що ти хотів запитати, коли заходив останнього разу.",
  "sk_quest_barrets_matters_p_1_el_13_text": "Ах, я хотів тебе запитати дещо про Алуру, але тебе не було на той час. Твоя сестра сказала, що вона попросила тебе дещо пошукати і ти зайнятий. Проте, я помітив, що вона була занепокоєною.",
  "sk_quest_barrets_matters_p_1_el_14_text": "Того дня трапилося щось?",
  "sk_quest_barrets_matters_p_1_el_15_text": "Це шанс покластися на нього та поділитися всім тим тягарем з кимось, але я не певен у наслідках такого рішення.",
  "sk_quest_barrets_matters_p_1_el_16_text": "З іншого боку, я можу діяти більш обережно та спробувати переконати його в тій версії, яку я розповів Мелісі. Після цього вона наче втихомирилася, і принаймні виглядало так, ніби вона частково повірила в це.",
  "sk_quest_barrets_matters_p_1_el_17_text": "Розкрити правду",
  "sk_quest_barrets_matters_p_1_el_18_text": "Розповісти безпечну версію",
  "sk_quest_barrets_matters_p_2_el_1_text": "Меліса втратила одну зі своїх прикрас у озері, тому я занурювався, щоб знайти її. <br> Це зайняло якийсь час і в процесі я випадково вдарився головою об камінь під водою. Від цього я почувався трохи не в собі, і в такому стані якось повернувся додому.",
  "sk_quest_barrets_matters_p_2_el_2_text": "Баррет виглядає трохи здивованим і задумливим.",
  "sk_quest_barrets_matters_p_2_el_3_text": "Хм, я не сказав цього одразу, але відчуваю, що в тобі зараз щось не так як завжди. Це точно просто через удар головою?", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_4_text": "Так, ти кажеш, що зміни в тобі, які я згадував раніше, з'явилися через удар головою та перенапругу?", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_5_text": "Ах, він несподівано уважно ставиться до цього.", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_6_text": "Ах, хоч я вже залучив його до перевірки, але мені не треба, щоб він докопувався далі.", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_7_text": "Можливо, я зміг би використати трюк переконання, який я використав на Мелісі.",
  "sk_quest_barrets_matters_p_2_el_8_text": "Ха-ха, можливо, це був типу магічний камінь. Але головний біль після удару об нього не такий магічний.", // if 'had I changed' Barret not complete
  "sk_quest_barrets_matters_p_2_el_9_text": "Ха-ха, можливо, це був типу магічний камінь. Це звучить набагато реалістичніше, чи не так, ха-ха?", // if 'had I changed' Barret complete
  "sk_quest_barrets_matters_p_2_el_10_text": "У будь-якому випадку, я сказав тобі все, що знаю, і я думаю <b>тут більше нема про що розмовляти</b>.",
  "sk_quest_barrets_matters_p_2_el_11_text": "Якось сумнівно все це, але якщо ти хочеш про щось притримати при собі, це твій вибір.",
  "sk_quest_barrets_matters_p_2_el_12_text": "Прокляття, це не спрацювало.",
  "sk_quest_barrets_matters_p_2_el_13_text": "Просто я хочу, щоб ти не вигадував щось для мене.",
  "sk_quest_barrets_matters_p_2_el_14_text": "Він очевидно розчарований тим, що ти приховуєш всю правду.",
  "sk_quest_barrets_matters_p_2_el_15_text": "Якщо я щось пригадаю, я повідомлю тобі.",
  "sk_quest_barrets_matters_p_2_el_16_text": "Отже, що з Алурою?",
  "sk_quest_barrets_matters_p_3_el_1_text": "Ти помічаєш, що йому не сподобалося те, що ти вирішив переключитись до іншої теми.",
  "sk_quest_barrets_matters_p_3_el_2_text": "Про Алуру...",
  "sk_quest_barrets_matters_p_3_el_3_text": "Було видно, що він почав вагатися, його обличчя демонструвало його сумніви.",
  "sk_quest_barrets_matters_p_3_el_4_text": "Я просто думав запитати, чи помітив ти, що вона останні кілька днів трохи засмучена. <br> І власне хотів запропонувати піти в похід біля озера, можливо на цілий день, або навіть й на ніч.",
  "sk_quest_barrets_matters_p_3_el_5_text": "Холод пробіг по спині при думці, що треба йти на те озеро і там ночувати.",
  "sk_quest_barrets_matters_p_3_el_6_text": "Але я думаю, що зараз не найкращий час для цього, зважаючи на твою ситуацію.",
  "sk_quest_barrets_matters_p_3_el_7_text": "Так само, як він помітив, що ти щось приховуєш, ти також побачив ознаки того, що він спочатку думав сказати щось інше.",
  "sk_quest_barrets_matters_p_3_el_8_text": "Хм, це все?",
  "sk_quest_barrets_matters_p_3_el_9_text": "Так, це саме те, що я хотів запропонувати, і тут більше нема про що розмовляти.",
  "sk_quest_barrets_matters_p_3_el_10_text": "Він передразнив мене, а така поведінка - рідкість для нього. <br> Схоже ця ситуація та слова, сказані та не сказані, мабуть таки завдали шкоди нашій дружбі.",
  "sk_quest_barrets_matters_p_3_el_11_text": "Зрозуміло.",
  "sk_quest_barrets_matters_p_3_el_12_text": "Мені цікаво, що насправді він хотів сказати щодо Алури, але немає сенсу тиснути на нього зараз. І, мабуть, я не маю на це права, оскільки і я сам приховую чимало.",
  "sk_quest_barrets_matters_p_3_el_13_text": "Коли я відновлюся, я обіцяю, що ми зберемося і сходимо туди на весь день. Але наразі краще без нічних посиденьок і точно краще без озера.",
  "sk_quest_barrets_matters_p_3_el_14_text": "Добре, звісно.",
  "sk_quest_barrets_matters_p_3_el_15_text": "Нам обом потрібно трохи охолонути і зняти напругу, яка зараз у повітрі.",
  "sk_quest_barrets_matters_p_3_el_16_text": "Мабуть, я піду. У мене все ще є речі, які треба зробити скоріше. І, якщо тобі захочеться щось ще розповісти, просто знайди мене. Найближчим часом я буду вдома переважно.",
  "sk_quest_barrets_matters_p_3_el_17_text": "Звісно, те ж саме стосується і тебе.",
  "sk_quest_barrets_matters_p_3_el_18_text": "Ага... Бувай.",
  "sk_quest_barrets_matters_p_3_el_19_text": "Піти"  
}
/* twine-user-script #6: "l10nString_en.js" */

function changel10nStrings_en () {
	/* General. */
	l10nStrings.identity = 'game';
	l10nStrings.aborting = 'Aborting';
	l10nStrings.cancel   = 'Cancel';
	l10nStrings.close    = 'Close';
	l10nStrings.ok       = 'OK';

	/* Errors. */
	l10nStrings.errorTitle              = 'Error';
	l10nStrings.errorToggle             = 'Toggle the error view';
	l10nStrings.errorNonexistentPassage = 'the passage "{passage}" does not exist'; // NOTE: `passage` is supplied locally
	l10nStrings.errorSaveDiskLoadFailed = 'failed to load save file from disk';
	l10nStrings.errorSaveMissingData    = 'save is missing required data. Either the loaded file is not a save or the save has become corrupted';
	l10nStrings.errorSaveIdMismatch     = 'save is from the wrong {identity}';

	/* Warnings. */
	l10nStrings._warningIntroLacking  = 'Your browser either lacks or has disabled';
	l10nStrings._warningOutroDegraded = ', so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.';
	l10nStrings.warningNoWebStorage   = '{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}';
	l10nStrings.warningDegraded       = '{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}';

	/* Debug bar. */
	l10nStrings.debugBarToggle      = 'Toggle the debug bar';
	l10nStrings.debugBarNoWatches   = '\u2014 no watches set \u2014';
	l10nStrings.debugBarAddWatch    = 'Add watch';
	l10nStrings.debugBarDeleteWatch = 'Delete watch';
	l10nStrings.debugBarWatchAll    = 'Watch all';
	l10nStrings.debugBarWatchNone   = 'Delete all';
	l10nStrings.debugBarLabelAdd    = 'Add';
	l10nStrings.debugBarLabelWatch  = 'Watch';
	l10nStrings.debugBarLabelTurn   = 'Turn'; // (noun) chance to act (in a game), moment, period
	l10nStrings.debugBarLabelViews  = 'Views';
	l10nStrings.debugBarViewsToggle = 'Toggle the debug views';
	l10nStrings.debugBarWatchToggle = 'Toggle the watch panel';

	/* UI bar. */
	l10nStrings.uiBarToggle   = 'Toggle the UI bar';
	l10nStrings.uiBarBackward = 'Go backward within the {identity} history';
	l10nStrings.uiBarForward  = 'Go forward within the {identity} history';
	l10nStrings.uiBarJumpto   = 'Jump to a specific point within the {identity} history';

	/* Jump To. */
	l10nStrings.jumptoTitle       = 'Jump To';
	l10nStrings.jumptoTurn        = 'Turn'; // (noun) chance to act (in a game), moment, period
	l10nStrings.jumptoUnavailable = 'No jump points currently available\u2026';

	/* Saves. */
	l10nStrings.savesTitle       = 'Saves';
	l10nStrings.savesDisallowed  = 'Saving has been disallowed on this passage.';
	l10nStrings.savesIncapable   = '{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.';
	l10nStrings.savesLabelAuto   = 'Autosave';
	l10nStrings.savesLabelDelete = 'Delete';
	l10nStrings.savesLabelExport = 'Save to Disk\u2026';
	l10nStrings.savesLabelImport = 'Load from Disk\u2026';
	l10nStrings.savesLabelLoad   = 'Load';
	l10nStrings.savesLabelClear  = 'Delete All';
	l10nStrings.savesLabelSave   = 'Save';
	l10nStrings.savesLabelSlot   = 'Slot';
	l10nStrings.savesUnavailable = 'No save slots found\u2026';
	l10nStrings.savesUnknownDate = 'unknown';

	/* Settings. */
	l10nStrings.settingsTitle = 'Settings';
	l10nStrings.settingsOff   = 'Off';
	l10nStrings.settingsOn    = 'On';
	l10nStrings.settingsReset = 'Reset to Defaults';

	/* Restart. */
	l10nStrings.restartTitle  = 'Restart';
	l10nStrings.restartPrompt = 'Are you sure that you want to restart? Unsaved progress will be lost.';

	/* Share. */
	l10nStrings.shareTitle = 'Connect';

	/* Alert. */
	l10nStrings.alertTitle = 'Alert';

	/* Autoload. */
	l10nStrings.autoloadTitle  = 'Autoload';
	l10nStrings.autoloadCancel = 'Go to start';
	l10nStrings.autoloadOk     = 'Load autosave';
	l10nStrings.autoloadPrompt = 'An autosave exists. Load it now or go to the start?';

	/* Macros. */
	l10nStrings.macroBackText   = 'Back'; // (verb) rewind, revert
	l10nStrings.macroReturnText = 'Return'; // (verb) go/send back

}
/* twine-user-script #7: "l10nString_fr.js" */
function changel10nStrings_fr() {
	
	/* General. */
	l10nStrings.identity = 'aventure';
	l10nStrings.aborting = 'Abandon';
	l10nStrings.cancel   = 'Annuler';
	l10nStrings.close    = 'Fermer';
	l10nStrings.ok       = 'OK';

	/* Errors. */
	l10nStrings.errorTitle              = 'Erreur';
	l10nStrings.errorToggle             = 'Afficher l\'erreur';
	l10nStrings.errorNonexistentPassage = 'le passage "{passage}" n\'existe pas';
	l10nStrings.errorSaveMissingData    = 'des éléments manquent dans cette sauvegarde. Soit ce fichier n\'en est pas une, soit il est corrompu';
	l10nStrings.errorSaveIdMismatch     = 'la sauvegarde ne semble pas provenir de cette {identity}';

	/* Warnings. */
	l10nStrings._warningIntroLacking  = 'Soit il manque à votre navigateur, soit il n\'autorise pas';
	l10nStrings._warningOutroDegraded = ', de ce fait l\'{identity} sera en mode dégradé. Cela n\'empechera le fonctionnement, mais vous risquez de rencontrer des erreurs.';
	l10nStrings.warningNoWebStorage   = '{_warningIntroLacking} l\'API de stockage de données{_warningOutroDegraded}';
	l10nStrings.warningDegraded       = '{_warningIntroLacking} certaines des fonctionnalités requises par l\'{identity}{_warningOutroDegraded}';

	/* Debug bar. */
	l10nStrings.debugBarToggle      = 'Afficher la barre de débogage';
	l10nStrings.debugBarNoWatches   = '\u2014 pas de surveillance active \u2014';
	l10nStrings.debugBarAddWatch    = 'Ajouter une surveillance';
	l10nStrings.debugBarDeleteWatch = 'Annuler une surveillance';
	l10nStrings.debugBarWatchAll    = 'Surveiller tout';
	l10nStrings.debugBarWatchNone   = 'Ne rien surveiller'; // if you want litteral : 'supprimer tout', but I think it's more what you want
	l10nStrings.debugBarLabelAdd    = 'Ajouter';
	l10nStrings.debugBarLabelWatch  = 'Surveillance';
	l10nStrings.debugBarLabelTurn   = 'Tournant';
	l10nStrings.debugBarLabelViews  = 'Vues';
	l10nStrings.debugBarViewsToggle = 'Basculer en mode débogage';
	l10nStrings.debugBarWatchToggle = 'Afficher la barre de surveillance';

	/* UI bar. */
	l10nStrings.uiBarToggle   = 'Afficher/cacher la barre d\'interface';
	l10nStrings.uiBarBackward = 'Revenir en arrière dans l\'histoire de l\'{identity}';
	l10nStrings.uiBarForward  = 'Avancer en arrière dans l\'histoire de l\'{identity}';
	l10nStrings.uiBarJumpto   = 'Aller à un point précis de l\'histoire de l\'{identity}';

	/* Jump To. */
	l10nStrings.jumptoTitle       = 'Aller à';
	l10nStrings.jumptoTurn        = 'Tournant';
	l10nStrings.jumptoUnavailable = 'Aucun point d\'arriver n\'est disponible\u2026';

	/* Saves. */
	l10nStrings.savesTitle       = 'Sauvegardes';
	l10nStrings.savesDisallowed  = 'Les sauvegardes sont désactivées pour ce passage.';
	l10nStrings.savesIncapable   = '{_warningIntroLacking} soit il n\'a pas la capacité pour prendre en charge les sauvegardes : elles seront désactivées pour cette session.';
	l10nStrings.savesLabelAuto   = 'Sauvegarde Auto';
	l10nStrings.savesLabelDelete = 'Effacer';
	l10nStrings.savesLabelExport = 'Enregistrer sur le disque\u2026';
	l10nStrings.savesLabelImport = 'Charger depuis le disque\u2026';
	l10nStrings.savesLabelLoad   = 'Charger';
	l10nStrings.savesLabelClear  = 'Effacer tout';
	l10nStrings.savesLabelSave   = 'Enregistrer';
	l10nStrings.savesLabelSlot   = 'Emplacement';
	l10nStrings.savesUnavailable = 'Aucun emplacement de sauvegarde n\'a été trouvé\u2026';
	l10nStrings.savesUnknownDate = 'inconnu';

	/* Settings. */
	l10nStrings.settingsTitle = 'Préférences';
	l10nStrings.settingsOff   = 'Off';
	l10nStrings.settingsOn    = 'On';
	l10nStrings.settingsReset = 'Réinitialiser';

	/* Restart. */
	l10nStrings.restartTitle  = 'Recommencer';
	l10nStrings.restartPrompt = 'Êtes vous sûr(e) de vouloir recommencer ? Tous progrès non sauvegardés seront perdus.';

	/* Share. */
	l10nStrings.shareTitle = 'Connexion';

	/* Autoload. */
	l10nStrings.autoloadTitle  = 'Chargement Auto';
	l10nStrings.autoloadCancel = 'Aller au début';
	l10nStrings.autoloadOk     = 'Chargement d\'une sauvegarde automatique';
	l10nStrings.autoloadPrompt = 'Une sauvegarde automatique est disponible. La charger ou recommencer ?';

	/* Macros. */
	l10nStrings.macroBackText   = 'En arrière';
	l10nStrings.macroReturnText = 'Retour';

}
/* twine-user-script #8: "l10nString_ru.js" */

function changel10nStrings_ru () {
	
	/* General. */
	l10nStrings.identity = 'игры';
	l10nStrings.aborting = 'Идет отмена';
	l10nStrings.cancel   = 'Отменить';
	l10nStrings.close    = 'Закрыть';
	l10nStrings.ok       = 'ОК';

	/* Errors. */
	l10nStrings.errorTitle              = 'Ошибка';
	l10nStrings.errorToggle             = 'Режим просмотра ошибок';
	l10nStrings.errorNonexistentPassage = 'Параграф "{passage}" не существует'; // NOTE: `passage` is supplied locally
	l10nStrings.errorSaveMissingData    = 'в сохранении нет необходимых данных. Сохранение было повреждено или загружен неверный файл';
	l10nStrings.errorSaveIdMismatch     = 'сохранение от другой {identity}';

	/* Warnings. */
	l10nStrings._warningIntroLacking  = 'Приносим извинения! В вашем браузере отсутствуют либо выключены необходимые функции';
	l10nStrings._warningOutroDegraded = ', так что включен ограниченный режим. Вы можете продолжать, но кое-что может работать некорректно.';
	l10nStrings.warningNoWebStorage   = '{_warningIntroLacking} (Web Storage API){_warningOutroDegraded}';
	l10nStrings.warningDegraded       = '{_warningIntroLacking} (необходимые для {identity}){_warningOutroDegraded}';

	/* Debug bar. */
	l10nStrings.debugBarToggle      = 'Панель отладки';
	l10nStrings.debugBarNoWatches   = '\u2014 отсутствуют отслеживания \u2014';
	l10nStrings.debugBarAddWatch    = 'Добавить отслеживание';
	l10nStrings.debugBarDeleteWatch = 'Удалить отслеживание';
	l10nStrings.debugBarWatchAll    = 'Отслеживать все';
	l10nStrings.debugBarWatchNone   = 'Удалить все';
	l10nStrings.debugBarLabelAdd    = 'Добавить';
	l10nStrings.debugBarLabelWatch  = 'Отслеживать';
	l10nStrings.debugBarLabelTurn   = 'Ход'; // (noun) chance to act (in a game), moment, period
	l10nStrings.debugBarLabelViews  = 'Макросы';
	l10nStrings.debugBarViewsToggle = 'Панель отладки макросов';
	l10nStrings.debugBarWatchToggle = 'Панель отслеживания';

	/* UI bar. */
	l10nStrings.uiBarToggle   = 'Открыть/закрыть панель навигации';
	l10nStrings.uiBarBackward = 'Назад по истории {identity}';
	l10nStrings.uiBarForward  = 'Вперед по истории {identity}';
	l10nStrings.uiBarJumpto   = 'Перейти в определенную точку истории {identity}';

	/* Jump To. */
	l10nStrings.jumptoTitle       = 'Перейти на';
	l10nStrings.jumptoTurn        = 'Ход'; // (noun) chance to act (in a game), moment, period
	l10nStrings.jumptoUnavailable = 'В данный момент нет точек для перехода\u2026';

	/* Saves. */
	l10nStrings.savesTitle       = 'Сохранения';
	l10nStrings.savesDisallowed  = 'На этом параграфе сохранение запрещено.';
	l10nStrings.savesIncapable   = '{_warningIntroLacking}, так что сохранения невозможны в текущей сессии.';
	l10nStrings.savesLabelAuto   = 'Автосохранение';
	l10nStrings.savesLabelDelete = 'Удалить';
	l10nStrings.savesLabelExport = 'Сохранить на диск\u2026';
	l10nStrings.savesLabelImport = 'Загрузить с диска\u2026';
	l10nStrings.savesLabelLoad   = 'Загрузить';
	l10nStrings.savesLabelClear  = 'Удалить все';
	l10nStrings.savesLabelSave   = 'Сохранить';
	l10nStrings.savesLabelSlot   = 'Слот';
	l10nStrings.savesUnavailable = 'Слоты сохранения не обнаружены\u2026';
	l10nStrings.savesUnknownDate = 'неизвестно';

	/* Settings. */
	l10nStrings.settingsTitle = 'Настройки';
	l10nStrings.settingsOff   = 'Выкл.';
	l10nStrings.settingsOn    = 'Вкл.';
	l10nStrings.settingsReset = 'По умолчанию';

	/* Restart. */
	l10nStrings.restartTitle  = 'Начать сначала';
	l10nStrings.restartPrompt = 'Вы уверены, что хотите начать сначала? Несохраненный прогресс будет утерян.';

	/* Share. */
	l10nStrings.shareTitle = 'Связь';

	/* Autoload. */
	l10nStrings.autoloadTitle  = 'Автосохранение';
	l10nStrings.autoloadCancel = 'Начать сначала';
	l10nStrings.autoloadOk     = 'Загрузить сохранение';
	l10nStrings.autoloadPrompt = 'Найдено автосохранение. Загрузить его или начать сначала?';

	/* Macros. */
	l10nStrings.macroBackText   = 'Назад'; // (verb) rewind, revert
	l10nStrings.macroReturnText = 'Вернуться'; // (verb) go/send back
};
/* twine-user-script #9: "l10nString_ua.js" */

function changel10nStrings_ua () {
	
	/* General. */
	l10nStrings.identity = 'ігри';
	l10nStrings.aborting = 'Йде скасування';
	l10nStrings.cancel   = 'Скасувати';
	l10nStrings.close    = 'Закрити';
	l10nStrings.ok       = 'Згоден';

	/* Errors. */
	l10nStrings.errorTitle              = 'Помилка';
	l10nStrings.errorToggle             = 'Режим перегляду помилок';
	l10nStrings.errorNonexistentPassage = 'Параграф "{passage}" не існує'; // NOTE: `passage` is supplied locally
	l10nStrings.errorSaveMissingData    = 'в збереженні немає необхідних даних. Збереження було пошкоджено або завантажено невірний файл';
	l10nStrings.errorSaveIdMismatch     = 'збереження від іншої {identity}';


	/* Warnings. */
	l10nStrings._warningIntroLacking  = 'Вибачте! У вашому браузері відсутні або вимкнені необхідні функції';
	l10nStrings._warningOutroDegraded = ', тому включений обмежений режим. Ви можете продовжити, але щось може працювати некоректно.';
	l10nStrings.warningNoWebStorage   = '{_warningIntroLacking} (Web Storage API){_warningOutroDegraded}';
	l10nStrings.warningDegraded       = '{_warningIntroLacking} (необхідні для {identity}){_warningOutroDegraded}';


	/* Debug bar. */
	l10nStrings.debugBarToggle      = 'Панель налагодження';
	l10nStrings.debugBarNoWatches   = '\u2014 відсутні відстеження \u2014';
	l10nStrings.debugBarAddWatch    = 'Додати відстеження';
	l10nStrings.debugBarDeleteWatch = 'Видалити відстеження';
	l10nStrings.debugBarWatchAll    = 'Відстежувати всі';
	l10nStrings.debugBarWatchNone   = 'Видалити всі';
	l10nStrings.debugBarLabelAdd    = 'Додати';
	l10nStrings.debugBarLabelWatch  = 'Відстежувати';
	l10nStrings.debugBarLabelTurn   = 'Хід'; // (noun) chance to act (in a game), moment, period
	l10nStrings.debugBarLabelViews  = 'Макроси';
	l10nStrings.debugBarViewsToggle = 'Панель налагодження макросів';
	l10nStrings.debugBarWatchToggle = 'Панель відстеження';

	/* UI bar. */
	l10nStrings.uiBarToggle   = 'Відкрити/закрити панель навігації';
	l10nStrings.uiBarBackward = 'Назад по історії {identity}';
	l10nStrings.uiBarForward  = 'Вперед по історії {identity}';
	l10nStrings.uiBarJumpto   = 'Перейти в певну точку історії {identity}';


	/* Jump To. */
	l10nStrings.jumptoTitle       = 'Перейти на';
	l10nStrings.jumptoTurn        = 'Хід'; // (noun) chance to act (in a game), moment, period
	l10nStrings.jumptoUnavailable = 'На даний момент немає точок для переходу\u2026';


	/* Saves. */
	l10nStrings.savesTitle       = 'Збереження';
	l10nStrings.savesDisallowed  = 'На цьому параграфі збереження заборонено.';
	l10nStrings.savesIncapable   = '{_warningIntroLacking}, тому збереження неможливі в поточній сесії.';
	l10nStrings.savesLabelAuto   = 'Автозбереження';
	l10nStrings.savesLabelDelete = 'Видалити';
	l10nStrings.savesLabelExport = 'Зберегти на диск\u2026';
	l10nStrings.savesLabelImport = 'Завантажити з диска\u2026';
	l10nStrings.savesLabelLoad   = 'Завантажити';
	l10nStrings.savesLabelClear  = 'Видалити всі';
	l10nStrings.savesLabelSave   = 'Зберегти';
	l10nStrings.savesLabelSlot   = 'Слот';
	l10nStrings.savesUnavailable = 'Слоти збереження не виявлені\u2026';
	l10nStrings.savesUnknownDate = 'невідомо';

	/* Settings. */
	l10nStrings.settingsTitle = 'Налаштування';
	l10nStrings.settingsOff   = 'Вимк.';
	l10nStrings.settingsOn    = 'Вкл.';
	l10nStrings.settingsReset = 'За замовчуванням';

	/* Restart. */
	l10nStrings.restartTitle  = 'Почати спочатку';
	l10nStrings.restartPrompt = 'Ви впевнені, що хочете почати спочатку? Незбережений прогрес буде втрачено.';


	/* Share. */
	l10nStrings.shareTitle = 'Зв\'язок';

	/* Autoload. */
	l10nStrings.autoloadTitle  = 'Автозбереження';
	l10nStrings.autoloadCancel = 'Почати спочатку';
	l10nStrings.autoloadOk     = 'Завантажити збереження';
	l10nStrings.autoloadPrompt = 'Знайдено автозбереження. Завантажити його чи почати спочатку?';

	/* Macros. */
	l10nStrings.macroBackText   = 'Назад'; // (verb) rewind, revert
	l10nStrings.macroReturnText = 'Повернутися'; // (verb) go/send back
};
/* twine-user-script #10: "system_en.js" */

localization_system_text['en'] = {
    day_of_week_list: {
        1: 'Saintsday',
        2: 'Estreday',
        3: 'Appuday',
        4: 'Centerday',
        5: 'Quarday',
        6: 'Funtday',
        7: 'Pasaday'
    },
    month_list: {
        1: 'Iar', 
        2: 'Fronort',
        3: 'Mouhs',
        4: 'Aphrillis',
        5: 'Vauntemit',
        6: 'Juzenn',
        7: 'Juliah',
        8: 'Harvesthaul',
        9: 'Yellbehall',
        10: 'Redfall',
        11: 'Novetit',
        12: 'Valyx'
    },
    rarity_list: {
        1: 'Defective', 
        2: 'Junk', 
        3: 'Common', 
        4: 'Uncommon',
        5: 'Rare',
        6: 'Epic',
        7: 'Legendary',
        8: 'Artifact',
        9: 'Divine'
    },
    lang_list: {
        en: 'English',
        ua: 'Ukrainian',
        ru: 'Russian',
        fr: 'French'
    },
    dialog_style_list: {
        0: 'Classic',
        1: 'New' 
    },
    item_list: {
        dagger: 'Dagger',
        rondel: 'Rondel',
        stiletto: 'Stiletto',
        sword: 'Sword',
        helmet: 'Helmet',
        sabatons: 'Sabatons',
        health_potion: 'Health Potion',
        brooch: 'brooch',
        socks: 'socks',
        key: 'key'
    },
    kind_list: {
        goblin: 'Goblin',
        wolf: 'Wolf',
    },
    index: {
        'index_title_welcome': 'Welcome to the',
        'index_select_lang': 'Please select the language you would like to view information in.',
        'index_introduction_title': 'Short Introduction',
        'index_introduction_1': 'Our company "2caKe gems" is delighted that you have chosen to explore our product.',
        'index_introduction_2': 'We hope you\'ll enjoy your time with our game!',
        'index_game_details_title': 'Game Details',
        'index_game_details_1': 'We are committed to crafting immersive experiences that seamlessly blend innovative and classic mechanics.',
        'index_game_details_2': 'Thus, for a deeper understanding of certain aspects of the game, additional supporting information may prove beneficial.',
        'index_info_interface_text': 'To become familiar with the game\'s interactions aspects:',
        'index_info_project_text': 'To learn more about the company and plans for the future:',
        'index_to_disclaimer_title': 'Getting Started',
        'index_to_disclaimer_1': 'Prior to starting the game, players must agree to certain official terms and conditions.'
    },
    info_disclaimer: {
        'disclaimer_general_title': 'Disclaimer',
        'disclaimer_general_1': 'Please read the following disclaimer carefully before proceeding with the game. ',
        'disclaimer_general_2': 'This game contains adult themes and may not be suitable for individuals under the legal age of your country. ',
        'disclaimer_age_title': 'Age Verification',
        'disclaimer_age_1': 'All characters depicted in this game are of the legal age as determined by your country.',
        'disclaimer_age_2': 'If you are below the legal age, you are prohibited from playing this game.',
        'disclaimer_matches_title': 'Coincidental Matches',
        'disclaimer_matches_1': 'Any resemblance to real persons, organizations, or copyrighted materials within this game is purely accidental. ',
        'disclaimer_matches_2': 'The game developers have made every effort to avoid intentional infringement.',
        'disclaimer_nonencourage_title': 'Non-Encouragement',
        'disclaimer_nonencourage_1': 'The content of this game is intended for entertainment purposes only and does not encourage or endorse any actions or behaviors depicted within. ',
        'disclaimer_nonencourage_2': 'The game developers bear no responsibility for any actions taken by players outside of the game.',
        'disclaimer_violent_title': 'Violent Scenes',
        'disclaimer_violent_1': 'Some scenes within this game may contain depictions of violence. ',
        'disclaimer_violent_2': 'Viewer discretion is advised, and player discretion is recommended.',
        'disclaimer_violent_3': 'If you are sensitive to such content, it is advised not to proceed.',
        'disclaimer_assets_title': 'Game Development and Assets',
        'disclaimer_assets_1': 'This game is currently in development and for now may utilize handmade and free third-party assets found on the internet. ',
        'disclaimer_assets_2': 'The game is provided on an "as is" basis.',
        'disclaimer_assets_3': 'The game developers make no representations or warranties of any kind, express or implied, regarding the accuracy, reliability, or completeness of the content within the game.',
        'disclaimer_assets_4': 'The developers disclaim any responsibility for errors or omissions in the game\'s content.',
        'disclaimer_assets_5': 'If you find content that violates legally registered rights, please contact us.',
        'disclaimer_commercial_title': 'Non-Commercial Basis',
        'disclaimer_commercial_1': 'This game is offered free of charge and has a non-commercial basis. ',
        'disclaimer_commercial_2': 'Any donations made and participation in beta testing, whether paid or unpaid, are strictly voluntary.',
        'disclaimer_to_players_title': 'To the Players',
        'disclaimer_to_players_1': 'Our game may undergo many changes during the development process and your feedback is crucial to the project\'s general improvement.',
        'disclaimer_to_players_2': 'We welcome testers, developers, text editors, translators, artists, designers, advanced AI users and any enthusiasts alike to enhance the game\'s interface and content. ',
        'disclaimer_to_players_3': 'Your participation is voluntary and we appreciate any contributions you choose to make.',
        'disclaimer_to_players_4': 'Thank you in advance for being part of our gaming community! :)',        
        'disclaimer_end_1': 'By clicking "Accept and proceed", you confirm that you acknowledge and agree to the terms and conditions set forth in this disclaimer.',
        'disclaimer_end_2': 'You understand that the game contains adult themes and may not be suitable for all audiences. ',
        'disclaimer_end_3': 'If you do not agree with any part of this disclaimer or are not of legal age in your country, please refrain from playing the game.'
    },
    info_interface: {
        'menu_item_1': 'Main Info',
        'menu_item_2': 'Location details',
        'menu_item_3': 'Quest & Tasks',
        'menu_item_4': 'Sketch system',
        'menu_item_5': 'Tips, popups and modal windows',
        'menu_item_6': 'Sidebar Info',
        'info_main_list_1': 'Game Systems',
        'info_main_list_2': 'The game uses several various systems.',
        'info_main_list_3': 'Those systems are:',
        'info_main_list_item_1': 'location details, activities and scheduling',
        'info_main_list_item_2': 'quest & tasks',
        'info_main_list_item_3': 'sketches(dialogs and narration)',
        'info_main_list_item_4': 'inventory',
        'info_main_list_item_5': 'fighting',
        'info_main_list_item_6': 'events',
        'info_main_list_item_7': 'tryouts (mini-games)',
        'info_main_list_item_8': 'system localization',
        'info_main_list_item_9': 'tips, popups and modal windows',
        'info_main_list_item_10': 'sidebar info',
        'info_main_list_item_status_1': '[will be updated]',
        'info_main_list_item_status_2': '[basically done]',
        'info_main_list_item_status_3': '[in future]',
        'info_main_list_item_status_4': '[will be reworked]',
        'info_main_list_item_status_5': '[need global testing]',
        'info_location_1': 'Location-Specific Details',
        'info_location_2': 'In the game, the player navigates through various locations.',
        'info_location_3': 'Each location is associated with its own image.',
        'info_location_4': 'Directly beneath the location images, the player can find green buttons featuring a "pin" icon. <br> These buttons act as links connecting different locations.',
        'info_location_character_interaction_title': 'Interactions with characters:',
        'info_location_character_interaction_1': 'Based on the scheduling system, certain characters may be present in specific locations during specific time.',
        'info_location_character_interaction_2': 'If a character isn\'t currently in the player\'s party and isn\'t engaged in a talk with the player, then character is occupied with their own activities.',
        'info_location_character_interaction_3': 'Some characters\'s activities cannot be interrupted. In such cases the player needs to wait until the character finishes the activity and becomes available for interaction.',
        'info_location_character_interaction_4': 'Some characters have lesser significance in terms of the overall story.',
        'info_location_character_interaction_5': 'They could have a narrower range of possible interaction types and fewer interactions in total.',
        'info_location_character_interaction_6': 'For now, in order to highlight the more important characters and clean the screen space, they have another style of their interaction links.',        
        'info_location_activities_title': 'Location activities:',
        'info_location_activities_1': 'Specific locations may offer a distinct set of activities, such as "Wait" or "Sleep".',
        'info_location_activities_2': 'Activities primarily serve to enhance played character stats.',
        'info_location_activities_3': '(Eg., choosing to "rest" increases the "stamina" parameter value, but also consumes some time.)',
        'info_location_activities_4': 'Activities have availability conditions.',
        'info_location_activities_5': '(Eg., if character "stamina" value is already high, player cannot choose to "take a nap".)',
        'info_location_activities_6': 'As the storyline progresses, new activities may become available within certain locations.',      
        'info_location_mirror_space_title': 'Mirror space:',
        'info_location_mirror_space_1': 'In certain locations, there may be a special link accompanied by a mirror icon. ',
        'info_location_mirror_space_2': 'This link serves as a passage to a mirror space.',
        'info_location_mirror_space_3': 'In the mirror space, players delve into the thoughts of the main character.',
        'info_location_mirror_space_4': 'Here, players can gain insights into the current intents of the main character, receive tips on the progression of the story, and obtain quests, among other things.',
        'info_location_mirror_space_5': '(Eg., can check why the main character is hesitant to leave the village and venture into other locations.)',        
        'info_qt_1': 'Quests and tasks',
        'info_qt_2': 'Quest can be activated by clicking on the quest button.',
        'info_qt_3': 'After activating a quest a set of tasks is being activated.',
        'info_qt_4': 'A quest can consist of multiple sets of tasks, presented one after another.',
        'info_qt_5': '(Eg., the first set - talk to the alchemist and request a special power potion [1 task],',
        'info_qt_6': 'the second set - the player needs to collect green flowers and collect red flowers [2 tasks],',
        'info_qt_7': 'the third set - the player should talk to the alchemist, who will then give a brewed special potion [1 task],',
        'info_qt_8': 'the fourth set - defeat the hobgoblin in the forest cave (that potion will help to do it) [1 task].)',
        'info_qt_button': 'Quest Title',        
        'info_qt_tasks_title': 'Tasks:',
        'info_qt_tasks_1_1': 'Certain types of tasks ',
        'info_qt_tasks_1_2': '["fight", "search", "distribute", "gather", "sketch"]',
        'info_qt_tasks_1_3': 'can be carried out in specific task-related locations.',
        'info_qt_tasks_2': 'Task can be activated by clicking on the task button.',
        'info_qt_tasks_3': 'Some tasks could have conditions to be done.',
        'info_qt_tasks_4': 'Certain tasks may require multiple actions to be completed.',
        'info_qt_tasks_5': '(Eg., to search three times on a specific location) ',
        'info_qt_tasks_6_1': 'Other task types like ',
        'info_qt_tasks_6_2': '(["eliminate", "escort"]) ',
        'info_qt_tasks_6_3': 'are completed through player actions.',
        'info_qt_tasks_7': '(Eg., an "eliminate 3 goblins" task can be completed by encountering goblins in their usual locations and defeating them or by defeating them during other tasks that involve fighting goblins. ) ',
        'info_qt_tasks_8': 'Player can find details about the current quests and tasks in the questlog. (After it will be implemented).',
        'info_qt_tasks_button': 'Fight goblins',
        'info_qt_mark_title': 'Quest marks for links:',
        'info_qt_mark_1': 'If there\'s a new quest available in the mirror space, the mirror space link will be highlighted with a quest mark.',
        'info_qt_mark_2_1': 'For more info about the mirror space - ',
        'info_qt_mark_2_2': 'check the locations tab ',
        'info_qt_mark_3': 'Here, players can explore the main character\'s current thoughts and can initiate associated quests at their discretion.',
        'info_qt_mark_4': 'The same approach is also employed when interacting with characters.',
        'info_sketch_1': 'Sketch system',
        'info_sketch_2': 'A "Sketch" serves as a unit to include dialogs, narrative content, associated media and selectable choices that fit the context of the page.',
        'info_sketch_3': 'These sketches can vary in size, the number of pages they contain, and the quantity of available choices.',
        'info_sketch_4': 'Some of sketch components may be hidden due to certain conditions, such as the player\'s stats, story progression, previous player choices and actions taken.',
        'info_sketch_5': '(Eg., during a specific quest\'s sketch dialogue, if the player has a character named Smith in their party, ',
        'info_sketch_5_1': 'then blocks of dialogue featuring Smith\'s perspective on the situation might appear, along with a new choice offering ways to resolve that situation using Smith\'s unique abilities.  ',
        'info_sketch_5_2': 'If the player doesn\'t have Smith in their party, those blocks would be hidden.)',
        'info_sketch_6': 'Narration text block types examples:',
        'info_sketch_text_narration': 'The story narration text provides a description of the unfolding events.',
        'info_sketch_text_thought': 'The inner thoughts and reflections of the character currently controlled.',
        'info_sketch_text_gesture': 'Description of emotions and gestures shown by other characters the scene.',
        'info_sketch_7': 'Dialog block example:',
        'info_sketch_8': 'Choice blocks examples:',
        'info_sketch_choice_default': 'Default continue link',
        'info_sketch_choice_deadend': 'Dead-end continue link',
        'info_sketch_choice_location': 'Location continue link',
        'info_sketch_9': 'There are few types of choice blocks that player could see. ',
        'info_sketch_10': 'The player may click on one of such links to choose between different options and proceed further in the story.',
        'info_sketch_11': 'Such links will lead to a dead-end sequence with game over at the end of it.',
        'info_sketch_12': 'However, an autosave will be triggered upon clicking the dead-end link, allowing players to load the choice page again.',
        'info_sketch_13': 'Dead-ends often provide more insights into the game\'s lore, characters\' personalities and their goals.',
        'info_sketch_14': 'Exploring them is recommended!',
        'info_sketch_15': 'Location link displays that by clicking it, player will move to a different in-game location.',
        'info_sketch_16': 'Quest links inside a sketch display quests that can only be started during displaying that sketch.',
        'info_sketch_17': 'Be aware that some sketches may be one-time only and and can no longer be initiated if skipped.',
        'info_tips_title': 'Tips, popups and modal windows.',
        'info_tips_popup_title': 'Popups:',
        'info_tips_popup_1': 'Within the game, players may encounter various information popups triggered by in-game actions.',
        'info_tips_popup_2': 'These popups typically fall into two categories: quest-specific and task-specific.',
        'info_tips_popup_3': '(Eg., when a player initiates a quest or fails it).',
        'info_tips_popup_4': 'In addition to textual information about triggered actions, the popups also feature categorized icons.',
        'info_tips_popup_5': 'These icons are unique and visually indicate the type of action that has been initiated.',
        'info_tips_popup_6': 'Over time, these icons will become familiar, helping players to quickly identify the nature of the action with less effort.',
        'info_tips_modals_title': 'Modal windows:',
        'info_tips_modals_1': 'The game also features such helping blocks as modal windows, which are primarily used for two purposes:',
        'info_tips_modals_2': 'to confirm specific one-time actions or to provide additional but important details.',
        'info_tips_game_clues_title': 'Game clues:',
        'info_tips_game_clues_1': 'Game clue is a special version of a modal window.',
        'info_tips_game_clues_2': 'It appears after a player leaves browser tab with a game for specific duration, currently set at 20 seconds.',
        'info_tips_game_clues_3': 'This feature presents a randomly selected tip about gameplay mechanics, interface details or encourages players to visit the game\'s social platforms.',
        'info_tips_game_clues_4': 'The idea is to provide additional insights and information, akin to loading screen tips in other games.',
        'info_tips_game_clues_5': 'This notification can turned off in the settings menu.',
        'info_tips_info_tips_title': 'Additional info tips:',
        'info_tips_info_tips_1': 'Players may see a "info tip" represented by an icon.',
        'info_tips_info_tips_2': 'Players can access detailed information by hovering their mouse cursor over this icon.',
        'info_tips_info_tips_3': 'These tips offer valuable insights and guidance to enhance gameplay experience.',        
        'info_tips_thelpers_title': 'Title helpers:',
        'info_tips_thelpers_1': 'To enhance user experience and ensure a clear understanding of system elements, title helpers are employed.',
        'info_tips_thelpers_2': 'They provide additional explanations for different parts of the interface, appearing upon hovering over specific elements.',
        'info_sidebar_1': 'Sidebar Info',
        'info_sidebar_2': 'This block displays the title and logo of the game.',
        'info_sidebar_3': 'A bit lower, there is a block that shows in-game time values.',
        'info_sidebar_4': 'These bars represent the main stats of the playing character.',
        'info_sidebar_5': 'This bar tracks the playing character\'s experience and its progress.',
        'info_sidebar_6': 'Towards the bottom of the sidebar, there is the game company-author\'s signature and the current game version.'
    },
    info_project: {
        'menu_item_1': 'Main',
        'menu_item_2': 'About Company',
        'menu_item_3': 'About Project',
        'menu_item_4': 'Next Release',
        'info_main_list_1': 'Project Information',
        'info_main_list_2': 'The information is divided into sections for better readability.',
        'main_list_item_1': 'Information about the development company ',
        'main_list_item_2': 'Project plans and details',
        'main_list_item_3': 'Todo list for next release',
        'company_1': 'About the Company',
        'company_2': '"2caKe gems" is a game development studio founded by a passionate front-end developer and project manager known as "2caKe", living in Ukraine.',
        'company_3': 'Specializing in creating indie RPG games, the company\'s focus is on crafting immersive experiences that blend innovative and classic mechanics.',
        'company_4': 'Prioritizing player feedback, "2caKe gems" is committed to listening to the community and incorporating their input into future releases.',
        'company_5': 'Although presently based in Ukraine, the studio remains open to expanding its reach and inviting team members from different parts of the world.',
        'company_6': 'While currently working with the Twine engine and SugarCube story format, company is open to exploring other game engines in the future to further refine its vision and reach a broader audience.',
        'project_1': 'About the Project',
        'project_2': 'Current project is the first game of the studio to reach release.',
        'project_3': 'The project is planned to be an ambitious dark fantasy text-based adventure RPG game with turn-based combat.',
        'project_story_title': 'What is the story about?',
        'project_story_1': 'The story follows a young villager who appears right on cue to be immersed into the midst of global events in a fantasy world.',
        'project_story_2': 'Various exciting adventures and heartfelt misadventures await him, enticing players to come along for the journey.',
        'project_structure_title': 'Game structure',
        'project_structure_1': 'The game is planned to be divided into several relative chapters.',
        'project_structure_2': 'Each chapter should be a borderline for opening more content.',
        'project_structure_3': '(Like, more available locations, new characters, quests, activities, etc.)',
        'project_structure_4': 'Players can reach new chapters by progressing with the main quests line.',
        'project_distribution_title': 'Version Distribution',
        'project_distribution_1': 'The project will be distributed through releases.',
        'project_distribution_2': 'Releases are not connected to the chapters of the game.',
        'project_distribution_3': 'Release usually would consist of:',
        'project_distribution_3_1': 'The main functionality of the release, after which the release will be named (e.g., "Quests & Tasks" for the 2nd release)',
        'project_distribution_3_2': 'Additional functionality implementations',
        'project_distribution_3_3': 'New content additions (eg., quest, tasks, locations, characters, etc.)',
        'project_distribution_3_4': 'Bugfixes and correction',
        'project_distribution_3_5': '\'Dark side of the moon\' work - tasks that are irrevocable, but invisible to players (eg., testing, administrating, supporting, planning, etc.)',
        'project_distribution_4': 'Approximate list of next releases:',
        'project_distribution_4_0': '2nd - "Quests & Tasks"',
        'project_distribution_4_1': '3rd - "Locations & Characters"',
        'project_distribution_4_2': '4th - "Diary & Sidebar Menu"',
        'project_distribution_4_3': '5th - "Items & Stores"',
        'project_distribution_4_4': '6th - "Fighting"',
        'project_tags_title': 'About game tags',
        'project_tags_1': 'Tags currently relevant:',
        'project_tags_2': 'Male protagonist, Text-based, Fantasy',
        'project_tags_3': 'Tags to be added based on the future plan:',
        'project_tags_4': 'Adventure, Combat, Monster, Romance, Rpg, Sandbox, Turn based combat',
        'project_tags_5': 'Tags possibly present in the future:',
        'project_tags_6': 'Graphic violence, Humor, Management, Point & Click, Possession, Transformation',
        'next_release_1': 'Next Release', 
        'next_release_2': 'What is planned for the next release:',       
        'next_release_2_1': 'Finalizing functionality for quests & tasks.',   
        'next_release_2_2': 'Refactoring current code to enhance flexibility for further versioning supporting.',  
        'next_release_2_3': 'Reworking XP system.',  
        'next_release_2_4': 'Adding new content updates (characters, locations, quests, activities, etc.).',  
        'next_release_2_5': 'Adding new text updates (dialogs, descriptions, tips, etc.).',      
        'next_release_2_6': 'Updating Interface.',      
        'next_release_2_7': 'Regular supporting tasks (testing, corrections, bugfixing, localization etc.).',      
        'next_release_2_8': 'Administrating tasks (managing documentation, performing researches for optimizations, planning new functional structuring, etc.).',      
        'next_release_3': 'The full list of tasks planned for implementation in the next release can be found in the studio\'s',       
        'next_release_4': '(Certain changes may be made to the plan during the process)'       
    },
    info_story: {
        'info_story_title': 'THE JOURNEY BEGINS...',
        'info_story_1': 'In a world filled with magic, demons, monsters and elves, our tale starts in a quaint village known as Elmdale.',
        'info_story_2': 'Elmdale is one of the villages of the kingdom of Alderia.',
        'info_story_3': 'It\'s a peaceful place, nestled near a vast and mysterious forest that stretches far and wide.',
        'info_story_4': 'Legend has it that long ago, humans and elves struck a pact to safeguard the deep woods, their mutual home.',
        'info_story_5': 'Together, they vowed to defend it against any outside threats.',
        'info_story_6': 'In return, ancient magic enveloped the nearby light forest, causing trees to grow swiftly and aiding in wood production.',        
        'info_story_7': 'Yet, for centuries, the villagers of Elmdale hadn\'t glimpsed an elf.',        
        'info_story_8': 'Representatives of this race, who concealed themselves with enchantments, remained hidden, leaving their existence to become the stuff of legends.',
        'info_story_9': 'Elmdale, although an average-sized village, flourished thanks to its distance from any turmoils of war.', 
        'info_story_10': 'In fact, it was considered to be one of the most tranquil places in the entire Alderia realm, and then perhaps even in whole world of Fanthira.',           
        'info_story_11_1': 'Even the impact of trespassers',                 
        'info_story_11_2': 'barely disrupted the village\'s way of life.',  
        'info_story_12': 'Our main character is not one of great renown or importance; he\'s just a young villager from a family of carpenters, known as the Wrights.',  
        'info_story_13': 'And so, our story unfolds with that young boy from Elmdale, as he becomes entangled in a world far more complex and perilous than one could have ever imagined.',         
        'info_story_name': 'His name is:',
        'info_story_wake_up': 'It\'s time to wake up in' ,
        'info_story_link_bedroom': 'Your bedroom',
        'info_skip_passage': 'Skip Passage'
    },
    setting: {
        'setting_select_name': 'Change name of the Main Character',
        'setting_lang': 'Language select', 
        'setting_dialog_style': 'Dialog view',
        'setting_return_notification': "Notifications on tab return",
        'setting_return_notification_btn': "Off/On",
    },
    sidebar: {
        'caption_lang': 'Current language',
        'caption_version': 'Version',
        'caption_name': 'Name',
        'caption_health': 'Health',
        'caption_stamina': 'Stamina',
        'caption_mana': 'Mana'
    },
    passages: {
        passage_info_interface: 'Interface and gameplay details',
        passage_info_project: 'Project Information',
        passage_info_disclaimer: 'Proceed to start the game',
        passage_info_disclaimer_refuse: 'Refuse',
        passage_info_disclaimer_accept: 'Accept and proceed',
        passage_menu_settings: 'Settings',
        passage_menu_inventory: 'Inventory',
        passage_menu_questlog: 'Questlog',
        passage_menu_party: 'Party',
        passage_menu_skill: 'Skills',
        passage_menu_info: 'Info',
        passage_menu_help: 'Help',
        passage_menu_debug: 'Debug',
        passage_home_mirror: 'Mirror',
        passage_home_mirror_return: 'Stop reflecting and return',
        passage_home_bedroom: 'Bedroom',
        passage_home_hallway: 'Hallway',
        passage_home_kitchen: 'Kitchen',
        passage_home_parents_room: 'Parents room',
        passage_home_yard: 'Yard',
        passage_home_yard_bath: 'Yard bath',
        passage_home_yard_toilet: 'Yard toilet',
        passage_home_yard__go_home: 'Go home',
        passage_home_yard__straight: 'Go straight to home',
        passage_dream: 'Sleep',
        passage_dream_out: 'Wake up',
        passage_village_shed: 'Shed',
        passage_village_stables: 'Horse stables',
        passage_village_kennels: 'Kennels',
        passage_village_west: 'Village West', 
        passage_village_east: 'Village East', 
        passage_village_center: 'Village Center', 
        passage_village_square: 'Village Square', 
        passage_village_church: 'Church',
        passage_village_church_godfrey_room: 'Godfrey room',
        passage_village_church_nun_room: 'Nuns room',
        passage_village_infirmary: 'Infirmary',
        passage_village_outside: 'Village Outside', 
        passage_village_store_smith: 'Check Smith store', 
        passage_village_store_mercer: 'Check Mercer store', 
        passage_village_tavern: 'Tavern', 
        passage_village_tavern_bedroom: 'Tavern bedroom', 
        passage_village_warders_entry: 'Warders entry',
        passage_village_warders_training_field: 'Training field',
        passage_village_warders_barracks: 'Warders Barracks',
        passage_village_outside_house_shikari: 'Mr.Shikari house',
        passage_village_outside_house_fisher: 'Mr.Fisher house',
        passage_village_outside_fields: 'Fields',
        passage_village_outside_meadow: 'Meadow',
        passage_village_outside_river: 'River',
        passage_village_outside_grazing: 'Grazing',  
        passage_village_outside_graveyard: 'Graveyard',    
        passage_elf_house_elder: 'Elder elf',
        passage_elf_house_herb: 'Herb house',
        passage_elf_house_bloodhound: 'Bloodhound house',
        passage_elf_village: 'Elf village',
        passage_elf_store_herb: 'Check Herb store',    
        passage_forest: 'Forest',
        passage_forest_lake: 'Lake',
        passage_forest_spring: 'Spring',
        passage_forest_swamp: 'Swamp',
        passage_forest_hut_witch: 'Witch hut',
        passage_forest_hut_witch_bedroom: 'Witch bedroom',
        passage_forest_edge: 'Forest edge',    
        passage_forest_deep: 'Deep forest', 
        passage_house_alura: 'Alura house', 
        passage_house_baxter: 'Bakery', 
        passage_house_ferryman: 'Ferryman house', 
        passage_house_mercer: 'Mercer mansion', 
        passage_house_ostler: 'Ms. Ostler house', 
        passage_house_smith: 'Smith house', 
        passage_house_steward: 'Village Head (Mr. Steward)', 
        passage_house_taylor: 'Ms. Taylor house', 
        passage_house_wizard: 'Wizard den', 
    },
    misc: {
        game_title: 'Fanthira Tales: wRight on cue',
        apply: 'Apply',
        accept: 'Accept', 
        cancel: 'Cancel',
        continue: 'Continue',
        return: 'Return',
        return_main: 'Main tab',   
        mirror_reflect: 'Reflect',
        mirror_room_text: 'Accessing half meditate state, you are now ready to dive into your issues and thoughts.',
        mirror_room_no_quest: 'I have nothing to think about right now.',
    },
    talk_menu: {
        chat: 'Chat',
        inventory: 'Inventory Management',
        train: 'Train',
        learn: 'Learn',
        stats: 'Check stats',
        talk_to: 'Talk',
        talk_to_cant: 'Cannot interact',
        is_here: 'is here',
        who_are_they: 'Who are they to you',
        think_of_you: 'Think of you as of',
        join_party: 'Add to party',
        leave_party: 'Remove from party', 
        join_escort: 'Start escorting mission',
        leave_escort_not_finish: 'Abandon escorting',
        leave_escort_finish: 'Complete escorting mission'
    },
    character_activities: {
        'cooking': 'Cooking',
        'cleaning': 'Cleaning',
        'reading_book': 'Reading a book',
        'resting': 'Resting',
        'sleeping': 'Sleeping',
        'eating': 'Eating',
        'studying': 'Studying',
        'working': 'Working',
        'bathing': 'Taking a bath',
        'swimming': 'Swimming',
        'sunbathing': 'Sunbathing',
        'training': 'Training',
        'shed_work': 'Working in the shed',
        'play_with_friends': 'Playing with friends',
        'play_wardrobe': 'Playing with her wardrobe',
        'mending': 'Mending',
        'stories_village': 'Listening to the villagers\' stories',
        'preparing_festival': 'Preparing for a festival',
        'daydreaming': 'Daydreaming',
        'teaching': 'Teaching',
        'study_spells': 'Studying spells',
        'reorganizing_store': 'Reorganizing store',
        'food_shopping': 'Food shopping', 
        'talking_with_customer': 'Talking with customer', 
        'work_on_orders': 'Work on orders',
        'smelting': 'Smelting',
        'crafting_tools': 'Crafting tools',
        'forging_weapon': 'Forging Weapon',        
        'learning_smith': 'Learning smithery',
        'assisting_forge': 'Assisting in the forge',
        'managing_finances': 'Managing Finances',
        'horseshoeing': 'Horseshoeing',
        'metalworking_demonstrations': 'Metalworking Demonstrations',
        'visiting_tailor': 'Visiting tailor',
        'talking_smith': 'Talking with Smith',
        'training_warder': 'Training with Warders',
        'hanging_out_alura': 'hanging out with Alura',
        'hanging_out_barret': 'hanging out with Barret',
        'work_on_fields': 'Work on fields',
        'q_return_brooch': 'Returning the brooch'
    },
    activities: {
        'rest': 'Rest',
        'nap': 'Nap',
        'sleep': 'Sleep',
        'wait': 'Wait',
        'eat': 'Eat',
        'drink': 'Drink',
        'bath': 'Bath',
        'swim': 'Swim',
        'work': 'Work',
        'clean': 'Clean'
    },
    activity_reasons: {
        'time': 'It`s not the right time for this.',
        'daily': 'You have already done that today.',
        'countdown': 'You did that recently, you need to wait some time before doing it again.',
        'stamina': 'You are not tired to have a rest.'
    },
    tasks: {
        'sketch': 'Start conversation about',
        'gather': 'Gather',
        'distribute': 'Distribute',
        'fight': 'Fight',
        'search': 'Search',
    }, 
    task_conditions: {
        'interact': 'Cannot interact right now',
        'gather': 'Cannot gather right now',
        'distribute': 'Cannot distribute right now',
        'fight': 'Cannot fight right now',
        'search': 'Stamina is not enough!',
    },
    deadend: {
        'you_died': 'You died',
        'load_autosave': 'Load Autosave',
        'select_save': 'Select Save',
        'restart_the_game': 'Restart the game',
        'desc_1': 'The course of your actions led to this unfortunate finale.',
        'desc_2': 'But perhaps with another chance, you might be able to change the fate that has befallen'
    },
    tips: {
        tip_name: 'You can change the main character\'s name anytime in the settings menu.',
        tip_example: 'You can see useful and explanation info.',
        tip_autosave: 'Autosaves are made before dead-end choices and during sleep.',
        tip_return_notification: `
        Enable or disable "Game Clue" notifications upon returning to the game tab. <br>
        If you switch from game tab to another tab or screen, then after certain time and once you return, 
        a notification with some game-related information will be shown. 
        `,
        tip_language_change: 'You will be able to change language in the settings menu.',
        tip_language_warning: 'Warning! <br> Translation for some languages may be incomplete or contain errors.',
        tip_info_in_help_menu: 'You will be able to review this information anytime in the "Help" menu.',
        tip_mc_name_change: 'Mostly used for updating MC name after language change.',
        tip_trespassers: `
        A significant mark on this world was made by travelers from other realms, now referred to as "trespassers". <br>
        This was primarily due to the two Interworld Crises that resulted from their actions and the subsequent establishment of international anti-trespasser laws. <br>
        These laws not only restrict the advancement of new technologies that are based on anything related to "trespassers", but also enforce regulations on the use of any legacy of "trespassers" more rigorously than even the most powerful and forbidden magical practices. <br> 
        Nonetheless, a few essential comforts crafted from ancient technologies and magic, that are an alternative to comforts introduced by trespassers, remain in common use. <br>
        Rumors suggest that the appearances of trespassers are increasing, hinting at a looming Third Interworld Crisis. Yet, such talk is often dismissed as the ramblings of the insane.
        `,
        tip_geoposition: `
        In the broader world of Fanthira, there are three continents. <br>
        Two, similar in size and close to each other, Eldertide and Neuboulan, while the third one - Isolara is smaller and remote. <br>
        The story unfolds in the kingdom of Alderia in the most human-populated of the continents, Neuboulan. <br>
        Currently Alderia finds itself in a state of tension, locked in a cold war with its eastern and north-eastern neighbor, the Imperia of Rakhmor — the largest country on the continent.<br>
        To the south, Elmdale's nearest neighbors belong to the Libarian Coalition, an alliance of small countries with vast differences but a united front against external threats.
        Some of these countries are so diminutive that they resemble large, fortified cities with multiple layers of defense separating their regions.<br>
        `,
        tip_location_blocked: 'Location is currently blocked.',
        tip_character_na: 'This character is currently unavailable.',
        tip_functionality_wip: 'Functionality is in development. <br> Will be added later on.',
        tip_functionality_wip_beta: 'Functionality is in development. <br> For now you can check beta version. <br> BUT BE AWARE THAT IT MAY BREAK THE GAME!! ',
        tip_functionality_tba: 'To be added. <br> This feature will be implemented in future. ',
        tip_leave_escort_not_finish: 'You are not on a correct location yet. Dispatching this character now will set the task a step back.',
        tip_already_chatted: 'You have already talked enough for now.'
    },
    thelper: {
        day_of_week: 'Current day of the week',
        month: 'Current month',
        time: 'Current time',
        day_of_month: 'Current day of month',
        money: 'Money',
        company_name: 'Developer\'s company name',
        narration: 'Narration text',
        thought: 'Playing character\'s thought',
        gesture: 'Character\'s gesture',
        quest_link: 'Start the quest',
        dead_end: 'This will lead to a dead-end sequence',
        refresh: 'Refresh',
        apply: 'All changes will be applied; you will remain on the page.',
        accept: 'All changes will be applied; you will return to the previous page.',
        talk__personal_question: 'Personal question',
        talk__chat: 'Simple talks about general things',
        talk__join: 'Character will join player\'s party',
        talk__leave: 'Character will leave player\'s party',
        talk__already_chatted: 'You\'ve talked enough for now',
        mirror: 'Check the mirror',
        location_blocked: 'Unavailable location',
        popup__health_low: 'Low health', 
        popup__stamina_low: 'Low stamina',
        popup__mana_low: 'Low mana',
        popup__stamina_not_enough: 'Not enough stamina',
        popup__task_created: 'New task',
        popup__add_party: 'Join party' ,
        popup__remove_party: 'Leave party',
        popup__quest_start: 'Quest started',
        popup__quest_complete: 'Quest completed',
        popup__quest_fail: 'Quest failed',
        popup__task_fail: 'Task failed',
        popup__quest_next_state: 'Quest moved to the next state',
        popup__task_gather: 'Task to gather',
        popup__task_escort_finished: 'Escort task finished',
        popup__task_escort_location: 'Escort character is on correct location',
        task_type__sketch: 'Sketch task',
        task_type__gather: 'Gather task',
        task_type__distribute: 'Distribute task',
        task_type__fight: 'Fight task',
        task_type__search: 'Search task',
        task_type__eliminate: 'Eliminate task',
        task_type__escort: 'Escort task',
        task_type__tryout: 'Tryout task',
        menu_tab__info_interface__menu_item_1: 'Main Info',
        menu_tab__info_interface__menu_item_2: 'Location details',
        menu_tab__info_interface__menu_item_3: 'Quest & Tasks',
        menu_tab__info_interface__menu_item_4: 'Sketch system',
        menu_tab__info_interface__menu_item_5: 'Tips, popups and modal windows',
        menu_tab__info_interface__menu_item_6: 'Sidebar Info',
        menu_tab__info_project__menu_item_1: 'Main',
        menu_tab__info_project__menu_item_2: 'About Company',
        menu_tab__info_project__menu_item_3: 'About Project',
        menu_tab__info_project__menu_item_4: 'Next Release',
    },
    modals: {
        no_valid_items_title: 'Not Valid',
        no_valid_items_1_1: 'You do not have enough',
        no_valid_items_1_2: 'items',
        no_valid_items_2_1: 'You have only',
        no_valid_items_2_2: 'out of',
        confirm_items_title: 'Confirmation',
        confirm_items_1: 'You will distribute the following items:',
        select_items_title: 'Select',        
        select_items_1_1: 'Select',
        select_items_1_2: 'items of type',
        select_items_1_3: 'to distribute:',
        show_clues_title: 'Game Clue',        
        modal_accept: 'Accept',
        modal_footer: 'Modal Footer',
    },
    game_clues: {
        clue_1_1: 'Try to speak more with characters!',
        clue_1_2: 'Some characters could share interesting and helpful information if your relationship is high enough.',
        clue_2_1: 'Find a bug or have a comment?',
        clue_2_2: 'Write to our discord channel! We will read, check and fix!',
        clue_3_1: 'Have ideas how to improve the game?',
        clue_3_2: 'We welcome everyone who is willing to help!',  
        clue_3_3: 'We require designers, artists, testers, text editors, translators, experienced AI arts creators, javascript developers and others who are willing to get involved!',
        clue_3_4: 'Join us to create an amazing product!',
        clue_4_1: 'Want to express your precious opinion about the current state of the game?',
        clue_4_2: 'Write to our discord channel! We appreciate any feedback about our work!',
    },
    popups: {
        health_low: 'Health is low!',
        stamina_low: 'Stamina is low!',
        mana_low: 'Mana is low!',
        stamina_not_enough: 'Stamina is not enough!',
        task_created: 'Task has been created!',
        add_party: 'has joined your party!',
        remove_party: 'had left your party!',
        quest_start: 'had been started!',
        quest_complete: 'had been completed!',
        quest_fail: 'had been failed!',
        quest_next_state_1: 'Tasks for Quest',
        quest_next_state_2: 'updated.',
        task_fail: 'had been failed!',
        task_gather: 'Gathered',
        task_escort_finished: 'has been escorted!',
        task_escort_location_1: 'You at the right location!',
        task_escort_location_2: 'You can leave',
        popup_quest: 'Quest',
        popup_task: 'Task',
    },
    socials: {
        link_to_discord: 'Link to our discord',
    },
    menu_help: {
        menu_help_info_interface_suggest: 'If the system doesn\'t work as you think it should, please check Interface guide. ',
        menu_help_info_interface_discord: 'If after reading it, there is still an issue that troubles you, please contact us via discord.'
    },    
    menu_party: {
        party_consists: 'Your current party consists of:',
        talk: 'Talk'
    }
    
}
/* twine-user-script #11: "system_fr.js" */

// Test version 
localization_system_text['fr'] = {
    day_of_week_list: {
        1: 'Saintsday',
        2: 'Estreday',
        3: 'Appuday',
        4: 'Centerday',
        5: 'Quarday',
        6: 'Funtday',
        7: 'Pasaday'
    },
    month_list: {
        1: 'Iar', 
        2: 'Fronort',
        3: 'Mouhs',
        4: 'Aphrillis',
        5: 'Vauntemit',
        6: 'Juzenn',
        7: 'Juliah',
        8: 'Harvesthaul',
        9: 'Yellbehall',
        10: 'Redfall',
        11: 'Novetit',
        12: 'Valyx'
    },
    rarity_list: {
        1: 'Défectueux',
        2: 'Corbeille',
        3: 'Régulier',
        4: 'Insolite',
        5: 'Écarté',
        6: 'Épique',
        7: 'Légendaire',
        8: 'Artefact',
        9: 'Divin'
    },
    lang_list: {
        en: 'Anglais',
        ua: 'Ukrainienne',
        ru: 'Russe',
        fr: 'Français'
    },
    dialog_style_list: {
        0: 'Classique',
        1: 'Nouveau' 
    },
    item_list: {
        dagger: 'Poignard',
        rondel: 'Rondelle',
        stiletto: 'Stiletto',
        sword: 'Épée',
        helmet: 'Casque',
        sabatons: 'Sabatons',

        brooch: 'Broche',
        socks: 'Chaussettes',
        key: 'Clé'
    },
    kind_list: {
        goblin: 'Gobelin',
        wolf: 'Loup',
    },
    index: {
        "index_temp": "Il y aurait une description du jeu ici...",
        "index_lang": "Sélection de la langue. (La langue peut être modifiée à tout moment sur la page des paramètres).",         
        'index_select_name': 'Veuillez sélectionner un nom pour Personnage Principal pour continuer',   
        
        
        'index_accept': 'Si vous confirmez que vous avez plus de 18 ans, appuyez sur \'Commencer le jeu\:',
        'index_start': 'Commencer le jeu',    
        
        
        'index_desc_01': 'C`est un monde fantastique avec de la magie, des démons, des elfes et d`autres éléments suffisants du monde fantastique.',
        'index_desc_02': 'Vous êtes ',
        'index_desc_03': 'Juste un jeune villageois.',
        'index_desc_04': 'Les impasses pourraient vous en dire plus sur la tradition du jeu, la nature et les objectifs du personnage.',
        'index_desc_end': 'Le soleil se lève et cela signifie que maintenant il est temps de' 
                 
    },
    setting: {
        'setting_select_name': 'You can change name for the Main Character',
        'setting_lang': 'Language select.', 
        'setting_dialog_style': 'You can choose variant of dialog blocks displaying.',
        'setting_return_notification': "Notifications on page return",
    },
    sidebar: {
        'caption_lang': 'Langue courante',
        'caption_version': 'Version',
        'caption_today': 'Aujourd\'hui est',
        'caption_name': 'Nom',
        'caption_money': 'Argent',
        'caption_coins': 'Las pièces',
        'caption_health': 'Santé',
        'caption_stamina': 'Résistance',
    },
    passages: {
        passage_menu_inventory: 'Inventaire',
        passage_menu_questlog: 'Journal de quête',
        passage_menu_party: 'Parti',
        passage_menu_skill: 'Skill',
        passage_menu_info: 'Info',
        passage_menu_help: 'Aide',
        passage_menu_debug: 'Déboguer',
        passage_start_description: 'Commencer le jeu',
        passage_start_description_wake_up: 'Réveillez-vous',

        passage_home_bedroom: 'Chambre',
        passage_home_hallway: 'Hallway',
        passage_home_kitchen: 'Cuisine',
        passage_home_parents_room: 'Chambre des parents',
        passage_home_yard: 'Сour',
        passage_home_yard_bath: 'Bain de cour',
        passage_home_yard_toilet: 'Toilette de cour',
        passage_home_yard__go_home: 'Rentrer chez soi',
        passage_home_yard__straight: 'Rentrez directement chez vous',
        passage_dream: 'Dormir',
        passage_dream_out: 'Réveillez-vous',

        passage_village_shed: 'L`appentis',
        passage_village_stables: 'Écuries pour chevaux',
        passage_village_kennels: 'Сhenil',
        passage_village_west: 'Village Ouest', 
        passage_village_east: 'Village Est', 
        passage_village_center: 'Village Centre', 
        passage_village_church: 'Église',
        passage_village_church_godfrey_room: 'Chambre Godfrey',
        passage_village_church_nun_room: 'Chambre des nonnes',
        passage_village_outside: 'Village l`extérieur', 
        passage_village_store_smith: 'Explorez la boutique de Smith', 
        passage_village_store_mercer: 'Explorez la boutique de Mercer', 
        passage_village_tavern: 'Taverne', 
        passage_village_tavern_bedroom: 'Tavern chambre', 
        passage_village_warders_entry: 'Entrée de Warders',
        passage_village_warders_training_field: 'Terrain de formation',
        passage_village_warders_barracks: 'Caserne des Warders',
        passage_village_outside_house_shikari: 'Manoir de M.Shikari',
        passage_village_outside_house_fisher: 'Manoir de M.Fisher',
        passage_village_outside_fields: 'Des champs',
        passage_village_outside_meadow: 'Prairies',
        passage_village_outside_river: 'Rivière',
        passage_village_outside_grazing: 'Pâturage',  
    
        passage_elf_house_elder: 'Elfe aîné',
        passage_elf_house_herb: 'Maison de Herb',
        passage_elf_house_bloodhound: 'Maison de Bloodhound',
        passage_elf_village: 'Village des elfes',
        passage_elf_store_herb: 'Explorez la boutique de Herb',
    
        passage_forest: 'Forêt',
        passage_forest_lake: 'Lac',
        passage_forest_spring: 'Source',
        passage_forest_swamp: 'Swamp',
        passage_forest_hut_witch: 'Cabane de la sorcière',
        passage_forest_hut_witch_bedroom: 'Chambre de la sorcière',
        passage_forest_edge: 'Lisière de la forêt',    
        passage_forest_deep: 'Forêt profonde', 

        passage_house_alura: 'Maison d`Alura', 
        passage_house_baxter: 'Boulangerie', 
        passage_house_ferryman: 'Maison de Ferryman', 
        passage_house_mercer: 'Manoir de Mercers', 
        passage_house_ostler: 'Maison de Mlle Ostler', 
        passage_house_smith: 'Maison de Smith', 
        passage_house_steward: 'Chef de village (M. Steward)', 
        passage_house_taylor: 'Maison de Mlle Taylor', 
        passage_house_wizard: 'Repaire du magicien', 
    },
    misc: {
        apply: 'Appliquer',
        accept: 'Accepter et retourner', 
        talk_to: 'Parlez',
        is_here: 'est là',
        join_party: 'Rejoindre l`équipe',
        leave_party: 'Quitter l`équipe', 
        join_escort: 'Rejoindre \'escorte\'',
        leave_escort_not_finish: 'Laisser \'escorter\' (ne finira pas la tâche)',
        leave_escort_finish: 'Quittez \'escorte\' (Terminera la tâche \'escorte\')'
    },
    character_activities: {
        'cooking': 'Cuisine',
        'cleaning': 'Nettoie',
        'reading_book': 'Lit des livres',
        'sleeping': 'Dort',
        'eating': 'Mange',
        'studying': 'Étudie',
        'working': 'Travaille',
        'bathing': 'Prend un bain',
        'swimming': 'Nage',
        'sunbathing': 'Prend un bain de soleil',
        'training': 'S\'entraîne',
        'playing_with_friends': 'Joue avec des amis',
        'mending': 'Répare',
        'stories_village': 'Écoute des histoires de village',
        'preparing_festival': 'Se prépare pour un festival',
        'daydreaming': 'Rêvasse',
    },
    activities: {
        'rest': 'Rest',
        'nap': 'Lainer',
        'sleep': 'Dormir',
        'wait': 'Attendre',
        'eat': 'Manger',
        'drink': 'Boire',
        'bath': 'Prendre un bain',
        'swim': 'Nager',
        'gather': 'Rassembler',
        'fight': 'Combattre',
        'work': 'Travailler',
        'clean': 'Nettoyer'
    },
    tasks: {
        'interact': 'Interagir',
        'gather': 'Rassembler',
        'distribute': 'Distribuer',
        'fight': 'Combattre',
        'search': 'Rechercher',
    },
    tips: {
        tip_name: 'You can change main character`s name anytime in the settings menu.',
        tip_example: 'You can see usefull and explanational info.',
        tip_return_notification: 'Once you leave a browser tab with a game, a timer will start on. <br> If timer exceed certain amount of time, notification will be displayed within a tab with a game. ',
        tip_language_change: 'Language can be changed on the Setting page anytime.',
        tip_character_na: 'This character is currently unavailable.',
        tip_trespassers: `
        A significant mark on this world was made by travelers from other realms, now referred to as "trespassers." <br>
        This was primarily due to the two Interworld Crises that resulted from their actions and the subsequent establishment of international anti-trespasser laws. <br>
        These laws not only restrict the advancement of new technologies but also enforce regulations more rigorously than even the most powerful of magical practices. <br> 
        Nonetheless, a few essential comforts crafted from ancient technologies and magic, that are an alternative to comforts introduced by trespassers, remain in common use. <br>
        Rumors suggest that the appearances of trespassers are increasing, hinting at a looming Third Interworld Crisis. Yet, such talk is often dismissed as the ramblings of the insane.
        `,
        tip_geoposition: `
        In the broader world of Fanthira, there are three continents. <br>
        Two, similar in size and close to each other, Eldertide and Neuboulan, while the third one - Isolara is smaller and remote. <br>
        The story unfolds in the kingdom of Alderia in the most human-populated of the continents, Neuboulan. <br>
        Currently Alderia finds itself in a state of tension, locked in a cold war with its eastern and north-eastern neighbor, the Imperia of Rakhmor — the largest country on the continent.<br>
        To the south, Elmdale's nearest neighbors belong to the Libarian Coalition, an alliance of small countries with vast differences but a united front against external threats.
        Some of these countries are so diminutive that they resemble large, fortified cities with multiple layers of defense separating their regions.<br>
        `,
        tip_already_chatted: 'Vous avez déjà assez bavardé pour l\'instant.'
        
    }   
    
}
/* twine-user-script #12: "system_ru.js" */

// Test version 
localization_system_text['ru'] = {
    day_of_week_list: {
        1: 'Сейнтсдей',
        2: 'Эстердей',
        3: 'Апудей',
        4: 'Центрдей',
        5: 'Кварддей',
        6: 'Фантдей',
        7: 'Пасадей'
    },
    month_list: {
        1: 'Иян', 
        2: 'Фронорт',
        3: 'Моус',
        4: 'Африлис',
        5: 'Вонтемит',
        6: 'Джузенн',
        7: 'Джулиа',
        8: 'Харвестхол',
        9: 'Йелбихол',
        10: 'Редфол',
        11: 'Ноутит',
        12: 'Великс'
    },
    rarity_list: {
        1: 'Дефектвиный', 
        2: 'Мусорный', 
        3: 'Обычный', 
        4: 'Необычный',
        5: 'Редкий',
        6: 'Эпический',
        7: 'Легендарный',
        8: 'Артифакт',
        9: 'Божественный'
    },
    lang_list: {
        en: 'Английский',
        ua: 'Украинский',
        ru: 'Русский',
        fr: 'Французский'
    },
    dialog_style_list: {
        0: 'Классический',
        1: 'Новый' 
    },
    item_list: {
        dagger: 'Кинжал',
        rondel: 'Рондел',
        stiletto: 'Стилет',
        sword: 'Меч',
        helmet: 'Шлем',
        sabatons: 'Сабатоны',

        brooch: 'Брошь',
        socks: 'Носки',
        key: 'Ключ'
    },
    kind_list: {
        goblin: 'Гоблин',
        wolf: 'Волк',
    },
    index: {
        'index_temp': 'В дальнейшем здесь будет описание игры...',
        'index_lang': 'Выбор языка. (Язык можно поменять в меню Настройки в любое время).',
        'index_select_name': 'Пожалуйста, выберите имя для Главного Героя чтобы продолжить',
        'index_warning_1': 'Все персонажи легального возраста вашей страны. ',
        'index_warning_2': 'Все совпадения с реальными личностями и вещами под правами обладания - случайны. ',
        'index_warning_3': 'Игра никого ничего не призывает делать.',
        'index_warning_4': 'Некоторые сцены могут *в будущем* содержать сцены насилия.',
        'index_accept': 'Если вы подтверждаете, что вам больше 18 лет нажмите \'Начать игру\':',
        'index_start': 'Начать игру',            

        'index_desc_01': 'Это фэнтезийный мир с магией, демонами, эльфами и прочими достаточными элементами фэнтезийного мира..',
        'index_desc_02': 'Ты - ',
        'index_desc_03': 'Просто молодой сельский житель.',
        'index_desc_04': 'Тупики могут рассказать вам больше об истории игры, характере персонажей и целях.',
        'index_desc_end': 'Солнце встает, а это значит, что пора ' 
    },
    sidebar: {
        'caption_lang': 'Текущий язык',
        'caption_version': 'Версия',
        'caption_name': 'Имя',
        'caption_money': 'Деньги',
        'caption_health': 'Здоровье',
        'caption_stamina': 'Выносливость',
        'caption_mana': 'Мана'
    },
    passages: {
        passage_menu_inventory: 'Инвентарь',    
        passage_menu_questlog: 'Журнал Квестов',
        passage_menu_party: 'Партия',
        passage_menu_skill: 'Навыки',
        passage_menu_info: 'Инфо',
        passage_menu_help: 'Помощь',
        passage_menu_debug: 'Дебаг',
        passage_start_description: 'Начать игру',
        passage_start_description_wake_up: 'Просыпаться',

        passage_home_bedroom: 'Спальня',
        passage_home_hallway: 'Коридор',
        passage_home_kitchen: 'Кухня',
        passage_home_parents_room: 'Комната родителей',
        passage_home_yard: 'Двор',
        passage_home_yard_bath: 'Дворовая купальня',
        passage_home_yard_toilet: 'Дворовой туалет',
        passage_home_yard__go_home: 'Идти домой',
        passage_home_yard__straight: 'Идти прямиком домой',
        passage_dream: 'Спать',
        passage_dream_out: 'Проснуться',

        passage_village_shed: 'Сарай',
        passage_village_stables: 'Конюшни',
        passage_village_kennels: 'Псарня',
        passage_village_west: 'Деревни Запад', 
        passage_village_east: 'Деревни Восток', 
        passage_village_center: 'Деревни Центр', 
        passage_village_church: 'Церковь',
        passage_village_church_godfrey_room: 'Комната Годфри',
        passage_village_church_nun_room: 'Комната монахинь',
        passage_village_outside: 'Деревни Пределы', 
        passage_village_store_smith: 'Осмотреть магазин Смита', 
        passage_village_store_mercer: 'Осмотреть магазин Мерсера', 
        passage_village_tavern: 'Таверна', 
        passage_village_tavern_bedroom: 'Спальня таверны', 
        passage_village_warders_entry: 'Входная Вордеров',
        passage_village_warders_training_field: 'Тренировочное поле',
        passage_village_warders_barracks: 'Казармы Вордеров',
        passage_village_outside_house_shikari: 'Дом г-на.Шикари',
        passage_village_outside_house_fisher: 'Дом г-на.Фишера',
        passage_village_outside_fields: 'Поля',
        passage_village_outside_meadow: 'Луга',
        passage_village_outside_river: 'Река',
        passage_village_outside_grazing: 'Пастбище',  
    
        passage_elf_house_elder: 'Старший эльф',
        passage_elf_house_herb: 'Дом Герб',
        passage_elf_house_bloodhound: 'Дом Бладхаунда',
        passage_elf_village: 'Деревня эльфов',
        passage_elf_store_herb: 'Осмотреть магазин Герб',
    
        passage_forest: 'Лес',
        passage_forest_lake: 'Озеро',
        passage_forest_spring: 'Источник',
        passage_forest_swamp: 'Болото',
        passage_forest_hut_witch: 'Хижина Ведьмы',
        passage_forest_hut_witch_bedroom: 'Спальня Ведьмы',
        passage_forest_edge: 'Опушка леса',    
        passage_forest_deep: 'Глубокий лес', 

        passage_house_alura: 'Дом Алуры', 
        passage_house_baxter: 'Пекарня', 
        passage_house_ferryman: 'Дом Ферримена', 
        passage_house_mercer: 'Особняк Мерсеров', 
        passage_house_ostler: 'Дом г-жи Остлер', 
        passage_house_smith: 'Дом Смитов', 
        passage_house_steward: 'Староста деревни (г-н Стюард)', 
        passage_house_taylor: 'Дом г-жи Тейлор', 
        passage_house_wizard: 'Логово волшебника', 
    },
    misc: {
        apply: 'Применить',
        accept: 'Принять и вернуться', 
        talk_to: 'Поговорить',
        is_here: 'здесь',
        join_party: 'Присоеденить к отряду',
        leave_party: 'Покинуть отряд', 
        join_escort: 'Присоеденить в \'сопровождение\'',
        leave_escort_not_finish: 'Покинуть \'сопровождение\' (не завершит задание \'сопровождение\')',
        leave_escort_finish: 'Покинуть \'сопровождение\' (завершит задание \'сопровождение\')'
    },
    character_activities: {
        'cooking': 'Готовит',
        'cleaning': 'Убирает',
        'reading_book': 'Читает книги',
        'sleeping': 'Спит',
        'eating': 'Ест',
        'studying': 'Учиться',
        'working': 'Работает',
        'bathing': 'Купается',
        'swimming': 'Плавает',
        'sunbathing': 'Загорает',
        'training': 'Тренеруется',
        'playing_with_friends': 'Играет с друзьями',
        'mending': 'Чинит вещи',
        'stories_village': 'Слушает истории деревенских',
        'preparing_festival': 'Подготавливается к фестивалю',
        'daydreaming': 'Мечтает'
    },        
    activities: {
        'rest': 'Отдыхать',
        'nap': 'Вздремнуть',
        'sleep': 'Спать',
        'wait': 'Ждать',
        'eat': 'Есть',
        'drink': 'Пить',
        'bath': 'Купаться',
        'swim': 'Плавать',
        'gather': 'Собирать',
        'fight': 'Сражаться',
        'work': 'Работать',
        'clean': 'Убирать'
    },
    tasks: {
        'interact': 'Взаимодействовать',
        'gather': 'Собирать',
        'distribute': 'Доставить',
        'fight': 'Сражаться',
        'search': 'Искать',
    }
    
}
/* twine-user-script #13: "system_ua.js" */

localization_system_text['ua'] = {
    day_of_week_list: {
        1: 'Святень',
        2: 'Ефірок',
        3: 'Повторок',
        4: 'Средина',
        5: 'Четвернь',
        6: 'Веселениця',
        7: 'Прохода'
    },
    month_list: {
        1: 'Ярий', 
        2: 'Зимій',
        3: 'Матень',
        4: 'Квітій',
        5: 'Теплень',
        6: 'Джунень',
        7: 'Джулень',
        8: 'Врожаій',
        9: 'Жовень',
        10: 'Краснопад',
        11: 'Новень',
        12: 'Валень'
    },
    rarity_list: {
        1: 'Дефектний', 
        2: 'Сміттєвий', 
        3: 'Звичайний', 
        4: 'Незвичайний',
        5: 'Рідкісний',
        6: 'Епічний',
        7: 'Легендарний',
        8: 'Артефакт',
        9: 'Божественний'
    },
    lang_list: {
        en: 'Англійська',
        ua: 'Українська',
        ru: 'Російська',
        fr: 'Французька'
    },
    dialog_style_list: {
        0: 'Класичний',
        1: 'Новий' 
    },
    item_list: {
        dagger: 'Кинджал',
        rondel: 'Рондель',
        stiletto: 'Стилет',
        sword: 'Меч',
        helmet: 'Шолом',
        sabatons: 'Сабатони',
        health_potion: 'Зілля здоров\'я',
        brooch: 'брошка',
        socks: 'шкарпетки',
        key: 'ключ'
    },
    kind_list: {
        goblin: 'Гоблін',
        wolf: 'Вовк',
    },
    index: {
        'index_title_welcome': 'Ласкаво просимо до гри',
        'index_select_lang': 'Будь ласка, виберіть мову, якою ви хочете бачити інформацію.',
        'index_introduction_title': 'Короткий вступ',
        'index_introduction_1': 'Наша компанія «2caKe gems» рада, що ви вирішили ознайомитися з нашим продуктом.',
        'index_introduction_2': 'Ми сподіваємося, що ви отримаєте задоволення від часу, проведеного за нашою грою!',
        'index_game_details_title': 'Деталі гри',
        'index_game_details_1': 'Ми прагнемо створити та передати імерсивний досвід через поєднання інноваційних та класичних механік.',
        'index_game_details_2': 'Тому, для глибшого розуміння певних аспектів гри може бути корисною додаткова допоміжна інформація.',        
        'index_info_interface_text': 'Ознайомитися з аспектами взаємодії у грі:',
        'index_info_project_text': 'Дізнатися більше про компанію та плани на майбутнє:',
        'index_to_disclaimer_title': 'Як почати гру',
        'index_to_disclaimer_1': 'Гравці повинні прийняти певні офіційні положення та умови, щоб розпочати гру.'
    },
    info_disclaimer: {
        'disclaimer_general_title': 'Дисклеймер',
        'disclaimer_general_1': 'Будь ласка, уважно прочитайте наступні застереження, перш ніж перейти до гри.',
        'disclaimer_general_2': 'Ця гра містить дорослі теми і може не підходити для осіб, які не досягли повноліття відповідно до законів вашої країни ',
        'disclaimer_age_title': 'Верифікація віку',
        'disclaimer_age_1': 'Усі персонажі, зображені в цій грі, є повнолітніми згідно з законами вашої країни.',
        'disclaimer_age_2': 'Якщо ви не досягли повноліття відповідно до законів вашої країни, вам заборонено грати в цю гру.',
        'disclaimer_matches_title': 'Випадкові збіг',
        'disclaimer_matches_1': 'Будь-який збіг з реальними особами, організаціями або матеріалами, що захищені авторськими правами, в цій грі є випадковим. ',
        'disclaimer_matches_2': 'Розробники гри зробили все можливе, щоб уникнути навмисного порушення прав.',
        'disclaimer_nonencourage_title': 'Незаохочення',
        'disclaimer_nonencourage_1': 'Вміст цієї гри призначений лише для розважальних цілей, не заохочує та не схвалює будь-які дії чи поведінку, зображені в грі. ',
        'disclaimer_nonencourage_2': 'Розробники гри не несуть відповідальності за будь-які дії гравців поза межами гри.',
        'disclaimer_violent_title': 'Сцени насильства',
        'disclaimer_violent_1': 'Деякі сцени в цій грі можуть містити зображення насильства.',
        'disclaimer_violent_2': 'Обережність з контентом глядачу та гравцю на власний розсуд.',
        'disclaimer_violent_3': 'Якщо ви чутливі до такого контенту, радимо не продовжувати.',
        'disclaimer_assets_title': 'Розробка гри та медіа ресурси',
        'disclaimer_assets_1': 'Ця гра знаходиться в стадії розробки і на даний момент може використовувати медіа ресурси виготовлені вручну, згенеровані або взяті з безкоштовні джерел, знайдених в Інтернеті. ',
        'disclaimer_assets_2': 'Гра надається на умовах "як є".',
        'disclaimer_assets_3': 'Розробники гри не надають жодних гарантій, явних чи неявних, щодо точності, надійності або повноти вмісту в грі.',
        'disclaimer_assets_4': 'Розробники відмовляються від будь-якої відповідальності за помилки чи упущення у контенті гри.',
        'disclaimer_assets_5': 'Якщо ви знайшли контент, який порушує юридично зареєстровані права, зв\'яжіться з нами.',
        'disclaimer_commercial_title': 'Некомерційна основа',
        'disclaimer_commercial_1': 'Ця гра пропонується як безкоштовна і має некомерційну основу.',
        'disclaimer_commercial_2': 'Будь-які пожертви та участь у бета-тестуванні, оплачувані чи безкоштовні, є цілковито добровільними.',
        'disclaimer_to_players_title': 'Гравцям',
        'disclaimer_to_players_1': 'Наша гра може зазнати багатьох змін у процесі розробки, і ваш відгук є важливим для загального вдосконалення проекту.',
        'disclaimer_to_players_2': 'Ми щиро вітаємо тестувальників, розробників, редакторів тексту, перекладачів, художників, дизайнерів, продвинутих користувачів штучного інтелекту та будь-яких ентузіастів, які можуть допомогти покращити інтерфейс та контент гри. ',
        'disclaimer_to_players_3': 'Ваша участь є добровільною, і ми цінуємо будь-який внесок, який ви вирішите зробити.',
        'disclaimer_to_players_4': 'Заздалегідь дякуємо за те, що ви є частиною нашої ігрової спільноти! :)',
        'disclaimer_end_1': 'Натискаючи «Прийняти і продовжити», ви підтверджуєте, що визнаєте та погоджуєтеся з умовами, викладеними в цьому дисклеймері.',
        'disclaimer_end_2': 'Ви розумієте, що гра містить дорослі теми та може підходити не для всіх аудиторій.',
        'disclaimer_end_3': 'Якщо ви не згодні з будь-яким застереженням у цьому дисклеймері або не досягли повноліття за мірками вашої країни, будь ласка, утримайтеся від гри.',
    },
    info_interface: {
        'menu_item_1': 'Основна інформація',
        'menu_item_2': 'Деталі локацій',
        'menu_item_3': 'Квести та завдання',
        'menu_item_4': 'Система cкечтів',
        'menu_item_5': 'Підказки, спливаючі та модальні вікна',
        'menu_item_6': 'Інформація бокової панелі',
        'info_main_list_1': 'Системи у грі',
        'info_main_list_2': 'Гра використовує декілька різних систем.',
        'info_main_list_3': 'Ці системи включають:',
        'info_main_list_item_1': 'деталі локацій, "діяльність" та "розклад"',
        'info_main_list_item_2': 'квести та завдання',
        'info_main_list_item_3': '"скетчі" (діалоги та наратив)',
        'info_main_list_item_4': 'інвентар',
        'info_main_list_item_5': '"битви"',
        'info_main_list_item_6': '"події"',
        'info_main_list_item_7': '"випробування" (міні-ігри)',
        'info_main_list_item_8': 'локалізаційну система',
        'info_main_list_item_9': 'підказки, спливаючі та модальні вікна',
        'info_main_list_item_10': 'інформація бокової панелі',
        'info_main_list_item_status_1': '[буде оновлено]',
        'info_main_list_item_status_2': '[загалом виконано]',
        'info_main_list_item_status_3': '[у майбутньому]',
        'info_main_list_item_status_4': '[буде перероблено]',
        'info_main_list_item_status_5': '[потребує глобального тестування]',  
        'info_location_1': 'Детально про локації',
        'info_location_2': 'У грі гравець переміщується через різні локації.',
        'info_location_3': 'Для кожної локації є власне зображенням.',
        'info_location_4': 'Прямо під зображеннями локації гравець може знайти зелені кнопки з іконкою "шпилька". <br> Ці кнопки діють як посилання, що з\'єднують різні локації.',
        'info_location_character_interaction_title': 'Взаємодія з персонажами:',
        'info_location_character_interaction_1': 'Згідно з системою "розкладу", деякі персонажі перебувають в певних локаціях в певний час.',
        'info_location_character_interaction_2': 'Якщо персонаж на даний момент не перебуває в групі гравця та не розмовляє з гравцем, то він зайнятий своїми власними справами.',
        'info_location_character_interaction_3': 'Деякі дії персонажів не можуть бути перервані. У таких випадках гравець повинен зачекати, доки персонаж завершить діяльність і стане доступним для взаємодії.',
        'info_location_character_interaction_4': 'Деякі персонажі мають менший вплив на загальний сюжет.',
        'info_location_character_interaction_5': 'У них може бути менший набір з типів можливої взаємодії та менше взагалі в цілому.',
        'info_location_character_interaction_6': 'Наразі, для виділення важливіших персонажів та звільнення місця на екрані, вони мають інший стиль своїх посилань на спосіб взаємодії.',
        'info_location_activities_title': '"Діяльність" в локаціях:',
        'info_location_activities_1': 'В окремих локаціях може бути доступний набір можливих "діяльностей", таких як "Очікувати" чи "Спати".',
        'info_location_activities_2': '"Діяльності" передусім призначені для покращення певних характеристик головного персонажа.',
        'info_location_activities_3': '(Наприклад, вибір "діяльності" "Відпочивати" підвищує значення параметра "витривалість", але також займає деякий час.)',
        'info_location_activities_4': '"Діяльності" мають умови для їх доступності.',
        'info_location_activities_5': '(Наприклад, якщо значення параметра "витривалість" персонажа вже високе, гравець не може вибрати "Подрімати")',
        'info_location_activities_6': 'З розвитком сюжету можуть стати доступними нові "діяльності" в певних локаціях.',
        'info_location_mirror_space_title': 'Дзеркальний простір:',
        'info_location_mirror_space_1': 'У деяких локаціях можна побачити спеціальне посилання з іконкою дзеркала.',
        'info_location_mirror_space_2': 'Це посилання слугує переходом до дзеркального простору.',
        'info_location_mirror_space_3': 'У дзеркальному просторі гравці можуть поглибитись у думки головного персонажа.',
        'info_location_mirror_space_4': 'Тут гравці можуть отримати уявлення про поточні наміри головного персонажа, здобути поради щодо розвитку сюжету та отримати квести, серед іншого.',
        'info_location_mirror_space_5': '(Наприклад, можна перевірити, чому головний герой не наважується залишити село та відправитися в інші локації.)',
        'info_qt_1': 'Квести та завдання',
        'info_qt_2': 'Квест можна активувати, натиснувши кнопку квесту.',
        'info_qt_3': 'Після активації квесту активується набір завдань, які відносяться до цього квесту',
        'info_qt_4': 'Квест може складатися з кількох таких наборів завдань, які активуються один після іншого.',
        'info_qt_5': '(Наприклад, перший набір - поговорити з алхіміком, запросивши особливе зілля сили [одне завдання],',
        'info_qt_6': 'другий набір - гравець повинен зібрати зелені квіти та червоні квіти [два завдання],',
        'info_qt_7': 'третій набір - гравець повинен поговорити з алхіміком, який віддасть зварене зілля [одне завдання],',
        'info_qt_8': 'четвертий набір - перемогти хобгобліна в печері в лісі (це зілля допоможе це зробити) [одне завдання].)',
        'info_qt_button': 'Назва квесту',
        'info_qt_tasks_title': 'Завдання:',
        'info_qt_tasks_1_1': 'Деякі типи завдань ',
        'info_qt_tasks_1_2': '["битва", "пошук", "доставка", "збір", "скетч"]',
        'info_qt_tasks_1_3': 'можна виконати в конкретних локаціях, пов\'язаних із завданням.',
        'info_qt_tasks_2': 'Завдання можна активувати, натиснувши кнопку завдань.',
        'info_qt_tasks_3': 'Деякі завдання можуть мати певні умови для їх виконання.',
        'info_qt_tasks_4': 'Деякі завдання можуть потребувати виконання кількох дій.',
        'info_qt_tasks_5': '(Наприклад, здійснити три раза пошук у конкретній локації) ',
        'info_qt_tasks_6_1': 'Інші типи завдань, такі як ',
        'info_qt_tasks_6_2': '(["знищення", "супровід"]) ',
        'info_qt_tasks_6_3': 'завершуються у результаті дій гравця.',
        'info_qt_tasks_7': '(Наприклад, завдання "знищити 3 гоблінів" можна виконати, зустрівши гоблінів у їх звичайних місцях перебування та перемігши їх, або здолавши їх під час інших завдань, що включають битву з гоблінами. ) ',
        'info_qt_tasks_8': 'Гравець може знайти деталі про поточні квести та завдання в журналі квестів. (Після того як цей функціонал буде реалізовано).',
        'info_qt_tasks_button': 'Битись з гоблінами',
        'info_qt_mark_title': 'Позначки квестів у посиланнях:',
        'info_qt_mark_1': 'Якщо у дзеркальному просторі доступний новий квест, посилання на дзеркальний простір буде підсвічуватися позначкою квесту.',
        'info_qt_mark_2_1': 'Для отримання більш докладної інформації про дзеркальний простір - ',
        'info_qt_mark_2_2': 'перевірте вкладку локацій ',
        'info_qt_mark_3': 'Тут гравці можуть досліджувати поточні думки головного героя та можуть ініціювати пов\'язані з цим квести за бажанням.',
        'info_qt_mark_4': 'Той самий підхід також використовується при взаємодії з персонажами.',
        'info_sketch_1': 'Система скетчів',
        'info_sketch_2': '"Скетч" слугує в якості одиниці контенту, який включає діалоги, наративний текст, опис емоцій, пов\'язані з цим медіа дані та варіанти вибору.',
        'info_sketch_3': 'Скетчі можуть відрізнятися за розміром, кількістю включених в нього сторінок та кількістю доступних варіантів вибору.',
        'info_sketch_4': 'Деякі компоненти скетчів можуть бути приховані через певні умови, такі як статистика гравця, розвиток сюжету, попередній вибори гравця та виконанні дії.',
        'info_sketch_5': '(Наприклад, під час діалогу певного квесту, якщо гравець має персонажа на ім\'я Сміт у своїй команді, ',
        'info_sketch_5_1': 'тоді можуть з\'явитися блоки діалогу, які показують погляд Сміта на ситуацію, разом із новим варіантом вибору, що пропонує новий шлях вирішення певної ситуації за допомогою унікальних здібностей Сміта.',
        'info_sketch_5_2': 'Якщо у гравця немає Сміта у своїй команді, то ці блоки будуть приховані.)',
        'info_sketch_6': 'Приклади блоків тексту наративу:',
        'info_sketch_text_narration': 'Текст наративу описує події, що розгортаються.',
        'info_sketch_text_thought': 'Внутрішні думки та роздуми персонажа, якого зараз контролюють.',
        'info_sketch_text_gesture': 'Опис емоцій та жестів, що показують інші персонажі.',
        'info_sketch_7': 'Приклад блоку діалогу:',
        'info_sketch_8': 'Приклади блоків варіантів вибору:',        
        'info_sketch_choice_default': 'Посилання звичайне продовження історії',
        'info_sketch_choice_deadend': 'Посилання до послідовності у глухий кут',
        'info_sketch_choice_location': 'Посилання на локацію',
        'info_sketch_9': 'Є кілька типів блоків вибору, які гравець може побачити.',
        'info_sketch_10': 'Гравець може натиснути на одне з таких посилань, щоб обрати між різними варіантами та продовжувати йти по історії.',        
        'info_sketch_11': 'Такі посилання призведуть до послідовності зі станом "гра закінчена" наприкінці.',
        'info_sketch_12': 'Проте, при натисканні на такі посилання, буде запущено автоматичне збереження, що дозволить гравцям знову завантажити сторінку перед вибором.',
        'info_sketch_13': 'Посилання до послідовності у глухий кут часто розкривають більше інформації про фольклор гри, особистості персонажів та їх цілі.',
        'info_sketch_14': 'Рекомендується їх досліджувати!',
        'info_sketch_15': 'Посилання на локацію показує, що при переході за ним гравець переміститься в іншу ігрову локацію.',
        'info_sketch_16': 'Посилання на квести, що знаходяться всередині скетчу відображають квести, які можна розпочати лише відображення саме цього скетчу.',
        'info_sketch_17': 'Майте на увазі, що деякі скетчі можуть бути разовими та більше не зможуть бути ініційовані, якщо їх пропустити.',
        'info_tips_title': 'Підказки, спливаючі повідомлення та модальні вікна.',
        'info_tips_popup_title': 'Спливаючі повідомлення:',
        'info_tips_popup_1': 'На протязі гри гравці можуть зустріти різноманітні спливаючі вікна з інформацією, які викликається певними діями.',
        'info_tips_popup_2': 'Ці спливаючі вікна зазвичай поділяються на дві категорії: для квестів та для завдань.',
        'info_tips_popup_3': '(Наприклад, коли гравець ініціює квест або провалює його).',
        'info_tips_popup_4': 'Крім текстової інформації про викликані дії, спливаючі повідомлення також містять категоризовані іконки.',
        'info_tips_popup_5': 'Ці іконки унікальні та візуально вказують на тип дії, яка була викликана.',
        'info_tips_popup_6': 'З часом гравці призвичаються до цих іконок і це стане допомагаючи їм швидше визначати тип викликаної дії.',
        'info_tips_modals_title': 'Модальні вікна:',
        'info_tips_modals_1': 'У грі також присутні такі допоміжні засоби, як модальні вікна, які використовуються в основному для двох цілей:',
        'info_tips_modals_2': 'для підтвердження специфічних одноразових дій або для надання додаткової, але важливої інформації.',
        'info_tips_game_clues_title': 'Ігрові підказки:',
        'info_tips_game_clues_1': 'Ігрові підказка - це особлива версія модального вікна.',
        'info_tips_game_clues_2': 'Вона з\'являється після того, як гравець полишає вкладку з грою на певний час, наразі цей час - 20 секунд.',
        'info_tips_game_clues_3': 'Ця функція презентує випадково вибрану пораду про механіки гри, деталі інтерфейсу або закликає гравців відвідати соціальні платформи гри.',
        'info_tips_game_clues_4': 'Ідея полягає в тому, щоб запропонувати додаткову інформацію для глибшого розуміння деталей гри, подібні підказки можна побачити у інших іграх під час екрану завантаження.',
        'info_tips_game_clues_5': 'Цю нотифікацію можна вимкнути в меню налаштувань.',
        'info_tips_info_tips_title': 'Підказки додаткової інформації:',
        'info_tips_info_tips_1': 'Гравці можуть пізнати "інфо підказку" у вигляді іконки.',
        'info_tips_info_tips_2': 'Гравці можуть отримати детальну інформацію, навівши курсор миші на цю іконку.',
        'info_tips_info_tips_3': 'Ці підказки пропонують цінну інформацію для покращення розуміння певних деталей гри та вказівки для покращення ігрового процесу.',
        'info_tips_thelpers_title': 'Допоміжні заголовки:',
        'info_tips_thelpers_1': 'Для покращення користувацького досвіду та забезпечення чіткого розуміння елементів системи використовуються допоміжні заголовки.',
        'info_tips_thelpers_2': 'Вони надають додаткові пояснення до різних частин інтерфейсу, з\'являючись при наведенні курсора на певні елементи.',
        'info_sidebar_1': 'Інформація бокової панелі',
        'info_sidebar_2': 'Цей блок показує назву та логотип гри.',
        'info_sidebar_3': 'Трохи нижче є блок, що відображає показники ігрового часу.',
        'info_sidebar_4': 'Ці індикатори демонструють основні характеристики головного героя.',
        'info_sidebar_5': 'Цей індикатор показує досвід головного героя та його прогрес.',
        'info_sidebar_6': 'Унизу бокової панелі, можна побачити назву компанії-автора та поточну версія гри.'
    },
    info_project: {
        'menu_item_1': 'Головна',
        'menu_item_2': 'Про компанію',
        'menu_item_3': 'Про проект',
        'menu_item_4': 'Наступний реліз',
        'info_main_list_1': 'Інформація по проекту',
        'info_main_list_2': 'Інформація розбита на розділи для більш зручного ознайомлення.',
        'main_list_item_1': 'Information about the development company ',
        'main_list_item_1': 'Інформація про компанію-розробника',
        'main_list_item_2': 'Плани проекту та деякі подробиці',
        'main_list_item_3': 'Список завдань на виконання на наступний реліз',
        'company_1': 'Про Компанію',
        'company_2': '"2caKe gems" - це студія розробки ігор, заснована затятим фронтенд-розробником та менеджером проектів, відомим під ніком "2caKe", який проживає в Україні.',
        'company_3': 'Націлившись на створенні інді-ігор жанру RPG, компанія фокусується на створенні захоплюючих ігрових відчуттів для гравців, через поєднання інноваційних та класичних механіки.',
        'company_4': 'Надаючи пріоритет думці гравців, "2caKe gems" прагне прислухатися до спільноти та враховувати її внесок для покращення майбутніх релізів.',
        'company_5': 'Незважаючи на те, що наразі студія базується в Україні, вона залишається відкритою для розширення свого охоплення та запрошення нових членів команди з  різних куточків світу.',
        'company_6': 'Хоча зараз компанія працює з рушієм Twine і форматом історій SugarCube, компанія відкрита для вивчення інших ігрових рушіїв у майбутньому, для подальшого вдосконалення свого продукту та охоплення ширшої аудиторії.',
        'project_1': 'Про Проект',
        'project_2': 'Поточний проект - перша гра студії, яка досягла релізу.',
        'project_3': 'Проект задуманий як амбітна текстова пригодницька RPG гру у світі темного фентезі з покроковими боями.',
        'project_story_title': 'Про що історія?',
        'project_story_1': 'Історія розповідає про молодого мешканця села, який опиняється в акурат і вчасно, щоб опинитися в самому центрі глобальних подій у фантастичному світі.',
        'project_story_2': 'Різноманітні захоплюючі пригоди та скорботні незгоди чекають на нього, спонукаючи побачити все це відправившись на цю подорож разом із ним.',
        'project_structure_title': 'Структура гри',
        'project_structure_1': 'Планується розділити гру на кілька відносних розділів.',
        'project_structure_2': 'Кожен розділ має бути кордоном для відкриття більшого контенту.',
        'project_structure_3': '(Наприклад, більше доступних локацій, нові персонажі, квести, активності тощо.)',
        'project_structure_4': 'Гравці можуть переходити до нових розділів, просуваючись по основному ланцюжку квестів.',
        'project_distribution_title': 'Доставка версій',
        'project_distribution_1': 'Проект буде розповсюджуватися через релізи.',
        'project_distribution_2': 'Релізи не пов\'язані з розділами гри.',
        'project_distribution_3': 'Реліз зазвичай буде включати:',
        'project_distribution_3_1': 'Основні функції релізу, за якими отримає назву сам реліз (наприклад, "Квести та завдання" для другого релізу)',
        'project_distribution_3_2': 'Реалізація додаткового функціоналу',
        'project_distribution_3_3': 'Нові доповнення до контенту (наприклад, квести, завдання, локації, персонажі тощо)',
        'project_distribution_3_4': 'Виправлення помилок і корекція тексту',
        'project_distribution_3_5': 'Робота над "Темною стороною місяця" - це про завдання, які є нескасовними, але незримі для гравців (наприклад, тестування, адміністрування, підтримка, планування тощо)',
        'project_distribution_4': 'Приблизний список наступних релізів:',
        'project_distribution_4_0': '2-й - "Квести та завдання"',
        'project_distribution_4_1': '3-й - "Локації та персонажі"',
        'project_distribution_4_2': '4-й - "Щоденник та меню бокової панелі"',
        'project_distribution_4_3': '5-й - "Предмети та Магазини"',
        'project_distribution_4_4': '6-й - "Битва"',
        'project_tags_title': 'Про теги гри',
        'project_tags_1': 'Актуальні теги на даний момент:',
        'project_tags_2': 'Чоловічий головний герой, Текстова гра, Фентезі',
        'project_tags_3': 'Теги, які будуть додані згідно з майбутніми планами:',
        'project_tags_4': 'Пригоди, Битви, Монстри, Романтика, РПГ, Пісочниця, Покроковий бій',
        'project_tags_5': 'Теги, які можуть з\'явитися у майбутньому:',
        'project_tags_6': 'Графічне насильство, Гумор, Менеджмент, Вкажи-й-Натисни, Оволодіння кимось, Трансформація',
        'next_release_1': 'Наступний реліз',
        'next_release_2': 'Що заплановано для наступного релізу:',
        'next_release_2_1': 'Завершення функціоналу для завдань та квестів.',
        'next_release_2_2': 'Рефакторинг поточного коду для покращення гнучкості для подальшої підтримки нових версій.',
        'next_release_2_3': 'Переробка системи досвіду.',
        'next_release_2_4': 'Нові доповнення до контенту (персонажі, локації, завдання, активності, тощо).',
        'next_release_2_5': 'Нові текстові доповнення (діалоги, описи, поради, тощо).',
        'next_release_2_6': 'Оновлення інтерфейсу.',
        'next_release_2_7': 'Регулярні завдання підтримки (тестування, корекції тексту, виправлення помилок, локалізація тощо).',
        'next_release_2_8': 'Адміністративні завдання (управління документацією, проведення досліджень для оптимізацій, планування нових функціональних структур, тощо).',
        'next_release_3': 'Повний список завдань, запланованих для впровадження у наступному релізі, можна знайти у студійної',
        'next_release_4': '(Певні зміни можуть бути внесені до плану вже під час процесу).'     
    },
    info_story: {
        'info_story_title': 'ПРИГОДА ПОЧИНАЄТЬСЯ...',
        'info_story_1': 'У світі, наповненому магією, демонами, монстрами і ельфами, наша історія бере свій старт в мальовничому селі, відомому як Ельмдейл.',
        'info_story_2': 'Ельмдейл - це одне з поселень королівства Альдерія.',
        'info_story_3': 'Це тихе місце, розташоване поблизу величезного таємничого лісу, що простягається далеко до кордонів.',
        'info_story_4': 'Легенда свідчить, що давним-давно люди та ельфи уклали угоду, щоб захищати глибокий ліс, їхній спільний дім.',
        'info_story_5': 'Разом вони погодились захищати його від будь-яких зовнішніх загроз.',
        'info_story_6': 'Натомість стародавня магія огорнула сусідній неглибокий ліс, спричиняючи швидкий ріст дерев і сприяючи виробництву деревини.', 
        'info_story_7': 'Проте протягом століть селяни Елмдейла не бачили жодного ельфа.',        
        'info_story_8': 'Представники цієї раси, які сховали свою присутність за допомогою чар, понині залишалися прихованими, роблячи своє існування об\'єктом для легенд.',
        'info_story_9': 'Ельмдейл, хоча й лише село середнього розміру, процвітало завдяки своїй великій дистанції від будь-яких негараздів війни.', 
        'info_story_10': 'Воно, фактично, вважалося одним із найспокійніших місць у всьому королівстві Альдерія і, можливо, навіть у всьому світі Фантіри.',           
        'info_story_11_1': 'Навіть вплив перетиначів',                 
        'info_story_11_2': 'майже не порушив спокійний спосіб життя у селі.',  
        'info_story_12': 'Наш головний герой - не є володарем великої слави чи важливості; він - простий молодий селянин з родини теслярів, відомих як Райти.',  
        'info_story_13': 'І ось, наша історія починає розгортатись на чолі з простим хлопцем із Елмдейла, коли він потрапляє у безодню фантастичного світу, що набагато складніший і небезпечніший, ніж він міг собі колись уявити.', 
        'info_story_name': 'Його ім\'я:',
        'info_story_wake_up': 'Пора прокидатися в' ,
        'info_story_link_bedroom': 'Ваша спальня',
        'info_skip_passage': 'Пропуск контенту'
    },
    setting: {
        'setting_select_name': 'Ви можете змінити ім\'я Головного Героя',
        'setting_lang': 'Вибір мови', 
        'setting_dialog_style': 'Вигляд діалогів',
        'setting_return_notification': 'Сповіщення при поверненні на вкладку з грою',
        'setting_return_notification_btn': "Вимк/Увімк",
    },
    sidebar: {
        'caption_lang': 'Поточна мова',
        'caption_version': 'Версія',
        'caption_name': 'Ім\'я',
        'caption_money': 'Гроші',
        'caption_health': 'Здоров\'я',
        'caption_stamina': 'Витривалість',
        'caption_mana': 'Мана'
    },
    passages: {
        passage_info_interface: 'Деталі інтерфейсу та ігрового процесу',
        passage_info_project: 'Інформація по проекту',
        passage_info_disclaimer: 'Перейти до правових положень',
        passage_info_disclaimer_refuse: 'Відмовитись',
        passage_info_disclaimer_accept: 'Прийняти і продовжити',
        passage_menu_settings: 'Налаштування',
        passage_menu_inventory: 'Інвентар',
        passage_menu_questlog: 'Журнал завдань',
        passage_menu_party: 'Група',
        passage_menu_skill: 'Навички',
        passage_menu_info: 'Інформація',
        passage_menu_help: 'Довідка',
        passage_menu_debug: 'Налагодження',
        passage_home_mirror: 'Дзеркало',
        passage_home_mirror_return: 'Припинити зазирання і повернутися',
        passage_home_bedroom: 'Спальня',
        passage_home_hallway: 'Коридор',
        passage_home_kitchen: 'Кухня',
        passage_home_parents_room: 'Кімната батьків',
        passage_home_yard: 'Двір',
        passage_home_yard_bath: 'Ванна у дворі',
        passage_home_yard_toilet: 'Туалет у дворі',
        passage_home_yard__go_home: 'Повернутися додому',
        passage_home_yard__straight: 'Прямувати прямо до дому',
        passage_dream: 'Спати',
        passage_dream_out: 'Прокинутися',
        passage_village_shed: 'Теслярська майстерня',
        passage_village_stables: 'Конюшні',
        passage_village_kennels: 'Псарня',
        passage_village_west: 'Західна частина селища', 
        passage_village_east: 'Східна частина селища', 
        passage_village_center: 'Центральна частина селища', 
        passage_village_square: 'Площа селища', 
        passage_village_church: 'Церква',
        passage_village_church_godfrey_room: 'Кімната Годфрея',
        passage_village_church_nun_room: 'Кімната монахинь',
        passage_village_infirmary: 'Лазарет',
        passage_village_outside: 'Окраїна селища', 
        passage_village_store_smith: 'Заглянути у крамницю коваля', 
        passage_village_store_mercer: 'Заглянути у крамницю крамаря', 
        passage_village_tavern: 'Таверна', 
        passage_village_tavern_bedroom: 'Спальня в таверні', 
        passage_village_warders_entry: 'Вхід до Ворденів',
        passage_village_warders_training_field: 'Поле для тренувань',
        passage_village_warders_barracks: 'Казарми Ворденів',
        passage_village_outside_house_shikari: 'Будинок пана Шікарі',
        passage_village_outside_house_fisher: 'Будинок пана Фішера',
        passage_village_outside_fields: 'Поля',
        passage_village_outside_meadow: 'Лука',
        passage_village_outside_river: 'Річка',
        passage_village_outside_grazing: 'Пасовище',  
        passage_village_outside_graveyard: 'Кладовище',    
        passage_elf_house_elder: 'Хатина старости',
        passage_elf_house_herb: 'Зіллярня',
        passage_elf_house_bloodhound: 'Хатина шукача',
        passage_elf_village: 'Ельфійське поселення',
        passage_elf_store_herb: 'Заглянути у Зіллярню',
        passage_forest: 'Ліс',
        passage_forest_lake: 'Озеро',
        passage_forest_spring: 'Джерело',
        passage_forest_swamp: 'Болото',
        passage_forest_hut_witch: 'Хижа відьми',
        passage_forest_hut_witch_bedroom: 'Спальня відьми',
        passage_forest_edge: 'Узлісся',    
        passage_forest_deep: 'Густий ліс', 
        passage_house_alura: 'Будинок Алури', 
        passage_house_baxter: 'Пекарня', 
        passage_house_ferryman: 'Будинок перевізника', 
        passage_house_mercer: 'Особняк крамаря', 
        passage_house_ostler: 'Будинок пані Остлер', 
        passage_house_smith: 'Будинок коваля', 
        passage_house_steward: 'Будинок голова селища', 
        passage_house_taylor: 'Будинок кравчині', 
        passage_house_wizard: 'Лігво чарівника', 
    },
    misc: {
        game_title: 'Повісті Фантіри: В акуРа(й)т і вчасно',
        apply: 'Застосувати',
        accept: 'Прийняти', 
        cancel: 'Скасувати',        
        continue: 'Продовжити',
        return: 'Повернутися',
        return_main: 'Головна вкладка',   
        mirror_reflect: 'Зазирнути',
        mirror_room_text: 'Увійшовши у полу-медитативний стан, ви готові зануритися у свої проблеми і думки.',
        mirror_room_no_quest: 'Наразі у мене немає про що слід поміркувати.',
    },
    talk_menu: {
        chat: 'Побалакти',
        inventory: 'Управління інвентарем',
        train: 'Тренування',
        learn: 'Вивчення',
        stats: 'Перевірити статистику',
        talk_to: 'Поговорити',
        talk_to_cant: 'Неможливо взаємодіяти з',
        is_here: 'знаходиться тут',
        who_are_they: 'Хто це для тебе',
        think_of_you: 'Думає про тебе як про',
        join_party: 'Приєднати до групи',
        leave_party: 'Прибрати з групи',
        join_escort: 'Почати місію супроводу',
        leave_escort_not_finish: 'Покинути місію супроводу',
        leave_escort_finish: 'Завершити місію супроводу'
    },
    character_activities: {
        'cooking': 'Готує',
        'cleaning': 'Прибирає',
        'reading_book': 'Читає книгу',
        'resting': 'Відпочиває',
        'sleeping': 'Спить',
        'eating': 'Їсть',
        'studying': 'Вчиться',
        'working': 'Працює',
        'bathing': 'Приймає ванну',
        'swimming': 'Плаває',
        'sunbathing': 'Засмагає',
        'training': 'Тренується',
        'shed_work': 'Працює в амбарі',
        'playing_with_friends': 'Грає з друзями',
        'play_wardrobe': 'Грає зі своїм гардеробом',
        'mending': 'Штопає одяг',
        'stories_village': 'Слухає історії селян',
        'preparing_festival': 'Готується до свята',
        'daydreaming': 'Марить',
        'teaching': 'Навчає',
        'study_spells': 'Вивчає закляття',
        'reorganizing_store': 'Реорганізує припаси',
        'food_shopping': 'Купляє їжу',
        'talking_with_customer': 'Розмовляє з клієнтом',
        'work_on_orders': 'Працює над замовленням',
        'smelting': 'ЗАймається плавкою',
        'crafting_tools': 'Виготовляє інструменти',
        'forging_weapon': 'Кує зброю',
        'learning_smith': 'Навчається ковальській справі',
        'assisting_forge': 'Допомагає в куванні',
        'managing_finances': 'Займається фінансами',
        'horseshoeing': 'Займається підковуванням',
        'metalworking_demonstrations': 'Демонструє металеві вироби',
        'visiting_tailor': 'Відвідає кравчиню',
        'talking_smith': 'Розмовляє з ковалем',
        'training_warder': 'Тренується з Вордерами',
        'hanging_out_alura': 'Гуляє з Алурою',
        'hanging_out_barret': 'Гуляє з Барретом',
        'work_on_fields': 'Працює в полі',
        'q_return_brooch': 'Повертає брошку'
    },
    activities: {
        'rest': 'Відпочити',
        'nap': 'Подрімати',
        'sleep': 'Спати',
        'wait': 'Очікувати',
        'eat': 'Їсти',
        'drink': 'Пити',
        'bath': 'Купатись',
        'swim': 'Плавати',
        'work': 'Працювати',
        'clean': 'Прибирати'
    },
    activity_reasons: {
        'time': 'Зараз не прийнятний час для цього.',
        'daily': 'Ви це вже робили сьогодні.',
        'countdown': 'Ви це недавно робили, вам потрібно трохи зачекати, перш ніж знову робити це.',
        'stamina': 'Ви не втомлені, щоб відпочивати.'
    },
    tasks: {
        'interact': 'Взаємодіяти',
        'gather': 'Зібрати',
        'distribute': 'Доставляти',
        'fight': 'Битися',
        'search': 'Шукати'
    }, 
    task_conditions: {
        'interact': 'Зараз неможливо взаємодіяти!',
        'gather': 'Зараз неможливо збирати!',
        'distribute': 'Зараз неможливо доставити!',
        'fight': 'Зараз неможливо збирати битися!',
        'search': 'Недостатньо витривалості!'
    },
    deadend: {
        'you_died': 'Ви померли',
        'load_autosave': 'Завантажити автозбереження',
        'select_save': 'Вибрати збереження',
        'restart_the_game': 'Перезапустити гру спочатку',
        'desc_1': 'Хід ваших дій привів до цього нещасливого фіналу.',
        'desc_2': 'Але, ймовірно, з ще однією можливістю, ви зможете змінити сумну долю, яка спіткала'

    },
    tips: {
        tip_name: 'Ви можете змінити ім’я головного героя у будь-який час в меню налаштувань.',
        tip_example: 'Ви можете переглядати корисну та пояснювальну інформацію.',        
        tip_autosave: 'Автозбереження відбувається перед виборами, які ведуть у глухий кут та під час сну.',
        tip_return_notification: `
        Ввімкніть або вимкніть сповіщення ігрових підказок після повернення на вкладку гри. <br>
        Якщо ви переходите з вкладки гри на іншу вкладку або екран, то через певний час повернувшись на вкладку,
        ви побачите сповіщення з додатковою інформацією, які відноситься до гри.
        `,
        tip_language_change: 'Переклад для деяких мов може бути неповним або містити помилки.',        
        tip_language_warning: 'УВАГА! <br> Переклад для деяких мов може бути неповним або містити помилки.',
        tip_info_in_help_menu: 'Ви зможете переглянути цю інформацію будь-коли в меню «Довідка».',
        tip_mc_name_change: 'Здебільшого використовується для оновлення назви ГГ після зміни мови.',
        tip_trespassers: `
        Значний слід у цьому світі залишили мандрівники з інших світів, яких тепер називають «перетиначами». <br>
        Це сталося насамперед через дві Міжсвітові Кризи, які стали результатом їхніх дій, та подальше встановлення міжнародних законів проти перетиначів. <br>
        Ці закони не лише обмежують розвиток нових технологій, які ґрунтуються на будь-чому, що стосується перетиначів, але також забезпечують дотримання правил щодо використання будь-якої спадщини перетиначів суворіше, ніж навіть щодо найпотужніших та заборонені магічні практики. <br>
        Тим не менш, кілька важливих технік для зручності, створених на основі стародавніх технологій та магії, які є альтернативою зручностям, запровадженим перетиначами, залишаються у загальному вжитку.
        Ходять чутки, що кількість перетиначів зростає, натякаючи на Третю Міжсвітову Кризу. Однак такі розмови часто відкидають як балаканину божевільних.
        `,
        tip_geoposition: `
        У величезному світі Фантіри існують три континенти. <br>
        Два, схожі за розміром та близькі один до одного - Елдертіда та Небулан, тоді як третій - Ізолара менший і віддалений. <br>
        Історія розгортається в королівстві Альдерія на найбільш населеному людьми континенті, Нойбулані. <br>
        Наразі Альдерія перебуває в стані напруги, заблокована в холодній війні зі своїм східним та північним сусідом, Імперією Ракмор - найбільшою країною на континенті. <br>
        На півдні найближчі сусіди Елмдейла належать до Лібарської коаліції, альянсу невеликих країн з великими відмінностями, але єдиним фронтом проти зовнішніх загроз.
        Деякі з цих країн настільки малі, що нагадують великі фортифіковані міста з кількома рівнями оборони, що розділяють їхні регіони. <br>
        `,
        tip_location_blocked: 'Локація наразі заблокована.',
        tip_character_na: 'Цей персонаж наразі недоступний.',
        tip_functionality_wip: 'Функціонал знаходиться в розробці. <br> Буде додано пізніше.',
        tip_functionality_wip_beta: 'Функціонал знаходиться в розробці. <br> Наразі ви можете перевірити бета-версію. <br> АЛЕ ЗВЕРНІТЬ УВАГУ, ЩО ЦЕ МОЖЕ ЗЛАМАТИ ГРУ!! ',
        tip_functionality_tba: 'Буде додано пізніше. <br> Цю функцію додадуть у майбутньому.',
        tip_leave_escort_not_finish: 'Ви ще не знаходитесь на правильній локації. Якщо відпустити цього персонажа зараз, то завдання відкинеться на крок назад.',
        tip_already_chatted: 'Ви вже поговорили достатньо.'
    },
    thelper: {
        day_of_week: 'Поточний день тижня',
        month: 'Поточний місяць',
        time: 'Поточний час',
        day_of_month: 'Поточний день місяця',
        money: 'Гроші',
        company_name: 'Назва компанії розробників',
        narration: 'Наративний текст',
        thought: 'Думка головного персонажа',
        gesture: 'Жести персонажа',
        quest_link: 'Почати квест',
        dead_end: 'Це призведе до послідовності у глухий кут',
        refresh: 'Оновити',
        apply: 'Усі зміни будуть застосовані; ви залишитеся на сторінці.',
        accept: 'Усі зміни будуть застосовані; ви повернетеся на попередню сторінку.',
        talk__personal_question: 'Особисте запитання',
        talk__chat: 'Прості розмови про загальні речі',
        talk__join: 'Персонаж приєднається до групи гравця',
        talk__leave: 'Персонаж покине групу гравця',
        talk__already_chatted: 'Ви вже достатньо набалакались',
        mirror: 'Перевірити дзеркало',
        location_blocked: 'Місце недоступне',
        popup__health_low: 'Низьке здоров\'я', 
        popup__stamina_low: 'Низька витривалість',
        popup__mana_low: 'Низька мана',
        popup__stamina_not_enough: 'Недостатньо витривалості',
        popup__task_created: 'Нове завдання',
        popup__add_party: 'Приєднати до групи' ,
        popup__remove_party: 'Покинути групу',
        popup__quest_start: 'Квест розпочато',
        popup__quest_complete: 'Квест завершено',
        popup__quest_fail: 'Квест провалено',
        popup__task_fail: 'Завдання провалено',
        popup__quest_next_state: 'Квест перейшов до наступного стану',
        popup__task_gather: 'Завдання збору',
        popup__task_escort_finished: 'Завдання супроводу завершено',
        popup__task_escort_location: 'Персонаж супроводу перебуває на підхожій локації',
        task_type__sketch: 'Завдання скетч',
        task_type__gather: 'Завдання на збір',
        task_type__distribute: 'Завдання на доставку',
        task_type__fight: 'Завдання на битву',
        task_type__search: 'Завдання на пошук',
        task_type__eliminate: 'Завдання на ліквідацію',
        task_type__escort: 'Завдання на супровід',
        task_type__tryout: 'Завдання на випробування',
        menu_tab__info_interface__menu_item_1: 'Основна інформація',
        menu_tab__info_interface__menu_item_2: 'Деталі локацій',
        menu_tab__info_interface__menu_item_3: 'Квести та завдання',
        menu_tab__info_interface__menu_item_4: 'Система скетчів',
        menu_tab__info_interface__menu_item_5: 'Підказки, вспливаючі та модальні вікна',
        menu_tab__info_interface__menu_item_6: 'Інформація бокової панелі' ,
        menu_tab__info_project__menu_item_1: 'Головна',
        menu_tab__info_project__menu_item_2: 'Про Компанію',
        menu_tab__info_project__menu_item_3: 'Про Проект',
        menu_tab__info_project__menu_item_4: 'Наступний Реліз',
    },
    modals: {
        no_valid_items_title: 'Не дійсно',
        no_valid_items_1_1: 'У вас недостатньо',
        no_valid_items_1_2: 'предметів',
        no_valid_items_2_1: 'У вас є лише',
        no_valid_items_2_2: 'з',
        confirm_items_title: 'Підтвердження',
        confirm_items_1: 'Ви розподілите наступні предмети:',
        select_items_title: 'Вибір',        
        select_items_1_1: 'Виберіть',
        select_items_1_2: 'предмети типу',
        select_items_1_3: 'для доставки:',
        show_clues_title: 'Ігрова підказка',        
        modal_accept: 'Прийняти',
        modal_footer: 'Футер модального вікна',
    },
    game_clues: {
        clue_1_1: 'Спробуйте більше спілкуватись з персонажами!',
        clue_1_2: 'Деякі персонажі можуть поділитись цікавою та корисною інформацією, якщо ваші відносини достатньо високі.',
        clue_2_1: 'Знайшли помилку або хочеться залишити коментар?',
        clue_2_2: 'Пишіть на наш канал у Discord! Ми прочитаємо, перевіримо і підкорегуємо!',
        clue_3_1: 'Маєте ідеї, як покращити гру?',
        clue_3_2: 'Ми вітаємо всіх, хто готовий допомогти!',
        clue_3_3: 'Нам потрібні дизайнери, художники, тестувальники, редактори тексту, перекладачі, досвідчені користувачі штучного інтелекту, розробники на JavaScript та всі інші, хто готовий долучитися!',
        clue_3_4: 'Приєднуйтеся до нас і ми створити дивовижний продукт!',
        clue_4_1: 'Хочете висловити свою неоціненну думку про поточний стан гри?',
        clue_4_2: 'Пишіть на наш канал у Discord! Ми вдячні за будь-який відгук про нашу роботу!',
    },
    popups: {
        health_low: 'Низьке здоров\'я!',
        stamina_low: 'Низька витривалість!',
        mana_low: 'Низька мана!',
        stamina_not_enough: 'Недостатньо витривалості!',
        task_created: 'Завдання створено!',
        add_party: 'приєднується до вашої групи',
        remove_party: 'залишає вашу групу!',
        quest_start: 'було розпочато!',
        quest_complete: 'було завершено!',
        quest_fail: 'було провалено!',
        quest_next_state_1: 'Завдання для квесту',
        quest_next_state_2: 'були оновлені.',
        task_fail: 'було провалено!',
        task_gather: 'Зібрано',
        task_escort_finished: 'було супроводжено!',
        task_escort_location_1: 'Ви у пригожому місці!',
        task_escort_location_2: 'Тепер ви можете залишити',
        popup_quest: 'Квест',
        popup_task: 'Завдання',
    },
    socials: {
        link_to_discord: 'Посилання на наш діскорд',
    },
    menu_help: {
        menu_help_info_interface_suggest: 'Якщо система не працює згідно вашим очікуванням, перегляньте посібник з інтерфейсу.',
        menu_help_info_interface_discord: 'Якщо після його прочитання все ще є питання, які вас непокоять, будь ласка, зв\'яжіться з нами через Discord.'
    },    
    menu_party: {
        party_consists: 'Ваша поточна група складається з:',
        talk: 'Поговорити'
    }
}
/* twine-user-script #14: "eventObserver.js" */
// --- EventObserver ---

class EventObserver {
    constructor () {
      this.observers = []
    }
  
    subscribe (fn) {
      this.observers.push(fn)
    }
  
    unsubscribe (fn) {
      this.observers = this.observers.filter(subscriber => subscriber !== fn)
    }
  
    broadcast (data) {
      this.observers.forEach(subscriber => subscriber(data))
    }
}
// window.EventObserver = EventObserver; // attach to the global scope
/* twine-user-script #15: "global_init_start.js" */

 

State.variables.settings = {};
State.variables.settings.lang = 'en';
State.variables.settings.debug = 1;
State.variables.settings.dialog_style = 1;
State.variables.settings.return_notification = 1;


State.variables.quests = {};
State.variables.tasks = {};
State.variables.characters = {}
State.variables.parties = {};
State.variables.enemies = {};
State.variables.sketches = {};
State.variables.schedule_list = {};
State.variables.characters_schedule_list = {};


State.variables.record_lists = {};
State.variables.record_lists.deadends_seen = [];
State.variables.record_lists.schedule_update_added = [];

State.variables.flags = {};

setup.tasks_broadcast = {};                           // to store tasks function in separate global array of "setup" space


State.variables.temp = {};
State.variables.temp.menu_tab = 1;
State.variables.temp.localization_text = {en:{}, ua:{}, ru:{}, fr:{}} 

State.variables.temp.cur_tasks_fight = [];
State.variables.temp.cur_tasks_escort = [];
State.variables.temp.countdowns = {};
State.variables.temp.spoke_list = {};
State.variables.temp.schedule_day = {}
State.variables.temp.daily = {};

State.variables.temp.tasks = {}
State.variables.temp.tasks.gather_amount = {}
State.variables.temp.tasks.search_stamina = {}



State.variables.misc = {};
State.variables.misc.static_counter = {};
State.variables.misc.player_name = '';

State.variables.settings.interface = {
    time: {
        day_of_week: 0,
        month: 0,
        hours: 0
    },
    stats: {
        player_name: 0,
        money: 0
    },
    bars: {
        health: 0,
        stamina: 0,
        mana: 0
    },
    exp: {
        level: 0,
    },
    menu_story: {
        inventory: 0,
        questlog: 0,
        party: 0,
        help: 0,
        info: 0,
        skill: 0
    },
    menu_core: {
        saves: 1,
        settings: 0,
        restart: 0,
        share: 1
    },
    sign: {
        author: 1,
        version: 1,
    },
    history: {
        backward: 1,
        forward: 1
    }
}

State.variables.lists = {};

State.variables.lists.activities = {};
State.variables.lists.assignments = {};
State.variables.lists.custom_locations = {};
State.variables.lists.image_list = {};
State.variables.lists.video_list = {};


State.variables.lists.task_types = [
    // 'interact', 
    'sketch', 
    'gather', 
    'distribute', 
    'fight', 
    'eliminate', 
    'search', 
    'escort' 
];

State.variables.lists.quest_types = [
    'main', 
    'sub', 
    'grind', 
    'companion'
];

State.variables.lists.characters_activities = [
    'sleeping',
    'eating',
    'working'
]

State.variables.lists.params = [
    'health',
    'health_max',
    'mana',
    'mana_max',
    'stamina',
    'stamina_max',
    'relation',
    'lvl',
    'exp',
    'battle',
    'is_known',
    'is_dead',
    'can_join'
];

State.variables.lists.comparatives = {
    greater: ">",
    less: "<",
    equal: "==",
    greater_equal: ">=",
    less_equal: "<="
};

State.variables.lists.link_types = [
    'default',
    'location',
    'quest',
    'dead_end',
    'personal',
    'personal_quest',
    'fight',
    'danger',
    'end_conversation',
    'check_skills'
];

State.variables.lists.img_styles = [
    'default',
    'location',
    'other'
];

State.variables.lists.postures = [
    'default',
    'angry',
    'angry_2',
    'sad',
    'sad_2',
    'happy', 
    'happy_2', 
    'fear',
    'fear_2',
    'flush',
    'flush_2',
    'shocked',
    'shocked_2',
    'anticipated',     
    'anticipated_2', 
    'hidden',
    'hidden_2',
    'marked',
    'marked_2',
];


State.variables.lists.items = {}
        
State.variables.lists.items.types = [
    'armor',
    'weapons',
    'potions',
    'food',
    'materials',
    'special_items',
    'quest_items'
];

State.variables.lists.items.weapons = {
    knife: [
        'dagger',
        'broken_bottle',
        'stilleto',
        'rondel',
        'baselard',
        'poignard',
        'misericorde',
        'anelace',
        'kukri',
        'kris',
        'cleaver'
    ],
    one_handed: [
        'katana',
        'sword',
        'rapier',
        'spatha',
        'saber'
    ],
    // 'two_handed': [
    //        not in this game
    // ]
    polearm: [
        'glaive',
        'halberd',
        'spear',
        'lance', 
        'partisan',           
        'skythe'
    ],
    fist_load: [
        'baghnakhs',
        'knuckles',
        'nails',
        'claw',
        'tooth',
        'wraps'
    ],
    magical: [
        'staff',
        'pol',
        'wand',
    ],
    unset: [            
        'hammer',
        'morningstar',
        'axe',
        'zaghnal',
        'tonfa',
        'mace',
        'whip',
        'kusarigama'
    ]
}

State.variables.lists.items.armor = {
    head: [
        'helmet'
    ],
    body: [],
    arms: [],
    legs: [
        'sabatons'
    ],
    foot: []
}

State.variables.lists.items.potions = [
    'health_potion'
]

State.variables.lists.items.food = [
    'bread',
    'meat'
];

State.variables.lists.items.materials = [
    'wood',
    'sweet_flower'
];

State.variables.lists.items.special_items = [
    'fishing_rod'
];

State.variables.lists.items.quest_items = [
    'brooch',
    'key',
    'socks'
];

State.variables.lists.enemies = [
    'wolf',
    'goblin',
    'goblino'
];


State.variables.lists.hours = {
    0: '0:00',
    1: '1:00',
    2: '2:00',
    3: '3:00',
    4: '4:00',
    5: '5:00',
    6: '6:00',
    7: '7:00',
    8: '8:00',
    9: '9:00',
    10: '10:00',
    11: '11:00',
    12: '12:00',
    13: '13:00',
    14: '14:00',
    15: '15:00',
    16: '16:00',
    17: '17:00',
    18: '18:00',
    19: '19:00',
    20: '20:00',
    21: '21:00',
    22: '22:00',
    23: '23:00',
    24: '24:00'
};


State.variables.lists.enemy_kinds = [
    'goblin', 
    'wolf'
];

const month_list_days = {
    1: 31, 
    2: 31,
    3: 28, 
    4: 30,
    5: 31,
    6: 30,
    7: 31, 
    8: 31,
    9: 30,	 
    10: 31,
    11: 30,	 
    12: 31 
};
State.variables.lists.month_list_days = month_list_days;


const time_initial = {
	minute: 10,
	hour: 7,
	total_day: 1,
	day_of_week_id: 2,
	month_id: 4
};
State.variables.time = {...time_initial};

changeLanguage();
/* twine-user-script #16: "json_activities.js" */

const activity_list = {
    "rest": {
        "id_name": "rest",
        "locations": [
            "prologue_2",
            "prologue_3",
            "Home_Bedroom"
        ]
    },
    "nap": {
        "id_name": "nap",
        "locations": [
            "prologue_2"
        ]
    },
    "sleep": {
        "id_name": "sleep",
        "locations": [
            "Home_Bedroom"
        ]
    },
    "wait": {
        "id_name": "wait",
        "locations": [
            "Home_Bedroom"
        ]
    },
    "eat": {
        "id_name": "eat",
        "locations": [
            "Home_Kitchen"
        ]
    },
    "drink": {
        "id_name": "drink",
        "locations": [
            "Home_Kitchen"
        ]
    },
    "bath": {
        "id_name": "bath",
        "locations": [
            "Home_Yard_Bath"
        ]
    },
    "swim": {
        "id_name": "swim",
        "locations": [
        ]
    },
    "gather": {
        "id_name": "gather",
        "locations": [
        ]
    },
    "fight": {
        "id_name": "fight",
        "locations": [
        ]
    },
    "work": {
        "id_name": "work",
        "locations": [
        ]
    },
    "clean": {
        "id_name": "clean",
        "locations": [
        ]
    },
}

/* twine-user-script #17: "json_assignments.js" */

const assignment_list = {    
    home_cooking: {
        locations: ['Home_Kitchen'],
        activity: 'cooking'
    },
    home_cleaning: {
        locations: ['Home_Bedroom', 'Home_Kitchen', 'Home_Hallway'],
        activity: 'cleaning'
    },
    home_cleaning_parents: {
        locations: ['Home_Parents_Room', 'Home_Kitchen', 'Home_Hallway'],
        activity: 'cleaning'
    },
    home_cleaning_yard: {
        locations: ['Home_Yard', 'Home_Yard', 'Home_Yard_Bath'],
        activity: 'cleaning'
    },
    home_eating:  { 
        locations: ['Home_Kitchen'],
        activity: 'eating'
    },    
    home_father_work:  { 
        locations: ['Village_West_Shed'],
        activity: 'shed_work'
    },
    resting_parents: {
        locations: ['Home_Parents_Room'],
        activity: 'resting'
    },
    yard_bath: {
        locations: ['Home_Yard_Bath'],
        activity: 'bathing',
        availability: false
    },
    food_shopping: {
        locations: ['House_Mercer'],
        activity: 'food_shopping'
    },  
    sleeping_parents: {
        locations: ['Home_Parents_Room'],
        activity: 'sleeping',
        availability: false
    },
    sleeping_melissa: { 
        locations: ['Home_Bedroom'],
        activity: 'sleeping',
        availability: false
    },
    studying_melissa: {
        locations: ['Home_Bedroom'],
        activity: 'studying'
    },
    play_with_friends_melissa: {
        locations: ['Home_Yard'],
        activity: 'play_with_friends',
        availability: false
    },
    play_wardrobe: {
        locations: ['Home_Bedroom'],
        activity: 'play_wardrobe'
    },
    mending_home: {
        locations: ['Home_Yard'],
        activity: 'mending'
    },
    stories_village: {
        locations: ['Home_Yard'],
        activity: 'stories_village'
    },
    preparing_festival: {
        locations: ['Home_Bedroom'],
        activity: 'preparing_festival',
        availability: false
    },
    daydreaming_melissa: {
        locations: ['Home_Yard'],
        activity: 'daydreaming'
    },
    sleeping_alura: { 
        locations: ['House_Alura'],
        activity: 'sleeping',
        availability: false
    },
    reading_book_alura: {
        locations: ['House_Alura'],
        activity: 'reading_book'
    },
    eating_alura: { 
        locations: ['House_Alura'],
        activity: 'eating'
    },
    cooking_alura: { 
        locations: ['House_Alura'],
        activity: 'eating'
    },
    mending_alura: { 
        locations: ['House_Alura'],
        activity: 'mending'
    },
    cleaning_alura: { 
        locations: ['House_Alura'],
        activity: 'cleaning'
    },
    sleeping_wizard: {
        locations: ['House_Wizard'],
        activity: 'sleeping',
        availability: false
    },
    reading_book_wizard: {
        locations: ['House_Wizard'],
        activity: 'reading_book'
    },
    study_spells_wizard: {
        locations: ['House_Wizard'],
        activity: 'study_spells'
    },
    reorganizing_store_wizard: {
        locations: ['House_Wizard'],
        activity: 'reorganizing_store'
    },
    talking_with_customer_smith: {
        locations: ['House_Smith'],
        activity: 'talking_with_customer'
    },
    smelting: {
        locations: ['House_Smith'],
        activity: 'smelting'
    },
    crafting_tools: {        
        locations: ['House_Smith'],
        activity: 'crafting_tools'
    },
    forging_weapon: {
        locations: ['House_Smith'],
        activity: 'forging_weapon'
    },
    metalworking_demonstrations: {
        locations: ['House_Smith'],
        activity: 'metalworking_demonstrations',
        availability: false
    },
    teaching_smith: {
        locations: ['House_Smith'],
        activity: 'teaching'
    },
    horseshoeing: {
        locations: ['Village_Stables'],
        activity: 'horseshoeing',
        availability: false
    },
    // metalworking_demonstrations: {
    //     locations: ['Village_Square'],
    //     activity: 'metalworking_demonstrations'
    // },
    learning_smith: {
        locations: ['House_Smith'],
        activity: 'learning_smith',
    },
    assisting_forge: {
        locations: ['House_Smith'],
        activity: 'assisting_forge',
    },
    managing_finances_smith: {        
        locations: ['House_Smith'],
        activity: 'managing_finances',
    },
    cleaning_smith: {        
        locations: ['House_Smith'],
        activity: 'cleaning',
    },
    cooking_smith: {        
        locations: ['House_Smith'],
        activity: 'cooking',
    },
    mending_clothes_smith: {
        locations: ['House_Smith'],
        activity: 'mending'
    },
    resting_smith: {
        locations: ['House_Smith'],
        activity: 'resting'
    },
    sleeping_smith: {
        locations: ['House_Smith'],
        activity: 'sleeping',
        availability: false
    },
    work_on_fields: {
        locations: ['Village_Outside_Fields'],
        activity: 'work_on_fields'
    },
    sleeping_taylor: {
        locations: ['House_Taylor'],
        activity: 'sleeping',
        availability: false
    },
    talking_with_customer_taylor: {
        locations: ['House_Taylor'],
        activity: 'talking_with_customer'
    },
    work_on_orders_taylor: {
        locations: ['House_Taylor'],
        activity: 'work_on_orders'
    },
    cooking_taylor: {
        locations: ['House_Taylor'],
        activity: 'cooking'
    },
    cleaning_taylor: {
        locations: ['House_Taylor'],
        activity: 'cleaning'
    },
    visiting_tailor: {        
        locations: ['House_Taylor'],
        activity: 'visiting_tailor'
    },
    talking_smith: {
        locations: ['House_Taylor'],
        activity: 'talking_smith'
    },
    training_warders: {        
        locations: ['Village_Warders_Training_Field'],
        activity: 'training_warder'
    },
    hanging_out_alura_center: {
        locations: ['Village_Center'],
        activity: 'hanging_out_alura'
    },
    hanging_out_barret_center: {
        locations: ['Village_Center'],
        activity: 'hanging_out_barret'
    },
    q_return_brooch: {
        locations: ['Home_Parents_Room'],
        activity: 'q_return_brooch',
        availability: false
    }
}
/* twine-user-script #18: "json_characters.js" */

const character_list = 
{
"mc": {
    "id_name": "mc",
    "battle": {
    "attack": "2",
    "defence": "1",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "6",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "30",
    "exp": "10",
    "can_die": "1",
    "is_known": "1",
    "inter_type": "type_1"
},
"melissa": {
    "id_name": "melissa",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "0",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "is_known": "1",
    "can_join": "1",
    "inter_type": "type_1"
},
"alura": {
    "id_name": "alura",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "0",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "is_known": "1",
    "inter_type": "type_1"
},
"barret": {
    "id_name": "barret",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "0",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "is_known": "1",
    "inter_type": "type_1"
},
"savia": {
    "id_name": "savia",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "7",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "1000",
    "exp": "0",
},
"witch": {
    "id_name": "witch",
    "battle": {
    "attack": "1",
    "defence": "1",
    "magic_attack": "20",
    "magic_defence": "20"
    },
    "lvl": "30",
    "health_max": "900",
    "stamina_max": "300",
    "mana_max": "900",
    "money": "0",
    "exp": "0",    
    "store_idn": 'test_store',
    "inter_type": "type_1"
},
"kalithara": {
    "id_name": "kalithara",
    "battle": {
    "attack": "1",
    "defence": "1",
    "magic_attack": "200",
    "magic_defence": "200"
    },
    "lvl": "220",
    "health_max": "10000",
    "stamina_max": "6500",
    "mana_max": "18000",
    "money": "0",
    "exp": "40",
    "inter_type": "type_1"
},
"sekhmau": {
    "id_name": "sekhmau",
    "battle": {
    "attack": "100",
    "defence": "50",
    "magic_attack": "0",
    "magic_defence": "30"
    },
    "lvl": "40",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "can_die": "1",
    "inter_type": "type_1"
},
"mother": {
    "id_name": "mother",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "8",
    "health_max": "120",
    "stamina_max": "180",
    "mana_max": "0",
    "money": "1000",
    "exp": "0",
    "inter_type": "type_2"
},
"father": {
    "id_name": "father",
    "battle": {
    "attack": "4",
    "defence": "2",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "10",
    "health_max": "150",
    "stamina_max": "220",
    "mana_max": "0",
    "money": "1500",
    "exp": "20",
    "inter_type": "type_2"
},
"amelina": {
    "id_name": "amelina",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "7",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "100",
    "exp": "0",
    "inter_type": "type_2"
},
"mr_smith": {
    "id_name": "mr_smith",
    "battle": {
    "attack": "5",
    "defence": "5",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "13",
    "health_max": "180",
    "stamina_max": "20",
    "mana_max": "0",
    "money": "3000",
    "exp": "60",
    "inter_type": "type_2",
    "store_idn": 'mr_smith_store',
},
"mrs_smith": {
    "id_name": "mrs_smith",
    "battle": {
    "attack": "1",
    "defence": "1",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "9",
    "health_max": "100",
    "stamina_max": "120",
    "mana_max": "0",
    "money": "500",
    "exp": "0",
    "inter_type": "type_2",
},
"ms_taylor": {
    "id_name": "ms_taylor",
    "battle": {
    "attack": "1",
    "defence": "1",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "9",
    "health_max": "100",
    "stamina_max": "120",
    "mana_max": "0",
    "money": "500",
    "exp": "0",
    "inter_type": "type_2",
},
"wizard": {
    "id_name": "wizard",
    "battle": {
    "attack": "5",
    "defence": "10",
    "magic_attack": "30",
    "magic_defence": "50"
    },
    "lvl": "25",
    "health_max": "2000",
    "stamina_max": "2000",
    "mana_max": "2000",
    "money": "2000",
    "exp": "0",
    "can_die": "1",
    "store_idn": 'test_store',
    "inter_type": "type_2"
},
"sexton": {
    "id_name": "sexton",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "50",
    "health_max": "100",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "500",
    "exp": "0",
    "is_known": "1",
    "inter_type": "type_2"
},
"eredira": {
    "id_name": "eredira",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "1",
    "health_max": "50",
    "stamina_max": "50",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "inter_type": "type_2"
},
"test_npc": {
    "id_name": "test_npc",
    "battle": {
    "attack": "0",
    "defence": "0",
    "magic_attack": "0",
    "magic_defence": "0"
    },
    "lvl": "0",
    "health_max": "2",
    "stamina_max": "100",
    "mana_max": "0",
    "money": "0",
    "exp": "0",
    "can_die": "1",
    "inter_type": "type_2"
}
}
/* twine-user-script #19: "json_image.js" */
const image_list = 
{
    "prologue": [
        'artifact_1.png',
        'brooch.png',
        'ceiling.png',
        'depth.webp',
        'global_catastrophe.png',
        'House_Wizard.jpg',
        'kalithara.png',
        'kalithara_mirror.png',
        'lake_1.webp',
        'lake_2.webp',
        'lake_3.webp',
        'lake_4.jpg',
        'lake_5.jpg',
        'melissa_anticipation.png',
        'melissa_crying.png',
        'melissa_grin.png',
        'melissa_headpat.png',
        'melissa_hug.png',
        'melissa_hug_crying.png',
        'melissa_sleeping.png',
        'melissa_sleepy.png',
        'melissa_sparkling_eyes.png',
        'Village_Outside.jpg',  
        'witch_first_contact.png',
        'Forest_Hut_Witch.jpg',   
        'Forest_Hut_Witch_Bedroom.jpg',   
        'witch_samples.webp',
        'witch_sorrow_door.png',
        'witch_younger.png',
        'wizard_portrait.png'
    ],
    "chapter_1": [
        'mc_new_look.png'
    ],
    "lake_events": [                
        'lake_events_1.jpg',
    ],
    "river_events": [   
        'river_event_1.jpg',
    ]
}
/* twine-user-script #20: "json_items.js" */

const item_list = {
    "test_weapon_1": {
      "category": "knife",
      "cost": "300",
      "id_name": "test_weapon_1",
      "lvl": "0",
      "sub_category": "stiletto",
      "type": "weapons"
    },
    "test_quest_item_1": {
      "id_name": "test_quest_item_1",
      "type": "quest_items",
      "category": "key"
    },
    "test_quest_item_2": {
      "id_name": "test_quest_item_2",
      "type": "weapons",
      "category": "knife",
      "sub_category": "dagger",
      "lvl": "1",
      "cost": "1"
    }
  }
/* twine-user-script #21: "json_locations.js" */

const custom_location_list = {    
    test_1: {
        id_name: 'test_1',
        name: 'Test 1',
        sketch: 'sketch_demo_1'
    },
    test_2: {
        id_name: 'test_2',
        name: 'Test 1',
        sketch: 'sketch_demo_2'
    },
    prologue_1: {
        id_name: 'prologue_1',
        name: 'Prologue 1',
        sketch: 'prologue_loc_1'
    },
    prologue_2: {
        id_name: 'prologue_2',
        name: 'Prologue 2',
        sketch: 'prologue_loc_2'
    },
    prologue_3: {
        id_name: 'prologue_3',
        name: 'Prologue 3',
        sketch: 'prologue_loc_3'
    },
    skip_passage: {
        id_name: 'skip_passage',
        name: 'Skip Passage',
        sketch: 'skip_passage_sketch'
    }
}
/* twine-user-script #22: "json_parties.js" */
const party_list = {
    "boss_of_the_gym": {
      "id_name": "boss_of_the_gym",
      "location": "Forest",
      "members": [
        "goblin",
        "goblin"
      ],
      "can_disband": "1"
    },
    "test_party": {
      "id_name": "test_party",
      "location": "Forest",
      "members": [
        "witch",
        "melissa",
        "goblin",
        "goblin"
      ]
    },
    "goblins_3": {
      "id_name": "goblins_3",
      "members": [
        "goblin",
        "goblin",
        "goblin"
      ]
    }
  }
/* twine-user-script #23: "json_quests.js" */

const quest_list = 
{
  "quest_tzmplate": {
    "id_name": "quest_tzmplate",
    "type": "main",
    "activation_flag": {
      "location": "Dream"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_tzmplate_1",
          "type": "distribute",
          "subject": "dagger",
          "amount": "1",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ],
      "2": [
        {
          "id_name": "quest_tzmplate_2",
          "type": "sketch",
          "subject": "sketch_demo_1",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  },
  "initial": {
    "id_name": "initial",
    "type": "main",
    "activation_flag": {
      "location": "Dream"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_initial",
          "type": "sketch",
          "subject": "sketch_demo_2",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  },
  "fight_test": {
    "id_name": "fight_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_fight_test_1",
          "type": "fight",
          "subject": "goblins_3",
          "location": "Home_Hallway"
        }
      ],
      "2": [
        {
          "id_name": "quest_fight_test_2",
          "type": "sketch",
          "subject": "sketch_demo_1",
          "location": "Home_Parents_Room"
        }
      ]
    }
  },
  "sketch_test": {
    "id_name": "sketch_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "sketch_task",
          "type": "sketch",
          "subject": "sketch_demo_1",
          "location": "Home_Parents_Room"
        }
      ]
    }
  },
  "eliminate_test": {
    "id_name": "eliminate_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_eliminate_test_1",
          "type": "eliminate",
          "subject": "goblin",
          "amount": "3",
          "location": "Home_Hallway"
        },
        {
          "id_name": "quest_eliminate_test_2",
          "type": "eliminate",
          "subject": "wolf",
          "amount": "2",
          "location": "Home_Hallway"
        }
      ]
    }
  },
  "search_test": {
    "id_name": "search_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_search_test_1",
          "type": "search",
          "amount": "2",
          "location": "Home_Hallway"
        },
        {
          "id_name": "quest_search_test_2",
          "type": "search",
          "amount": "1",
          "location": "Home_Hallway"
        }
      ],
      "2": [
        {
          "id_name": "quest_search_test_3",
          "type": "sketch",
          "subject": "test_quest_1",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  },
  "escort_test": {
    "id_name": "escort_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "quest_escort_test_1",
          "type": "escort",
          "subject": "melissa",
          "location": "Home_Hallway"
        },
        {
          "id_name": "escort_gather_socks",
          "is_optional": "1",
          "type": "gather",
          "subject": "socks",
          "amount": "6",
          "location": "Home_Hallway"
        }
      ]
    }
  },
  "escort_test_2": {
    "id_name": "escort_test_2",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "escort_test_2",
          "type": "escort",
          "subject": "alura",
          "location": "Home_Hallway"
        }
      ]
    }
  },
  "gather_test": {
    "id_name": "gather_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "gather_socks",
          "is_optional": "1",
          "type": "gather",
          "subject": "socks",
          "amount": "7",
          "location": "Home_Hallway"
        },
        {
          "id_name": "gather_keys",
          "is_optional": "1",
          "type": "gather",
          "subject": "key",
          "amount": "4",
          "location": "Home_Hallway"
        }
      ],
      "2": [
        {
          "id_name": "gather_stage_2",
          "type": "sketch",
          "subject": "sketch_demo_1",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  },
  "distribute_test": {
    "id_name": "distribute_test",
    "type": "main",
    "activation_flag": {
      "id_name": "initial_2",
      "value": "2",
      "location": "Home_Hallway"
    },
    "states": {
      "1": [
        {
          "id_name": "distribute_gather_socks",
          "type": "gather",
          "subject": "socks",
          "amount": "6",
          "location": "Home_Hallway"
        },
        {
          "id_name": "distribute_gather_keys",
          "type": "gather",
          "subject": "key",
          "amount": "3",
          "location": "Home_Hallway"
        }
      ],
      "2": [
        {
          "id_name": "distribute_socks",
          "type": "distribute",
          "subject": "socks",
          "amount": "6",
          "location": "Home_Hallway"
        },
        {
          "id_name": "distribute_keys",
          "type": "distribute",
          "subject": "key",
          "amount": "3",
          "location": "Home_Hallway"
        }
      ],
      "3": [
        {
          "id_name": "distribute_dagger",
          "type": "distribute",
          "subject": "dagger",
          "amount": "2",
          "location": "Home_Hallway"
        }
      ]
    }
  },
  "q_search_brooch": {
    "id_name": "q_search_brooch",
    "type": "main",
    "activation_flag": {
      "id_name": "initial",
      "value": "2",
      "location": "prologue_loc_1"
    },
    "states": {
      "1": [
        {
          "id_name": "prologue_search",
          "type": "search",
          "amount": "2",
          "location": "prologue_2",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $temp.custom_location = 'prologue_3'; >>",
            }
          ]
        }
      ],      
      "2": [
        {
          "id_name": "prologue_gather",
          "type": "gather",
          "subject": "brooch",
          "amount": "1",
          "location": "prologue_3",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $temp.cur_sketch = 'prologue_sk_2'>> <<run Engine.play('Uni_Sketch')>>",
            }
          ]
        }
      ]
    }
  },
  "q_had_i_changed": {
    "id_name": "q_had_i_changed",
    "type": "main",
    "activation_flag": {
      "id_name": "q_search_brooch",
      "value": "2",
      "location": ""
    },
    "states": {
      "1": [
        {
          "id_name": "prologue_talk_my_changes_melissa",
          "type": "sketch",
          "subject": "quest_had_i_changed_melissa",
          "location": "Talk_Menu",
          "location_character": "melissa"
        },
        {
          "id_name": "prologue_talk_my_changes_barret",
          "type": "sketch",
          "subject": "quest_had_i_changed_barret",
          "location": "Talk_Menu",
          "location_character": "barret"
        },
        {
          "id_name": "prologue_talk_my_changes_alura",
          "type": "sketch",
          "subject": "quest_had_i_changed_alura",
          "location": "Talk_Menu",
          "location_character": "alura"
        }
      ],
      "2": [
        {
          "id_name": "prologue_talk_my_changes_final",
          "type": "sketch",
          "subject": "quest_had_i_changed_final",
          "location": "Mirror_Room"
        }
      ]
    }
  },
  "q_barrets_matters": {
    "id_name": "q_barrets_matters",
    "type": "main",    
    "activation_flag": {
      "id_name": "q_search_brooch",
      "value": "2",
      "location": ""
    },
    "states": {
      "1": [
        {
          "id_name": "prologue_talk_barret",
          "type": "sketch",
          "subject": "quest_barrets_matters",
          "location": "Talk_Menu",
          "location_character": "barret"
        }
      ]
    }
  },
  "q_return_brooch": {
    "id_name": "q_return_brooch",
    "type": "main",
    "activation_flag": {
      "id_name": "q_search_brooch",
      "value": "2",
      "location": ""
    },
    "states": {
      "1": [
        {
          "id_name": "prologue_talk_brooch",
          "type": "sketch",
          "subject": "quest_return_brooch",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  },
  "q_swim_melissa": {
    "id_name": "q_swim_melissa",
    "type": "main",    
    "activation_flag": {
      "id_name": "q_return_brooch",
      "value": "2",
      "location": ""
    },
    "states": {
      "1": [
        {
          "id_name": "swim_melissa_talk_1",
          "type": "sketch",
          "subject": "quest_melissa_swim",
          "location": "Talk_Menu",
          "location_character": "melissa"
        }
      ]
    }
  }
}
/* twine-user-script #24: "json_schedules.js" */

const schedule_list = 
{
    "base_melissa": {
      "id_name": "base_melissa",
      "character_idn": "melissa",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_melissa"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8"
          ],
          "assignments": [
            "yard_bath"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5"
          ],
          "hours": [
            "10",
            "11",
            "12"
          ],
          "assignments": [
            "studying_melissa"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14",
            "15"
          ],
          "assignments": [
            "play_with_friends_melissa"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "16",
            "17"
          ],
          "assignments": [
            "home_cooking",
            "home_cleaning"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "18"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "home_cooking",
            "home_cleaning"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "play_wardrobe"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_melissa"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "6",
            "7"
          ],
          "hours": [
            "10",
            "11",
            "12"
          ],
          "assignments": [
            "daydreaming_melissa"
          ]
        }
      ]
    },
    "base_alura": {
      "id_name": "base_alura",
      "character_idn": "alura",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8"
          ],
          "assignments": [
            "sleeping_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9"
          ],
          "assignments": [
            "eating_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5"
          ],
          "hours": [
            "10",
            "11",
            "12"
          ],
          "assignments": [
            "mending_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14",
            "15"
          ],
          "assignments": [
            "cleaning_alura",
            "cooking_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "16",
            "17"
          ],
          "assignments": [
            "cleaning_alura",
            "cooking_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "18"
          ],
          "assignments": [
            "eating_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "hanging_out_barret_center"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "reading_book_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_alura"
          ]
        }
      ]
    },
    "base_barret": {
      "id_name": "base_barret",
      "character_idn": "barret",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9"
          ],
          "assignments": [
            "learning_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "10"
          ],
          "assignments": [
            "assisting_forge"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "11",
            "12"
          ],
          "assignments": [
            "smelting",
            "crafting_tools"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14"
          ],
          "assignments": [
            "smelting",
            "crafting_tools"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "15",
            "16"
          ],
          "assignments": [
            "smelting",
            "crafting_tools"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "17",
            "18"
          ],
          "assignments": [
            "training_warders"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "hanging_out_alura_center"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "resting_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        }
      ]
    },
    "base_savia": {
      "id_name": "base_savia",
      "character_idn": "savia",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
            "19",
            "20",
            "21"
          ],
          "assignments": [
            "reading_book_wizard",
            "study_spells_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        }
      ]
    },    
    "base_witch": {
      "id_name": "base_witch",
      "character_idn": "witch",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
            "19",
            "20",
            "21"
          ],
          "assignments": [
            "reading_book_wizard",
            "study_spells_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        }
      ]
    },    
    "base_sekhmau": {
      "id_name": "base_sekhmau",
      "character_idn": "sekhmau",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
            "19",
            "20",
            "21"
          ],
          "assignments": [
            "reading_book_wizard",
            "study_spells_wizard"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_wizard"
          ]
        }
      ]
    },
    "base_mother": {
      "id_name": "base_mother",
      "character_idn": "mother",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_parents"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9",
            "10",
            "11",
          ],
          "assignments": [
            "home_cleaning_parents",
            "home_cooking"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "12",
            "13",
            "14",
            "15",
            "16",
          ],
          "assignments": [
            "home_cleaning_yard",
            "home_cleaning_parents"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "16",
            "17",
            "18",
          ],
          "assignments": [
            "home_cooking"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "20",
            "21"
          ],
          "assignments": [
            "resting_parents"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_parents"
          ]
        }
      ]
    },
    "base_father": {
      "id_name": "base_father",
      "character_idn": "father",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_parents"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
          ],
          "assignments": [
            "home_father_work"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19"
          ],
          "assignments": [
            "home_eating"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "20",
            "21"
          ],
          "assignments": [
            "resting_parents"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_parents"
          ]
        }
      ]
    },
    "base_mr_smith": {
      "id_name": "base_mr_smith",
      "character_idn": "mr_smith",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9"
          ],
          "assignments": [
            "teaching_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "10"
          ],
          "assignments": [
            "forging_weapon"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "11",
            "12"
          ],
          "assignments": [
            "forging_weapon",
            "talking_with_customer_smith",
            "crafting_tools"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14"
          ],
          "assignments": [
            "talking_with_customer_smith",            
            "crafting_tools"        
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "15",
            "16"
          ],
          "assignments": [
            "smelting",
            "talking_with_customer_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "17",
            "18"
          ],
          "assignments": [
            "forging_weapon",
            "talking_with_customer_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "crafting_tools",
            "forging_weapon"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "visiting_tailor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        }
      ]
    },
    "base_mrs_smith": {
      "id_name": "base_mrs_smith",
      "character_idn": "mrs_smith",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9",
            "10"
          ],
          "assignments": [
            "cooking_smith",
            "cleaning_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "11",
            "12"
          ],
          "assignments": [
            "managing_finances_smith",
            "mending_clothes_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14"
          ],
          "assignments": [
            "managing_finances_smith",
            "mending_clothes_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "15",
            "16",
            "17",
            "18"
          ],
          "assignments": [
            "managing_finances_smith",
            "mending_clothes_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "cleaning_smith",
            "cooking_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "resting_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_smith"
          ]
        }
      ]
    },
    "base_ms_taylor": {
      "id_name": "base_ms_taylor",
      "character_idn": "ms_taylor",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "assignments": [
            "sleeping_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8",
            "9"
          ],
          "assignments": [
            "cooking_taylor",
            "cleaning_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "10",
            "11",
            "12"
          ],
          "assignments": [
            "talking_with_customer_taylor",
            "work_on_orders_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "13",
            "14"
          ],
          "assignments": [
            "talking_with_customer_taylor",
            "work_on_orders_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "15",
            "16"
          ],
          "assignments": [
            "talking_with_customer_taylor",
            "work_on_orders_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "17",
            "18"
          ],
          "assignments": [
            "talking_with_customer_taylor",
            "work_on_orders_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19",
            "20"
          ],
          "assignments": [
            "cooking_taylor",
            "cleaning_taylor"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "21"
          ],
          "assignments": [
            "talking_smith"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_taylor"
          ]
        }
      ]
    },
    "base_amelina": {
      "id_name": "base_amelina",
      "character_idn": "amelina",
      "list": [
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
          ],
          "assignments": [
            "sleeping_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "7"
          ],
          "assignments": [
            "cooking_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "8"
          ],
          "assignments": [
            "eating_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9",
            "10",
            "11",
            "12",
            "13",
            "14",
            "15",
            "16",
            "17",
            "18",
          ],
          "assignments": [
            "work_on_fields"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "19"
          ],
          "assignments": [
            "eating_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "20",
            "21"
          ],
          "assignments": [
            "reading_book_alura"
          ]
        },
        {
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "22",
            "23"
          ],
          "assignments": [
            "sleeping_alura"
          ]
        }
      ]
    },
    "update_melissa_1": {
      "id_name": "update_melissa_1",
      "character_idn": "melissa",
      "list": [
        {
          "assignments": [
            "sleeping_melissa"
          ],
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "9",
            "10"
          ]
        },
        {
          "assignments": [
            "sleeping_melissa"
          ],
          "months": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            "10",
            "11",
            "12"
          ],
          "days_of_week": [
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7"
          ],
          "hours": [
            "11",
            "12"
          ]
        }
      ]
    }
  }
/* twine-user-script #25: "json_sketches.js" */
const sketch_list = {
  "sketch_warning": {
    "id_name": "sketch_warning",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        }
      }
    }
  },
  "sketch_demo_1": {
    "id_name": "sketch_demo_1",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "player",
          "posture": "scarred"
        },
        "el_2": {
          "type": "injection",
          "injection": "<<fadein 3s .5s>><<fadeout 2s 6s>> FadeIn Text Test <br><br> <</fadeout>><</fadein>>"
        },
      },
      "page_2": {
        "el_1": {
          "type": "speech",
          "character": "melissa",
          "posture": "happy"
        }
      }
    }
  },
  "sketch_demo_2": {
    "id_name": "sketch_demo_2",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_2": {
          "type": "choice",
          "move_to": "passage",
          "passage": "test_1",
          "page_link": "page_2",
          "link_type": "default"
        },
        "el_3": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "link_type": "danger"
        }
      },
      "page_2": {
        "el_1": {
          "type": "text",
          "text_type": "gesture"
        }
      }
    }
  },
  "test_quest_1": {
    "id_name": "test_quest_1",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "choice",
          "move_to": "passage",
          "passage": "Home_Kitchen",
          "link_type": "default",
          "actions": [
            {
              "type": "start_quest",
              "quest": "gather_test"
            },
            {
              "type": "fail_task",
              "quest": "fight_test",
              "task": "quest_fight_test_2"
            }
          ]
        }
      }
    }
  },
  "prologue_loc_1": {
    "id_name": "prologue_loc_1",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "ceiling.png"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_anticipation.png"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "choice",
          "passage": "Home_Bedroom",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_1",
          "link_type": "default"
        }
      }
    }
  },
  "prologue_sk_1": {
    "id_name": "prologue_sk_1",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_2": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_5": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_8": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_sparkling_eyes.png"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_11": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_12": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_13": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_14": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_16": {
          "type": "text",
          "text_type": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_20": {
          "type": "text",
          "text_type": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_22": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_23": {
          "type": "text",
          "text_type": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_25": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_26": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_27": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_28": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_29": {
          "type": "text",
          "text_type": "thought"
        },
        "el_30": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "quest",
          "actions": [
            {
              "type": "start_quest",
              "quest": "q_search_brooch"
            }
          ]
        }
      },
      "page_2": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_4": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_hug.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_9": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "choice",
          "move_to": "passage",
          "passage": "prologue_2",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "location",
          "actions": [
            {
              "type": "add_time",
              "minute": "30",
              "hour": "0",
              "day": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "reduce",
              "value": "5"
            }
          ]
        }
      }
    }
  },
  "prologue_loc_2": {
    "id_name": "prologue_loc_2",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "lake_1.webp",
          "width": "580",
          "height": "320",
          "img_style": "location"
        },
        "el_2": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_counter",
              "quest": "q_search_brooch",
              "task": "prologue_search",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_counter",
              "quest": "q_search_brooch",
              "task": "prologue_search",
              "comparatives": "greater_equal",
              "value": "1"
            },
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "greater_equal",
              "value": "75"
            }
          ],
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "conditions": [
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "greater_equal",
              "value": "75"
            }
          ],
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "conditions": [
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "less",
              "value": "50"
            }
          ],
          "text_type": "default"
        },
        "el_6": {
          "type": "text",
          "conditions": [
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "less",
              "value": "75"
            }
          ],
          "text_type": "thought"
        },
        "el_7": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_counter",
              "quest": "q_search_brooch",
              "task": "prologue_search",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "text_type": "thought"
        },
        "el_8": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_counter",
              "quest": "q_search_brooch",
              "task": "prologue_search",
              "comparatives": "greater_equal",
              "value": "1"
            },
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "greater_equal",
              "value": "75"
            }
          ],
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "conditions": [
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "less_equal",
              "value": "90"
            },
            {
              "type": "check_param",
              "character": "player",
              "param": "stamina",
              "comparatives": "greater_equal",
              "value": "75"
            }
          ],
          "text_type": "thought"
        }
      }
    }
  },
  "prologue_loc_3": {
    "id_name": "prologue_loc_3",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "lake_4.jpg",
          "width": "500",
          "height": "320"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        }
      }
    }
  },
  "skip_passage_sketch": {
    "id_name": "skip_passage_sketch",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "choice",
          "move_to": "passage",
          "passage": "Home_Bedroom",
          "sketch_idn": "prologue_sk_3",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $settings.interface.time.day_of_week = 1>>, <<set $settings.interface.time.month = 1>>, <<set $settings.interface.time.hours = 1>>, <<set $settings.interface.bars.health = 1>>, <<set $settings.interface.bars.stamina = 1>>, <<set $settings.interface.bars.mana = 1>>, <<set $settings.interface.exp.level = 1>>, <<set $settings.interface.menu_story.help = 1>>, <<set $settings.interface.menu_story.party = 1>>,  <<set $settings.interface.stats.player_name=1>>, <<set $settings.interface.stats.money = 1>>"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "3",
              "day": "1"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health_max",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina_max",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "set",
              "value": "20"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "30"
            },
            {
              "type": "set_time",
              "hour": "9",
              "minute": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "lvl",
              "change_type": "set",
              "value": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "exp",
              "change_type": "set",
              "value": "0"
            },
            {
              "type": "start_quest",
              "quest": "q_search_brooch"
            },
            {
              "type": "finish_task",
              "quest": "q_search_brooch",
              "task": "prologue_search"
            },
            {
              "type": "finish_task",
              "quest": "q_search_brooch",
              "task": "prologue_gather"
            }
          ]
        }
      }
    }
  },
  "prologue_sk_2": {
    "id_name": "prologue_sk_2",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "brooch.png",
          "width": "256",
          "height": "256"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "artifact_1.png",          
          "width": "256",
          "height": "300",
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "depth.webp"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_3",
          "link_type": "default"
        }
      }
    }
  },
  "prologue_sk_3": {
    "id_name": "prologue_sk_3",
    "pages": {
      "page_1": {
        "el_13": {
          "type": "injection",
          "injection": "<<fadein 2s 0s>> "
        },
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_14": {
          "type": "injection",
          "injection": "<</fadein>>"
        },
        "el_15": {
          "type": "injection",
          "injection": "<<fadein 2s 2.5s>> "
        },
        "el_3": {
          "type": "injection",
          "injection": "<<shadowed_img 'sketches/prologue/kalithara.png' '256' '300' >> <<br>>"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_16": {
          "type": "injection",
          "injection": "<</fadein>>"
        },
        "el_17": {
          "type": "injection",
          "injection": "<<fadein 2s 5.5s>> "
        },
        "el_6": {
          "type": "injection",
          "injection": "<<shadowed_img 'sketches/prologue/global_catastrophe.png'>><<br>>"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_18": {
          "type": "injection",
          "injection": "<</fadein>>"
        },
        "el_19": {
          "type": "injection",
          "injection": "<<fadein 2s 8.5s>> "
        },
        "el_9": {
          "type": "injection",
          "injection": "<<shadowed_img 'sketches/prologue/witch_samples.webp' '256' '300' >><<br>>"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_20": {
          "type": "injection",
          "injection": "<</fadein>>"
        },
        "el_21": {
          "type": "injection",
          "injection": "<<fadein 2s 11s>> "
        },
        "el_12": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_4",
          "link_type": "default",
          "actions": [
            {
              "type": "add_time",
              "minute": "30",
              "hour": "1",
              "day": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "reduce",
              "value": "30"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "50"
            }
          ]
        },
        "el_22": {
          "type": "injection",
          "injection": "<</fadein>>"
        }
      }
    }
  },
  "prologue_sk_4": {
    "id_name": "prologue_sk_4",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "Forest_Hut_Witch_Bedroom.jpg",
          "width": "256",
          "height": "300",
          "img_style": "location"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "witch_first_contact.png",
          "width": "256",
          "height": "300",
          "img_style": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_14": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_flag",
              "flag": "witch_prologue_behavior",
              "value": "1"
            }
          ]
        },
        "el_15": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_flag",
              "flag": "witch_prologue_behavior",
              "value": "2"
            }
          ]
        }
      },
      "page_2": {
        "el_1": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_7": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_9": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_4",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_3": {
        "el_1": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_4",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_4": {
        "el_1": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_behavior",
              "comparatives": "equal",
              "value": "1"
            }
          ],
          "character": "witch",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_behavior",
              "comparatives": "equal",
              "value": "2"
            }
          ],
          "character": "witch",
          "posture": "default"
        },
        "el_8": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_6",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_flag",
              "flag": "witch_prologue_trust",
              "value": "1"
            },
            {
              "type": "add_time",
              "minute": "30",
              "hour": "0",
              "day": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "reduce",
              "value": "20"
            }
          ]
        },
        "el_9": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_5",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_5": {
        "el_1": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_6": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_7",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_flag",
              "flag": "witch_prologue_trust",
              "value": "1"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "1",
              "day": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "reduce",
              "value": "40"
            }
          ],
        },
        "el_7": {
          "type": "choice",
          "passage": "Forest",
          "page_link": "page_1",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_5",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_6": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_3": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_5": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_7",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_flag",
              "flag": "witch_prologue_trust",
              "value": "2"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "1",
              "day": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "reduce",
              "value": "40"
            }
          ]
        },
        "el_10": {
          "type": "choice",
          "passage": "Forest",
          "page_link": "page_1",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_5",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_7": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_6": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_9": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_de_1",
          "fake": "",
          "link_type": "dead_end",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "set",
              "value": "1"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "1"
            }
          ]
        },
        "el_10": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_5",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "reduce",
              "value": "10"
            }
          ]
        }
      }
    }
  },
  "prologue_sk_de_1": {
    "id_name": "prologue_sk_de_1",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "injection",
          "injection": "<<fadein 2s >> <<fadeout 1.5s 4s>>\n"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_4": {
          "type": "injection",
          "injection": "<<fadein 2s 6s>><<fadeout 1.5s 10s>> \n"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_7": {
          "type": "injection",
          "injection": "<<fadein 2s 12s>><<fadeout 1.5s 14s>> "
        },
        "el_8": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_9": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_10": {
          "type": "injection",
          "injection": "<<fadein 2s 16s>><<fadeout 1.5s 18s>> \n"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_13": {
          "type": "injection",
          "injection": "<<fadein 2s 20s>><<fadeout 1.5s 22s>> \n"
        },
        "el_14": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_15": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_16": {
          "type": "injection",
          "injection": "<<fadein 2s 24s>><<fadeout 1.5s 26s>> "
        },
        "el_17": {
          "type": "text",
          "text_type": "default"
        },
        "el_18": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_19": {
          "type": "injection",
          "injection": "<<fadein 2s 28s>><<fadeout 1.5s 32s>> \n  "
        },
        "el_20": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_21": {
          "type": "injection",
          "injection": "<</fadeout>><</fadein>>"
        },
        "el_22": {
          "type": "injection",
          "injection": "<<fadein 2s 34s>>  \n"
        },
        "el_23": {
          "type": "text",
          "text_type": "default"
        },
        "el_24": {
          "type": "injection",
          "injection": "<</fadein>>"
        },
        "el_25": {
          "type": "injection",
          "injection": "<<fadein 2s 36s>>\n"
        },
        "el_26": {
          "type": "choice",
          "move_to": "passage",
          "passage": "Uni_Deadend",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        },
        "el_27": {
          "type": "injection",
          "injection": "<</fadein>>"
        }
      }
    }
  },
  "prologue_sk_5": {
    "id_name": "prologue_sk_5",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "greater",
              "value": "0"
            }
          ],
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "character": "witch",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "greater",
              "value": "0"
            }
          ],
          "character": "player",
          "posture": "scarred"
        },
        "el_4": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "character": "player",
          "posture": "scarred"
        },
        "el_5": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_6": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "greater",
              "value": "0"
            }
          ],
          "character": "player",
          "posture": "scarred"
        },
        "el_7": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "character": "player",
          "posture": "scarred"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_9": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "greater",
              "value": "0"
            }
          ],
          "character": "witch",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_trust",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "character": "witch",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_14": {
          "type": "text",
          "text_type": "default"
        },
        "el_15": {
          "type": "text",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_behavior",
              "comparatives": "equal",
              "value": "1"
            }
          ],
          "text_type": "thought"
        },
        "el_16": {
          "type": "text",
          "conditions": [
            {
              "type": "check_flag",
              "flag": "witch_prologue_behavior",
              "comparatives": "equal",
              "value": "2"
            }
          ],
          "text_type": "thought"
        },
        "el_17": {
          "type": "text",
          "text_type": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "mc",
          "posture": "scarred"
        },
        "el_19": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_20": {
          "type": "text",
          "text_type": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "default"
        },
        "el_22": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "reduce",
              "value": "5"
            }
          ]
        }
      },
      "page_2": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "Village_Outside.jpg",
          "width": "",
          "height": "",
          "img_style": "location"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "text",
          "text_type": "default"
        },
        "el_14": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "Home_Bedroom",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_6",
          "fake": "",
          "link_type": "location",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "5"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "5"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "8",
              "day": "0"
            },
            {
              "type": "set_time",
              "minute": "0",
              "hour": "8",
            }
          ]
        }
      }
    }
  },
  "prologue_sk_6": {
    "id_name": "prologue_sk_6",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $characters.mc = $player;>> <<set $player = $characters.kalithara;>>"
            }
          ]
        }
      },
      "page_2": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "kalithara_mirror.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "unknown_woman",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "player",
          "character_name_specific": "void_woman",
          "posture": "younger"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "witch_younger.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_10": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_11": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_12": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_13": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_14": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_15": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_16": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_17": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_18": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_19": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_20": {
          "type": "speech",
          "character": "player",
          "posture": "younger"
        },
        "el_21": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_22": {
          "type": "speech",
          "character": "witch",
          "posture": "younger"
        },
        "el_23": {
          "type": "text",
          "text_type": "default"
        },
        "el_24": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_25": {
          "type": "text",
          "text_type": "thought"
        },
        "el_27": {
          "type": "text",
          "text_type": "default"
        },
        "el_27": {
          "type": "choice",
          "passage": "Home_Bedroom",
          "page_link": "page_1",
          "move_to": "sketch",
          "sketch_idn": "prologue_loc_4",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $characters.kalithara = $player;>> <<set $player = $characters.mc;>> "
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina_max",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health_max",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "30"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "health",
              "change_type": "set",
              "value": "20"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "lvl",
              "change_type": "set",
              "value": "0"
            },
            {
              "type": "change_param",
              "character": "player",
              "param": "exp",
              "change_type": "set",
              "value": "0"
            }
          ]
        }
      }
    }
  },
  "prologue_loc_4": {
    "id_name": "prologue_loc_4",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_sleeping.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "choice",
          "passage": "Home_Bedroom",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_2": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_sleepy.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_crying.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_15": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        },
      },
      "page_3": {
        "el_1": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_5": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_8": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_15": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_16": {
          "type": "text",
          "text_type": "thought"
        },
        "el_17": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_hug_crying.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_18": {
          "type": "text",
          "text_type": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_23": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_25": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_26": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_27": {
          "type": "text",
          "text_type": "default"
        },
        "el_28": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_headpat.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_29": {
          "type": "text",
          "text_type": "default"
        },
        "el_30": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_31": {
          "type": "text",
          "text_type": "thought"
        },
        "el_32": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_de_2_melissa",
          "fake": "",
          "link_type": "dead_end",
          "actions": [
            {
              "type": "add_time",
              "minute": "15",
              "hour": "0",
              "day": "0"
            }
          ]
        },        
        "el_33": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_4",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_4": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_15": {
          "type": "text",
          "text_type": "thought"
        },
        "el_16": {
          "type": "text",
          "text_type": "thought"
        },
        "el_17": {
          "type": "text",
          "text_type": "thought"
        },
        "el_18": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_5",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_5": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_15": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "melissa_grin.png",
        },
        "el_16": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_17": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_18": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "default"
        },
        "el_23": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_25": {
          "type": "text",
          "text_type": "default"
        },
        "el_26": {
          "type": "choice",
          "move_to": "passage",
          "passage": "Mirror_Room",
          "page_link": "page_1",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "injection_action",
              "injection_action": "<<set $settings.interface.stats.money = 1>> <<set $settings.interface.menu_story.party = 1>>"
            }
          ]
          
        }
      }
    }
  },
  "prologue_sk_de_2_melissa": {
    "id_name": "prologue_sk_de_2_melissa",
    "pages": {
      "page_1": {          
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },    
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_10": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_16": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "location",
          "actions": [
            {
              "type": "change_param",
              "character": "mc",
              "param": "stamina",
              "change_type": "reduce",
              "value": "5"
            },            
            {
              "type": "add_time",
              "minute": "10",
              "hour": "0",
              "day": "0"
            }
          ]
        }
      },
      "page_2": {     
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "House_Wizard.jpg",
          "width": "",
          "height": "",
          "img_style": "location"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "wizard_portrait.png",
          "width": "256",
          "height": "320"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "text",
          "text_type": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "default"
        },
        "el_15": {
          "type": "text",
          "text_type": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "default"
        },
        "el_22": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_23": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "add_time",
              "minute": "30",
              "hour": "1",
              "day": "0"
            }
          ]
        }
      },
      "page_3": {     
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "thought"
        },
        "el_22": {
          "type": "text",
          "text_type": "thought"
        },
        "el_23": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_de_2_final",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "mc",
              "param": "health",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "2",
              "day": "3"
            }
          ]
        }
      } 
    }
  },
  "prologue_sk_de_2_barret": {
    "id_name": "prologue_sk_de_2_barret",
    "pages": {
      "page_1": {          
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },    
        "el_3": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_15": {
          "type": "text",
          "text_type": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_17": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "location",
          "actions": [
            {
              "type": "change_param",
              "character": "mc",
              "param": "stamina",
              "change_type": "reduce",
              "value": "5"
            },            
            {
              "type": "add_time",
              "minute": "10",
              "hour": "0",
              "day": "0"
            }
          ]
        }
      },
      "page_2": {    
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "House_Wizard.jpg",
          "width": "",
          "height": "",
          "img_style": "location"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "wizard_portrait.png",
          "width": "256",
          "height": "320"
        },    
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "text",
          "text_type": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "default"
        },
        "el_23": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_24": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "add_time",
              "minute": "30",
              "hour": "1",
              "day": "0"
            }
          ]
        }
      },
      "page_3": {     
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "thought"
        },
        "el_23": {
          "type": "text",
          "text_type": "thought"
        },
        "el_24": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_de_2_final",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "mc",
              "param": "health",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "2",
              "day": "3"
            }
          ]
        }
      } 
    }
  },
  "prologue_sk_de_2_alura": {
    "id_name": "prologue_sk_de_2_alura",
    "pages": {
      "page_1": {          
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_3": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_4": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_5": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "alura_hug.png",
          "width": "256",
          "height": "320"
        }, 
        "el_6": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_7": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_8": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_10": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_11": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_13": {
          "type": "text",
          "text_type": "thought"
        }, 
        "el_14": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_16": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_17": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_18": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_alura",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "alura",
          "posture": "default"
        }, 
        "el_19": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_20": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_21": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_22": {
          "type": "text",
          "text_type": "thought"
        }, 
        "el_23": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        }, 
        "el_24": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        }, 
        "el_25": {
          "type": "text",
          "text_type": "default"
        }, 
        "el_26": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "location",
          "actions": [
            {
              "type": "change_param",
              "character": "mc",
              "param": "stamina",
              "change_type": "reduce",
              "value": "5"
            },            
            {
              "type": "add_time",
              "minute": "10",
              "hour": "0",
              "day": "0"
            }
          ]
        }
      },
      "page_2": {     
        "el_1": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "House_Wizard.jpg",
          "width": "",
          "height": "",
          "img_style": "location"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "wizard_portrait.png",
          "width": "256",
          "height": "320"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "text",
          "text_type": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "default"
        },
        "el_22": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_23": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "add_time",
              "minute": "30",
              "hour": "1",
              "day": "0"
            }
          ]
        }
      },
      "page_3": {     
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "thought"
        },
        "el_23": {
          "type": "text",
          "text_type": "thought"
        },
        "el_24": {
          "type": "choice",
          "move_to": "sketch",
          "passage": "pre_sketch_passage",
          "page_link": "page_1",
          "sketch_idn": "prologue_sk_de_2_final",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_param",
              "character": "player",
              "param": "stamina",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "change_param",
              "character": "mc",
              "param": "health",
              "change_type": "set",
              "value": "50"
            },
            {
              "type": "add_time",
              "minute": "0",
              "hour": "2",
              "day": "3"
            }
          ]
        }
      } 
    }
  },
  "prologue_sk_de_2_final": {
    "id_name": "prologue_sk_de_2_final",
    "pages": {
      "page_1": {     
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "wizard",
          "posture": "default"
        },
        "el_14": {
          "type": "text", 
          "text_type": "default"
        },
        "el_15": {
          "type": "text", 
          "text_type": "default"
        },
        "el_16": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "jovan.png",
        },
        "el_17": {
          "type": "speech",
          "character": "jovan",
          "character_name_specific": "tall_man",          
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_22": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_23": {
          "type": "text",
          "text_type": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "mother",
          "posture": "default"
        },
        "el_25": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_2": {   
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_9": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "text_type": "thought"
        },
        "el_10": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "1"
            }
          ],
          "text_type": "thought"
        },
        "el_11": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_16": {
          "type": "text",
          "text_type": "thought"
        },
        "el_17": {
          "type": "speech",
          "character": "mother",
          "posture": "default"
        },
        "el_18": {
          "type": "text",
          "text_type": "default"
        },
        "el_19": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "mother",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_22": {
          "type": "text",
          "text_type": "default"
        },
        "el_23": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_25": {
          "type": "text",
          "text_type": "default"
        },
        "el_26": {
          "type": "text",
          "text_type": "thought"
        },
        "el_27": {
          "type": "text",
          "text_type": "default"
        },
        "el_28": {
          "type": "speech",
          "character": "jovan",
          "posture": "default"
        },
        "el_29": {
          "type": "text",
          "text_type": "default"
        },
        "el_30": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_31": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_32": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_alura_matters",
              "comparatives": "greater_equal",
              "value": "1"
            }
          ],
          "text_type": "default"
        },
        "el_33": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "add_time",
              "minute": "0",
              "hour": "6",
              "day": "0"
            }
          ]
        }
      },
      "page_3": {     
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },        
        "el_10": {
          "type": "text",
          "text_type": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "default"
        },
        "el_13": {
          "type": "text",
          "text_type": "thought"
        },
        "el_14": {
          "type": "text",
          "text_type": "thought"
        },
        "el_15": {
          "type": "text",
          "text_type": "default"
        },
        "el_16": {
          "type": "text",
          "text_type": "default"
        },
        "el_17": {
          "type": "image",
          "media_folder": "prologue",
          "media_file": "witch_sorrow_door.png",
        },
        "el_18": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_19": {
          "type": "speech",
          "character": "witch",
          "posture": "default"
        },
        "el_20": {
          "type": "text",
          "text_type": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "default"
        },
        "el_22": {
          "type": "choice",
          "move_to": "passage",
          "passage": "Uni_Deadend",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "sketch_personal_mc": {
    "id_name": "sketch_personal_mc",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_locations_limit",
          "fake": "",
          "link_type": "personal"
        },
        "el_2": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_keep_silent",
          "fake": "",
          "link_type": "personal"
        },
        "el_3": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_power_of_order",
          "fake": "",
          "link_type": "personal"
        },
        "el_4": {
          "type": "choice",          
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_return_brooch",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_give_brooch",
          "fake": "",
          "link_type": "personal_quest"
        },
        "el_5": {
          "type": "choice",          
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_barrets_matters",
          "fake": "",
          "link_type": "personal_quest",
        },
        "el_6": {
          "type": "choice",          
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_had_i_changed",
              "comparatives": "less",
              "value": "1"
            }
          ],
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "sketch_personal_mc_i_changed",
          "fake": "",
          "link_type": "personal_quest",
        }
      }
    }
  },
  "sketch_personal_mc_locations_limit": {
    "id_name": "sketch_personal_mc_locations_limit",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  }, 
  "sketch_personal_mc_keep_silent": {
    "id_name": "sketch_personal_mc_keep_silent",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  }, 
  "sketch_personal_mc_power_of_order": {
    "id_name": "sketch_personal_mc_power_of_order",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },        
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },        
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },  
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },  
        "el_6": {
          "type": "text",
          "text_type": "thought",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ]
        },  
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },  
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  }, 
  "sketch_personal_mc_give_brooch": {    
    "id_name": "sketch_personal_mc_give_brooch",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "quest",
          "actions": [
            {
              "type": "start_quest",
              "quest": "q_return_brooch"
            }
          ]
        },
        "el_10": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "sketch_personal_mc_barrets_matters": {
    "id_name": "sketch_personal_mc_barrets_matters",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "quest",
          "actions": [
            {
              "type": "start_quest",
              "quest": "q_barrets_matters"
            }
          ]
        },
        "el_6": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "sketch_personal_mc_i_changed": {
    "id_name": "sketch_personal_mc_i_changed",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "mc_new_look.png",
          "width": "",
          "height": "",
          "img_style": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "quest",
          "actions": [
            {
              "type": "start_quest",
              "quest": "q_had_i_changed"
            }
          ]
        },
        "el_13": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "sketch_personal_melissa": {
    "id_name": "sketch_personal_melissa",
    "pages": {
      "page_1": {
        "el_2": {
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_return_brooch",
              "comparatives": "equal",
              "value": "2"
            }
          ],
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "sketch",
          "sketch_idn": "quest_melissa_swim",
          "fake": "",
          "link_type": "personal_quest"          
        }
      }
    }
  },
  "quest_return_brooch": {
    "id_name": "quest_return_brooch",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_4": {
          "type": "text",
          "text_type": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_2": {
        "el_1": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "melissa_sad.png"
        },
        "el_5": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_15": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "melissa_smile.png"
        },
        "el_16": {
          "type": "text",
          "text_type": "thought"
        },
        "el_17": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_19": {
          "type": "text",
          "text_type": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_22": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_23": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_25": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default",
          "actions": [
            {
              "type": "change_schedule_current_hour",
              "character": "melissa",
              "assignment": "q_return_brooch"
            }
          ]
        }
      }
    }
  },
  "quest_barrets_matters": {
    "id_name": "quest_barrets_matters",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "mrs_smith",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mrs_smith",
          "posture": "default"
        },
        "el_6": {
          "type": "text",
          "text_type": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mrs_smith",
          "posture": "default"
        },
        "el_8": {
          "type": "text",
          "text_type": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_15": {
          "type": "text",
          "text_type": "thought"
        },
        "el_16": {
          "type": "text",
          "text_type": "thought"
        },
        "el_17": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "page_link": "page_2",
          "move_to": "sketch",
          "sketch_idn": "prologue_sk_de_2_barret",
          "fake": "",
          "link_type": "dead_end",
          "actions": [
            {
              "type": "finish_task",
              "quest": "q_barrets_matters",
              "task": "prologue_talk_barret"
            }
          ]
        },
        "el_18": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_2",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_2": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_2": {
          "type": "text",
          "text_type": "default"
        },
        "el_3": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "text_type": "thought"
        },
        "el_6": {
          "type": "text",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "text_type": "thought"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_barret",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_14": {
          "type": "text",
          "text_type": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "choice",
          "passage": "pre_sketch_passage",
          "move_to": "page",
          "page_link": "page_3",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      },
      "page_3": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_4": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_5": {
          "type": "text",
          "text_type": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_15": {
          "type": "text",
          "text_type": "thought"
        },
        "el_16": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_18": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_19": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "page_link": "page_1",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "quest_had_i_changed_melissa": {
    "id_name": "quest_had_i_changed_melissa",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_15": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "quest_had_i_changed_barret": {
    "id_name": "quest_had_i_changed_barret",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_3": {
          "type": "text",
          "text_type": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_11": {
          "type": "text",
          "text_type": "default"
        },
        "el_12": {
          "type": "text",
          "text_type": "thought"
        },
        "el_13": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "barret_examining.png"
        },
        "el_14": {
          "type": "text",
          "text_type": "thought"
        },
        "el_15": {
          "type": "text",
          "text_type": "default"
        },
        "el_16": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_17": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "barret_embarrassed_not_looking.png"
        },
        "el_18": {
          "type": "text",
          "text_type": "thought"
        },
        "el_19": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_20": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_21": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_22": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_23": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_24": {
          "type": "text",
          "text_type": "gesture"
        },
        "el_25": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "barret_embarrassed.png"
        },
        "el_26": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_27": {
          "type": "text",
          "text_type": "thought"
        },
        "el_28": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_29": {
          "type": "text",
          "text_type": "thought"
        },
        "el_30": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_31": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_32": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_33": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_34": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_35": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "mc",
          "posture": "default"
        },
        "el_36": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "character": "barret",
          "posture": "default"
        },
        "el_37": {
          "type": "text",
          "conditions": [
            {
              "type": "check_quest_status",
              "quest": "q_barrets_matters",
              "comparatives": "greater_equal",
              "value": "2"
            }
          ],
          "text_type": "default"
        },
        "el_38": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_39": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_alura",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "mc",
          "posture": "default"
        },
        "el_40": {
          "type": "speech",
          "conditions": [
            {
              "type": "check_task_status",
              "quest": "q_had_i_changed",
              "task": "prologue_talk_my_changes_melissa",
              "comparatives": "less",
              "value": "2"
            }
          ],
          "character": "mc",
          "posture": "default"
        },
        "el_41": {
          "type": "speech",
          "character": "barret",
          "posture": "default"
        },
        "el_42": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "quest_had_i_changed_alura": {
    "id_name": "quest_had_i_changed_alura",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_9": {
          "type": "text",
          "text_type": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_17": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_18": {
          "type": "text",
          "text_type": "default"
        },
        "el_19": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "alura_grab.png"
        },
        "el_20": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_21": {
          "type": "text",
          "text_type": "thought"
        },
        "el_22": {
          "type": "image",
          "media_folder": "chapter_1",
          "media_file": "alura_look.png"
        },
        "el_23": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_24": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_25": {
          "type": "text",
          "text_type": "default"
        },
        "el_26": {
          "type": "text",
          "text_type": "thought"
        },
        "el_27": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_28": {
          "type": "speech",
          "character": "alura",
          "posture": "default"
        },
        "el_29": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "quest_had_i_changed_final": {
    "id_name": "quest_had_i_changed_final",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "thought"
        },
        "el_2": {
          "type": "text",
          "text_type": "thought"
        },
        "el_3": {
          "type": "text",
          "text_type": "thought"
        },
        "el_4": {
          "type": "text",
          "text_type": "thought"
        },
        "el_5": {
          "type": "text",
          "text_type": "thought"
        },
        "el_6": {
          "type": "text",
          "text_type": "thought"
        },
        "el_7": {
          "type": "text",
          "text_type": "thought"
        },
        "el_8": {
          "type": "text",
          "text_type": "thought"
        },
        "el_9": {
          "type": "text",
          "text_type": "thought"
        },
        "el_10": {
          "type": "text",
          "text_type": "thought"
        },
        "el_11": {
          "type": "text",
          "text_type": "thought"
        },
        "el_12": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_talk_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "quest_melissa_swim": {
    "id_name": "quest_melissa_swim",
    "pages": {
      "page_1": {
        "el_1": {
          "type": "text",
          "text_type": "default"
        },
        "el_2": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_3": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_4": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_5": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_6": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_7": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_8": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_9": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_10": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_11": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_12": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_13": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_14": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_15": {
          "type": "speech",
          "character": "melissa",
          "posture": "default"
        },
        "el_16": {
          "type": "speech",
          "character": "mc",
          "posture": "default"
        },
        "el_17": {
          "type": "choice",
          "move_to": "passage",
          "passage": "pre_sketch_passage",
          "sketch_idn": "sketch_warning",
          "fake": "",
          "link_type": "default"
        }
      }
    }
  },
  "sketch_personal_alura": {
    "id_name": "sketch_personal_alura",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_barret": {
    "id_name": "sketch_personal_barret",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_barret": {
    "id_name": "sketch_personal_barret",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_savia": {
    "id_name": "sketch_personal_savia",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_witch": {
    "id_name": "sketch_personal_witch",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_sekhmau": {
    "id_name": "sketch_personal_sekhmau",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_mother": {
    "id_name": "sketch_personal_mother",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_father": {
    "id_name": "sketch_personal_father",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_amelina": {
    "id_name": "sketch_personal_amelina",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_mr_smith": {
    "id_name": "sketch_personal_mr_smith",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_mrs_smith": {
    "id_name": "sketch_personal_mrs_smith",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_ms_taylor": {
    "id_name": "sketch_personal_ms_taylor",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_wizard": {
    "id_name": "sketch_personal_wizard",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_sexton": {
    "id_name": "sketch_personal_sexton",
    "pages": {
      "page_1": {}
    }
  },
  "sketch_personal_eredira": {
    "id_name": "sketch_personal_eredira",
    "pages": {
      "page_1": {}
    }
  }
}
/* twine-user-script #26: "json_tasks.js" */
const task_list = 
{
  "test_gather_socks": {
    "id_name": "test_gather_socks",
    "type": "gather",
    "subject": "socks",
    "amount": "4",
    "location": "Home_Parents_Room"
  },
  "test_gather_keys": {
    "id_name": "test_gather_keys",
    "type": "gather",
    "subject": "key",
    "amount": "4",
    "location": "Home_Parents_Room"
  },
  "quest_test_sketch_1": {
    "id_name": "quest_test_sketch_1",
    "type": "sketch",
    "subject": "sketch_demo_2",
    "location": "Home_Kitchen"
  },
  "quest_test_fight_1": {
    "id_name": "quest_test_fight_1",
    "type": "fight",
    "subject": "test_party",
    "location": "Home_Hallway"
  }
}
/* twine-user-script #27: "json_video.js" */
const video_list = 
{
    "lake_events": [                
        'lake_events_1.mp4',
    ],
    "river_events": [   
        'river_event_1.mp4',
    ]
}
/* twine-user-script #28: "_func_classes.js" */

function assignClassValues(_this, config, defaultConfig) {
    if (defaultConfig) {
        for (const key in defaultConfig) {
            _this[key] = defaultConfig[key];
        }
    }
    
    for (const key in config) {
        if (typeof config[key] == 'object') {
            for (const sub_key in config[key]) {
                if (config[key][sub_key] != '') {      
                    _this[key][sub_key] = checkConvertInteger(config[key][sub_key]);
                }
            }
        } else {         
            if (config[key] != '') {      
                _this[key] = checkConvertInteger(config[key]);
            }
        } 
    }
}


function recordClassStaticCounter(classname) {
    if (classname) { // if current class exists 
        const static_counter = State.variables.misc.static_counter;   
        
        if (static_counter[classname] >= 1) static_counter[classname] += 1;
        if (!static_counter[classname]) static_counter[classname] = 1;
    }
}

function checkConvertInteger(value) {
    const number = Number(value);
    return (isNaN(number)) ? value : number;
}


// Needs to be reworked !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
function generateNpcName(kind, defaultConfig) {
    const lang = State.variables.settings.lang;
    const localized_kind = localization_system_text[lang]['kind_list'][kind];
    const new_item_name = `${localized_kind}`;           

    defaultConfig.name = new_item_name;    
}

// UNIFY with generateItemIdName ????
function generateNpcIdName(_this, defaultConfig) {    
    const classaname = _this.kind;
    recordClassStaticCounter(classaname);

    const static_counter = State.variables.misc.static_counter[classaname]; 
    const obj_new_id = `${classaname}_${static_counter}`;
    defaultConfig.id_name = obj_new_id;
}


function generateItemIdName(_this, defaultConfig) {
    const classaname = (_this.sub_category) ? _this.sub_category : _this.category;
    recordClassStaticCounter(classaname);

    const static_counter = State.variables.misc.static_counter[classaname]; 
    const obj_new_id =`${classaname}_${static_counter}`;
    defaultConfig.id_name = obj_new_id;
}


function rarityUpdate(cur_rarity_update_fields, defaultConfig) {    
    let updated_config = defaultConfig;

    // Firstly replacing values
    updated_config.lvl = cur_rarity_update_fields.lvl;
    updated_config.specials = cur_rarity_update_fields.specials;     

    // Secondly multiplying values
    for (let key in updated_config.battle) {      
        updated_config.battle[key] *= cur_rarity_update_fields.battle[key];
    }

    updated_config['cost'] *= cur_rarity_update_fields['cost'];
    updated_config['price'] = (updated_config['price']) ? updated_config['price'] : updated_config['cost'] ; // REMOVE USED FOR TESTING ONLY

    defaultConfig = {...defaultConfig, ...updated_config};
}


function generateCharacterName(defaultConfig) {
    defaultConfig.name = getLocalizedText(defaultConfig.id_name);    
}


/* twine-user-script #29: "classes_armor.js" */

class Armor {
    constructor () {
        this.type = 'armor';
        this.rarity_id = 3; 
    }
}
window.Armor = Armor; // attach to the global scope


// #region Head

class Head extends Armor {
    constructor (...args) {
        super(...args);

        this.category = 'head';
        
    }
}
window.Head = Head; // attach to the global scope


    class Helmet extends Head {
        constructor (config) {
            super();
            
            this.sub_category = 'helmet';

            const default_tables_cur_config = default_tables[this.type][this.category][this.sub_category];
            const defaultConfig = $.extend(true,{},default_tables_cur_config);      // So defaultConfig would be not a reference to default_tables, but a new deep cloned object 

            if ((config) && (config.rarity_id)) this.rarity_id = config.rarity_id;

            if (!config.id_name) generateItemIdName(this, defaultConfig);  

            const cur_rarity_update_fields = rarity_tables[this.type][this.category][this.rarity_id];
            rarityUpdate(cur_rarity_update_fields, defaultConfig); 

            if (config) assignClassValues(this, config, defaultConfig);
    
        }

    }
    window.Helmet = Helmet; // attach to the global scope

// #endregion



// #region Foot

class Foot extends Armor {
    constructor (...args) {
        super(...args);

        this.category = 'foot';
        
    }
}
window.Foot = Foot; // attach to the global scope


    class Sabatons extends Foot {
        constructor (config) {
            super();

            this.sub_category = 'sabatons';

            const default_tables_cur_config = default_tables[this.type][this.category][this.sub_category];
            const defaultConfig = $.extend(true,{},default_tables_cur_config); // So defaultConfig would be not a reference to default_tables, but a new deep cloned object 

            if ((config) && (config.rarity_id)) this.rarity_id = config.rarity_id;

            if (!config.id_name) generateItemIdName(this, defaultConfig);  

            const cur_rarity_update_fields = rarity_tables[this.type][this.category][this.rarity_id];
            rarityUpdate(cur_rarity_update_fields, defaultConfig); 

            if (config) assignClassValues(this, config, defaultConfig);
        
        }
    }
    window.Sabatons = Sabatons; // attach to the global scope

// #endregion




// #region Arms


// #endregion
/* twine-user-script #30: "classes_enemy.js" */

class Enemy {
    constructor (config) {
        this.enemy = true;
        this.can_die = true;

        for (const key in config) {
            this[key] = config[key];
        }
    }
}
window.Enemy = Enemy; // attach to the global scope


    class Wolf extends Enemy {
        static class_id_counter = 1; 

        constructor (config) {
            super(config);

            this.kind = 'wolf';

            const defaultConfig = {
                id_name: '',
                xp: 40, 
                health_max: random(45,55),   
                stamina_max: random(80,100),
                mana_max: 0,
                lvl: random(1,2),
                battle: {
                    attack: random(1,2),
                    defence: random(0,1),
                    magic_attack: 0,
                    magic_defence: 0
                }
            };
            
            generateNpcIdName(this, defaultConfig);   
            // generateNpcName(defaultConfig.kind, defaultConfig);  

            assignClassValues(this, config, defaultConfig);

            this.health = this.health_max;
            this.stamina = this.stamina_max;
            this.mana = this.mana_max;

        }
    }
    window.Wolf = Wolf; // attach to the global scope


    class Goblin extends Enemy {
        static class_id_counter = 1; 
        
        constructor (config) {
            super(config);
            
            this.kind = 'goblin';

            const defaultConfig = {
                id_name: '',
                xp: 20, 
                health_max: random(25,35),   
                stamina_max: random(50,70),
                mana_max: 0,
                lvl: 1,
                battle: {
                    attack: random(1,3),
                    defence: 0,
                    magic_attack: 0,
                    magic_defence: 0
                }
            };

            generateNpcIdName(this, defaultConfig);   
            // generateNpcName(defaultConfig.kind, defaultConfig); 

            assignClassValues(this, config, defaultConfig);

            this.health = this.health_max;
            this.stamina = this.stamina_max;
            this.mana = this.mana_max;
        }
    }
    window.Goblin = Goblin; // attach to the global scope



/* twine-user-script #31: "classes_food.js" */

// food rariety 
// decide if it uses general rarity system or it own ['bad', 'medium', 'good', 'excellent', 'masterchief']


class Food {
    constructor () {
        this.type = 'food';
    }
}
window.Food = Food; // attach to the global scope


    class Meat extends Food {
        constructor (config) {
            super();

            this.category = 'meat';

            const defaultConfig = {
                lvl: 0, 
                cost: 20,
                weight: 0.5,
                effects:[
                    {effect: 'addHealth', value: 5}
                ]
            };
            
            if ((config) && (config.rarity_id)) {   

                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);            
            assignClassValues(this, config, defaultConfig);
        }
    }
    window.Meat = Meat; // attach to the global scope

    class Bread extends Food {
        constructor (config) {
            super();

            this.category = 'bread';

            const defaultConfig = {
                lvl: 0, 
                cost: 20,
                weight: 0.3,
                effects:[
                    {effect: 'addHealth', value: 10}
                ]
            };
            
            if ((config) && (config.rarity_id)) {   

                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);            
            assignClassValues(this, config, defaultConfig);
        }
    }
    window.Bread = Bread; // attach to the global scope



/* twine-user-script #32: "classes_materials.js" */

// Probably add 'applied' property to show if it ca nbe applied to certain item category/type
// Eg., wood: ['armor', 'weapons', 'special_items']
// flower: ['food', 'potion'] 


class Materials {
    constructor () {
        this.type = 'materials';
    }
}
window.Materials = Materials; // attach to the global scope


    class Wood extends Materials {
        constructor (config) {
            super();

            this.category = 'wood';

            const defaultConfig = {
                weight: 2,  
                lvl: 0, 
                cost: 20,
            };
            
            if ((config) && (config.rarity_id)) {   

                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);            
            assignClassValues(this, config, defaultConfig);
        }
    }
    window.Wood = Wood; // attach to the global scope



/* twine-user-script #33: "classes_npc.js" */


class Character {
    constructor (config) {
        const defaultConfig = {
            id_name: '',
            type: '',
            lvl: 0,
            exp: 0,
            lvl_exp: 0,
            total_exp: 0,
            health_max: 100,   
            stamina_max: 100,
            mana_max: 0,
            relations: {},
            battle: {
                attack: 0,
                defence: 0,
                magic_attack: 0,
                magic_defence: 0
            },
            inventory: {
                in_use: {
                    primary: false,
                    secondary: false,
                    head: false,
                    body: false,
                    arms: false,
                    legs: false,
                    foot: false
                },
                weapons : [],
                armor : [],
                potions : [],
                food: [],
                materials: [],
                special_items: [],
                quest_items : []
            },
            can_die: false,
            is_dead: false,
            is_known: false,
            can_join: false,
            store_idn: false,
            inter_type: 'type_2'
            // type_1 is story main characters, like Alura, Melissa
            // type_2 is story sub characters, like Wizard, Ms Taylor
            // type_3 is generated character, generated villagers with limited interactions
        };
        

        assignClassValues(this, config, defaultConfig);

        generateCharacterName(defaultConfig);


        this.health = this.health ?? this.health_max;
        this.stamina = this.stamina ?? this.stamina_max;
        this.mana = this.mana ?? this.mana_max;
        
        this.health = (this.health > this.health_max) ? this.health_max : this.health;
        this.stamina = (this.stamina > this.stamina_max) ? this.stamina_max : this.stamina;
        this.mana = (this.mana > this.mana_max) ? this.mana_max : this.mana;

    }
}
window.Character = Character; // attach to the global scope  



class NPC {
    constructor (config) {
        const defaultConfig = {
            name: '',
            type: '',
            health_max: 100,   
            stamina_max: 100,
            relation: 0,
            affection: 0,
            lvl: 0,
            battle: {
                attack: 0,
                defence: 0,
                magic_attack: 0,
                magic_defence: 0
            }
        };

        assignClassValues(this, config, defaultConfig);

        this.health = this.health_max;
        this.stamina = this.stamina_max;
    }
}
window.NPC = NPC; // attach to the global scope

    class Generated_NPC extends NPC {
    constructor (config) {
            super(config);
            
            this.name = config.name,
            this.id_name = config.id_name,
            this.gender = config.gender,
            this.phrases = [
                'Oh, hi Mark',
                'Hello there, general Kenobi',
                'Hello, Peter',
                'Hello Darkness, My Old Friend'
            ]
        }
    }

    window.Generated_NPC = Generated_NPC;


function generateRandomNPC() {
    const npcs = [
        'villager_a',
        'villager_b',
        'villager_c'
    ];
    
    State.variables.generated_villagers = [];
    let generated_villagers = [];

    for(let i = 0; i < npcs.length; i++) {
        let current_npc = npcs[i];

        window[`${current_npc}`] = new Generated_NPC({name: classnaming(current_npc), id_name: current_npc});
        let temp = window[`${current_npc}`];

        let property = temp.id_name;
        let property_value = temp;

        generated_villagers.push(property_value);
    }
    
    State.variables.generated_villagers = generated_villagers;
}

$(document).ready(function(){
    generateRandomNPC();
    console.log(State.variables.generated_villagers);
});


/* twine-user-script #34: "classes_parties.js" */

class Party {
    constructor (party_params) {
        this.id_name = party_params.id_name,
        this.location = party_params.location,
        this.members = party_params.members ?? [];
        this.can_disband = 1;
    }
}
window.Party = Party; // attach to the global scope  
/* twine-user-script #35: "classes_potions.js" */

// potion rarity 
// decide if it uses general rarity system or it own ['bad', 'medium', 'good', 'excellent', 'masterchief'] ['big', 'medium', 'small']

// Add modifier based on alchemy skill level (eg., at alch_level 1 small potion = 20*0.6 )

 
class Potions {
    constructor () {
        this.type = 'potions';
    }
}
window.Potions = Potions; // attach to the global scope


    class HealthPotion extends Potions {
        constructor (config) {
            super();

            this.category = 'health_potion'

            const defaultConfig = {
                rarity: 'Common',
                lvl: 2, 
                cost: 20, 
                weight: 0.1,
                effects:[
                    {effect: 'addHealth', value: 40}
                ]
            };
            
            if ((config) && (config.rarity_id)) {   

                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;                
                
                // rarityPotions(defaultConfig, config);        // potions on rarity
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);            
            assignClassValues(this, config, defaultConfig);
        }
    }

    window.HealthPotion = HealthPotion; // attach to the global scope





    class MixedPotion extends Potions {
        constructor (config) {
            super();

            this.category = 'mixed_potion';

            const defaultConfig = {
                rarity: 'Common',
                lvl: 5, 
                cost: 300, 
                weight: 0.1,
                effects:[
                    {effect: 'addHealth', value: 40},
                    {effect: 'addStamina', value: 50}
                ]
            };
            
            if ((config) && (config.rarity_id)) {   
                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;
                
                // rarityPotions(defaultConfig, config);        // potions on rarity
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);            
            assignClassValues(this, config, defaultConfig);
        }
    }

    window.MixedPotion = MixedPotion; // attach to the global scope



// #endregion


/* twine-user-script #36: "classes_quest_items.js" */

class QuestItems {
    constructor () {
        this.type = 'quest_items';
    }
}
window.QuestItems = QuestItems; // attach to the global scope

    class Brooch extends QuestItems {
        constructor (config) {
            super();

            this.category = 'brooch';
            
            const defaultConfig = {
            };
            
            if (!config.id_name) generateItemIdName(this, config);  
            assignClassValues(this, config, defaultConfig);  
        }
    }
    window.Brooch = Brooch; // attach to the global scope


    class Key extends QuestItems {
        constructor (config) {
            super();

            this.category = 'key';

            const defaultConfig = {
                // category: 'key',
                // rarity: 3
            };
            
            if (!config.id_name) generateItemIdName(this, config);  
            
            assignClassValues(this, config, defaultConfig);  
        }
    }
    window.Key = Key; // attach to the global scope


    class Socks extends QuestItems {
        constructor (config) {
            super();

            this.category = 'socks';
            
            const defaultConfig = {
                // category: 'socks',
                // rarity: 3
            };
            
            if (!config.id_name) generateItemIdName(this, config);  
            assignClassValues(this, config, defaultConfig);  
        }
    }
    window.Socks = Socks; // attach to the global scope

/* twine-user-script #37: "classes_quests.js" */

class Quest {
    constructor (quest_params) {
        this.id_name = quest_params.id_name ?? 'No quest.id_name',
        this.type = quest_params.type ?? 'No quest.type',
        this.states = quest_params.states ?? [];
        this.state = quest_params.state ?? 1;
        this.status = quest_params.status ?? 1;
        this.chosen = !!quest_params.chosen;
        this.activation_flag = quest_params.activation_flag ?? {};
        if (quest_params.start_sketch) this.start_sketch = quest_params.start_sketch;
    }
}

window.Quest = Quest; // attach to the global scope

/* twine-user-script #38: "classes_special_items.js" */

// Rename to Misc items???
// decide if it uses general rarity system or it own ['awful', 'bad', 'normal', 'good', 'masterpiece']


class SpecialItems {
    constructor () {
        this.type = 'special_items';
    }
}
window.SpecialItems = SpecialItems; // attach to the global scope


    class FishingRod extends SpecialItems {
        constructor (config) {
            super();

            this.category = 'fishing_rod'

            const defaultConfig = {
                lvl: 2, 
                cost: 200,
                weight: 3,
            };
            
            if ((config) && (config.rarity_id)) {   

                defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;
            }
        
            if (!config.id_name) generateItemIdName(this, defaultConfig);           
            assignClassValues(this, config, defaultConfig);
        }
    }
    window.FishingRod = FishingRod; // attach to the global scope



/* twine-user-script #39: "classes_task.js" */

class Task {
    constructor (task_params) {
        this.id_name = task_params.id_name ?? 'No task.id_name',
        this.type = task_params.type ?? 'No task.type',
        this.location = task_params.location ?? 'Menu_Debug',
        this.subject = task_params.subject ?? '',
        this.amount = task_params.amount ?? 1,
        this.status = task_params.status ?? 0;
        this.activation_flag = task_params.activation_flag ?? {};
        this.is_optional = task_params.is_optional;    
        this.no_start_link = (this.type == 'escort' || this.type == 'eliminate') ? 1 : 0;
        if (task_params.location_character) this.location_character = task_params.location_character;
        if (task_params.conditions)  this.conditions = task_params.conditions; 
        if (task_params.actions)  this.actions = task_params.actions; 


        // Autoset correct amount
        if (this.type == 'fight') {
            if (isParty(this.subject)) {
                this.amount = getParty(this.subject).members.length;
            } 
        }
    }
}

window.Task = Task; // attach to the global scope
/* twine-user-script #40: "classes_weapon.js" */

class Weapons {
    constructor () {
        this.type = 'weapons';
        this.rarity_id = 3; 
        this.be_secondary = false;
        this.with_secondary = false;
    }
}
window.Weapons = Weapons; // attach to the global scope


// #region Knife

class Knife extends Weapons {
    constructor (...args) {
        super(...args);

        this.category = 'knife';
        this.length = 'short';
        this.be_secondary = true;
        this.with_secondary = true;
        
    }
}
window.Knife = Knife; // attach to the global scope


    class Dagger extends Knife {
        constructor (config) {
            super();

            this.sub_category = 'dagger';

            const default_tables_cur_config = default_tables[this.type][this.category][this.sub_category];
            const defaultConfig = $.extend(true,{},default_tables_cur_config); // So defaultConfig would be not a reference to default_tables, but a new deep cloned object 

            if ((config) && (config.rarity_id)) this.rarity_id = config.rarity_id;

            if (!config.id_name) generateItemIdName(this, defaultConfig);  

            const cur_rarity_update_fields = rarity_tables[this.type][this.category][this.rarity_id];
            rarityUpdate(cur_rarity_update_fields, defaultConfig); 

            if (config) assignClassValues(this, config, defaultConfig);
        }
    }
    window.Dagger = Dagger; // attach to the global scope

    // class Rondel extends Knife {
    //     static class_id_counter = 1;

    //     constructor (config) {
    //         super(config);
    //         const defaultConfig = {
    //             sub_category: 'rondel',
    //             name: 'Typical Rondel',
    //             description: '...',     
    //             lvl: 1, 
    //             cost: 50, 
    //             battle: { 
    //                 attack: 3,
    //                 defence: 0,
    //                 magic_attack: 0,
    //                 magic_defence: 0,                
    //                 length: .3,
    //                 weight: 1,
    //             },
    //             specials: false
    //         };

    //         if ((config) && (config.rarity_id)) {   
                
    //             // getrarityChange(config, defaultConfig);

    //             defaultConfig.name = `${defaultConfig.name} ${config.rarity_id}`;

    //         }
                  
    //         assignClassValues(this, config, defaultConfig);
    //     }
    // }
    // window.Rondel = Rondel; // attach to the global scope

    class Stiletto extends Knife {
        constructor (config) {
            super();

            this.sub_category = 'stiletto';

            const default_tables_cur_config = default_tables[this.type][this.category][this.sub_category];
            const defaultConfig = $.extend(true,{},default_tables_cur_config); // So defaultConfig would be not a reference to default_tables, but a new deep cloned object 

            if ((config) && (config.rarity_id)) this.rarity_id = config.rarity_id;

            if (!config.id_name) generateItemIdName(this, defaultConfig);  

            const cur_rarity_update_fields = rarity_tables[this.type][this.category][this.rarity_id];
            rarityUpdate(cur_rarity_update_fields, defaultConfig); 

            if (config) assignClassValues(this, config, defaultConfig);
        }
    }
    window.Stiletto = Stiletto; // attach to the global scope



// #endregion


// // #region One Handed

// class OneHanded extends Weapons {
//     constructor (...args) {
//         super(...args);

//         this.category = 'one_handed';
//         this.length = 'middle';
//         this.with_secondary = true;
        
//     }
// }
// window.OneHanded = OneHanded; // attach to the global scope


//     class Sword extends OneHanded {

//     }
//     window.Sword = Sword; // attach to the global scope


// #endregion




// #region Polearm


// #endregion








/* twine-user-script #41: "global_init_end.js" */

// This functions can show console logs, like it work on every page refresh, BUT in reality work only once as it is called at the StoryInit
setup.initOnce = function() {
	State.variables.quest_list = quest_list;
	State.variables.tasks = task_list;
	
	refreshSketches() 
	State.variables.items = item_list;
	State.variables.character_list = character_list;   // additional list to separate json lists and object of Classes list
	State.variables.party_list = party_list;  	 		// additional list to separate json lists and object of Classes list
	


	$.each(State.variables.character_list, function(character_index, character) {
		State.variables.characters[character_index] = Reflect.construct(Character, [character]);
	});

	$.each(State.variables.party_list, function(party_index, party) {	
		State.variables.parties[party_index] = Reflect.construct(Party, [party]);
	});
	// Add parties of one character automatically to put them into fights
	$.each(State.variables.characters, function(character_index, character) {	
		const new_party = {id_name:character.id_name, name: `${character.id_name} party`, members: [character]}
		State.variables.parties[character.id_name] = Reflect.construct(Party, [new_party]);
	});

	
	reassignCharactersScheduleList();

	
	const flag_list  = [
		'witch_prologue_trust',
		'witch_prologue_behavior',
	];

	State.variables.flags = flag_list.reduce((ac,a) => ({...ac,[a]:0}),{});


	updateJsonLists() // include custom_locations, so should go before any functionality that uses it


	const location_passages = Story.lookupWith(pas  => { if (pas.tags.includes("Location")) return pas.tags; });           
	const location_list = location_passages.map(passage => passage.title);

	const talk_menu_passage = 'Talk_Menu';
	const deadend_passage = 'Uni_Deadend';
	const custom_location_list_array = Object.values(State.variables.lists.custom_locations).map(location => location.id_name);
	const location_list_expanded = location_list.concat(custom_location_list_array).concat(talk_menu_passage).concat(deadend_passage); 

	State.variables.lists.location_list = location_list; 
	State.variables.lists.location_list_expanded = location_list_expanded;

	State.variables.player = State.variables.characters.mc;


	const time_update = {
		new_day: State.variables.time.total_day,
		month_day: State.variables.time.total_day,
		day_of_week: State.variables.lists.day_of_week_list[State.variables.time.day_of_week_id],
		month: State.variables.lists.month_list[State.variables.time.month_id]
	}
	Object.assign(State.variables.time, time_update);



	State.variables.party_hero = {
		side: "Hero Party",
		party: [State.variables.player]
	}

	State.variables.party_enemy = {
		side: "Enemy Party",
		party: []
	}


	Config.history.maxStates = 12;
	Config.history.controls = true;
	Config.ui.stowBarInitially = false;

	getAjaxGlobal();

	updateDailyFunctions(); // first and only one time call; other calls of this function will be executed by dy change


	activateInitialQuestCostyl(); // Temporary

	// variablesAccessControl();


}
/* twine-user-script #42: "_func_quest.js" */

function getTaskQuest(cur_task_idn) {    
    const cur_quest_data = {};
    // For patch and test purposes
    const patched_task = { 
        id_name: 'patched_task',
        type: 'interact',
        location: passage(),
        subject: '',
        amount: 0,
        status: 1
    } 

    
    $.each(State.variables.quest_list, function (quest_index, quest) { 
        $.each(quest.states, function (state_index, state) {  
            $.each(state, function (task_index, task) {
                try {                       
                    if (cur_task_idn == task.id_name) {
                        cur_quest_data.id_name = quest.id_name;
                        cur_quest_data.state = state_index;
                        cur_quest_data.state_task_index = task_index;
                        return false;
                    }        
                } catch (err) {
                    State.variables.quest_list[quest.id_name].states[state_index] = [patched_task];
                    console.error(`Error has occurred during getTaskQuest at ${quest.id_name}.statuses[${state_index}]`);
                    alert(`Error has occurred during getTaskQuest at ${quest.id_name}.statuses[${state_index}]`); 
                    // console.error(err);
                }

            });
        });
    });

    return cur_quest_data;
}


function getQuestTaskList(quest_idn) {    
    const quest = State.variables.quest_list[quest_idn] ?? {};
    const task_list = [];

    $.each(quest.states, function (index, state) {   
        $.each(state, function (task_index, task) {
            task_list.push(task.id_name);
        });
    });

    return task_list;
}



function getTaskByIdn(task_idn) {
    const task_quest = getTaskQuest(task_idn);
    const is_task_exists = (!$.isEmptyObject(task_quest));

    
    if (is_task_exists) {
        const is_active_quest = State.variables.quests[task_quest.id_name]?.status ?? false;
        
        
        const task = (is_active_quest) ? 
        State.variables.quests[task_quest.id_name].states[task_quest.state][task_quest.state_task_index]:
        State.variables.quest_list[task_quest.id_name].states[task_quest.state][task_quest.state_task_index];


        return task;
    } else {
        console.error('Task`s quest is not defined!', task_idn);
        return false;
    }
}

function getQuestByIdn(quest_idn) {
    const quest = State.variables.quests[quest_idn];
    return quest;
}


function getAllQuestsTaskList() {
    const task_list = {};
    $.each(State.variables.quest_list, function(i, quest) {        
        $.each(quest.states, function(i, state) {
            state.forEach( (task, index) => (task_list[task.id_name] = task))
        });
    });

    return task_list;
}


// For Quests in Sketch Constructor
function removeTaskFromQuest(task_idn) {
    const task_quest = getTaskQuest(task_idn);
    const is_task_exists = (!$.isEmptyObject(task_quest));
    
    if (is_task_exists) {                   
        const task_state = State.variables.quest_list[task_quest.id_name].states[task_quest.state];  
        const task = task_state[task_quest.state_task_index];
        State.variables.tasks[task.id_name] = task;

        task_state.splice(task_quest.state_task_index, task_quest.state_task_index+1)
        if (!task_state.length) {
            delete State.variables.quest_list[task_quest.id_name].states[task_quest.state];
        } else {
            console.error('Task`s quest is not defined!!', task_idn);
            return false;
        }
    } else {

    }
}


setup.isAnyQuestAvailable = (target_location, character) => isAnyQuestAvailable(target_location, character);

function isAnyQuestAvailable(target_location = "Mirror_Room", character) {
    const character_idn = (character == 'player') ? State.variables.player.id_name : character;
    const character_sketch_idn = getSketchPersonalIdn(target_location, character_idn);
    const hasAvailableQuestLinkInPersonalSketch = checkHasAvailableQuestLinkInPersonalSketch(character_sketch_idn, character_idn); // check if personal sketch of certain character has a pesonal quest with available quest inside it.
    const hasAvailableQuestLink = checkHasAvailableQuestLink(target_location); // check if location have an active quest link

    const has_available_quest = (hasAvailableQuestLink || hasAvailableQuestLinkInPersonalSketch);

    return has_available_quest;
}



setup.isAnyTaskAvailableForCharacter = (character) => isAnyTaskAvailableForCharacter(character);

function isAnyTaskAvailableForCharacter(character="player") {
    const character_idn = (character == 'player') ? State.variables.player.id_name : character;
    const has_available_task = checkCharacterHasAvailableTaskLink(character_idn);
    
    return has_available_task;
}

function checkHasAvailableQuestLink(target_location) {
    const quest_list = State.variables.quest_list;

    for (const quest_idn in quest_list) {
        const quest = quest_list[quest_idn];
        const quest_start_location = quest.activation_flag.location;
        const passQuestLocationCondition = (quest_start_location === target_location);
        const passQuestStatusNotActivated = !(State.variables.quests[quest.id_name]);
        const passConditionQuestStatus = isPassQuestConditionActivationFlag(quest.id_name);

        const passQuestConditions = (passQuestLocationCondition && passQuestStatusNotActivated && passConditionQuestStatus) 
        if (passQuestConditions) return true;
    }

    return false;
}

function checkHasAvailableQuestLinkInPersonalSketch(character_sketch_idn, character_idn) {
    const character_sketch = State.variables.sketches[character_sketch_idn];
    const character = State.variables.characters[character_idn];
    let has_at_least_one_available_quest = undefined;

    if (character.inter_type == 'type_1') {
        if (!character_sketch) {
            alert(`Sketch "${character_sketch_idn}" does not exist!.`);
            console.error(`Sketch "${character_sketch_idn}" does not exist!.`);
            return false; // Early return if the sketch doesn't exist
        }

        const sketch_page = character_sketch.pages.page_1; // For personal sketches, there is always only one page.
        has_at_least_one_available_quest = Object.values(sketch_page).some((element) => {
            return (
                element.link_type === "personal_quest" &&
                isSketchElementConditionsPassed(element.conditions) &&
                elementHasSketchThatHasAvailableQuests(element)
            );
        });
    }

    if (character.inter_type == 'type_2') {
        has_at_least_one_available_quest = false;
    }

    return has_at_least_one_available_quest;
}

function checkCharacterHasAvailableTaskLink(character_idn) {
    let has_at_least_one_available_task = false;
    
    $.each(State.variables.quests, function (quest_idn, quest) {          
        if (quest.status == 1) {
            const current_quest_tasks = quest.states[quest.state];
            $.each(current_quest_tasks, function (task_index, task) {  
                const is_active_task = (task.status == 1);
                const is_talk_location = (character_idn !== "mc") ? (task.location == "Talk_Menu") : (task.location == "Mirror_Room");
                const is_correct_task_character = (character_idn !== "mc") ? (task.location_character == character_idn) : true;
                const is_correct_task_type = (task.type == "sketch");
                const pass_task_conditions = true; // after implementing actions\conditions for quests and task will be correct function to check

                
                if (is_active_task && is_talk_location && is_correct_task_character && is_correct_task_type && pass_task_conditions) {
                    has_at_least_one_available_task = true;
                    return false;
                }
            })
        }
    })

    return has_at_least_one_available_task;
}

// Need to check after conditions/actions will be implemented
// function checkCharacterHasAvailableQuestLink(character_idn) {
//     let has_at_least_one_available_quest = false;
    
//     $.each(State.variables.quests, function (quest_idn, quest) {     
//         const is_active_quest = (quest.status == 1);       
//         const pass_quest_conditions = true;  
        
//         if (is_active_quest && pass_quest_conditions) {
//             has_at_least_one_available_quest = true;
//             return false;
//         }
//     })

//     return has_at_least_one_available_quest;
// }



function elementHasSketchThatHasAvailableQuests(element) {
    // Common logic for checking available quests
    const inner_sketch_page = State.variables.sketches[element.sketch_idn].pages.page_1; //sketch page of inner personal sketch where quest could be found
    const quest_elements = Object.values(inner_sketch_page).filter((element) => {
        return (element.type === 'choice' && element.link_type === 'quest');
    });

    let has_available_quest = true;

    if (quest_elements.length) {
        $.each(quest_elements, function(index, quest_element) {
            const draw_quest_link = passQuestLinkInnerConditions(quest_element);
            if (!draw_quest_link) {
                has_available_quest = false;
                return false;
            }
        });
    }

    return has_available_quest;
}


function isPassQuestConditionActivationFlag(quest_idn) {            //function is used to perform checkup before drawing quest links
    const cur_quest = State.variables.quest_list[quest_idn];

    if (cur_quest) {
        const condition_quest_idn = cur_quest.activation_flag.id_name;
        const condition_quest_status = cur_quest.activation_flag.value ?? 'none'; // 'none' here to avoid false positive if both meanings in next condition are 'undefined'
        const passConditionQuestStatus = (State.variables.quests[condition_quest_idn]?.status == condition_quest_status);

        return passConditionQuestStatus;
    } 
    if (!!cur_quest) {
        alert(`Quest "${quest_idn}" not found.`);
        console.error(`Quest "${quest_idn}" not found.`, element);
    }
}



function assignTempTaskCounter(counter, task_idn, value) {
    if (typeof State.variables.temp.tasks[counter] !== "undefined") {
        State.variables.temp.tasks[counter][task_idn] = value;
    } else {
        alert(`Error: temp task counter - '${counter}' does not exists`);
    }
}

function deleteTempTaskCounter(counter, task_idn) {
    delete State.variables.temp.tasks[counter][task_idn];  
}

function getTempTaskCounter(counter, task_idn) { 
    if (typeof State.variables.temp.tasks[counter] !== "undefined") {
        return State.variables.temp.tasks[counter][task_idn]; 
    } else {
        alert(`Error: temp task counter - '${counter}' does not exists`);
    }
}
/* twine-user-script #43: "_outdated.js" */
/* Alternative thelper realisation */
/* <button class="btn-thelper" data-thelper="accept">	
	<p class="thelper-message--style"><<text_system 'thelper' 'accept'>></p>
</button> */




// $(document).one(':passageinit', function (ev) {
//     const sidebar_body = $('#ui-bar-body');
//     const company_name = `2caKe gems`;
//     const version_string = getLocalizedSystemText('sidebar', 'caption_version');
//     const version_number = '0.1.018';

//     const content = `
//         <div class='sidebar-signature'>
//             <p id="company_name">[${company_name}]</p>
//             <p id="game_version">${version_string}: ${version_number}</p>
//         </div>
//     `;

//     sidebar_body.append(content);

// });


// Add Setting page to System Menu
// $(document).one(':passageinit', function (ev) {
// 	const $link = $(`<a tabindex="0">${ L10n.get('settingsTitle') }</a>`);

//     $link.ariaClick(function (ev) {
//         ev.preventDefault();
//         Engine.play('Menu_Settings');
//     });

//     const $li = $(`<li id="menu-item-settings"></li>`);
//     $li.append($link);
//     $li.insertBefore('#menu-item-restart');
// });
/* twine-user-script #44: "activities.js" */

$(document).on(":passagedisplay", function () {
    const activities = State.variables.lists.activities;
    
    $.each(activities, function (activity_index, activity) { 
        $.each(activity.locations, function (activity_location_index, activity_location) { 
            if (activity_location == getCurrentLocation()) {  
                const check_conditions_result = checkActivityCondition(activity.id_name);
                const passed_conditions = check_conditions_result['pass'];
                if (passed_conditions) { 
                    addActivityLink(activity, activity_location);
                } else {                    
                    const reasons = check_conditions_result['reasons'] ?? [];

                    if (!reasons.length) { // check if conditions did not pass, it is obligatory to have non-empty list with reason
                        console.error(`List 'reasons' cannot be empty! Activity: '${activity.id_name}'`);
                        alert(`List 'reasons' cannot be empty! Activity: '${activity.id_name}'`);
                    } else {
                        addFakeActivityLink(activity, reasons);
                    }                    
                }
            }
        });        
    });       
});




function addActivityLink(activity, activity_location) {
    const activity_text = getLocalizedSystemText('activities', activity.id_name);

    const activity_link = `
        <a 
            data-location="${activity_location}" 
            data-activity='${activity.id_name}'
            class="link-internal link-contents activity-link link-activity" 
            tabindex="0"
        >
            <span> ${activity_text} </span> 
        </a>
        <<br>>
    `;

    const $link_parent = $('.passage-list__activity');
    $link_parent.wiki( nobr(activity_link) );
}


function addFakeActivityLink(activity, reasons) {
    const activity_text = getLocalizedSystemText('activities', activity.id_name);

    const fake_activity_link = `
        <div class="link-activity link-contents link-activity--fake">
            <p class="link-fake__tip-text tip_gen"> ${showActivityBlockingReasons(reasons)} </p>

            <div class="link-content-wrapper">
                <div class="link-content-container link-underline-container">          
                    <span> ${activity_text} </span>
                </div>
            </div>
        </div>
        <<br>>
    `;


    const $link_parent = $('.passage-list__activity');
    $link_parent.wiki( nobr(fake_activity_link) );
}

function showActivityBlockingReasons(reasons) {
    let content = '';
    $.each(reasons, function(index, reason) {
        const lstr_reason = getLocalizedSystemText('activity_reasons', reason);
        content += `<span>${lstr_reason}</span><br>`
    });

    return content;
}



function addActivityLinkListener() {
    $('body').on('click', '.activity-link', function() {
        const location = $(this).data('location');
        const activity = $(this).data('activity');

        if (activity) executeActionActivityType(activity);

        moveToLocation(location);
    });
};




function checkActivityCondition(activity_type) {
    switch (activity_type) {
        case 'rest':
            return passActivityConditionRest();
        case 'nap': 
            return passActivityConditionNap();
        case 'sleep': 
            return passActivityConditionSleep();
        case 'wait':  
            return passActivityConditionWait();
        case 'eat':  
            return passActivityConditionEat();
        case 'drink': 
            return passActivityConditionDrink();
        case 'bath': 
            return passActivityConditionBath();
        // case 'swim':  
        //     return passConditionTimeCountdown(condition);
        // case 'gather':  
        //     return passConditionTimeCountdown(condition);            
        // case 'fight':  
        //     return passConditionTimeCountdown(condition);      
        // case 'work':  
        //     return passConditionTimeCountdown(condition);      
        // case 'clean':  
        //     return passConditionTimeCountdown(condition);
        default:
            console.error(`No Condition Type Match!!! [${activity_type}]`);
            alert(`No Condition Type Match!!! [${activity_type}]`);
    }

    // return {
    //     rest: passActivityConditionRest(),
    //     nap: passActivityConditionNap(),
    //     sleep: passActivityConditionSleep(),
    //     wait: passActivityConditionWait(),
    //     eat: passActivityConditionEat(),
    //     drink: passActivityConditionDrink(),
    //     bath: passActivityConditionBath(),
    // }[activity_type]
}


function passActivityConditionRest() {
    const player = State.variables.player;
    const time = State.variables.time;
    const min_stamina = 0.9;
    const condition_stamina = ( player.stamina <= player.stamina_max*min_stamina );        
    const condition_timezone = (time.hour >= 8 && time.hour < 20);

    const condition_reasons = {
        time: condition_timezone, 
        stamina: condition_stamina
    }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionNap() {
    const player = State.variables.player;
    const time = State.variables.time;
    const min_stamina = 0.4;
    const condition_stamina = ( player.stamina <= player.stamina_max*min_stamina );        
    const condition_timezone = (time.hour >= 10 && time.hour < 18);    
    const condition_reasons = {
        time: condition_timezone, 
        stamina: condition_stamina
    }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionSleep() {
    const time = State.variables.time;   
    const condition_timezone = (time.hour >= 22 || time.hour < 6);   
    const condition_reasons = { time: condition_timezone }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionWait() {
    const time = State.variables.time;   
    const condition_timezone = (time.hour >= 6 && time.hour <= 21);   
    const condition_reasons = { time: condition_timezone }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionEat() {
    const time = State.variables.time;   
    const condition_timezone = (time.hour >= 6 && time.hour <= 21);   
    const pass_countdown = passCountdown('activity_eat'); 
    
    const condition_reasons = {
        time: condition_timezone, 
        countdown: pass_countdown
    }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionDrink() {
    const time = State.variables.time;   
    const condition_timezone = (time.hour >= 6 && time.hour <= 21);  
    const pass_countdown = passCountdown('activity_drink');   

    const condition_reasons = {
        time: condition_timezone, 
        countdown: pass_countdown
    }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function passActivityConditionBath() {
    const time = State.variables.time;   
    const condition_timezone = (time.hour >= 6 && time.hour < 21);   
    const condition_daily = isDailyAvailable('bath');

    const condition_reasons = {
        time: condition_timezone, 
        daily: condition_daily
    }
    const result_response = getBlockingActivityConditionList(condition_reasons);

    return result_response;
}

function getBlockingActivityConditionList(condition_reasons={}) {
    const blocking_condition_list = [];
    $.each(condition_reasons, function(block_reason, condition_value) {
        if (!condition_value) blocking_condition_list.push(block_reason)
    });

    const conditions_passed = (!blocking_condition_list.length);
    const result_response = {pass: conditions_passed};
    if (!conditions_passed) result_response['reasons'] = blocking_condition_list;    

    return result_response;
}



function executeActionActivityType(activity_type) {    

    const selectedActivity = {
        rest: executeActionActivityRest,
        nap: executeActionActivityNap,
        sleep: executeActionActivitySleep,
        wait: executeActionActivityWait,
        eat: executeActionActivityEat,
        drink: executeActionActivityDrink,
        bath: executeActionActivityBath,
    }[activity_type];

    if (selectedActivity) {
        selectedActivity();
    } else {
        console.error(`Invalid activity type: ${activity_type}`);
    }
}

const executeActionActivityRest = () => {
    const player = State.variables.player;
    const time = State.variables.time;
    const add_time_hours = 2;
    const min_return_stamina = 40;
    const percent_return_stamina = 0.2;
    const percented_stamina_max = player.stamina_max*percent_return_stamina;

    const return_stamina = (percented_stamina_max > min_return_stamina) ? percented_stamina_max : min_return_stamina;

    player.stamina = parseInt(player.stamina, 10) + return_stamina;
    time.hour += add_time_hours;
}

const executeActionActivityNap = () => {
    const player = State.variables.player;
    const time = State.variables.time;
    const add_time_hours = 4;
    const min_return_stamina = 80;
    const percent_return_stamina = 0.4;
    const percented_stamina_max = player.stamina_max*percent_return_stamina;

    const return_stamina = (percented_stamina_max > min_return_stamina) ? percented_stamina_max : min_return_stamina;

    player.stamina = parseInt(player.stamina, 10) + return_stamina;
    time.hour += add_time_hours;
}

const executeActionActivitySleep = () => {
    const player = State.variables.player;    
    const time = State.variables.time;
    const set_wakeup_hours = 7;
    const set_wakeup_minute = 0;
    const add_time_minutes = (60 - time.minute)
    const add_time_hours = ((24 - time.hour) + (set_wakeup_hours - 1)) //(set_wakeup_hours - 1) => because also need to add minutes

    const min_sleep_stamina = 60;
    const percent_return_stamina = 0.8;
    const percented_stamina_max = player.stamina_max*percent_return_stamina;
    const min_sleep_health = 25;
    const percent_return_health = 0.5;
    const percented_health_max = player.health_max*percent_return_health;
    const min_sleep_mana = 2;
    const percent_return_mana = 0.1;
    const percented_mana_max = player.mana_max*percent_return_mana;
    
    const return_stamina = (percented_stamina_max > min_sleep_stamina) ? percented_stamina_max : min_sleep_stamina;
    const return_health = (percented_health_max > min_sleep_health) ? percented_health_max : min_sleep_health;
    const return_mana = (percented_mana_max > min_sleep_mana) ? percented_mana_max : min_sleep_mana;

    player.stamina = parseInt(player.stamina, 10) + return_stamina;
    player.health = parseInt(player.health, 10) + return_health;
    player.mana = parseInt(player.mana, 10) + return_mana;
    
    time.minute += add_time_minutes;
    time.hour += add_time_hours;
}

const executeActionActivityWait = () => {
    const time = State.variables.time;
    const add_time_hours = 1;
    
    time.hour += add_time_hours;
}

const executeActionActivityEat = () => {
    const player = State.variables.player;    
    const time = State.variables.time;
    const hours_for_countdown = 8;
    const add_time_minutes = 30;
    const min_eat_health = 20;
    const percent_return_health = 0.2;
    const percented_health_max = player.health_max*percent_return_health;
    const min_eat_mana = 2;
    const percent_return_mana = 0.02;
    const percented_mana_max = player.mana_max*percent_return_mana;
    
    const return_health = (percented_health_max > min_eat_health) ? percented_health_max : min_eat_health;
    const return_mana = (percented_mana_max > min_eat_mana) ? percented_mana_max : min_eat_mana;

    player.health = parseInt(player.health, 10) + return_health;
    player.mana = parseInt(player.mana, 10) + return_mana;
    time.minute += add_time_minutes;

    createCountdown('activity_eat', hours_for_countdown);
}

const executeActionActivityDrink = () => {
    const player = State.variables.player;   
    const time = State.variables.time;
    const hours_for_countdown = 6;
    const add_time_minutes = 5;
    const min_drink_stamina = 10;
    const percent_return_stamina = 0.1;
    const percented_stamina_max = player.stamina_max*percent_return_stamina;
    const min_eat_health = 5;
    const percent_return_health = 0.05;
    const percented_health_max = player.health_max*percent_return_health;
    
    const return_stamina = (percented_stamina_max > min_drink_stamina) ? percented_stamina_max : min_drink_stamina;
    const return_health = (percented_health_max > min_eat_health) ? percented_health_max : min_eat_health;
    
    player.stamina = parseInt(player.stamina, 10) + return_stamina;
    player.health = parseInt(player.health, 10) + return_health;
    time.minute += add_time_minutes;

    createCountdown('activity_drink', hours_for_countdown);
}

const executeActionActivityBath = () => {
    const player = State.variables.player;    
    const time = State.variables.time;
    const add_time_hours = 1;
    const min_drink_stamina = 20;
    const percent_return_stamina = 0.2;
    const percented_stamina_max = player.stamina_max*percent_return_stamina;
    
    const return_stamina = (percented_stamina_max > min_drink_stamina) ? percented_stamina_max : min_drink_stamina;
    
    player.stamina = parseInt(player.stamina, 10) + return_stamina;
    time.hour += add_time_hours;

    activateDailyVariables('bath');
}
/* twine-user-script #45: "autosave.js" */
Config.saves.autoload = "prompt";

Config.saves.version = 1;
Config.saves.slots = 10;
Config.saves.autosave = false;                           // enable only manual autosave
// Config.saves.autosave = ["autosave", "savepoint"];      // autosave at passages with tag 'savepoint'
// Every sleep through dream passage


function showSaveManagementWindow() {
    UI.saves();    
    clearSaveBottomButtons();
}


function hideSaveToDiskButtons() {
    $('#saves-export').hide();
    $('#saves-import').hide();
}

function hideSaveDeleteAllButton() {
    $('#saves-clear').hide();
}

function addSaveDeleteListener() {
    setTimeout(() => { 
        $('.delete').on('click', () =>  clearSaveBottomButtons() );
    }, 200);
};

function clearSaveBottomButtons() {
    hideSaveDeleteAllButton();    
    if ($("#saves-delete-auto").length)  $("#saves-delete-auto").ariaDisabled(true); // block delete button of autosave
    if (passage() !== 'Mirror_Room') {
        hideSaveToDiskButtons(); 
        $('#ui-dialog').find('ul.buttons').hide(); // to hide empty block if nothing to output for bottom buttons of saves window
    }

    addSaveDeleteListener(); // call it once again, because engine recreates elements on the save window without reopening it and engine does not provide any hooks when this change is triggered
}




setup.autosave = function () {
    Save.autosave.save(`AUTOSAVE: "${passage()}"`);
}


setup.after_saveload = function (save_title) {
    reloadPage();
}





// Save.onLoad.add(function (save) {
//     /* code to process the save object before it's loaded */

//     const metadata = save.metadata;
//     const deadend_sketch = metadata['deadend_sketch'];
//     localStorage.setItem("deadend_sketch", deadend_sketch);


//     $.wiki(`
//         <<set _save_title = {title: '${save.title}'}>> 
//         <<run setup.after_saveload(_save_id)>>
//     `); 
//     // this form is used so code could be executed after save is loaded.
//     // '_save' exists as 'save' object cannot be given as argument directly.
// });

// Save.onLoad.add(function (save) {
//     // if ((save.version === undefined) || (save.version < 3)) {  // Saves prior to v0.15 won't work anymore.
//     //     alert("Sorry, this save file is too old to be used with the current version of the game.");
//     //     return false;  // Cancels loading the save.
//     // }
//     // if (save.version < 4) {  // Patch saves prior to v0.20.
//     //     missing_variables["variable_name"] = 0;
//     // }
//     // if (save.version < 5) {  // Patch saves prior to v0.23.
//     //     missing_variables["anotherVariable"] = "Some text";
//     // }

    
//     const metadata = save.metadata;
//     if (save.metadata) {
//         const deadend_sketch = metadata['deadend_sketch'];
//         // record_lists.deadends_seen
//         // localStorage.setItem("deadend_sketch", deadend_sketch);
//     }

//     var missing_variables = {};
//     missing_variables["anotherVariable"] = "Some text";


//     if (Object.keys(missing_variables).length > 0) {
//         // Add missing variables to history.
//         console.log('save', save)
//         var i, key;
//         for (i = 0; i < save.state.history.length; i++) {
//             for (key in missing_variables) {
//                 save.state.history[i].variables[key] = missing_variables[key];
//             }
//         }
//     }
//     save.version = Config.saves.version;
// });




Save.onLoad.add(function (save) {
    let missing_variables = {};    

    // For test
    // missing_variables = { ...missing_variables, ...getUpdateObj() }
    
    //For now metadata is used ONLY for transporting info for visited 'deadend' links.
    //This functionality will not show 'deadend' links if save was done manually before clicking on deadend link.
    const save_metadata = getAutosaveDeadendMetadata(save);

    if (save_metadata) {
        missing_variables["record_lists"] = save_metadata;
    }

    // updates current save with new variables
    updateSaveMissingVariables(save.state.history, missing_variables);

    save.version = Config.saves.version;


    // this form is used so code could be executed after save is loaded.
    // '_save' exists as 'save' object cannot be given as argument directly.
    $.wiki(`
        <<set _save_title = {title: '${save.title}'}>> 
        <<run setup.after_saveload(_save_id)>>
    `); 
});



function getAutosaveDeadendMetadata(cur_save={}) {
    const autosave_metadata = Save.get().autosave?.metadata;
    if (autosave_metadata) {        
        const deadend_sketch_idn = (cur_save.metadata) ? cur_save.metadata['deadend_sketch'] : autosave_metadata['deadend_sketch'];

        // Used this approach of forming array to clear out duplicates (not just avoid them)
        // Clearing out is needed as variables in history could be cleared/not cleared by engine inner work with save files
        const new_deadends_seen = Array.from(new Set([...State.variables.record_lists.deadends_seen, deadend_sketch_idn])) ?? false; 
        const return_obj = {'deadends_seen': new_deadends_seen};
        
        return return_obj;
    } else {
        return false;
    }
}

// function getUpdateObj() {
//     // test data
    
//     let missing_variables = {};   

//     missing_variables = {"anotherVariable": "Some text"};
//     missing_variables["temp"] = {
//         'daily': {
//             "anotherVariable2": "Some text2",
//             "anotherVariableArr": ["Some textArr1", "Some textArr2"],
//             "anotherVariable3": "Some text3",
//         }
//     };
//     missing_variables["deep_list"] = {'inner_list':{"anotherVariable3": "Some text3"}, 'inner_list2': {"anotherVariable4": "Some text4"} };

//     return missing_variables;
// }

// Add missing variables to all history states of savefile. 
function updateSaveMissingVariables(save_history, missing_variables) {
    if (Object.keys(missing_variables).length > 0) {
        for (let i = 0; i < save_history.length; i++) {
            for (const key in missing_variables) {
                const value = missing_variables[key];
                const cur_history = save_history[i];
                const cur_history_variables = cur_history.variables;
                // console.log(cur_history_variables, key, cur_history_variables[key], value)
                if (typeof value === 'object' && value !== null) {
                    for (const nested_key in value) {
                        const nested_keys = nested_key.split('.');
                        if (!cur_history_variables[key])  cur_history_variables[key] = {};
                        updateNestedVariables(cur_history, cur_history_variables[key], nested_keys, value[nested_key]);
                    }
                } else {
                    cur_history_variables[key] = value;
                }
            }
        }
    }
}


function updateNestedVariables(history, current_variables, nested_keys, value) {
    if (nested_keys.length === 1) {
        const cur_variable = current_variables[nested_keys[0]] ?? {};
        for (const [prop_name, prop_value] of Object.entries(value)) {
            cur_variable[prop_name] = prop_value;
        }
        // cur_variable = value;
        
    } else {
        const key = nested_keys.shift();
        if (!current_variables[key]) {
            current_variables[key] = {};
        }
        updateNestedVariables(history, current_variables[key], nested_keys, value);
    }
}

// For future notification of game version updates.

// Save.onLoad.add(function (save) {
//     prerender['save-update'] = function (_, t) {
//         delete prerender[t];
     
//         if (setup.patch.v_orLower('0.9.1')) {
//             State.variables.version = '0.10.0';
//             setup.patch.patchIngredient('agates', 0);
//             setup.patch.patchIngredient('elixir', 0);
//             UI.alert("Game save updated to v0.10.x. This saved data may no longer work in older game versions.");
//         }

//         if (setup.patch.v_orLower('0.10.1')) {
//             State.variables.version = '0.11.0';
//             setup.patch.patchGain('ondatra', 0);
//             setup.patch.patchIngredient('corona', 0);
//             UI.alert("Game save updated to v0.11.x. This saved data may no longer work in older game versions.");
//         }
     
//     };
// });


// or another version 


// Config.saves.version = 5;  //v0.23
// // Handle loading saves for various game versions and patching in missing variables.
// Save.onLoad.add(function (save) {
//     if ((save.version === undefined) || (save.version < 3)) {  // Saves prior to v0.15 won't work anymore.
//         alert("Sorry, this save file is too old to be used with the current version of the game.");
//         return false;  // Cancels loading the save.
//     }
//     var missing_variables = {};
//     if (save.version < 4) {  // Patch saves prior to v0.20.
//         missing_variables["variable_name"] = 0;
//     }
//     if (save.version < 5) {  // Patch saves prior to v0.23.
//         missing_variables["anotherVariable"] = "Some text";
//     }
//     if (Object.keys(missing_variables).length > 0) {
//         // Add missing variables to history.
//         var i, key;
//         for (i = 0; i < save.state.history.length; i++) {
//             for (key in missing_variables) {
//                 save.state.history[i].variables[key] = missing_variables[key];
//             }
//         }
//     }
//     save.version = Config.saves.version;
// });




// To setup correct title for saves
Save.onSave.add(function (save) {
    const player_name = getPlayerName('en');
    const player_lvl = State.variables.player.lvl;
    const total_days = State.variables.time.total_day;
    const formatted_date = new Date(save.date).toISOString().slice(0, 19).replace('T', ', ');

    const new_title = `${player_name}, lvl: ${player_lvl}, day: ${total_days}; Save Date: ${formatted_date}, Save Version: ${save.version}`;

    save.title = new_title;
});

/* twine-user-script #46: "_func_constructors.js" */


function getSerializedForm(form) {
    function updateForm(data, keys, value) {
        if (keys.length === 0) {
            // Leaf node
            return value;
        }

        let key = keys.shift();
        if (!key) {
            data = data || [];
            if (Array.isArray(data)) {
                key = data.length;
            }
        }
    
        // Try converting key to a numeric value
        let index = +key;
        if (!isNaN(index)) {
            // We have a numeric index, make data a numeric array
            // This will not work if this is a associative array 
            // with numeric keys
            
            // data = data || [];
            
            // I've commented this converions so it would be assosiative array instead of simple one
            data = data || {};
            key = index;
        }
        
        // If none of the above matched, we have an associative array
        data = data || {};
    
        let val = updateForm(data[key], keys, value);
        data[key] = val;
    
        return data;
    }
    
    function serializeForm(form) {
        return Array.from((new FormData(form)).entries())
        .reduce((data, [field, value]) => {
            let [_, prefix, keys] = field.match(/^([^\[]+)((?:\[[^\]]*\])*)/);
    
            if (keys) {
            keys = Array.from(keys.matchAll(/\[([^\]]*)\]/g), m => m[1]);
            value = updateForm(data[prefix], keys, value);
            }            
            data[prefix] = value;
            return data;
        }, {});
    }

    const serialized = serializeForm(form);
    return serialized;
}





$(document).on(":passagedisplay", function () {
    if (passage() == "Uni_Constructor_Table") {
        displayConstructorTable();
    } else     
    if (passage() == "Uni_Constructor") {
        const constructors = {
            sketches: 'sketchConstructor',
            items: 'itemConstructor',
            quests: 'questConstructor',
            tasks: 'taskConstructor',
            characters: 'characterConstructor',
            parties: 'partyConstructor',
            custom_locations: 'customLocationConstructor',
            schedules: 'scheduleConstructor',
            localization: 'displayLocalizationTable'
        }
        const constructor_passage_function = constructors[State.variables.temp.constructor_entity]; 
        
        if (constructor_passage_function) eval(constructor_passage_function)();
        
    } else {
        delete State.variables.temp.constructor_item_edit;
        delete State.variables.temp.constructor_entity;
    }
}); 




function getEntityListName(entity) {
    // additional list to separate json lists and object of class list
    const json_entity_lists = {
        characters: 'character_list',
        quests: 'quest_list',
        parties: 'party_list',
        schedules: 'schedule_list'
    }
    
    const new_entity_list = (json_entity_lists[entity]) ? json_entity_lists[entity] : entity;
    
    return new_entity_list;
}



$(document).on('click', '.form-block-section__header',  function (e) { 
    $(this).closest('.form-block-section').find('.form-block-section-wrapper').toggle();
});



function addEditorLinkListener() {
    $(document).on('click', '.constructor-table__editor-link', function() {      
        const location = $("#constructor-table__container").find('.constructor-table').data('location');
        const item_idn = $(this).data('item');

        State.variables.temp.constructor_item_edit = item_idn;    
        Engine.play(location);
    });
}

$(document).on('click', '.constructor-table__remove', function() {     
    const item_idn = $(this).closest('.constructor-table__row').data('idn');    
    const entity = $('#constructor-table__container').find('.constructor-table').data('entity');        
    const entity_list_name = getEntityListName(entity);
    showModal('confirm_remove_constructor_item', {entity: entity_list_name, item: item_idn});
});




function updateEntitySelectOptions(entity, select_class){
    const list = getOptionsListContent(entity, select_class);
    $(select_class).each(function(index, select) {
        $(select).find('option').not(':selected').remove(); // do not clear selected option
        $(select).append(list);
    });
}

function getOptionsListContent(entity, select_class) {
    const entities = State.variables[entity];
    const entity_list = Object.entries(entities); // convert to array
    const selected_options = getSelectedOptionsList(select_class);
    const filtered_entity_list = entity_list.filter(([key, item]) => !selected_options.includes(item.id_name));
    const filtered_entities = Object.fromEntries(filtered_entity_list); // convert to object

    const entity_options = `
        ${Object.values(filtered_entities).map((item) => (
            `<option value="${item.id_name}"> ${item.id_name} </option>`
        )).join('')} 
    `;
    
    return entity_options;
}

function getSelectedOptionsList(select_class) {
    const list = [];
    
    $(select_class).each(function(index, select) {
        const character_idn = select.value;
        list.push(character_idn);
    });
    return list;
};


function searchWidgetContent(search_txt=false) {
    const content = `
        <div class="search-container">	
            <input type="search" id="search-input" placeholder="type..." />
            <button type="button" class="search-btn" data-search="idn">Search IDN</button>
            ${(search_txt) ? `<button type="button" class="search-btn" data-search="localization">Search Text</button>` : ''}
        </div>
    `;

    return content;
}

$('body').on('click', '.search-btn', function() {
    const search_data_class_list = {
        idn: '.constructor-table__cell-idn', 
        localization: '.localization-table__textarea'
    }
    const search_data = $(this).data('search');
    const search_class = search_data_class_list[search_data] ?? '';
    
    const searched_value_upper = $(this).parent().find('#search-input').val().toUpperCase(); 
    const table_rows = $('.constructor-table').find('tr');

    $.each(table_rows, function(i, row) {
        const cell_elems = $(row).find('td').find(search_class);
        $.each(cell_elems, function(j, cell_elem) {    
            const cell_value = cell_elem.value || cell_elem.innerHTML;        
            const cell_value_upper = cell_value.toUpperCase();
            const row_pass = (cell_value_upper.includes(searched_value_upper));
            
            (row_pass) ? $(row).show() : $(row).hide();
            if (row_pass) return false // break out of loop in order to prevent overwriting result by values from next columns that meet requirements
        });
    });
});



function addQuickLocalization(entity) {
    $( ".localized-text" ).each(function( index, entity_block ) {
        const entity_list = State.variables.temp.constructor_entity;
        const entity_property = $(entity_block).data('prop');
        const entity_value = $(entity_block).val() || $(entity_block).text();
        let localization_string = `${entity_list}_${entity.id_name}_${entity_property}`;
        if (entity_list == "sketches") {
            const sketch_entity_list = 'sk';
            const page = $(entity_block).data('page');
            const el = $(entity_block).data('el');
            localization_string = `${sketch_entity_list}_${entity.id_name}_p_${page}_el_${el}_${entity_property}`;
        }
        addLocalizationText(localization_string, entity_value);    
    });
}
/* twine-user-script #47: "_func_port_data.js" */


function activatePortListeners(cur_entity) {
    const entity_list_name = getEntityListName(cur_entity);

    $('.port__export-link').on('click', function() {
        // Find constructor item id_name if it is existed. If not found then it is not not item but general constructor export.
        const idn = $(this).closest('.constructor-table__row').data('idn');  
        (idn) ? exportJSON(entity_list_name, this, idn) : exportJSON(entity_list_name, this);    
    });

    $('.port__import-input').on('change', function () {
        // Find constructor item id_name if it is existed. If not found then it is not not item but general constructor import.
        const idn = $(this).closest('.constructor-table__row').data('idn');
        (idn) ? importJSON(entity_list_name, this, idn) : importJSON(entity_list_name, this); 
    });
}


function exportJSON(entity_list_name, link, idn=false) {
    const json_name = (idn) ? `${idn}__${capitalize(entity_list_name)}_JSON` : `${capitalize(entity_list_name)}_JSON`;
    const stringified_object = (idn) ? State.variables[entity_list_name][idn] : State.variables[entity_list_name] ; // idn for one record export, non idn for export of whole list
    const json_data = JSON.stringify(stringified_object, null, 2);
    const blob = new Blob([json_data], {type: "application/json"});
    
    link.href = URL.createObjectURL(blob);
    link.download = json_name; 
}


function importJSON(entity_list_name, input, idn=false ) {
    const file = input.files[0];
    
    if (file.type == "application/json") {
        const fileRider = new FileReader();
        
        fileRider.onload = function(event) { 
            const json_data = JSON.parse(event.target.result);
            console.log('json_data', json_data);
            (idn) ? State.variables[entity_list_name][idn] = json_data : State.variables[entity_list_name] = json_data;  // idn for one record import, non idn for import of whole list
            Engine.play(passage());
        }
        
        fileRider.readAsText(file);
    } else {
        console.error("File is corrupted or not in 'application/json' type");
    }
}


function activateLocalizationPortListeners() {
    const entity_list_name = 'localization';

    $('.port__export-link').on('click', function() {
        const lang = $(this).closest('.port__container').data('lang');
        exportLocalizationJSON(entity_list_name, this, lang); 
    });

    $('.port__import-input').change( function () {
        const lang = $(this).closest('.port__container').data('lang');
        importLocalizationJSON(entity_list_name, this, lang);
    });
}

function exportLocalizationJSON(entity_list_name, link, lang) {
    const json_name = `${capitalize(entity_list_name)}_JSON_${lang}`;
    const stringified_object = { ...localization_text[lang] ,  ...State.variables.temp.localization_text[lang]} ;
    const json_data = JSON.stringify(stringified_object, null, 2);
    const blob = new Blob([json_data], {type: "application/json"});
    
    link.href = URL.createObjectURL(blob);
    link.download = json_name; 
}


function importLocalizationJSON(entity_list_name, input, lang) {
    const file = input.files[0];
    
    if (file.type == "application/json") {
        const fileRider = new FileReader();
        
        fileRider.onload = function(event) { 
            const json_data = JSON.parse(event.target.result);
            console.log('json_data', json_data, State.variables.temp.localization_text);
            State.variables.temp.localization_text[lang] = json_data;
            Engine.play(passage());
        }
        
        fileRider.readAsText(file);
    } else {
        console.error("File is corrupted or not in 'application/json' type");
    }
}




function portItemContent() {
    const result = `
        <div class="port__table-container">
            <a href="" class="port__export-link" id="port__export-id">
                <span class="port__export-text">Export</span>
            </a>

            <label for="port__import-id" class="port__import-label port__import-label--item">
                <p class="port__import-text">Import</p>
                <input id="port__import-id" class="port__import-input" type="file" accept="application/json"/>
            </label>   
        </div>  
    `;
    return result;
}


function drawPortContent(lang) {
    const result = `
        <div class="port__container" ${(lang) ? `data-lang='${lang}'` :'' }>			
            <a href="" class="port__export-link" id="port__export-id_all">
                <span class="port__export-text">Export ${(lang) ? `'${lang}' list`:'' }</span>
            </a>

            <label for="port__import-id_all${(lang) ? `--${lang}`:'' }" class="port__import-label">
                <p class="port__import-text">Import JSON ${(lang) ? `'${lang}'`:'' }</p>
                <input id="port__import-id_all${(lang) ? `--${lang}`:'' }" class="port__import-input" type="file" accept="application/json"/>
            </label>
        </div>
    `;
    return result;
};
/* twine-user-script #48: "assignment_constructor.js" */


// // Add style for sections (like character schedule)
// // Add check if character with such id_name already exists

// function scheduleConstructor() {
//     $(document).ready(function() {      
//         const $constructor_block = $('#constructor');
//         const schedule_edit_idn = State.variables.temp.constructor_item_edit;
//         const schedule_edit = (schedule_edit_idn) ? State.variables.items[schedule_edit_idn] : {id_name: ''};
         
//         console.log('schedule_edit', schedule_edit);

//         const location_list = State.variables.lists.location_list;      
//         const characters_activities = State.variables.lists.characters_activities;         
//         const hours = State.variables.lists.hours;

//         const months_list = Object.values(localization_system_text['en']['month_list'])
//         const days_of_week_list = Object.values(localization_system_text['en']['day_of_week_list'])
        
//         let schedule_counter = 1;

//         const constructor_form = `            
//             <div class="form-block">
//                 <label> ID Name* </label>
//                 <input name="id_name" value="${schedule_edit.id_name}" />
//             </div>
               

//             <div class="form-block-section">
//                 <p style="font-size: 50px; color: red;">DOES NOT WORK!</p>
//                 <h1 class="form-block-section__header">Character Schedule</h1>

//                 <div class="form-block-section-wrapper">                  
//                     <div class="schedule-container">
//                         <button type="button" class="form_add add_schedule"> Add Schedule </button>
                    
//                         <div class="form-block">
//                             <button type="button" class="form_remove remove_schedule">Remove Schedule</button>
//                         </div>
//                     </div>  
//                 </div> 

//             </div>

//             <button type="button" class="form-save" id="save_schedule">Save sketch</button>  
//         `;


//         $constructor_block.append(constructor_form);

//         const period_content = getSchedulePeriodContent(); 
//         $('.schedule-container').prepend(period_content);
//         $('.select2-multiple').select2();
     
        

        


//         const $add_button = $('.add_schedule');
//         $add_button.on('click', function() {
//             schedule_counter += 1;
//             const period_content = getSchedulePeriodContent();

//             $(period_content).insertBefore( $add_button );
//             $('.select2-multiple').select2();


//         });

//         $constructor_block.on('click', '.remove_schedule', function() {
//             schedule_counter -= 1;
//             $(this).closest('.schedule-container').find('.schedule-block').last().remove();
//         });



//         function getSchedulePeriodContent() {        
//             const state = `      
//                 <div class="schedule-block">
//                     <h1 class="form-block-section__header">Period ${schedule_counter}</h1>
//                     <div class="form-block-section-wrapper">
//                         <div class="form-blocks-row">
//                             <div class="form-block">
//                                 <label for="description">
//                                     Character Location 
//                                 </label>
//                                 <select name="schedule[${schedule_counter}][hours][location]">
//                                     <option disabled selected value="-1">-- select --</option>
//                                     ${location_list.map((value) => (
//                                         `<option value="${value}">${value}</option>`
//                                     )).join('')}
//                                 </select>
//                             </div>
                            
//                             <div class="form-block">
//                                 <div class="form-blocks-row">
//                                     <div class="form-block">
//                                         <label>Start</label>
//                                         <select name="schedule[${schedule_counter}][hours][start]">
//                                             <option disabled selected value="-1">-- select --</option>
//                                             ${Object.values(hours).map((value, key) => (
//                                                 `<option value="${key}">${value}</option>`
//                                             )).join('')}
//                                         </select>
//                                     </div>
                                
//                                     <div class="form-block">
//                                         <label>End</label>
//                                         <select name="schedule[${schedule_counter}][hours][end]">
//                                             <option disabled selected value="-1">-- select --</option>
//                                             ${Object.values(hours).map((value, key) => (
//                                                 `<option value="${key}">${value}</option>`
//                                             )).join('')}
//                                         </select>
//                                     </div>
//                                 </div>
                                
//                             </div>

//                             <div class="form-block">
//                                 <label for="description">
//                                     Activity
//                                 </label>
//                                 <select name="schedule[${schedule_counter}][hours][activity]">
//                                     ${characters_activities.map((value) => (
//                                         `<option value="${value}">${value}</option>`
//                                     )).join('')}
//                                 </select>
//                             </div>

//                             <div class="form-block">
//                                 <label>&nbsp</label>
//                                 <div>
//                                     <input type="checkbox" name="schedule[${schedule_counter}][hours][availability]" value="0" >
//                                     <span> N/A</span>
//                                 </div>
//                             </div>
                            
//                         </div>     

//                         <div class="form-block">
//                             <div class="form-blocks-row">
//                                 <div class="form-block">
//                                     <label>Months</label>
//                                     <select name="schedule[${schedule_counter}][months][]" class="select2-multiple" multiple="multiple">
//                                         ${months_list.map((value, key) => (
//                                             `<option value="${value}">${value}</option>`
//                                         )).join('')}
//                                     </select>
//                                 </div>
                            
//                                 <div class="form-block">
//                                     <label>Days of Week</label>
//                                     <select name="schedule[${schedule_counter}][days_of_week][]" class="select2-multiple" multiple="multiple">
//                                         ${days_of_week_list.map((value, key) => (
//                                             `<option value="${value}">${value}</option>`
//                                         )).join('')}
//                                     </select>
//                                 </div>
//                             </div>
                            
//                         </div>        
//                     </div>  
//                 </div>       

//             `;

//             return state;
//         }



        
//         const $save_button = $('#save_schedule'); 
//         $save_button.on('click', function() {
//             const form = $constructor_block[0];
//             const serialized_form = getSerializedForm(form);
//             const new_schedule = transformScheduleOnjToArray(serialized_form) 
//             console.log('new_schedule', new_schedule);

//         });
//     });
// }







// function transformScheduleOnjToArray(obj) {
//     if (!obj.schedule) return obj; // Return the original object if 'schedule' is missing

//     const scheduleArray = Object.values(obj.schedule); // Get the values (schedule objects) from the 'schedule' object

//     // Update the object with the transformed 'schedule' array
//     obj.schedule = scheduleArray;

//     return obj;
// }


/* twine-user-script #49: "character_constuctor.js" */

function characterConstructor() {
    $(document).ready(function() {      
        const $constructor_block = $('#constructor');
        const entity_list = State.variables.temp.constructor_entity;
        const character_edit_idn = State.variables.temp.constructor_item_edit;
        const character_edit = (character_edit_idn) ? State.variables.characters[character_edit_idn] : {id_name: ''};

        console.log('character_edit', character_edit)

        const name = getLocalizedText(`${entity_list}_${character_edit.id_name}_name`);
        const desc = getLocalizedText(`${entity_list}_${character_edit.id_name}_description`);

        const constructor_form = `
            <div class="form-block">
                <label> ID Name </label>                
                <input 
                    type="text" 
                    name="id_name" 
                    value="${character_edit.id_name}" 
                /> 
            </div>

            <div class="form-block">
                <label> Name (EN)</label>                
                <input
                    class="localized-text"
                    data-prop="name"
                    value="${(name) ? name:''}" 
                />
            </div>             

            <div class="form-block-section">
                <h1 class="form-block-section__header">Battle Stats</h1>

                <div class="form-block-section-wrapper">                
                    <div class="form-blocks-row">
                        <div class="form-block">
                            <label>Attack</label>
                            <input                                 
                                class="form-block__input--small"
                                type="number" 
                                name="battle[attack]" 
                                value="${(character_edit.battle) ? character_edit.battle.attack:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label for="subject_characters">Defence</label>
                            <input                                                                  
                                class="form-block__input--small"
                                type="number" 
                                name="battle[defence]" 
                                value="${(character_edit.battle) ? character_edit.battle.defence:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label for="subject_characters">M.Attack</label>
                            <input                                 
                                class="form-block__input--small"
                                type="number" 
                                name="battle[magic_attack]" 
                                value="${(character_edit.battle) ? character_edit.battle.magic_attack:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label for="subject_characters">M.Defence</label>
                            <input                                     
                                class="form-block__input--small"
                                type="number" 
                                name="battle[magic_defence]" 
                                value="${(character_edit.battle) ? character_edit.battle.magic_defence:0}" 
                            />
                        </div>
                    </div>                
                </div>
            </div>

            
            <div class="form-block-section">
                <h1 class="form-block-section__header">Other Stats</h1>

                <div class="form-block-section-wrapper">                  
                    <div class="form-blocks-row">
                        <div class="form-block">
                            <label>Level</label>
                            <input                                      
                                class="form-block__input--small"
                                type="number" 
                                name="lvl"  
                                value="${(character_edit.lvl) ? character_edit.lvl:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>M.Health</label>
                            <input 
                                class="form-block__input--small"
                                type="number" 
                                name="health_max" 
                                value="${(character_edit.health_max) ? character_edit.health_max:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>M.Stamina</label>
                            <input
                                class="form-block__input--small" 
                                type="number" 
                                name="stamina_max" 
                                value="${(character_edit.stamina_max) ? character_edit.stamina_max:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>M.Mana</label>
                            <input 
                                class="form-block__input--small" 
                                type="number" 
                                name="mana_max" 
                                value="${(character_edit.mana_max) ? character_edit.mana_max:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>Money</label>
                            <input 
                                class="form-block__input--small" 
                                type="number" 
                                name="money" 
                                value="${(character_edit.money) ? character_edit.money:0}" 
                            />
                        </div>
                    </div>
             
                    <div class="form-blocks-row">
                        <div class="form-block">
                            <label>Experience</label>
                            <input 
                                class="form-block__input--small" 
                                type="number" 
                                name="exp" 
                                value="${(character_edit.exp) ? character_edit.exp:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>Health</label>
                            <input 
                                class="form-block__input--small"
                                type="number" 
                                name="health" 
                                value="${(character_edit.health) ? character_edit.health:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>Stamina</label>
                            <input 
                                class="form-block__input--small" 
                                type="number" 
                                name="stamina" 
                                value="${(character_edit.stamina) ? character_edit.stamina:0}" 
                            />
                        </div>

                        <div class="form-block">
                            <label>Mana</label>
                            <input 
                                class="form-block__input--small"
                                type="number" 
                                name="mana" 
                                value="${(character_edit.health) ? character_edit.health:0}" 
                            />
                        </div>
                    </div>
                </div>
            </div>
                        
            <div class="form-block">
                <label> Description (EN)</label>                
                <textarea 
                    data-prop="description" 
                    class="localized-text"
                >${desc}</textarea>
            </div> 
            
            <div class="form-block">
                <label>
                    <input type="checkbox" name="can_die" ${(character_edit.can_die == 1) ? 'checked' : '' } value="1" />
                    Can die in battle 
                </label>
            </div>
            
            <div class="form-block">
                <label>
                    <input type="checkbox" name="is_known" ${(character_edit.is_known == 1) ? 'checked' : '' } value="1" />
                    Character is known 
                </label>
            </div>

            <button type="button" class="form-save" id="save_character">Save Character</button>   
        `;

        $constructor_block.append(constructor_form);



        const $save_button = $('#save_character'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);
            console.log('serialized_form', serialized_form);

            const character = serialized_form;            

            if(!character.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');   
            } else {                
                State.variables.character_list[character.id_name] = character;

                const new_character = new Character(character);
                State.variables.characters[new_character.id_name] = new_character;

                addQuickLocalization(character);
                                
                alert('Character has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }
        });
        
    });
}

/* twine-user-script #50: "item_constructor.js" */

function itemConstructor () {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');
        const entity_list = State.variables.temp.constructor_entity;
        const item_edit_idn = State.variables.temp.constructor_item_edit;
        const item_edit = (item_edit_idn) ? State.variables.items[item_edit_idn] : {id_name: ''};
        
        console.log('item_edit', item_edit);

        const item_types = State.variables.lists.items.types;
        const name = getLocalizedText(`${entity_list}_${item_edit.id_name}_name`);

        const select_class_item_type = '.item__type';       
        const select_class_item_category = '.item__category'; 
        const select_class_item_sub_category = ".item__sub-category" 

        
        const constructor_form = `
            <div class="form-block">
                <label> Item ID Name* </label>
                <input name="id_name" value="${item_edit.id_name}" />
            </div>

            <div class="form-block">
                <label> Name (EN)</label>                
                <input
                    class="localized-text"
                    data-prop="name"
                    value="${(name) ? name:''}" 
                />
            </div>    

            <div class="form-block">
                <label for="type">Type* </label>
                <select 
                    class="select2 item__type"
                    name="type"
                >                       
                    <option disabled selected value="-1">-- select --</option>
                    ${Object.entries(item_types).map(([key, value]) => (    
                        `<option 
                            ${(value == item_edit.type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>

            <div class="item-type__container">Select type</div>

            <button type="button" class="form-save" id="save_item">Save item</button>   
        `;

        $constructor_block.append(constructor_form);
        const type_container = $('.item-type__container');

        if (item_edit_idn) addItemTypeContent(item_edit.type, type_container);
        $(".select2").select2();


        $constructor_block.on('change', select_class_item_type, function() {   
            const select = this;
            const cur_type = select.value;
            const type_container = $(select).closest('#constructor').find('.item-type__container');

            addItemTypeContent(cur_type, type_container);

            $(".select2").select2();
        });


        function addItemTypeContent(cur_type, type_container) {
            type_container.empty();
                
            // Add corresponding blocks for each item type.
            const cur_type_options = getItemTypeFields(cur_type);

            $.each(cur_type_options, function(index, option ) {
                const content_option = getItemOptionContent(option, item_edit);
                type_container.append(content_option);                
            });            
        }

        $constructor_block.on('change', select_class_item_category, function() {
            const select = this;
            const cur_category = select.value;
            const selected_type = $(select_class_item_type).val();
            const sub_category_list = State.variables.lists.items[selected_type][cur_category];

            $(select_class_item_sub_category).empty();

            $.each(sub_category_list, function(index, sub_category) {
                const option_content = 
                    `<option 
                        value=${sub_category}
                        ${(sub_category == item_edit.sub_category) ? 'selected' : '' }
                    >
                        ${sub_category}
                    </option>`
                ;
                $(select_class_item_sub_category).append(option_content);
            });
        });

      
        // #region Item Validation and Save 

        // Save item
        const $save_button = $('#save_item'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);

            console.log('serialized_form', serialized_form);

            const item = serialized_form;
            

            if(!item.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');   
            } else {                
                State.variables.items[item.id_name] = item;
                                                
                addQuickLocalization(item);

                alert('Item has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }

        });


        // #endregion

    });
}




function getItemTypeFields(type) {
    const 
    weapons_options = [
        'item_type_category',
        'item_type_sub_category',
        'item_type_description',
        'item_type_level',
        'item_type_cost'
    ],
    armor_options = [
        'item_type_category',        
        'item_type_sub_category',
    ],
    potions_options = [
        'item_type_category' ,
        'item_type_description'
    ],
    food_options = [
        'item_type_category' ,
        'item_type_description'
    ],
    materials_options = [
        'item_type_category' ,
        'item_type_description'
    ],
    special_items_options = [
        'item_type_category' ,
        'item_type_description'
    ],
    quest_items_options = [
        'item_type_category' ,
        'item_type_description'
    ]

    return {
        weapons: weapons_options,
        armor: armor_options,
        potions: potions_options,
        food: food_options,
        materials: materials_options,
        special_items: special_items_options,
        quest_items: quest_items_options
    }[type]
}



function getItemOptionContent(option, item={}) {
    
    const content_item_type_category = () => { 
        const selected_type = $('.item__type').val();
        const categories = State.variables.lists.items[selected_type];
        const hasSubCategory = (categories.constructor === Object);

        const class_list = (hasSubCategory) ? Object.keys(categories) : Object.values(categories);

        const content = `
            <div class="form-block">
                <label> Category* </label>
                <select 
                    class="select2 item__category" 
                    name="category"
                >                                                 
                    ${class_list.map((value) => (                       
                        `<option 
                            ${(value == item.category) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value} 
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;
    
        return content;
    };        

    const content_item_type_sub_category = () => { 
        const selected_type = $('.item__type').val();
        const selected_category = $('.item__category').val();
        const sub_categories = State.variables.lists.items[selected_type][selected_category];

        const content = `
            <div class="form-block">
                <label> Sub Category* </label>
                <select 
                    class="select2 item__sub-category" 
                    name="sub_category"
                >                             
                    ${sub_categories.map((value) => (                        
                        `<option 
                            ${(value == item.sub_category) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;
    
        return content;
    };   

    const content_item_type_description= () => {         
        const entity_list = State.variables.temp.constructor_entity;
        const desc = getLocalizedText(`${entity_list}_${item.id_name}_description`);

        const content = `
            <div class="form-block">
            <label> Description (EN)</label>                
                <textarea 
                    data-prop="description" 
                    class="localized-text"
                >${desc}</textarea>
            </div> 
        `;

        return content;
    };
    
    const content_item_type_level = () => { 

        const content = `
            <div class="form-block">
                <label> Level </label>                                        
                <input 
                    class="form-block__input--small"
                    name="lvl"
                    type="number"
                    min="0"
                    value="${(item.lvl) ? item.lvl : '0'}"
                ></input>
            </div>   
        `;
            
        return content;
    };

    const content_item_type_cost = () => { 

        const content = `
            <div class="form-block">
                <label> Cost </label>                                        
                <input 
                    class="form-block__input--small"
                    name="cost"
                    type="number"
                    min="0"
                    value="${(item.cost) ? item.cost : '0'}"
                ></input>
            </div>   
        `;
            
        return content;
    };


    return {
        item_type_category: content_item_type_category,
        item_type_sub_category: content_item_type_sub_category,
        item_type_description: content_item_type_description,
        item_type_level: content_item_type_level,
        item_type_cost: content_item_type_cost,
    }[option];
}
/* twine-user-script #51: "localization_constructor.js" */
function displayLocalizationTable() {
    const table_container = $('#constructor'); 
    const table_items = { ...localization_text['en'] ,  ...State.variables.temp.localization_text['en']} ;
    const lang_lists = State.variables.temp.localization_text;
    const generate_randon_id = (deepness = 10) => parseInt(Date.now() + Math.random()*deepness);
    
    const table_content = `
        <div class="constructor-table__header">
            <button 
                type="button"
                class="constructor-table__add-btn localization-table__add-btn"   
                data-item='${`string_${generate_randon_id()}`}'
            >
                Add New 
            </button>
            
            <div>
            ${drawPortContent('en')}
            ${drawPortContent('ua')}
            </div>
        </div>


        <p class="form-tip">**Temp records are highlighted in red. Please export and input them in the game files.</p>
        <p class="form-tip">**Lack of translation for the record in certain language is highlighted in orange dotted border. Please fill it and export file.</p>

        ${searchWidgetContent(true)}

        <table 
            class="constructor-table"         
            data-location="Uni_Constructor" 
        >
            <thead>
                <tr>
                    <th class="localization-table__header-idn">IDN</th>
                    ${Object.entries(lang_lists).map(([lang, value]) => (                 
                        `<th > ${lang} </th>`
                    )).join('')}
                    <th class="localization-table__header-remove">Remove</th>
                </tr>
            </thead>
            <tbody class="constructor-table__body">     
            </tbody>
        </table>

        
    `;


    table_container.append(table_content);
    
    $.each( reverseObject(table_items) , function (table_item_idn, table_item) {  
        addLocalizationTableRow(table_item_idn);
    });

    activateLocalizationPortListeners();
}



$(document).on('click', '.localization-table__add-btn', function() {          
    const item_idn = $(this).data('item');
    $(this).data('item', item_idn+1);
  
    $.each(State.variables.temp.localization_text, function (lang, lang_list) {
        if (lang == 'en') lang_list[item_idn] = item_idn;
    });
    
    Engine.play(passage());
});



function addLocalizationTableRow(item_idn, item) {
    const lang_lists = State.variables.temp.localization_text;
    const tbody = $('.constructor-table__body');

    const string = localization_text['en'][item_idn];
    const is_empty = (string == "");

    let table_row = `
        <tr class="constructor-table__row" data-idn="${item_idn}">
            <td>
                <input 
                    type='text'  
                    class="localization-table__input 
                        constructor-table__cell-idn 
                        ${(!string && !is_empty) ? 'localization-table__input--temp' : ''}
                    " 
                    value="${item_idn}"
                />
            </td>
            ${Object.entries(lang_lists).map(([lang, value]) => {       
                const localized_text = getLocalizedText(item_idn,lang,'');
                const cell =
                    `<td>
                        <textarea 
                            class="localization-table__textarea ${(localized_text == '') ? 'localization-table__textarea--empty' : '' }"
                        >${localized_text}</textarea>
                    </td>`;
                return cell;
            }).join('')}
            <td>
                <button type="button" class="localization-table__remove">Remove</button>
            </td>
        </tr>
    `;

    tbody.append(table_row);
}


$(document).on('click', '.localization-table__remove', function() {     
    const item_idn = $(this).closest('.constructor-table__row').data('idn');    
    showModal('confirm_localization_remove', {item: item_idn});
});

/* twine-user-script #52: "location_constructor.js" */

function customLocationConstructor() {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');

        const sketch_list = State.variables.sketches;
        
        const constructor_form = `
            <div class="form-block">    
                <label for="name">
                    Name 
                </label>
                <input name="name" id="name"/>
            </div>
            
            <div class="form-block">
                <label for="id_name">
                    ID Name*
                </label>
                <input name="id_name" id="id_name"/>
            </div>
            
            <div class="form-block">
                <label for="sketch">Sketch </label>
                <select name="type" id="type">                
                    <option selected value="-1">-- select --</option>
                    ${Object.keys(sketch_list).map((value) => (
                        `<option value="${value}">${value}</option>`
                    )).join('')}
                </select>
            </div>
        `;

        
        $constructor_block.append(constructor_form);




        const $save_button = $('#save_location'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);
            console.log('serialized', serialized_form);

            const new_location = serialized_form;
            const no_space = (new_location.id_name.trim().indexOf(' ') >= 0);

            
            // Probably rework so field that are required would automatically show generic message
            if(!new_location.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');
            } else if (no_space) {
                alert('Task id_name should be without spaces!');
                console.error('Task id_name should be without spaces');
            } else {                
                alert('Task has been created successfully!');
                State.variables.lists.custom_locations[serialized_form.id_name] = serialized_form;
                Engine.play(passage());
            }

        });
    
    });
}
/* twine-user-script #53: "party_constructor.js" */


function partyConstructor() {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');
        const entity_list = State.variables.temp.constructor_entity;
        const party_edit_idn = State.variables.temp.constructor_item_edit;
        const party_edit = (party_edit_idn) ? State.variables.party_list[party_edit_idn] : {id_name: ''};

        console.log('party_edit', party_edit);

        const name = getLocalizedText(`${entity_list}_${party_edit.id_name}_name`);
        const desc = getLocalizedText(`${entity_list}_${party_edit.id_name}_description`);
        const location_list = State.variables.lists.location_list;
        const update_members_entity = 'characters';

        const add_member_class = '.add_member',
            remove_member_class = '.remove_member',
            add_member_kind_class = '.add_member_kind',            
            update_members_select_class = '.party__members-select';


        const constructor_form = `   
            <div class="form-block">
                <label> ID Name* </label>
                <input name="id_name" value="${party_edit.id_name}" />
            </div>

            <div class="form-block">
                <label> Name (EN)</label>                
                <input
                    class="localized-text"
                    data-prop="name"
                    value="${(name) ? name:''}" 
                />
            </div> 
            
            <div class="form-block">
                <label> Description (EN)</label>                
                <textarea 
                    data-prop="description" 
                    class="localized-text"
                >${desc}</textarea>
            </div> 

            <div class="form-block">
                <label for="can_disband">
                    <input type="checkbox" name="can_disband" ${(party_edit.can_disband == 1) ? 'checked' : '' } value="1" />
                    Can disband
                </label>
            </div>
            
            <div class="form-block">
                <label> Party Location </label>
                <select name="location" class="select2">
                    <option disabled selected value="-1">-- select --</option>
                    ${location_list.map((value) => (
                        `<option 
                        ${(value == party_edit.location) ? 'selected' : ''}
                        value="${value}"
                    >
                        ${value}
                    </option>`
                    )).join('')}
                </select>
            </div>

            <div class="form-block-section">
                <h1 class="form-block-section__header">Party Members from Characters</h1>

                <div class="form-block-section-wrapper">                  
                    <div class="form-blocks-row">
                        <button type="button" class="form_add add_member"> Add Member </button>
                    </div>
                </div>
            </div>

            
            <div class="form-block-section">
                <h1 class="form-block-section__header">Party Members based on Kind</h1>

                <div class="form-block-section-wrapper">                  
                    <div class="form-blocks-row">
                        <button type="button" class="form_add add_member_kind"> Add Member Kind </button>
                    </div>
                </div>
            </div>


            <button type="button" class="form-save" id="save_party">Save Party</button>    
        `;

        $constructor_block.append(constructor_form);


        addEditPartyMemberContent();
        $constructor_block.find(".select2").select2();




        // Member Block

        function addEditPartyMemberContent() {    
            const characters = State.variables.characters; 
            const npc_kinds = Object.values(State.variables.lists.enemy_kinds);

            $.each(party_edit.members, function(i, member) {  
                if (characters[member]) {
                    addPartyMemberBlock(member);                      
                    updateEntitySelectOptions(update_members_entity, update_members_select_class);
                } 
                if (npc_kinds.includes(member)) addPartyMemberKindBlock(member);
            });

            

        }

        function addPartyMemberBlock(member) {
            const characters = State.variables.characters; 

            const content = `
                <div class="form-blocks-row member-block">
                    <div class="form-block">
                        <select name="members[]" class="select2 party__members-select">
                            <option disabled selected value="-1">-- select --</option>
                            ${Object.values(characters).map((character) => (                      
                                `<option 
                                    ${(character.id_name == member) ? 'selected' : ''}
                                    value="${character.id_name}"
                                >
                                    ${character.id_name}
                                </option>`
                            )).join('')}
                        </select>
                    </div>

                    <button type="button" class="form_remove remove_member">Remove</button>                
                </div>
            `;
            
            $(content).insertBefore( $(add_member_class) );
        }


        $(add_member_class).on('click', function() {
            addPartyMemberBlock();
            
            updateEntitySelectOptions(update_members_entity, update_members_select_class);
        });

        $constructor_block.on('change', '.party__members-select', function() {   
            updateEntitySelectOptions(update_members_entity, update_members_select_class);
        });


        // Member Kind Block

        $(add_member_kind_class).on('click', function() {
            addPartyMemberKindBlock();
        });

        function addPartyMemberKindBlock(member) {
            const npc_kinds = Object.values(State.variables.lists.enemy_kinds);

            const content = `
                <div class="form-blocks-row member-block">
                    <div class="form-block">
                        <select name="members[]" class="select2">
                            <option disabled selected value="-1">-- select --</option>
                            ${npc_kinds.map((kind) => (
                                `<option 
                                    ${(kind == member) ? 'selected' : ''}
                                    value="${kind}"
                                >
                                    ${kind}
                                </option>`
                            )).join('')}
                        </select>
                    </div>

                    <button type="button" class="form_remove remove_member">Remove</button>                
                </div>
            `;

            $(content).insertBefore( $(add_member_kind_class) );            
        }

        
        $constructor_block.on('click', remove_member_class, function() {
            const member_block = $(this).closest('.member-block');
            member_block.remove();

            updateEntitySelectOptions(update_members_entity, update_members_select_class);
        });
       
        



        // #region Party Validation and Save 

        const $save_button = $('#save_party'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);

            console.log('serialized_form', serialized_form)

            const party = serialized_form;

            if(!party.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');            
            } else {                
                State.variables.party_list[party.id_name] = party;

                const new_party = new Party(party);
                State.variables.parties[new_party.id_name] = new_party;                  
                
                addQuickLocalization(party);

                alert('Party has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }

        });

        // #endregion
        
    });
}

/* twine-user-script #54: "quest_constructor.js" */

    
function questConstructor () {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');
        const entity_list = State.variables.temp.constructor_entity;
        const quest_edit_idn = State.variables.temp.constructor_item_edit;
        const quest_edit = (quest_edit_idn) ? State.variables.quest_list[quest_edit_idn] : {id_name: '', activation_flag: {}};

        console.log('quest_edit', quest_edit);
        
        const name = getLocalizedText(`${entity_list}_${quest_edit.id_name}_name`);
        const desc = getLocalizedText(`${entity_list}_${quest_edit.id_name}_description`);
        const start_quest_text = getLocalizedText(`${entity_list}_${quest_edit.id_name}_start_text`);
    
        const quest_types = State.variables.lists.quest_types
        const quest_statuses = [
            'non_active', 
            'active', 
            'completed', 
            'failed'
        ];  
        const characters = State.variables.characters;    
        const activation_quests = State.variables.quest_list;
        const location_list = State.variables.lists.location_list_expanded;
        const update_tasks_entity = 'tasks';
        
        const add_state_class = '.add_state',
            remove_state_class = '.remove_state',
            add_task_class = '.add_task',
            remove_task_class = '.remove_task',
            select_task_class = '.state_tasks__select',
            update_tasks_select_class = '.state_tasks-container .state_tasks__select';

        
        const constructor_form = `            
            <div class="form-block">
                <label>ID Name* </label>
                <input name="id_name" id="id_name" value="${quest_edit.id_name}"/>
            </div>

            <div class="form-block">
                <label> Name (EN)</label>                
                <input
                    class="localized-text"
                    data-prop="name"
                    value="${(name) ? name:''}" 
                />
            </div>    
            
            <div class="form-block">
                <label>Type </label>
                <select name="type" id="type">
                    ${quest_types.map((value) => (
                        `<option 
                            ${(value == quest_edit.type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>

            <div class="form-block">
                <label> Description (EN)</label>                
                <textarea 
                    data-prop="description" 
                    class="localized-text"
                >${desc}</textarea>
            </div> 
            

            <div class="form-block-section">
                <h1 class="form-block-section__header">Activation</h1>                
                <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">
                    <div class="form-blocks-row">

                        <div class="form-block">
                            <label> Quest </label>
                            <select name="activation_flag[id_name]"  class="select2">
                                <option disabled selected value="-1">-- select --</option>
                                ${Object.keys(activation_quests).map((value) => (                                         
                                    `<option 
                                        ${(value == quest_edit.activation_flag.id_name) ? 'selected' : ''}
                                        value="${value}"
                                    >
                                        ${value} 
                                    </option>`
                                )).join('')}
                            </select>
                        </div>

                        <div class="form-block">
                            <label> Status </label>
                            <select name="activation_flag[value]">
                                <option disabled selected value="-1">-- select --</option>
                                ${quest_statuses.map((value, index) => (
                                    `<option 
                                        ${(index == quest_edit.activation_flag.value) ? 'selected' : ''} 
                                        value="${index}"
                                    >
                                        ${value}
                                    </option>`
                                )).join('')}
                            </select>
                        </div>

                        <div class="form-block">
                            <label> Location </label>
                            <select id="activation_flag_location" name="activation_flag[location]" class="select2">
                                <option disabled selected value="-1">-- select --</option>
                                ${location_list.map((value) => (
                                    `<option 
                                        ${(value == quest_edit.activation_flag.location) ? 'selected' : ''}
                                        value="${value}"
                                    >
                                        ${value}
                                    </option>`
                                )).join('')}
                            </select>
                        </div>

                        <div class="form-block">
                            <label> Quest Text (EN)</label>                
                            <textarea                             
                                data-prop="start_text" 
                                class="localized-text"
                            >${start_quest_text}</textarea>
                        </div> 
                    </div>
                </div>
            </div>

            <div class="form-block-section">
                <h1 class="form-block-section__header">States</h1>
                <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">
                    <button type="button" class="add_state form_add"> Add State </button>
                    <button type="button" class="form_remove remove_state">Remove State</button> 
                </div>
            </div>

            <button type="button" class="form-save" id="save_quest">Save quest</button>   

            <br><br><br><br><p style="font-size: 50px; color: red;">Following functional will be added in future!</p>
            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Conditions</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">                                      
                        
                        <button type="button" class="form_add add_quest-condition"> Add Condition </button>
                    </div>   
                </div>   
            </div>    

            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Actions</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">                                      
                        
                        <button type="button" class="form_add add_quest-action"> Add Actions </button>
                    </div>   
                </div>   
            </div>       

        `;

        $constructor_block.append(constructor_form);

        addEditQuestStatesBlock();
        
        $constructor_block.find(".select2").select2();



        const latest_state = $('.state-block:last-of-type').data('state');                                   
        let state_counter = latest_state ?? 0;
        $(add_state_class).on('click', function() { 
            addQuestStateBlock(++state_counter);
        });

        function addEditQuestStatesBlock(){
            $.each(quest_edit.states, function(state_index, state) {   
                addQuestStateBlock(state_index);      

                const state_block = $(`.state-block[data-state="${state_index}"]`)[0]; 
                $.each(quest_edit.states[state_index], function(task_index, state_task) { 
                    addQuestTaskBlock(state_block, state_task);
                });
        
            });
            
            window.setTimeout(function () {	  
                const last_edit_select = $('.state_tasks__select').last();
                triggerLastTaskSelectChange(last_edit_select);
            }, 10);
        }

        function addQuestStateBlock(state_num) {
            const cur_btn_add_state = $constructor_block.find(add_state_class);

            const state_content = `
                <div class="form-block-section state-block" data-state='${state_num}'>
                    <h1 class="form-block-section__header">State ${state_num}</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">

                        <div class="form-row">
                            <div class="form-blocks-row state_tasks-container"></div>

                            <button type="button" class="form_add add_task">Add Task</button> 
                            <button type="button" class="form_remove remove_task">Remove Task</button> 

                        </div>
                    </div>
                </div>
            `;

            $(state_content).insertBefore( cur_btn_add_state );             
        }

        $constructor_block.on('click', remove_state_class, function() {      
            state_counter-=1;
            const state_block = $constructor_block.find('.state-block:last-of-type');  

            state_block.find('.state_tasks__select').each(function() {
                const task_idn = this.value;
                removeTaskFromQuest(task_idn);
            });
            
            state_block.remove();
            updateEntitySelectOptions(update_tasks_entity, update_tasks_select_class);
        });


        $constructor_block.on('click', add_task_class, function() {             
            addQuestTaskBlock(this);
            updateEntitySelectOptions(update_tasks_entity, update_tasks_select_class);

            triggerLastTaskSelectChange(this);
        });

        $constructor_block.on('click', remove_task_class, function() {    
            const task_block = $(this).closest('.state-block').find('.state_tasks-container').find('.form-block:last-of-type');  
            const task_idn = task_block.find('select').val();

            removeTaskFromQuest(task_idn);
            task_block.remove();
            
            updateEntitySelectOptions(update_tasks_entity, update_tasks_select_class);
        });

        
        $constructor_block.on('change', select_task_class, function() {   
            const task_idn = this.value;
            removeTaskFromQuest(task_idn);

            updateEntitySelectOptions(update_tasks_entity, update_tasks_select_class);    
        });


        
        function addQuestTaskBlock(cur_block, state_task) {  
            const tasks_container = $(cur_block).closest('.state-block').find('.state_tasks-container');
            const state_counter = $(cur_block).closest('.state-block').data('state');

            const task = `
                <div class="form-block">
                    <label>Task </label>
                    <select name="states[${state_counter}][]" class="select2 state_tasks__select">
                        ${(state_task)
                        ? `<option value="${state_task.id_name}"> ${state_task.id_name} </option>` 
                        : ''}
                    </select>
                </div>                
            `;

            tasks_container.append(task);  
        }




        $('#activation_flag_location').on('change', function() {

            const location_character_block = `
                <div class="form-block">
                    <label for="location"> Location Character* </label>
                    <select name="activation_flag[location_character]" id="activation_flag_location_character">
                        <option selected value="-1">-- select --</option>
                        ${Object.keys(characters).map((value) => (   
                            `<option value="${value}">${value}</option>`
                        )).join('')}
                    </select>
                </div>
            `;

            if (this.value == 'Talk_Menu') $(this).closest('.form-block').append(location_character_block);
        });


        // #region Sketch Validation and Save 

        const $save_button = $('#save_quest');        
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);
            
            const new_quest = serialized_form;                     

            const tasks = State.variables.tasks;
            $.each(new_quest.states, function (state, state_tasks) { 
                $.each(state_tasks, function (task_index, task_id_name) {
                    const task_obj = tasks[task_id_name] ?? false;  

                    if (task_obj) {     // if task is in task list, get task object form the list and remove task from the list. 
                        new_quest.states[state][task_index] = tasks[task_id_name];
                        delete State.variables.tasks[task_id_name];  
                    } else {        // if task already in quest, just rewrite new quest enity . 
                        new_quest.states[state][task_index] = quest_edit.states[state][task_index];                        
                    }
                });
            });
            
            console.log('new_quest', new_quest);

            const no_space = (new_quest.id_name.trim().indexOf(' ') >= 0);
            
            if(!new_quest.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');
            } else if (no_space) {                
                alert('Task id_name should be without spaces!');
                console.error('Task id_name should be without spaces');
            } else {                
                State.variables.quest_list[new_quest.id_name] = new_quest;

                addQuickLocalization(new_quest);

                alert('Quest has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }

        });
        // #endregion

    });
}

// function updateAllTaskSelects() {
//     const list = getTasksListContent();
//     $().each(function(index, select) {
//         $(select).find('option').not(':selected').remove(); // do not clear selected option
//         $(select).append(list);
//     });
// }


// function getTasksListContent() {
//     const tasks = State.variables.tasks;
//     const task_list = Object.entries(tasks); // convert to array
//     const selected_tasks = getAllSelectedTasks();
//     const filtered_task_list = task_list.filter(([key, task]) => !selected_tasks.includes(task.id_name));
//     const filtered_tasks = Object.fromEntries(filtered_task_list); // convert to object

//     const task_options = `
//         ${Object.values(filtered_tasks).map((task) => (
//             `<option value="${task.id_name}"> ${task.id_name} </option>`
//         )).join('')} 
//     `;
    
//     return task_options;
// }


// function getAllSelectedTasks() {
//     const list = [];
//     $('.state_tasks-container .state_tasks__select').each(function(index, select) {
//         const task_idn = select.value;
//         list.push(task_idn);
//     });
//     return list;
// };


function triggerLastTaskSelectChange(cur_block) {
    // trigger change to preform :selected validation            
    const tasks_container = $(cur_block).closest('.state-block').find('.state_tasks-container');
    const added_select = tasks_container.find('.form-block:last-of-type .state_tasks__select');
    added_select.change();
}


/* twine-user-script #55: "schedule_constructor.js" */


// Add style for sections (like character schedule)
// Add check if character with such id_name already exists

function scheduleConstructor() {
    $(document).ready(function() {      
        const $constructor_block = $('#constructor');
        const schedule_edit_idn = State.variables.temp.constructor_item_edit;
        const schedule_edit = (schedule_edit_idn) ? State.variables.schedule_list[schedule_edit_idn] : {id_name: ''};
         
        console.log('schedule_edit', schedule_edit);
        
        const characters = State.variables.characters;
        let schedule_counter = 0;

        

        const constructor_form = `            
            <div class="form-block">
                <label> ID Name* </label>
                <input name="id_name" value="${schedule_edit.id_name}" />
            </div>
               

            <div class="form-block-section">
                <h1 class="form-block-section__header">Character Schedule</h1>

                <div class="form-block-section-wrapper">                  
                
                    <div class="form-blocks-row">
                        <div class="form-block">
                            <label> Character </label>
                            <select name="character_idn">   
                                <option disabled selected value="-1">-- select --</option>
                                ${Object.keys(characters).map((value) => (                                                
                                    `<option 
                                        ${(value == schedule_edit.character_idn) ? 'selected' : ''}
                                        value="${value}"
                                    >
                                        ${value}
                                    </option>`
                                )).join('')}
                            </select>
                        </div>                        
                    </div>     

                    <div class="schedule-container"></div>  

                    <button type="button" class="form_add add_schedule"> Add Schedule </button>
                    
                    <div class="form-block">
                        <button type="button" class="form_remove remove_schedule">Remove Schedule</button>
                    </div>
                </div> 

            </div>

            <p> ** Don't forget to past new changes into the 'json_schedules' file! </p>
            <p> Schedules added via constructor only, will be removed after day change and then page restart!</p>
            
            <button type="button" class="form-save" id="save_schedule">Save sketch</button>  
        `;


        $constructor_block.append(constructor_form);

        
        $.each(schedule_edit.list, function(period_list_index, period_list) {
            const period_content = getSchedulePeriodContent(period_list_index, period_list); 
            $('.schedule-container').append(period_content);
            schedule_counter += 1;
        });
        $('.select2-multiple').select2();
     
        

        


        const $add_button = $('.add_schedule');
        $add_button.on('click', function() {
            const period_content = getSchedulePeriodContent(schedule_counter);
            $('.schedule-container').append(period_content);
            $('.select2-multiple').select2();
            schedule_counter += 1; 
        });

        $constructor_block.on('click', '.remove_schedule', function() {
            $(this).closest('.form-block-section').find('.schedule-container').find('.schedule-block').last().remove();
            schedule_counter -= 1;
        });



        function getSchedulePeriodContent(period_list_index=0, period_list={}) { 
            const period_counter = period_list_index+1;
            const assignments = State.variables.lists.assignments;
            const hours_list = State.variables.lists.hours;
            const months_list = localization_system_text['en']['month_list'];
            const days_of_week_list = localization_system_text['en']['day_of_week_list'];

            const schedule_assignments = period_list.assignments ?? [];
            const schedule_months = period_list.months ?? [];
            const schedule_days_of_week = period_list.days_of_week ?? [];
            const schedule_hours = period_list.hours ?? [];
            

            const state = `      
                <div class="schedule-block">
                    <h1 class="form-block-section__header">Period ${period_counter}</h1>
                    <div class="form-block-section-wrapper">

                        <div class="form-block">
                            <div class="form-blocks-row">
                                <div class="form-block">
                                    <label> Assignments </label>                                    
                                    <select name="list[${period_counter}][assignments][]" class="select2-multiple" multiple="multiple">
                                        ${Object.keys(assignments).map((value) => (                                                
                                            `<option 
                                                ${(schedule_assignments.includes(value)) ? 'selected' : ''}
                                                value="${value}"
                                            >
                                                ${value}
                                            </option>`
                                        )).join('')}
                                    </select>
                                </div>                        
                            </div> 

                            <div class="form-blocks-row">
                                <div class="form-block">
                                    <label>Months</label>
                                    <select name="list[${period_counter}][months][]" class="select2-multiple" multiple="multiple">
                                        ${Object.entries(months_list).map(([key, value]) => (  
                                            `<option 
                                                ${(schedule_months.includes( key)) ? 'selected' : ''}    
                                                value="${key}"
                                            >
                                                ${value} ${key}
                                            </option>`
                                        )).join('')}
                                    </select>
                                </div>
                            
                                <div class="form-block">
                                    <label>Days of Week</label>
                                    <select name="list[${period_counter}][days_of_week][]" class="select2-multiple" multiple="multiple">
                                        ${Object.entries(days_of_week_list).map(([key, value]) => (  
                                            `<option 
                                                ${(schedule_days_of_week.includes( key)) ? 'selected' : ''}    
                                                value="${key}"
                                            >
                                                ${value} ${key}
                                            </option>`
                                        )).join('')}
                                        
                                    </select>
                                </div>

                                <div class="form-block">
                                    <label>Hours</label>
                                    <select name="list[${period_counter}][hours][]" class="select2-multiple" multiple="multiple">
                                        ${Object.entries(hours_list).map(([key, value]) => (  
                                            `<option 
                                                ${(schedule_hours.includes(key)) ? 'selected' : ''}
                                                value="${key}"
                                            > 
                                                ${value}
                                            </option>`
                                        )).join('')}
                                    </select>
                                </div>
                            </div>
                            
                        </div>        
                    </div>  
                </div>       

            `;

            return state;
        }



        
        const $save_button = $('#save_schedule'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);
            const new_schedule = transformScheduleOnjToArray(serialized_form) 
            console.log('new_schedule', new_schedule);

            if(!new_schedule.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');            
            } else {               
                schedule_list[new_schedule.id_name] = new_schedule;    
                State.variables.schedule_list = schedule_list;

                alert('Schedule has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }

        });

    });
}







function transformScheduleOnjToArray(obj) {
    const key_property = 'list';
    if (!obj[key_property]) return obj; // Return the original object if 'schedule' is missing

    const scheduleArray = Object.values(obj[key_property]); // Get the values (schedule objects) from the 'schedule' object

    // Update the object with the transformed 'schedule' array
    obj[key_property] = scheduleArray;

    return obj;
}


/* twine-user-script #56: "sketch_constructor.js" */

        
// spid - Sketch Page ID
// seid - Sketch Element ID
// scid - Sketch Condition ID 
// said - Sketch Action ID
 
function sketchConstructor () {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');
        const sketch_edit_idn = State.variables.temp.constructor_item_edit;
        const sketch_edit = (sketch_edit_idn) ? State.variables.sketches[sketch_edit_idn] : {id_name: '', pages: {}}  ;

        console.log('sketch_edit', sketch_edit);

        const add_button_page = '.add_sketch_page';
        const remove_button_page = '.remove_sketch-page';

        const add_button_elem = '.add_sketch_elem';
        const up_button_element = '.sketch-element-up';
        const down_button_element = '.sketch-element-down';
        const remove_button_element = '.remove_sketch-element';
        const element_type_select_class = '.sketch-element-type__select';

        const media_folder_select = '.sketch__media-files-folder';
        const media_name_select = '.sketch__media-files-name';
                
        const element_types = [
            'speech',
            'text',
            'image',
            'video', 
            'injection',
            'choice'
        ];

        
        const add_button_condition = '.add_sketch-condition';
        const remove_button_condition = '.remove_sketch-condition';
        const select_class_condition = '.sketch-condition__type';        
        const select_class_condition_param = '.sketch-condition__param';
        const select_class_condition_character = '.sketch-condition__character';
        const select_class_condition_relation = '.sketch-condition__relation';
        const select_class_condition_battle = '.sketch-condition__battle';
        const select_class_condition_item_type = '.sketch-condition__item-type';
        const select_class_condition_item_class = '.sketch-condition__item-class';        
        const condition_types = {
            check_param: 'Check parameter',
            check_flag: 'Check flag',
            in_party: 'Is in party',
            on_location: 'On location',
            timeline: 'Timeline',
            has_item_idn: 'Has item',
            has_item_class: 'Has item of class',
            time_countdown: 'Time countdown',
            check_quest_status: 'Quest status',
            check_task_status: 'Task status',
            check_task_counter: 'Task counter',
            custom: 'Custom (N/A)'
        };

        
        const add_button_action = '.add_sketch-action';
        const remove_button_action = '.remove_sketch-action';
        const select_class_action = '.sketch-action__type';
        const select_class_action_param = '.sketch-action__param';
        const select_class_action_character = '.sketch-action__character';
        const select_class_action_relation = '.sketch-action__relation';
        const select_class_action_battle = '.sketch-action__battle';
        const select_class_action_item_type = '.sketch-action__item-type';
        const select_class_action_item_class = '.sketch-action__item-class';     
        const select_class_quest_list = '.sketch-list__quest';        
        const select_class_task_list = '.sketch-list__task';
        const action_types = {
            change_param: 'Change param',
            add_time: 'Add time',
            set_time: 'Set time',
            change_flag: 'Change flag',
            change_schedule: 'Change schedule',
            change_schedule_daily: 'Change schedule daily',
            change_schedule_current_hour: 'Change schedule current hour',
            add_inventory_idn: 'Add item',
            add_inventory_class: 'Add item of class',
            remove_inventory_idn: 'Remove item',
            add_to_party: 'Add to party',
            remove_from_party: 'Remove from party',
            start_quest: 'Start quest', 
            finish_task: 'Finish task',
            fail_task: 'Fail task',
            time_countdown: 'Time countdown',
            injection_action: 'Injection action',
            custom: 'Custom (N/A)'
        };



        const global_variables = $.extend(true,{},State.variables);     // deep cloning for not to change State.variables
        const object_variables  = [];
        const global_first_level = [];
        $.each(global_variables, function(prop, value ) {    
            if (typeof value == 'function')  delete global_variables[prop];
            if (typeof value == 'object')  object_variables[prop]=value;
            if (typeof value == 'array')  object_variables[prop]=value;
            if (typeof value == 'number')  global_first_level[prop]=value;
            if (typeof value == 'string')  global_first_level[prop]=value;
            if (typeof value == 'boolean')  global_first_level[prop]=value;
        });


        // #region Sketch Form 

        const constructor_form = `            
            <div class="form-block">
                <label> Sketch ID Name </label>
                <input name="id_name" id="id_name" value="${sketch_edit.id_name}" />
            </div>

            <button type="button" class="form_add add_sketch_page"> Add Sketch Page </button>
            <button type="button" class="form-save" id="save_sketch">Save sketch</button>  
        `;
        
        $constructor_block.append(constructor_form);

        // Draw existing pages
        $.each(sketch_edit.pages, function(sketch_page_index, sketch_page) {
            addEditSketchPage(sketch_page_index, sketch_page);
        });
        
        $(".select2").select2();
        activateSelect2Tagging()

        // #endregion



        // #region Sketch Pages 

        function addEditSketchPage(sketch_page_index, sketch_page) {
            const spid = getIdFromIndex(sketch_page_index);

            addSketchPageContent(spid);

            $.each(sketch_page, function(sketch_element_index, sketch_element) {
                addEditSketchElement(sketch_element_index, sketch_element, spid);
            });
    
        }

        // Add new sketch page
        $constructor_block.on('click', add_button_page, function() {   
            const last_page = $(this).prev('.sketch-page')[0];  
            const last_page_id = (typeof last_page !== "undefined") ? $(last_page).data('page') : 0; // get last existing page id
            const new_page_id = last_page_id + 1; // create new page id
            const spid = new_page_id;

            addSketchPageContent(spid);
        });

        
        function addSketchPageContent(spid) {
            const page_content = `
                <div class="form-block-section sketch-page"  data-page=${spid}>
                    <h1 class="form-block-section__header">Sketch Page ${spid}</h1>

                    <div class="form-block-section-wrapper"> 

                        <div class="form-blocks">
                            <button type="button" class="form_add add_sketch_elem"> Add Sketch Element </button>
                        </div> 
                    </div>

                    <button type="button" class="form_remove form_remove--left remove_sketch-page">Remove Page</button>

                </div> 
            `;       
            $(page_content).insertBefore( $(add_button_page) ); 
            updateSketchPagesList();
        }

        $constructor_block.on('click', remove_button_page, function() {
            $(this).closest('.sketch-page').remove();
            updateSketchPagesList();
        });

        // #endregion


        
        // #region Sketch Elements 

        function addEditSketchElement(sketch_element_index, sketch_element, spid) {
            const cur_page_btn_add_element = $(`.sketch-page[data-page="${spid}"]`).find(add_button_elem); 
            const seid = getIdFromIndex(sketch_element_index);

            addSketchElementContent(spid, seid, cur_page_btn_add_element, sketch_element.type);

            addEditElementTypeContent(spid, seid, sketch_element);
        }

        // Add new sketch element
        $constructor_block.on('click', add_button_elem, function() {
            const cur_page_btn_add_element = $(this);
            const spid = $(cur_page_btn_add_element).parents('.sketch-page').data('page');

            const all_page_elements = $(cur_page_btn_add_element).parents('.sketch-page').find('.sketch-element');
            const elements_ids_list = all_page_elements.map( (index, value) => { return $(value).data('element')}).get();   // transform to list for further readability          
            const page_elements_highest_id = (elements_ids_list.length) ? Math.max.apply(Math, elements_ids_list) : 0;   // get last element_id in current page
            const seid = page_elements_highest_id + 1;
            
            addSketchElementContent(spid, seid, cur_page_btn_add_element);

            $(this).closest('.sketch-page').find(".select2").select2();
        });


        function addSketchElementContent(spid, seid, cur_page_btn_add_element, sketch_element_type='') {
            const element_content = `            
                <div class="form-block-section sketch-element"  data-element=${seid}>
                    <div class="form-block">
                        <button type="button" class="sketch-element-up">↑</button>
                        <button type="button" class="sketch-element-down">↓</button>
                    </div>
                    <h1 class="form-block-section__header">Sketch Element ${seid}</h1>

                    <div class="form-block-section-wrapper"> 

                        <div class="form-blocks-row">
                            <div class="form-block">
                                <label for="description"> Sketch Element Type </label>
                                <select name="pages[page_${spid}][el_${seid}][type]" class="select2 sketch-element-type__select"> 
                                    <option disabled selected value="-1">-- select --</option>
                                    ${element_types.map((value) => (
                                        `<option 
                                            ${(value == sketch_element_type) ? 'selected' : ''}
                                            value="${value}"
                                        >
                                            ${value}
                                        </option>`
                                    )).join('')}
                                </select>
                            </div>

                            <div class="form-block sketch-element-type__container"></div>
                    
                        </div>

                    </div>                 
                    <button type="button" class="form_remove form_remove--left remove_sketch-element">Remove Element</button>
                </div>
            `;

            $(element_content).insertBefore( cur_page_btn_add_element );
        }

        
        $constructor_block.on('click', up_button_element, function() {
            const cur_element = $(this).closest('.sketch-element');
            const upper_element = cur_element.prev();
            cur_element.detach().insertBefore(upper_element).hide().show('slow');   // moving block with simple animations
        });

        $constructor_block.on('click', down_button_element, function() {
            const cur_element = $(this).closest('.sketch-element');
            const lower_element = cur_element.next();
            cur_element.detach().insertAfter(lower_element).hide().show('slow');    // moving block with simple animations
        });

        $constructor_block.on('click', remove_button_element, function() {
            $(this).closest('.sketch-element').remove();
        });



        function addEditElementTypeContent(spid, seid, sketch_element) {      
            const cur_type = sketch_element.type;
            const cur_element_block = $(`.sketch-page[data-page="${spid}"]`).find(`.sketch-element[data-element="${seid}"]`);
            const element_container = cur_element_block.find('.sketch-element-type__container');

            addSketchElementTypeContent(spid, seid, cur_type, element_container, sketch_element);
                
            
            // Check if element type is one of media types and output its blocks in case it's true
            if (sketch_element.type == 'video' || sketch_element.type == 'image') addEditElementMediaType(sketch_element, element_container);

            // Check if there are 'conditions' for this element and output its blocks if true                 
            if (Array.isArray(sketch_element.conditions) && sketch_element.conditions.length) {   
                $.each(sketch_element.conditions, function(sketch_condition_index, sketch_condition) {
                    addEditCondition(sketch_condition_index, sketch_condition, element_container);
                });
            }

            // Check if there are 'conditions' for this element and output its blocks if true
            if (Array.isArray(sketch_element.actions) && sketch_element.actions.length) {    
                $.each(sketch_element.actions, function(sketch_action_index, sketch_action) {
                    addEditAction(sketch_action_index, sketch_action, element_container);
                });
            }
        }

        // Dynamic Change of Fields for Different Sketch Types
        $constructor_block.on('change', element_type_select_class, function() {
            const select = this;
            const spid = $(select).parents('.sketch-page').data('page');
            const seid = $(select).parents('.sketch-element').data('element');  

            const cur_type = select.value;
            const cur_element_block = $(select).closest('.sketch-element');
            const element_container = cur_element_block.find('.sketch-element-type__container');

            addSketchElementTypeContent(spid, seid, cur_type, element_container );

            element_container.find(".select2").select2();
        });


        function addSketchElementTypeContent(spid, seid, cur_type, element_container, sketch_element={}) {
            element_container.empty();
            
            // Add corresponding blocks for each element type.
            const cur_type_options = getSketchElementTypeFields(cur_type);
            $.each(cur_type_options, function(index, option ) {
                const content_option = getElementTypeOptionContent(option, spid, seid, sketch_element);
                element_container.append(content_option);
            });            
            
            updateSketchPagesList();
        }

        // #endregion



        // #region Sketch Element Media Types 

        function addEditElementMediaType(sketch_element, element_container) {
            const selected_folder = sketch_element.media_folder ;
            const media_type = sketch_element.type;
            const media_name_select = $(element_container).closest('.sketch-element').find(`.sketch__media-files-name`);

            addEditElementMediaTypeContent(media_type, selected_folder, media_name_select, sketch_element);
            
            showDemoSketchMedia(element_container, sketch_element.media_folder, sketch_element.media_file);   
        }

        
        // Dynamic Change of Sketch Element Media Types lists on media folder list select
        $constructor_block.on('change', media_folder_select, function() {
            const select = this;
            const selected_media_folder = select.value;
            const media_type = $(select).data('type');
            const media_name_select = $(select).closest('.sketch-element').find(`.sketch__media-files-name`);

            addEditElementMediaTypeContent(media_type, selected_media_folder, media_name_select);

            // !!! Value should be get after adding content function.
            const selected_media_name = media_name_select.val();        
            showDemoSketchMedia(select, selected_media_folder, selected_media_name);     
        });

        
        function addEditElementMediaTypeContent(media_type, selected_folder, media_name_select, sketch_element={}) {
            const sketch_media_name_list = State.variables.lists[`${media_type}_list`][selected_folder];

            media_name_select.empty();

            $.each(sketch_media_name_list, function(index, media_name) {
                const option_content = 
                    `<option 
                        value=${media_name}
                        ${(media_name == sketch_element.media_file) ? 'selected' : '' }
                    >
                        ${media_name}
                    </option>`
                ;
                media_name_select.append(option_content);
            });
        }


        // Dynamic Change of Sketch Element Media Types lists on media name list select
        $constructor_block.on('change', media_name_select, function() {
            const select = this;
            const selected_media_name = select.value;
            const selected_media_folder = $(select).closest('.sketch-element').find(media_folder_select).val();

            showDemoSketchMedia(select, selected_media_folder, selected_media_name);
        });

        function showDemoSketchMedia(cur_media_block, selected_media_folder, selected_media_name) {
            const file_path = `media/sketches/${selected_media_folder}/${selected_media_name}`;
            const media_file_demo = $(cur_media_block).closest('.sketch-element').find('.sketch__media-files-demo');

            media_file_demo.show();
            media_file_demo.attr("src", file_path);
            media_file_demo.attr("alt", `no such image: '${selected_media_name}' in folder ${selected_media_folder}`);
        }

        // #endregion

        

        // #region Sketch Conditions 

        function addEditCondition(sketch_condition_index, sketch_condition, element_container) {  
            const scid = sketch_condition_index + 1;

            addSketchConditionContent(scid, element_container, sketch_condition)
            
            addEditConditionContent(sketch_condition, scid, element_container);
        }

        $constructor_block.on('click', add_button_condition, function() {
            const cur_button_condition = this;

            const last_element_condition = $(cur_button_condition).prev('.sketch-condition')[0];  
            const last_element_condition_id = (typeof last_element_condition !== "undefined") ? $(last_element_condition).data('condition') : 0;  // get last existing condition id
            const new_last_element_condition_id = last_element_condition_id + 1;  // create new condition id
            const scid = new_last_element_condition_id;
            
            addSketchConditionContent(scid, cur_button_condition);

            $(this).closest('.sketch-element-type__container').find(".select2").select2();
        });

        function addSketchConditionContent(scid, cur_block, sketch_condition={}) {      
            const spid = $(cur_block).parents('.sketch-page').data('page');
            const seid = $(cur_block).parents('.sketch-element').data('element');              
            const cur_element_btn_add_condition = $(cur_block).parent().find(add_button_condition);

            const condition_content = `   
                <div class="form-blocks-row sketch-condition form-blocks-row--borderline" data-condition=${scid}>   
                    <div class="form-block">
                        <label> Type </label>
                        <select 
                            class="select2 sketch-condition__type"
                            name="pages[page_${spid}][el_${seid}][conditions][${scid}][type]"
                        >                                                                         
                            <option disabled selected value="-1">-- select --</option>
                                ${Object.entries(condition_types).map(([key, value]) => (    
                                    `<option 
                                        ${(key == sketch_condition.type) ? 'selected' : ''}
                                        value="${key}"
                                    >
                                        ${value}
                                    </option>`
                                )).join('')}
                        </select>                         
                    </div>   

                    <div class="form-blocks-row sketch-condition__container"></div>  
                    
                    <button type="button" class="form_remove remove_sketch-condition">Remove</button>
                </div>   
            `;

            $(condition_content).insertBefore( cur_element_btn_add_condition );  
        }


        $constructor_block.on('click', remove_button_condition, function() {
            $(this).closest('.sketch-condition').remove();
        });
        

        function addEditConditionContent(sketch_condition, scid, element_container) {   
            const cur_type = sketch_condition.type;
            const condition_container = $(element_container).find(`.sketch-condition[data-condition="${scid}"]`).find('.sketch-condition__container');  

            const spid = $(element_container).parents('.sketch-page').data('page');
            const seid = $(element_container).parents('.sketch-element').data('element');  

            addSketchConditionTypeContent(spid, seid, scid, cur_type, condition_container, sketch_condition);  
            
            if (sketch_condition.type == 'check_task_counter' || sketch_condition.type == 'check_task_status') addTaskActionTypeContent(condition_container, sketch_condition.quest, sketch_condition.task);      

            const hasParamRelation = ((sketch_condition.relation !== undefined) && (!!sketch_condition.relation));
            if (hasParamRelation) addRelationConditionSelectContent(condition_container, sketch_condition.character, sketch_condition.relation);
            
            const hasParamBattle = ((sketch_condition.battle !== undefined) && (!!sketch_condition.battle));
            if (hasParamBattle) addBattleConditionSelectContent(condition_container, sketch_condition.character, sketch_condition.battle);
        }

        // For Dynamic Displaying of Conditions Type Content
        $constructor_block.on('change', select_class_condition, function() {   
            const select = this;
            const cur_type = select.value;
            const condition_container = $(select).closest('.sketch-condition').find('.sketch-condition__container');

            const spid = $(select).parents('.sketch-page').data('page');
            const seid = $(select).parents('.sketch-element').data('element');  
            const scid = $(select).parents('.sketch-condition').data('condition');  

            addSketchConditionTypeContent(spid, seid, scid, cur_type, condition_container);

            $(condition_container).find(".select2").select2();
            activateSelect2Tagging()
        });


        function addSketchConditionTypeContent(spid, seid, scid, cur_type, condition_container, sketch_condition={}) {
            condition_container.empty();
            
            // Add corresponding blocks for each condition type.
            const cur_type_options = getSketchConditionFields(cur_type);
            $.each(cur_type_options, function(index, option ) {
                const content_option = getConditionOptionContent(option, spid, seid, scid, sketch_condition);
                condition_container.append(content_option);
            });            
        }



        $constructor_block.on('change', select_class_condition_character, function() {
            const select = this;
            const cur_character_name = this.value;
            const param_select = $(select).parents('.sketch-condition').find(select_class_condition_param)[0];            

            if (param_select) refreshAdditionalConditionParamSelect(param_select, cur_character_name);
        });       

        $constructor_block.on('change', select_class_condition_param, function() {
            const select = this;
            const cur_character_name = $(select).parents('.sketch-condition').find(select_class_condition_character).val();

            if (cur_character_name) refreshAdditionalConditionParamSelect(select, cur_character_name);
        });

        function refreshAdditionalConditionParamSelect(param_select, cur_character_name) {
            const relation_select_block = $(param_select).parents('.sketch-condition').find(select_class_condition_relation).parent();
            relation_select_block.remove();
            const battle_select_block = $(param_select).parents('.sketch-condition').find(select_class_condition_battle).parent();
            battle_select_block.remove();

            if (param_select.value == 'relation') {
                addRelationConditionSelectContent(param_select, cur_character_name);
            } else if (param_select.value == 'battle') {
                addBattleConditionSelectContent(param_select, cur_character_name);
            }
            
            $(param_select).parents('.sketch-condition').find(".select2").select2();
        }

        function addRelationConditionSelectContent(cur_block, cur_character_name, selected_character_relation) { 
            if (cur_character_name == 'player') cur_character_name = State.variables.player.id_name;
            const cur_character = State.variables.characters[cur_character_name];
            
            const existed_relation_select_block = $(cur_block).parents('.sketch-condition').find(select_class_condition_relation).parent();
            const cur_select_block = $(cur_block).parents('.sketch-condition').find(select_class_condition_param).parent();

            const spid = $(cur_select_block).parents('.sketch-page').data('page');
            const seid = $(cur_select_block).parents('.sketch-element').data('element');  
            const scid = $(cur_select_block).parents('.sketch-condition').data('condition');  

            const relation_select = `            
                <div class="form-block">
                    <label> Relations </label>
                    <select 
                        class="select2 sketch-condition__relation" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][relation]"
                    >         
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.keys(cur_character.relations).map((value) => (                                         
                            `<option 
                                ${(value == selected_character_relation) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>
            `;

            existed_relation_select_block.remove();
            $(relation_select).insertAfter( cur_select_block );
        }

        function addBattleConditionSelectContent(cur_block, cur_character_name, selected_character_battle) { 
            if (cur_character_name == 'player') cur_character_name = State.variables.player.id_name;
            const cur_character = State.variables.characters[cur_character_name];
            
            const existed_battle_select_block = $(cur_block).parents('.sketch-condition').find(select_class_condition_battle).parent();
            const cur_select_block = $(cur_block).parents('.sketch-condition').find(select_class_condition_param).parent();

            const spid = $(cur_select_block).parents('.sketch-page').data('page');
            const seid = $(cur_select_block).parents('.sketch-element').data('element');  
            const scid = $(cur_select_block).parents('.sketch-condition').data('condition');  

            const new_select = `            
                <div class="form-block">
                    <label> Battle Param </label>
                    <select 
                        class="select2 sketch-condition__battle" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][battle]"
                    >         
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.keys(cur_character.battle).map((value) => (                                         
                            `<option 
                                ${(value == selected_character_battle) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>
            `;

            existed_battle_select_block.remove();
            $(new_select).insertAfter( cur_select_block );
        }


        $constructor_block.on('change', select_class_condition_item_type, function() {
            const select = this;
            const cur_type = this.value;
            const item_class_select = $(select).parents('.sketch-condition').find(select_class_condition_item_class);    

            item_class_select.empty();
    
            const list_content = getItemsListContent(cur_type);
            item_class_select.append(list_content);
        });

        // #endregion

        



        
        // #region Sketch Actions 

        function addEditAction(sketch_action_index, sketch_action, element_container) {  
            const said = sketch_action_index + 1;
            
            addSketchActionContent(said, element_container, sketch_action);

            addEditActionContent(sketch_action, said, element_container);
        }


        $constructor_block.on('click', add_button_action, function() {
            const cur_button_action = this;
            const last_element_action = $(cur_button_action).prev('.sketch-action')[0];  
            const last_element_action_id = (typeof last_element_action !== "undefined") ? $(last_element_action).data('action') : 0;  // get last existing action id
            const new_last_element_action_id = last_element_action_id + 1; // create new action id
            const said = new_last_element_action_id; 
            
            addSketchActionContent(said, cur_button_action);
            
            $(this).closest('.sketch-element-type__container').find(".select2").select2();
        });


        function addSketchActionContent(said, cur_block, sketch_action={}) {      
            const spid = $(cur_block).parents('.sketch-page').data('page');
            const seid = $(cur_block).parents('.sketch-element').data('element');              
            const cur_element_btn_add_action = $(cur_block).parent().find(add_button_action);
            
            const action_content = `   
                <div class="form-blocks-row sketch-action form-blocks-row--borderline" data-action=${said}>   

                    <div class="form-block">
                        <label> Type </label>
                        <select 
                            class="select2 sketch-action__type"
                            name="pages[page_${spid}][el_${seid}][actions][${said}][type]"
                        >                                                                         
                            <option disabled selected value="-1">-- select --</option>                                
                            ${Object.entries(action_types).map(([key, value]) => (    
                                `<option 
                                    ${(key == sketch_action.type) ? 'selected' : ''}
                                    value="${key}"
                                >
                                    ${value}
                                </option>`
                            )).join('')}
                        </select>
                    </div>   

                    <div class="form-blocks-row sketch-action__container"></div>    
                    
                    <button type="button" class="form_remove remove_sketch-action">Remove</button>
                </div>   
            `;

            $(action_content).insertBefore( cur_element_btn_add_action );
        }


        $constructor_block.on('click', remove_button_action, function() {
            $(this).closest('.sketch-action').remove();
        });


        function addEditActionContent(sketch_action, said, element_container) {  
            const cur_type = sketch_action.type;
            const action_container = $(element_container).find(`.sketch-action[data-action="${said}"]`).find('.sketch-action__container');  

            const spid = $(element_container).parents('.sketch-page').data('page');
            const seid = $(element_container).parents('.sketch-element').data('element');  

            addSketchActionTypeContent(spid, seid, said, cur_type, action_container, sketch_action);

            if (sketch_action.type == 'fail_task' || sketch_action.type == 'finish_task') addTaskActionTypeContent(action_container, sketch_action.quest, sketch_action.task);      
            
            const hasParamRelation = ((sketch_action.relation !== undefined) && (!!sketch_action.relation));
            if (hasParamRelation) addRelationActionSelectContent(action_container, sketch_action.character, sketch_action.relation);  

            const hasParamBattle = ((sketch_action.battle !== undefined) && (!!sketch_action.battle));
            if (hasParamBattle) addBattleActionSelectContent(action_container, sketch_action.character, sketch_action.battle);  
        }
        

        // For Dynamic Displaying of Actions Type Content
        $constructor_block.on('change', select_class_action, function() {
            const select = this;
            const cur_type = select.value;
            const action_container = $(this).closest('.sketch-action').find('.sketch-action__container');

            const spid = $(select).parents('.sketch-page').data('page');
            const seid = $(select).parents('.sketch-element').data('element');   
            const said = $(select).parents('.sketch-action').data('action');  

            addSketchActionTypeContent(spid, seid, said, cur_type, action_container);
            
            $(action_container).find(".select2").select2();
            activateSelect2Tagging()
        });

        
        function addSketchActionTypeContent(spid, seid, said, cur_type, action_container, sketch_action={}) {
            action_container.empty();
            
            // Add corresponding blocks for each action type.
            const cur_type_options = getSketchActionFields(cur_type);
            $.each(cur_type_options, function(index, option ) {
                const content_option = getActionOptionContent(option, spid, seid, said, sketch_action);
                action_container.append(content_option);
            });            
        }


        $constructor_block.on('change', select_class_action_character, function() {
            const select = this;
            const cur_character_name = this.value;
            const param_select = $(select).parents('.sketch-action').find(select_class_action_param)[0];

            if (param_select) refreshAdditionalActionParamSelect(param_select, cur_character_name);
        });


        $constructor_block.on('change', select_class_action_param, function() {
            const select = this;
            const cur_character_name = $(select).parents('.sketch-action').find(select_class_action_character).val();

            if (cur_character_name) refreshAdditionalActionParamSelect(select, cur_character_name);
        });

        function refreshAdditionalActionParamSelect(param_select, cur_character_name) {
            const relation_select_block = $(param_select).parents('.sketch-action').find(select_class_action_relation).parent();
            relation_select_block.remove();
            const battle_select_block = $(param_select).parents('.sketch-action').find(select_class_action_battle).parent();
            battle_select_block.remove();

            if (param_select.value == 'relation') {
                addRelationActionSelectContent(param_select, cur_character_name);
            } else if (param_select.value == 'battle') {
                addBattleActionSelectContent(param_select, cur_character_name);
            } 

            $(param_select).parents('.sketch-action').find(".select2").select2();
        }

        function addRelationActionSelectContent(cur_block, cur_character_name, selected_character_relation) { 
            if (cur_character_name == 'player') cur_character_name = State.variables.player.id_name;
            const cur_character = State.variables.characters[cur_character_name];
            
            const existed_relation_select_block = $(cur_block).parents('.sketch-action').find(select_class_action_relation).parent();
            const cur_relation_select_block = $(cur_block).parents('.sketch-action').find(select_class_action_param).parent();

            const spid = $(cur_relation_select_block).parents('.sketch-page').data('page');
            const seid = $(cur_relation_select_block).parents('.sketch-element').data('element');  
            const said = $(cur_relation_select_block).parents('.sketch-action').data('action');  

            const relation_select = `            
                <div class="form-block">
                    <label> Relations </label>
                    <select 
                        class="select2 sketch-action__relation" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][relation]"
                    >         
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.keys(cur_character.relations).map((value) => (                                         
                            `<option 
                                ${(value == selected_character_relation) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>
            `;

            existed_relation_select_block.remove();
            $(relation_select).insertAfter( cur_relation_select_block );
        }

        function addBattleActionSelectContent(cur_block, cur_character_name, selected_character_battle) { 
            if (cur_character_name == 'player') cur_character_name = State.variables.player.id_name;
            const cur_character = State.variables.characters[cur_character_name];
            
            const existed_battle_select_block = $(cur_block).parents('.sketch-action').find(select_class_action_battle).parent();
            const cur_select_block = $(cur_block).parents('.sketch-action').find(select_class_action_param).parent();

            const spid = $(cur_select_block).parents('.sketch-page').data('page');
            const seid = $(cur_select_block).parents('.sketch-element').data('element');  
            const said = $(cur_select_block).parents('.sketch-action').data('action');  

            const new_select = `            
                <div class="form-block">
                    <label> Battle </label>
                    <select 
                        class="select2 sketch-action__battle" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][battle]"
                    >         
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.keys(cur_character.battle).map((value) => (                                         
                            `<option 
                                ${(value == selected_character_battle) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>
            `;

            existed_battle_select_block.remove();
            $(new_select).insertAfter( cur_select_block );
        }

        $constructor_block.on('change', select_class_action_item_type, function() {
            const select = this;
            const cur_type = this.value;
            const item_class_select = $(select).parents('.sketch-action').find(select_class_action_item_class);    

            item_class_select.empty();
    
            const list_content = getItemsListContent(cur_type);
            item_class_select.append(list_content);
        });

        
        // For Dynamic Displaying of Tasks By Selected Quest
        $constructor_block.on('change', select_class_quest_list, function() {
            const select = this;
            const selected_quest = select.value;

            addTaskActionTypeContent(select, selected_quest);
        });

        function addTaskActionTypeContent(cur_block, selected_quest, selected_task) { 
            const quest_tasks = getQuestTaskList(selected_quest);
            const type = $(cur_block).parent().find(select_class_quest_list).data('type');
            const classname = `.sketch-${type}`;
            const tasks_select = $(cur_block).closest(classname).find(select_class_task_list);
            tasks_select.empty();

            $.each(quest_tasks, function(index, task_idn) {
                const option_content = 
                    `<option 
                        value=${task_idn}
                        ${(task_idn == selected_task) ? 'selected' : '' }
                    >
                        ${task_idn}
                    </option>`
                ;
                tasks_select.append(option_content);
            });
        }

        // #endregion




        
        // #region Sketch Validation and Save 

        const $save_button = $('#save_sketch'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);

            let radio_not_checked = false;
            
            const flags = State.variables.flags;

            $.each(serialized_form.pages, function(page_idn, page) {  
                $.each(page, function(element_idn, element) {
                    if (element.conditions) element.conditions = Object.values(element.conditions);
                    if (element.actions) element.actions = Object.values(element.actions); 
                    if ((element.type == 'choice') && (!element.move_to)) radio_not_checked = true;
                    

                    // Autoregister flags if they do not exist yet.
                    if (element.conditions) {
                        $.each(element.conditions, function(index_condiion, condition) { 
                            if (condition.type == "check_flag") {
                                if (!flags[condition.flag]) flags[condition.flag] = 0;
                            }
                        });                       
                    }

                    if (element.actions) {
                        $.each(element.actions, function(index_action, action) { 
                            if (action.type == "change_flag") {
                                if (!flags[action.flag]) flags[action.flag] = 0;
                            }
                        });                       
                    }
                });            
            });    

            console.log('serialized_form', serialized_form);
            const sketch = serialized_form;
            

            if(!sketch.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');
            } else if (radio_not_checked){        
                alert('Radio "Location" was not checked in one of elements!');
                console.error('No selected "move_to" field in "choice" type of element!');      
            } else {                
                State.variables.sketches[sketch.id_name] = sketch;
                                
                addQuickLocalization(sketch);

                alert('Sketch has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }
        });

        // #endregion
    });
}


function getSketchElementTypeFields(type) {
    const 
    speech_options = [
        'element_type_condition',
        'element_type_character',
        'element_type_posture',
        'element_type_text',
    ],
    injection_options = [
        'element_type_condition',
        'element_type_injection'   
    ],
    text_options = [
        'element_type_condition',
        'element_type_text_model',
        'element_type_text'
    ],
    image_options = [
        'element_type_condition',
        'element_type_image'
    ],
    video_options = [
        'element_type_condition',
        'element_type_video'
    ],
    choice_options = [
        'element_type_condition',
        'element_type_text',
        'element_type_passage',
        'element_type_link_type',
        'element_type_actions'
    ]

    return {
        speech: speech_options,
        injection: injection_options,
        text: text_options,
        image: image_options,
        video: video_options,
        choice: choice_options
    }[type]
}

function getSketchConditionFields(type) {
    const 
    check_param_options = [
        'condition_character',
        'condition_param',
        'condition_comparatives',
        'condition_value'
    ],
    check_flag_options = [
        'condition_flag',
        'condition_comparatives',
        'condition_value'
    ],
    in_party_options = [
        'condition_character'
    ],
    on_location_options = [
        'condition_character',
        'condition_location'
    ],
    has_item_options = [
        'condition_character',
        'condition_item_idn'
    ],
    has_item_class_options = [
        'condition_character',
        'condition_item_type',
        'condition_item_class'
    ],
    timeline_options = [
        'condition_timeline_hours',
        'condition_timeline_day_of_week',
        'condition_timeline_month'
    ],
    time_countdown_options = [
        'condition_input'
    ],
    check_quest_status_options = [   
        'condition_quest',
        'condition_comparatives',
        'condition_value'
    ],
    check_task_status_options = [        
        'condition_quest',
        'condition_task',
        'condition_comparatives',
        'condition_value'
    ],
    check_task_counter_options = [        
        'condition_quest',
        'condition_task',
        'condition_comparatives',
        'condition_value'
    ],
    custom_options = [
        'condition_custom',
        'condition_comparatives',
        'condition_value'
    ]

    return {
        check_param: check_param_options,
        has_item_idn: has_item_options,
        has_item_class: has_item_class_options,
        check_flag: check_flag_options,
        in_party: in_party_options,
        on_location: on_location_options,
        timeline: timeline_options,
        time_countdown: time_countdown_options,
        check_quest_status: check_quest_status_options,
        check_task_status: check_task_status_options,
        check_task_counter: check_task_counter_options,
        custom: custom_options
    }[type]
}

function getSketchActionFields(type) {
    const 
    change_param_options = [
        'action_character',
        'action_param',
        'action_change_type', 
        'action_value'      
    ],
    add_time_options = [
        'action_add_time'
    ],
    set_time_options = [
        'action_set_time'
    ],
    change_flag_options = [
        'action_flag',
        'action_value'       
    ],
    change_schedule_options = [
        'action_schedule'
    ],
    change_schedule_daily_options = [
        'action_schedule'
    ],
    change_schedule_current_hour_option = [
        'action_character',   
        'action_assignment'
    ],
    add_inventory_idn_options = [
        'action_character',
        'action_item_idn'
    ],
    add_inventory_class_options = [
        'action_character',
        'action_item_type',
        'action_item_class'
    ],
    remove_inventory_idn_options = [
        'action_character',
        'action_item_idn'
    ],
    add_to_party_options = [
        'action_character'
    ],
    remove_from_party_options = [
        'action_character'
    ],
    start_quest_options = [
        'action_quest'
    ],
    fail_task_options = [
        'action_quest',
        'action_task'
    ],
    finish_task_options = [
        'action_quest',
        'action_task'
    ],
    time_countdown_options = [
        'action_input',
        'action_value'      
    ],
    injection_action_options = [
        'action_textarea'
    ]

    
    return {
        change_param: change_param_options,
        add_time: add_time_options,
        set_time: set_time_options,
        change_flag: change_flag_options,
        change_schedule: change_schedule_options,
        change_schedule_daily: change_schedule_daily_options,
        change_schedule_current_hour: change_schedule_current_hour_option,
        add_inventory_idn: add_inventory_idn_options,
        add_inventory_class: add_inventory_class_options,
        remove_inventory_idn: remove_inventory_idn_options,
        add_to_party: add_to_party_options,
        remove_from_party: remove_from_party_options,
        start_quest: start_quest_options,
        fail_task: fail_task_options,
        finish_task: finish_task_options,
        time_countdown: time_countdown_options,
        injection_action: injection_action_options
    }[type]

}


function getElementTypeOptionContent(option, spid, seid, sketch_element={}) {

    const content_element_type_condition = () => { 

        const content = `
            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Conditions</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">                                      
                        
                        <button type="button" class="form_add add_sketch-condition"> Add Condition </button>
                    </div>   
                </div>   
            </div>    
        `;

        return content;
    };
    
    const content_element_type_character = () => { 
        const characters = State.variables.characters;

        const content = `
            <div class="form-block">
                <label> Character </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][character]"
                >                             
                    <option value="player">player</option>
                    ${Object.keys(characters).map((value) => (                        
                        `<option 
                            ${(value == sketch_element.character) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;
    
        return content;
    };          

    const content_element_type_posture = () => { 
        const postures = State.variables.lists.postures;

        const content = `
            <div class="form-block">
                <label> Posture </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][posture]"
                >
                    ${postures.map((value, index) => (
                        `<option 
                            ${(value == sketch_element.posture) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;

        return content;
    };

    const content_element_type_text_model = () => {       
        const text_types = [
            'default',
            'thought',
            'gesture'
        ];

        const content = `
            <div class="form-block">
                <label> Text Type </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][text_type]"
                >                             
                    ${Object.values(text_types).map((value) => (                        
                        `<option 
                            ${(value == sketch_element.text_type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    };

    const content_element_type_text = () => {         
        const sketch_id_name = $('#id_name').val();         
        const sketch_entity_list = 'sk';
        const text = getLocalizedText(`${sketch_entity_list}_${sketch_id_name}_p_${spid}_el_${seid}_text`);

        const content = `
            <div class="form-block">
                <label> Text (EN)</label>                
                <textarea 
                    data-prop="text" 
                    data-page="${spid}" 
                    data-el="${seid}" 
                    class="localized-text"
                >${text}</textarea>
            </div>  
        `;

        return content;
    };
                                    
    const content_element_type_injection = () => { 
        const content = `
            <div class="form-block">
                <label> Content (SugarCube Code + HTML)</label>
                <textarea 
                    name="pages[page_${spid}][el_${seid}][injection]"
                >${(sketch_element.injection) ? sketch_element.injection : ''}</textarea>
            </div>   
        `;

        return content;
    };
    
    const content_element_type_image = () => { 
        const sketch_images = State.variables.lists.image_list;          
        const img_styles = State.variables.lists.img_styles;

        const content = `        
            <div class="form-block">
                <div class="form-blocks-row">   
                    <div class="form-block">
                        <label> Image Folder </label>
                        <select 
                            class="select2 sketch__media-files-folder" 
                            name="pages[page_${spid}][el_${seid}][media_folder]"
                            data-type="image" 
                        >
                            <option disabled selected value="-1">-- select --</option>
                            ${Object.keys(sketch_images).map((value, index) => (
                                `<option 
                                    ${(value == sketch_element.media_folder) ? 'selected' : ''}
                                    value="${value}"
                                >
                                    ${value}
                                </option>`
                            )).join('')}
                        </select>
                    </div>   

                    <div class="form-block">
                        <label> Image Name </label>
                        <select 
                            class="select2 sketch__media-files-name" 
                            name="pages[page_${spid}][el_${seid}][media_file]"
                        >
                            <option disabled selected value="-1">-- select --</option>
                        </select>
                    </div>   
                </div>

                <img class="sketch__media-files-demo" src="#" alt="" />

                
                <div class="form-blocks-row">  
                    <div class="form-block">
                        <label> Width[px] </label>                                        
                        <input 
                            type="number"
                            min="0"
                            class="form-block__input--small"
                            name="pages[page_${spid}][el_${seid}][width]"
                            value="${(sketch_element.width) ? sketch_element.width : ''}"
                        ></type=>
                    </div>   

                    <div class="form-block">
                        <label> Height[px] </label>                                        
                        <input 
                            type="number"
                            min="0"
                            class="form-block__input--small"
                            name="pages[page_${spid}][el_${seid}][height]"
                            value="${(sketch_element.height) ? sketch_element.height : ''}"
                        ></input>
                    </div> 

                    <div class="form-block">
                        <label> Image Style </label>
                        <select 
                            class="select2"
                            name="pages[page_${spid}][el_${seid}][img_style]"
                        >
                            ${img_styles.map((value) => (
                                `<option 
                                    ${(value == sketch_element.img_style) ? 'selected' : ''}
                                    value="${value}"
                                >
                                    ${value}
                                </option>`
                            )).join('')}
                        </select>
                    </div> 
                </div> 
            </div>
        `;

        return content;
    };
    
    const content_element_type_video = () => {   
        const sketch_videos = State.variables.lists.video_list;   

        const content = `    
            <div class="form-blocks-row">   
                <div class="form-block" >
                    <label> Video Type </label>
                    <select                                   
                        class="select2 sketch__media-files-folder"
                        name="pages[page_${spid}][el_${seid}][media_folder]"
                        data-type="video"
                    >      
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.keys(sketch_videos).map((value, index) => (
                            `<option 
                                ${(value == sketch_element.media_folder) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>   

                <div class="form-block">
                    <label> Video Name </label>
                    <select 
                        class="select2 sketch__media-files-name" 
                        name="pages[page_${spid}][el_${seid}][media_file]"
                    >
                        <option disabled selected value="-1">-- select --</option>
                    </select>
                </div>   

                <video class="sketch__media-files-demo" src="#" autoplay loop controls alt="" />

                <div class="form-blocks-row">  
                    <div class="form-block">
                        <label> Width[px] </label>                                        
                        <input 
                            type="number"
                            min="0"
                            class="form-block__input--small"
                            name="pages[page_${spid}][el_${seid}][width]"
                            value="${(sketch_element.width) ? sketch_element.width : ''}"
                        ></input>
                    </div>   

                    <div class="form-block">
                        <label> Height[px] </label>                                        
                        <input 
                            type="number"
                            min="0"
                            class="form-block__input--small"
                            name="pages[page_${spid}][el_${seid}][height]"
                            value="${(sketch_element.height) ? sketch_element.height : ''}"
                        ></input>
                    </div> 
                </div> 
            </div>
        `;

        return content;
    };

    const content_element_type_passage = () => { 
        const passages = getSketchPassageList();
        const sketches = Object.keys(State.variables.sketches);
        const pages = getSketchPagesList();

        const content = `    
            <div class="form-block" id="passage" >
                <label> Move To </label>

                <div class="form-blocks-row">
                    <div>
                        <input 
                            type="radio" 
                            name="pages[page_${spid}][el_${seid}][move_to]" 
                            value="passage"                         
                            ${('passage' == sketch_element.move_to) ? 'checked' : ''}
                        >
                        <label>Location</label>                                        
                    </div>

                    <select 
                        class="select2 select2--large"
                        name="pages[page_${spid}][el_${seid}][passage]"
                    >
                        ${passages.map((value) => (
                            `<option 
                                ${(value == sketch_element.passage) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>


                <div class="form-blocks-row" id="page_link">
                    <div>
                        <input 
                            type="radio" name="pages[page_${spid}][el_${seid}][move_to]" 
                            value="page" 
                            class="sketch-page__radio" 
                            ${('page' == sketch_element.move_to) ? 'checked' : ''}                            
                        >
                        <label>Page</label>
                    </div>
                
                    <select 
                        class="select2"
                        name="pages[page_${spid}][el_${seid}][page_link]"
                        data-selected="${sketch_element.page_link}"
                    >                                                                         
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.values(pages).map((value) => (
                            `<option 
                                ${(value == sketch_element.page_link) ? 'selected' : ''}
                                value="${value} 2"
                            >
                                ${value} 1
                            </option>`
                        )).join('')}
                    </select>
                </div>  

                <div class="form-blocks-row">
                    <div>
                        <input 
                            type="radio" 
                            name="pages[page_${spid}][el_${seid}][move_to]" 
                            value="sketch"                         
                            ${('sketch' == sketch_element.move_to) ? 'checked' : ''}
                        >
                        <label>Sketch IDN</label>                                        
                    </div>

                    <select 
                        class="select2 select2--large"
                        name="pages[page_${spid}][el_${seid}][sketch_idn]"
                    >
                        ${sketches.map((value) => (
                            `<option 
                                ${(value == sketch_element.sketch_idn) ? 'selected' : ''}
                                value="${value}"
                            >
                                ${value}
                            </option>`
                        )).join('')}
                    </select>
                </div>

                
                <div class="form-blocks-row">
                    <div>
                        <input 
                            type="radio" 
                            name="pages[page_${spid}][el_${seid}][move_to]" 
                            value="fake"                         
                            ${('fake' == sketch_element.move_to) ? 'checked' : ''}
                        >
                        <label>Fake</label>                                        
                    </div>

                    <input 
                        type="text" 
                        name="pages[page_${spid}][el_${seid}][fake]
                        value="${(sketch_element.fake) ? sketch_element.fake : ''}"
                    >  
                </div>

            </div>  
        `;

        return content;
    };

    const content_element_type_link_type = () => {          
        const link_types = State.variables.lists.link_types;

        const content = `    
            <div class="form-block" id="link_type" >
                <label> Link Style Type </label>
                <select 
                    class="select2"
                    name="pages[page_${spid}][el_${seid}][link_type]"
                >
                    ${link_types.map((value) => (
                        `<option 
                            ${(value == sketch_element.link_type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>  
        `;

        return content;
    };
    
    const content_element_type_actions = () => { 

        const content = `               
            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Actions</h1>
        
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small"> 
                        <button type="button" class="form_add add_sketch-action"> Add Action </button>
                    </div>   
                </div>   

            </div>
        `;
            
        return content;
    };

    return {
        element_type_condition: content_element_type_condition,
        element_type_character: content_element_type_character,
        element_type_posture: content_element_type_posture,
        element_type_text_model: content_element_type_text_model,
        element_type_text: content_element_type_text,
        element_type_injection: content_element_type_injection,
        element_type_image: content_element_type_image,
        element_type_video: content_element_type_video,
        element_type_passage: content_element_type_passage,
        element_type_link_type: content_element_type_link_type,
        element_type_actions: content_element_type_actions
    }[option];
}

function getConditionOptionContent(option, spid, seid, scid, sketch_condition={}) {

    const content_condition_character = () => { 
        const characters = State.variables.characters;

        const content =`
            <div class="form-block">
                <label> Character </label>
                <select 
                    class="select2 sketch-condition__character" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][character]"
                >          
                    <option value="player">player</option>                     
                    ${Object.keys(characters).map((value) => (                      
                        `<option 
                            ${(value == sketch_condition.character) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>   
            </div>   
        `;

        return content;
    };
  
    const content_condition_param  = () => {
        const params = State.variables.lists.params;
        
        const content = `
            <div class="form-block">
                <label> Parametr </label>
                <select 
                    class="select2 sketch-condition__param" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][param]"
                >                                
                    ${params.map((value) => (                     
                        `<option 
                            ${(value == sketch_condition.param) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>     
        `;

        return content;
    };

    const content_condition_flag = () => {        
        const flags = State.variables.flags;

        const content = `
            <div class="form-block">
                <label> Flag </label>
                <select 
                    class="select2 select2-tagging" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][flag]"
                >                                
                    ${Object.keys(flags).map((value) => (                     
                        `<option 
                            ${(value == sketch_condition.flag) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;

        return content;
    };
    
    const content_condition_comparatives = () => {         
        const comparatives = State.variables.lists.comparatives;

        const content = `
            <div class="form-block">
                <label> Comparatives </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][comparatives]"
                >                                                
                    ${Object.entries(comparatives).map(([key, value]) => (                   
                        `<option 
                            ${(key == sketch_condition.comparatives) ? 'selected' : ''}
                            value="${key}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;

        return content;
    };

    const content_condition_value = () => { 

        const content = `
            <div class="form-block">
                <label> Value </label>                                        
                <input 
                    type="number"
                    class="form-block__input--small"
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][value]"
                    value="${(sketch_condition.value) ? sketch_condition.value : ''}"
                ></input>
            </div>   
        `;

        return content;
    };
    
    const content_condition_input = () => { 
        const content = `
            <div class="form-block">
                <label> Input </label>                                        
                <input 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][input]"
                    value="${(sketch_condition.input) ? sketch_condition.input : ''}"
                ></input>
            </div>   
        `;        

        return content;
    };

    const content_condition_item_idn = () => { 
        const content = `
            <div class="form-block">
                <label> Item Idn </label>                                        
                <input 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][item_idn]"
                    value="${(sketch_condition.item_idn) ? sketch_condition.item_idn : ''}"
                ></input>
            </div>   
        `;        

        return content;
    };

    const content_condition_item_type = () => { 
        const item_types = State.variables.lists.items.types;
        const sketch_condition_item_type = getTypeByClass(sketch_condition.item_class);

        const content = `
            <div class="form-block">
                <label> Item Type </label>
                <select 
                    class="select2 sketch-condition__item-type" 
                >                            
                    ${item_types.map((value) => (                     
                        `<option 
                            ${(value == sketch_condition_item_type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;        

        return content;
    };
        
    const content_condition_item_class = () => {  
        const sketch_condition_item_type = getTypeByClass(sketch_condition.item_class);
        const list_content = getItemsListContent(sketch_condition_item_type, sketch_condition.item_class);

        const content = `
            <div class="form-block">
                <label> Item Class </label>
                <select 
                class="select2 sketch-condition__item-class" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][item_class]"
                >                            
                    ${list_content}
                </select>
            </div>   
        `;

        return content;
    };

    const content_condition_location = () => {  
        const passages = getSketchPassageList();

        const content = `
            <div class="form-block">
                <label> Locations </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][location]"
                >                                
                    ${passages.map((value) => (                     
                        `<option 
                            ${(value == sketch_condition.location) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    };


    const content_condition_timeline_hours = () => {  
        const hours = State.variables.lists.hours;     
        
        const content = `
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Hour </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][hour_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(hours).map(([key, value]) => (            
                            `<option 
                                ${(key == sketch_condition.hour_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Hour </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][hour_end]"
                    >                                                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(hours).reverse().map(([key, value]) => (         
                            `<option 
                                ${(key == sketch_condition.hour_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 
        `;

        return content;
    };
        
    const content_condition_timeline_day_of_week = () => {  
        const day_of_week_list = State.variables.lists.day_of_week_list;
        
        const content = `
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Day </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][day_of_week_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(day_of_week_list).map(([key, value]) => (            
                            `<option 
                                ${(key == sketch_condition.day_of_week_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Day </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][day_of_week_end]"
                    >                                                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(day_of_week_list).reverse().map(([key, value]) => (         
                            `<option 
                                ${(key == sketch_condition.day_of_week_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 
        `;

        return content;
    };

    const content_condition_timeline_month = () => {  
        const month_list = State.variables.lists.month_list;

        const content = `                
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Month </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][month_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(month_list).map(([key, value]) => (       
                            `<option 
                                ${(key == sketch_condition.month_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Month </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][conditions][${scid}][month_end]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(month_list).reverse().map(([key, value]) => ( 
                            `<option 
                                ${(key == sketch_condition.month_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 

        `;

        return content;
    }

    const content_condition_quest = () => {
        const quests = State.variables.quest_list;

        const content = `        
            <div class="form-block">
                <label> Quest </label>
                <select 
                    class="select2 sketch-list__quest" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][quest]"
                    data-type="condition"
                >                                          
                    <option disabled selected value="-1">-- select --</option>
                    ${Object.keys(quests).map((value) => (         
                        `<option 
                            ${(value == sketch_condition.quest) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    }

    const content_condition_task = () => {
        const content = `                
            <div class="form-block">
                <label> Task </label>
                <select 
                    class="select2 sketch-list__task" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][task]"
                >         
                    <option disabled selected value="-1">-- select --</option>
                </select>
            </div>
        `;

        return content;
    }

    

    
    const content_condition_custom = () => {  
        const global_variables = $.extend(true,{},State.variables);     // deep cloning for not to change State.variables
        $.each(global_variables, (prop, value ) => {  if (typeof value == 'function')  delete global_variables[prop] });

        const content = `
            <div class="form-block">
                <label> 1 Level </label>
                <select 
                    class="select2 sketch-condition__custom" 
                    name="pages[page_${spid}][el_${seid}][conditions][${scid}][custom_lvl_1]"
                >                    
                    <option disabled selected value="-1">-- select --</option>
                    ${Object.keys(global_variables).map((value) => (     
                        `<option 
                            ${(value == sketch_condition.custom_lvl_1) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;

        return content;        
    }

    return {
        condition_character: content_condition_character,
        condition_param: content_condition_param,
        condition_flag: content_condition_flag,
        condition_comparatives: content_condition_comparatives,
        condition_value: content_condition_value,
        condition_input: content_condition_input,
        condition_item_idn: content_condition_item_idn,
        condition_item_type: content_condition_item_type,
        condition_item_class: content_condition_item_class,
        condition_location: content_condition_location,
        condition_timeline_hours: content_condition_timeline_hours,
        condition_timeline_day_of_week: content_condition_timeline_day_of_week,
        condition_timeline_month: content_condition_timeline_month,
        condition_custom: content_condition_custom,
        condition_quest: content_condition_quest,
        condition_task: content_condition_task
    }[option];
}

function getActionOptionContent(option, spid, seid, said, sketch_action={}) {
    const content_action_character = () => { 
        const characters = State.variables.characters;

        const content =`
            <div class="form-block">
                <label> Character </label>
                <select 
                    class="select2 sketch-action__character" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][character]"
                >          
                    <option value="player">player</option>                     
                    ${Object.keys(characters).map((value) => (                   
                        `<option 
                            ${(value == sketch_action.character) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>   
            </div>   
        `;

        return content;
    };

    const content_action_param  = () => {
        const params = State.variables.lists.params;
        
        const content = `
            <div class="form-block">
                <label> Parametr </label>
                <select 
                    class="select2 sketch-action__param" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][param]"
                >                                
                    ${params.map((value) => (                 
                        `<option 
                            ${(value == sketch_action.param) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>     
        `;

        return content;
    };

    const content_action_change_type = () => {
        
        const content = `
            <div class="form-block">
                <label> Change type </label>
                <div> 
                    <input 
                        type="radio" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][change_type]" 
                        value="set" 
                        checked
                        ${(sketch_action.change_type == "set") ? 'checked' : ''}
                    /> 
                    <label>Set to</label>                                        
                </div>

                <div> 
                    <input 
                        type="radio" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][change_type]" 
                        value="add" 
                        ${(sketch_action.change_type == "add") ? 'checked' : ''}
                    /> 
                    <label>Add</label>                                        
                </div>

                <div> 
                    <input 
                        type="radio" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][change_type]" 
                        value="reduce" 
                        ${(sketch_action.change_type == "reduce") ? 'checked' : ''}
                    /> 
                    <label>Reduce</label>                                        
                </div>
            </div>     
        `;

        return content;
    };

    const content_action_flag = () => {        
        const flags = State.variables.flags;

        const content = `
            <div class="form-block">
                <label> Flag </label>
                <select 
                    class="select2 select2-tagging" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][flag]"
                >                                
                    ${Object.keys(flags).map((value) => (             
                        `<option 
                            ${(value == sketch_action.flag) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>   
        `;

        return content;
    };

    const content_action_value = () => { 

        const content = `
            <div class="form-block">
                <label> Value </label>                                        
                <input 
                    type="number"
                    class="form-block__input--small"
                    name="pages[page_${spid}][el_${seid}][actions][${said}][value]"
                    value="${(sketch_action.value) ? sketch_action.value : ''}"
                ></input>
            </div>   
        `;

        return content;
    };

    const content_action_input = () => { 
        const content = `
            <div class="form-block">
                <label> Input </label>                                        
                <input 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][input]"
                    value="${(sketch_action.input) ? sketch_action.input : ''}"
                ></input>
            </div>   
        `;        

        return content;
    };

    const content_action_textarea = () => { 
        const content = `
            <div class="form-block">
                <label> Content (SugarCube Code + HTML)</label>
                <textarea 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][injection_action]"
                >${(sketch_action.injection_action) ? sketch_action.injection_action : ''}</textarea>
            </div>   
        `;

        return content;
    };

    const content_action_item_idn = () => { 
        const content = `
            <div class="form-block">
                <label> Item Idn </label>                                        
                <input 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][item_idn]"
                    value="${(sketch_action.item_idn) ? sketch_action.item_idn : ''}"
                ></input>
            </div>   
        `;        

        return content;
    };

    const content_action_item_type = () => { 
        const item_types = State.variables.lists.items.types;
        const sketch_action_item_type = getTypeByClass(sketch_action.item_class);

        const content = `
            <div class="form-block">
                <label> Item Type </label>
                <select 
                    class="select2 sketch-action__item-type" 
                >                            
                    ${item_types.map((value) => (                     
                        `<option 
                            ${(value == sketch_action_item_type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;        

        return content;
    };
        
    const content_action_item_class = () => {    
        const sketch_action_item_type = getTypeByClass(sketch_action.item_class);
        const list_content = getItemsListContent(sketch_action_item_type, sketch_action.item_class);

        const content = `
            <div class="form-block">
                <label> Item Class </label>
                <select 
                class="select2 sketch-action__item-class" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][item_class]"
                >                            
                    ${list_content}
                </select>
            </div>   
        `;

        return content;
    };

    const content_action_schedule = () => { 
        // filter out base characters schedules
        const schedule_update_list = State.variables.record_lists.schedule_update_added;
        const filtered_schedule_list= Object.fromEntries( Object.entries(schedule_list).filter(([key, value]) => !key.startsWith('base_') && (!schedule_update_list.includes(key)) ));


        const content =`
            <div class="form-block">
                <label> Character </label>
                <select 
                    class="select2 sketch-action__character" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][schedule_idn]"
                >                           
                    ${Object.keys(filtered_schedule_list).map((value) => (                   
                        `<option 
                            ${(value == sketch_action.schedule_idn) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>   
            </div>   
        `;

        return content;
    };

    const content_action_quest = () => {  
        const quests = State.variables.quest_list;

        const content = `        
            <div class="form-block">
                <label> Quest </label>
                <select 
                    class="select2 sketch-list__quest" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][quest]"
                    data-type="action"
                >                                          
                    <option disabled selected value="-1">-- select --</option>
                    ${Object.keys(quests).map((value) => (         
                        `<option 
                            ${(value == sketch_action.quest) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    };

    const content_action_task = () => {  
        const content = `                
            <div class="form-block">
                <label> Task </label>
                <select 
                    class="select2 sketch-list__task" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][task]"
                >         
                    <option disabled selected value="-1">-- select --</option>
                </select>
            </div>
        `;

        return content;
    };

    const content_action_add_time = () => {  
        const content = `         
            <div class="form-blocks-row">       
                <div class="form-block">
                    <label> Minutes </label>
                    <input 
                        class="form-block__input--small"
                        name="pages[page_${spid}][el_${seid}][actions][${said}][minute]"
                        value="${(sketch_action.minute) ? sketch_action.minute : 0}"
                    ></input>
                </div>
                <div class="form-block">
                    <label> Hours </label>
                    <input 
                        class="form-block__input--small"
                        name="pages[page_${spid}][el_${seid}][actions][${said}][hour]"
                        value="${(sketch_action.hour) ? sketch_action.hour : 0}"
                    ></input>
                </div>
                <div class="form-block">
                    <label> Days </label>
                    <input 
                        class="form-block__input--small"
                        name="pages[page_${spid}][el_${seid}][actions][${said}][day]"
                        value="${(sketch_action.day) ? sketch_action.day : 0}"
                    ></input>
                </div>
            </div>
            `;

        return content;
    };

    const content_action_set_time = () => {  
        const content = `      
            <div class="form-blocks-row">    
                <div class="form-block">
                    <label> Minutes </label>
                    <input 
                        class="form-block__input--small"
                        name="pages[page_${spid}][el_${seid}][actions][${said}][minute]"
                        value="${(sketch_action.minute) ? sketch_action.minute : 0}"
                    ></input>
                </div>   
                <div class="form-block">
                    <label> Hours </label>
                    <input 
                        class="form-block__input--small"
                        name="pages[page_${spid}][el_${seid}][actions][${said}][hour]"
                        value="${(sketch_action.hour) ? sketch_action.hour : 0}"
                    ></input>
                </div>
            </div>        
        `;   
    
        return content;
    };


    const content_action_timeline_hours = () => {  
        const hours = State.variables.lists.hours;
        
        const content = `
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Hour </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][hour_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(hours).map(([key, value]) => (            
                            `<option 
                                ${(key == sketch_action.hour_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Hour </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][hour_end]"
                    >                                                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(hours).reverse().map(([key, value]) => (         
                            `<option 
                                ${(key == sketch_action.hour_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 
        `;

        return content;
    };
        
    const content_action_timeline_day_of_week = () => {  
        const day_of_week_list = State.variables.lists.day_of_week_list;
        
        const content = `
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Day </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][day_of_week_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(day_of_week_list).map(([key, value]) => (            
                            `<option 
                                ${(key == sketch_action.day_of_week_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Day </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][day_of_week_end]"
                    >                                                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(day_of_week_list).reverse().map(([key, value]) => (         
                            `<option 
                                ${(key == sketch_action.day_of_week_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 
        `;

        return content;
    };

    const content_action_timeline_month = () => {  
        const month_list = State.variables.lists.month_list;

        const content = `                
            <div class="form-blocks-row form-blocks-row--once">
                <div class="form-block">
                    <label> From Month </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][month_start]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(month_list).map(([key, value]) => (       
                            `<option 
                                ${(key == sketch_action.month_start) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
                <div class="form-block">
                    <label> Till Month </label>
                    <select 
                        class="select2" 
                        name="pages[page_${spid}][el_${seid}][actions][${said}][month_end]"
                    >                                
                        <option disabled selected value="-1">-- select --</option>
                        ${Object.entries(month_list).reverse().map(([key, value]) => ( 
                            `<option 
                                ${(key == sketch_action.month_end) ? 'selected' : ''}
                                value="${key}"
                            >
                                ${value} [${key}]
                            </option>`
                        )).join('')}
                    </select>
                </div> 
            </div> 

        `;

        return content;
    }

    const content_action_location = () => {  
        const passages = State.variables.lists.location_list_expanded;

        const content = `
            <div class="form-block">
                <label> Locations </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][location]"
                >                                
                    ${passages.map((value) => (                     
                        `<option 
                            ${(value == sketch_action.location) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    };

    const content_action_assignment = () => {
        const assignments = State.variables.lists.assignments;

        const content = `
            <div class="form-block">
                <label> Locations </label>
                <select 
                    class="select2" 
                    name="pages[page_${spid}][el_${seid}][actions][${said}][assignment]"
                >                                
                    ${Object.entries(assignments).map(([key, value]) => ( 
                        `<option 
                            ${(key == sketch_action.assignment) ? 'selected' : ''}
                            value="${key}"
                        >
                            ${key}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;

        return content;
    }

    return {
        action_character: content_action_character,
        action_param: content_action_param,
        action_change_type: content_action_change_type,
        action_flag: content_action_flag,
        action_value: content_action_value,
        action_input: content_action_input,
        action_textarea: content_action_textarea,
        action_item_idn: content_action_item_idn,
        action_item_type: content_action_item_type,
        action_item_class: content_action_item_class,
        action_schedule: content_action_schedule,
        action_quest: content_action_quest,
        action_task: content_action_task,
        action_add_time: content_action_add_time,
        action_set_time: content_action_set_time,        
        action_timeline_hours: content_action_timeline_hours,
        action_timeline_day_of_week: content_action_timeline_day_of_week,
        action_timeline_month: content_action_timeline_month,
        action_location: content_action_location,
        action_assignment: content_action_assignment
    }[option];
}




function getItemsListContent(items_type=State.variables.lists.items.types[0], items_class) {
    const item_class_list = State.variables.lists.items[items_type];

    const list_content = `                            
        ${Object.entries(item_class_list).map(([index, sub_category]) => (   
            `<option 
                ${(sub_category == items_class) ? 'selected' : ''}
                value="${sub_category}"
            >
                ${sub_category}
            </option>`    
        )).join('')}    
    `;

    const list_content_optgroup = `                            
        ${Object.entries(item_class_list).map(([category, category_list]) => (       
            `<optgroup label="${category}">                        
                ${Object.entries(category_list).map(([index, sub_category]) => (   
                    `<option 
                        ${(sub_category == items_class) ? 'selected' : ''}
                        value="${sub_category}"
                    >
                        ${sub_category} [${category}] 
                    </option>`    
                )).join('')}                        
            </optgroup>`
        )).join('')}  
    `;

    const hasSubCategory = (item_class_list.constructor === Object);
    const result = (hasSubCategory) ? list_content_optgroup : list_content;

    return result;
}


function getSketchPagesList() {
    const page_list = {};
    
    const page_link_blocks_node_list = document.querySelectorAll('.sketch-page');
    const page_link_blocks_array = Array.from(page_link_blocks_node_list);

    $.each(page_link_blocks_array, function () { 
        const cur_spid = $(this).data('page');
        page_list[cur_spid] = `page_${cur_spid}`;
    });

    return page_list;
}

// Used to prevent from creating sketches with links to unexisting pages
function updateSketchPagesList() {
    const page_list = getSketchPagesList();

    checkValidatePageRadio(page_list);

    const page_link_blocks_node_list = document.querySelectorAll('.sketch-page');
    const page_link_blocks_array = Array.from(page_link_blocks_node_list);

    $.each(page_link_blocks_array, function (index, page) { 
        const cur_select = $(page).find('#page_link select') ?? {};
        const cur_page_id = $(page).data('page');
        const cur_select_selected_page = cur_select.data('selected');

        cur_select.empty();

        $.each(page_list, function(page_id, page_idn) {
            if (cur_page_id != page_id)  {
                const content = `  
                    <option 
                        ${(cur_select_selected_page == page_idn) ? 'selected' : ''}
                        value="${page_idn}"
                    >
                        ${page_idn}
                    </option>  
                `;
                cur_select.append(content);
            }
        });

    });

}

// Validation to exclude possible choice of radio input of field 'move_to' when select of pages if empty.
function checkValidatePageRadio(page_list) {    
    const validate_page_radio = (Object.keys(page_list).length <= 1);
    $('.sketch-page__radio').prop('disabled', validate_page_radio);
}



function getTypeByClass(item_class) {
    runClassesFunction('setTypeByClass', {item_class});

    const resulted_type = State.temporary.resulted_type;
    return resulted_type;
}



function activateSelect2Tagging() {
    $('.select2-tagging').select2({
        // multiple: true,
        tags:true
    });
}

function getSketchPassageList() {
    const pre_sketch_passage = 'pre_sketch_passage'; //can return to Talk screen
    const pre_talk_passage = 'pre_talk_passage'; //return only to passage, before Talk screen 
    const passages = structuredClone(State.variables.lists.location_list_expanded);
    passages.unshift(pre_sketch_passage, pre_talk_passage);

    return passages;
}
/* twine-user-script #57: "task_constructor.js" */

// Recheck about deactivation flag

function taskConstructor() {
    $(document).ready(function() {
        const $constructor_block = $('#constructor');
        const entity_list = State.variables.temp.constructor_entity;        
        const task_edit_idn = State.variables.temp.constructor_item_edit;
        const task_list_unassigned = State.variables.tasks;
        const task_list_quests = getAllQuestsTaskList();
        const task_list = {...task_list_unassigned, ...task_list_quests}; 
        const task_edit = (task_edit_idn) ? task_list[task_edit_idn] : {id_name: ''};

        console.log('task_edit', task_edit);

        const name = getLocalizedEntityText(task_edit.id_name, 'task', 'name');    
        const desc = getLocalizedEntityText(task_edit.id_name, 'task', 'description');   
        const link_title = getLocalizedEntityText(task_edit.id_name, 'task', 'link_title');   

        const task_types = State.variables.lists.task_types;
        const characters = State.variables.characters; 
        const location_list = State.variables.lists.location_list_expanded;

        const task_type_select_class = '.task-type__select';
        const select_class_task_item_type = '.task__item-type';
        const select_class_task_item_class = '.task__item-class';    

        
        const add_button_action = '.add_task-action';
        
        

        const constructor_form = `            
            <div class="form-block">
                <label>ID Name*</label>
                <input name="id_name" value="${task_edit.id_name}"/>
            </div>

            <div class="form-block">
                <label> Name (EN)</label>                
                <input
                    class="localized-text"
                    data-prop="name"
                    value="${(name) ? name:''}" 
                />
            </div> 

            <div class="form-block">
                <label for="is_optional">
                    <input type="checkbox" name="is_optional" ${(task_edit.is_optional == 1) ? 'checked' : '' } value="1" />
                    Is optional 
                </label>
            </div>
            
            <div class="form-block-section task-type">
                <h1 class="form-block-section__header">Type Options</h1>

                <div class="form-block-section-wrapper">                
                    <div class="form-block">
                        <label>Type* </label>
                        <select name="type" class="task-type__select">                
                            <option selected value="-1">-- select --</option>
                            ${task_types.map((value) => (
                                `<option 
                                    ${(value == task_edit.type) ? 'selected' : ''}
                                    value="${value}"
                                >
                                    ${value}
                                </option>`
                            )).join('')}
                        </select>
                    </div>

                    <div class="form-blocks-row task-type__container"></div>     
                </div>        
            </div>


            <div class="form-block">
                <label> Location* </label>
                <select 
                    id="location"
                    name="location" 
                    class="select2" 
                >
                    <option selected value="-1">-- select --</option>
                    ${location_list.map((value) => (
                        `<option 
                            ${(value == task_edit.location) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>
            
            <div class="form-block">
                <label> Link Title (EN)</label>                
                <input
                    class="localized-text form-block__input--large"
                    data-prop="link_title"
                    placeholder="Leave empty to show default text based on task type"
                    value="${(link_title) ? link_title:''}" 
                />
            </div> 

            <div class="form-block">
                <label> Description (EN)</label>                
                <textarea 
                    data-prop="description" 
                    class="localized-text"
                >${desc}</textarea>
            </div>  

            <button type="button" class="form-save" id="save_task">Save task</button>    

            
            <br><br><br><br><p style="font-size: 50px; color: red;">Following functional will be added in future!</p>
            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Conditions</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">                                      
                        
                        <button type="button" class="form_add add_task-condition"> Add Condition </button>
                    </div>   
                </div>   
            </div>    

            <div class="form-block">
                <div class="form-block-section">
                    <h1 class="form-block-section__header">Actions</h1>
                    <div class="form-block form-block-section-wrapper form-block-section-wrapper--small">                                      
                        
                        <button type="button" class="form_add add_task-action"> Add Actions </button>
                    </div>   
                </div>   
            </div>        
                  
        `;

        $constructor_block.append(constructor_form);

        addEditTaskTypeContent();
        
        $constructor_block.find(".select2").select2();

        
        $(task_type_select_class).on('change', function() {
            const select = this;
            const cur_type = select.value;
            const type_container = $constructor_block.find('.task-type__container');

            addTaskTypeContent(cur_type, type_container );
        });

        function addEditTaskTypeContent() {
            const type_container = $constructor_block.find('.task-type__container');
            addTaskTypeContent(task_edit.type, type_container, task_edit );
        }

        
        function addTaskTypeContent(cur_type, type_container, task_edit ) {
            type_container.empty();
            
            // Add corresponding blocks for each task type.
            const cur_type_options = getTaskTypeFields(cur_type);
            $.each(cur_type_options, function(index, option ) {
                const content_option = getTaskTypeOptionContent(option, task_edit);
                type_container.append(content_option);
            });            

            type_container.find(".select2").select2();
        }

        $constructor_block.on('change', select_class_task_item_type, function() {
            const select = this;
            const cur_type = this.value;
            const item_class_select = $(select).parents('.task-type').find(select_class_task_item_class);    

            item_class_select.empty();
    
            const list_content = getItemsListContent(cur_type);
            item_class_select.append(list_content);
        });



        $('#location').on('change', function() {
            
            const location_character_block = `
                <div class="form-block">
                    <label for="location"> Location Character* </label>
                    <select name="location_character" id="location_character">
                        <option selected value="-1">-- select --</option>
                        ${Object.keys(characters).map((value) => (   
                            `<option value="${value}">${value}</option>`
                        )).join('')}
                    </select>
                </div>
            `;

            if (this.value == 'Talk_Menu') $(this).closest('.form-block').append(location_character_block);
        });





        $constructor_block.on('click', add_button_action, function() {
            // const cur_button_action = this;
            // const last_element_action = $(cur_button_action).prev('.sketch-action')[0];  
            // const last_element_action_id = (typeof last_element_action !== "undefined") ? $(last_element_action).data('action') : 0;  // get last existing action id
            // const new_last_element_action_id = last_element_action_id + 1; // create new action id
            // const said = new_last_element_action_id; 
            
            // addSketchActionContent(said, cur_button_action);
            
            // $(this).closest('.sketch-element-type__container').find(".select2").select2();
        });
        



        
        // #region Task Validation and Save 

        const $save_button = $('#save_task'); 
        $save_button.on('click', function() {
            const form = $constructor_block[0];
            const serialized_form = getSerializedForm(form);
            console.log('serialized', serialized_form);

            const new_task = serialized_form;

            // const unassigned_tasks = State.variables.tasks;
            // const task_quest = getTaskByIdn(new_task.id_name);
            // const is_exist = (Object.values(unassigned_tasks).some(task => (task.id_name == new_task.id_name)) || (task_quest));
            const no_space = (new_task.id_name.trim().indexOf(' ') >= 0);


            
            // Probably rework so field that are required would automatically show generic message
            if(!new_task.id_name) {
                alert('Field "id_name!" was not filled!');
                console.error('No id_name!');
            } else if (no_space) {
                alert('Task id_name should be without spaces!');
                console.error('Task id_name should be without spaces');
            // } else if (is_exist) {
            //     alert('Task with the same id_name is already exist!');
            //     console.error('Task with the same id_name is already exist!');
            } else if (new_task.type == -1) {
                alert('Task has to have selected type!');
                console.error('Task has to have selected type!');
            } else if (new_task.location == -1) {
                alert('Task has to have selected location!');
                console.error('Task has to have selected location!');        
            } else if (typeof new_task.subject === 'undefined' && new_task.type != 'search') {
                alert('Task has to have selected subject!');
                console.error('Task has to have selected subject!');     
            } else if (new_task.amount === '' ) {
                alert('This type of task has to have amount!');
                console.error('This type of task has to have amount!');
            } else if (new_task.amount < 1 ) {
                alert('Amount can not be lower then 1!');
                console.error('Amount can not be lower then 1!');
            } else {                
                State.variables.tasks[serialized_form.id_name] = new_task;
                
                addQuickLocalization(new_task);
                
                alert('Task has been created successfully!');
                Engine.play('Uni_Constructor_Table');
            }

        });

        // #endregion

    });


}

        
function getTaskTypeFields(type) {
    const 
    // interact_options = [
    //     'subject_character'   
    // ],
    sketch_options = [
        'subject_sketch'
    ],
    gather_options = [
        'subject_items_type',
        'subject_items_class',
        'amount_param'
    ],
    distribute_options = [
        'subject_items_type',
        'subject_items_class',
        'amount_param' 
    ],
    fight_options = [
        'subject_parties'
    ],
    eliminate_options = [
        'subject_enemy_kind',
        'amount_param'
    ],
    search_options = [
        'amount_param'
    ],
    escort_options = [
        'subject_character'
    ]

    return {
        // interact: interact_options,
        sketch: sketch_options,
        gather: gather_options,
        distribute: distribute_options,
        fight: fight_options,
        eliminate: eliminate_options,
        search: search_options,
        escort: escort_options
    }[type]
}


function getTaskTypeOptionContent(option, task_edit={}) {

    const content_subject_character = () => { 
        const characters = State.variables.characters;

        const content = `
            <div class="form-block">
                <label> Character </label>
                <select 
                    class="select2" 
                    name="subject"
                >                             
                    ${Object.keys(characters).map((value) => (                      
                        `<option 
                            ${(value == task_edit.subject) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>  
        `;

        return content;
    };

    
    const content_subject_sketch = () => { 
        const sketches = State.variables.sketches;

        const content = `
            <div class="form-block">
                <label> Sketch </label>
                <select 
                    class="select2 select2--large" 
                    name="subject"
                >                             
                    <option selected disabled>-- select --</option>
                    ${Object.keys(sketches).map((value) => (                      
                        `<option 
                            ${(value == task_edit.subject) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>  
        `;

        return content;
    };

    const content_subject_items_type = () => { 
        const item_types = State.variables.lists.items.types;
        const sketch_action_item_type = getTypeByClass(task_edit.subject);

        const content = `
            <div class="form-block">
                <label> Item Type </label>
                <select 
                    class="select2 task__item-type" 
                >                            
                    ${item_types.map((value) => (                     
                        `<option 
                            ${(value == sketch_action_item_type) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div> 
        `;        

        return content;
    };

    const content_subject_items_class = () => { 
        const item_type = getTypeByClass(task_edit.subject);
        const list_content = getItemsListContent(item_type, task_edit.subject);

        const content = `              
            <div class="form-block">
                <label> Item </label>
                <select 
                    class="select2 task__item-class" 
                    name="subject"
                >                             
                    ${list_content}
                </select>
            </div>  
        `;

        return content;
    };

    const content_subject_parties = () => { 
        const parties = State.variables.parties;

        const content = `        
            <div class="form-block">
                <label> Party </label>
                <select 
                    class="select2" 
                    name="subject"
                >                             
                    ${Object.keys(parties).map((value) => (                      
                        `<option 
                            ${(value == task_edit.subject) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>  
        `;

        return content;
    };

    const content_enemy_kind = () => { 
        const enemy_kind = State.variables.lists.enemy_kinds;

        const content = `        
            <div class="form-block">
                <label> Enemy Kind </label>
                <select 
                    class="select2" 
                    name="subject"
                >                             
                    ${enemy_kind.map((value) => (                      
                        `<option 
                            ${(value == task_edit.subject) ? 'selected' : ''}
                            value="${value}"
                        >
                            ${value}
                        </option>`
                    )).join('')}
                </select>
            </div>  
        `;

        return content;
    };

    const content_amount_param = () => { 
        const content = `        
            <div class="form-block">
                <label> Amount </label>
                <input type="number" name="amount" value="${(task_edit.amount) ? task_edit.amount : '1' }" min="1" step="1"/>
            </div>  
        `;

        return content;
    };

    return {
        subject_character: content_subject_character,
        subject_sketch: content_subject_sketch,
        subject_items_class: content_subject_items_class,
        subject_items_type: content_subject_items_type,
        subject_parties: content_subject_parties,
        subject_enemy_kind: content_enemy_kind,
        amount_param: content_amount_param,
    }[option];
}



/* twine-user-script #58: "uni_constructor_table.js" */
function displayConstructorTable() {
    const table_container = $('#constructor-table__container'); 
    const cur_entity = State.variables.temp.constructor_entity;
    const entity_list_name = getEntityListName(cur_entity);
    const table_items = State.variables[entity_list_name] ?? {};

    const table_content = `
        <div class="constructor-table__header">
            <button 
                class="constructor-table__add-btn constructor-table__editor-link"   
                data-item='0'
            >
                Add New 
            </button>
            
            ${drawPortContent()}
        </div>

        ${searchWidgetContent()}

        <table 
            class="constructor-table"         
            data-location="Uni_Constructor" 
            data-entity="${cur_entity}"
        >
            <thead>
                <tr>
                    ${getConstructorColumnsHeaders(cur_entity)}
                    <th>Edit</th>
                    <th>Remove</th>
                    <th class="constructor-table__port-cell">Port</th>
                </tr>
            </thead>
            <tbody class="constructor-table__body">
            </tbody>
        </table>

    `;

    table_container.append(table_content);
    
    $.each( reverseObject(table_items), function (table_item_idn, table_item) {  
        addConstructorTableRow(table_item, cur_entity);
    });

    activatePortListeners(cur_entity);
}




function addConstructorTableRow(item, cur_entity) {
    const tbody = $('.constructor-table__body');

    let table_row = `
        <tr class="constructor-table__row" data-idn="${item.id_name}">
            ${getConstructorItemColumns(item, cur_entity)}
            <td>
                <a 
                    class="link-internal constructor-table__editor-link" 
                    data-item='${item.id_name}'
                >
                    Edit
                </a>
            </td>
            <td>
                <button class="constructor-table__remove">Remove</button>
            </td>
            <td>
                ${portItemContent()}
            </td>
        </tr>
    `;

    tbody.append(table_row);
    
}


function getConstructorColumnsHeaders(cur_entity) {
    
    const sketch_columns_headers = `
        <th>IDN</th>
        <th>Pages</th>
    `;

    const quest_columns_headers = `
        <th>IDN</th>
        <th>Name</th>
        <th>Type</th>
        <th>Activation</th>
    `;

    const task_columns_headers = `
        <th>IDN</th>
        <th>Name</th>
        <th>Type</th>
        <th>Location</th>
    `;

    const item_columns_headers = `
        <th>IDN</th>
        <th>Type</th>
        <th>Category</th>
        <th>Sub Category</th>
    `;

    const character_columns_headers = `
        <th>IDN</th>
        <th>Name</th>
    `;

    const parties_columns_headers = `
        <th>IDN</th>
        <th>Name</th>
        <th>Location</th>
    `;

    const custom_locations_columns_headers = `
        <th>IDN</th>
        <th>Name</th>
        <th>Sketches</th>    
    `;

    const schedules_columns_headers = ` 
        <th>IDN</th>
        <th>Character</th>
    `;

    return {
        quests: quest_columns_headers,
        sketches: sketch_columns_headers,
        tasks: task_columns_headers,
        items: item_columns_headers,
        characters: character_columns_headers,
        parties: parties_columns_headers,
        custom_locations: custom_locations_columns_headers,
        schedules: schedules_columns_headers
    }[cur_entity]
}



function getConstructorItemColumns(item, cur_entity) {
    
    const sketch_columns = () => { 
        const pages_length = Object.keys(item.pages).length;
        const content  = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${pages_length}</td>
        `;

        return content;
    }

    const quest_columns = () => { 
        const cur_lang_name = getLocalizedText(`quests_${item.id_name}_name`);
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${cur_lang_name}</td>
            <td>${item.type}</td>
            <td>${(item.activation_flag.location)?item.activation_flag.location : 'N/a'}</td>  
        `;

        return content;
    }

    const task_columns = () => { 
        const cur_lang_name = getLocalizedEntityText(item.id_name, 'task', 'name');
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${cur_lang_name}</td>
            <td>${item.type}</td>
            <td>${item.location}</td>
        `;
        return content;
    }
    
    const item_columns = () => { 
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${item.type}</td>
            <td>${item.category}</td>
            <td>${(item.sub_category) ? item.sub_category: ''}</td>
        `;
        return content;
    }

    const character_columns = () => { 
        const cur_lang_name = getLocalizedText(`characters_${item.id_name}_name`);
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${cur_lang_name}</td>
        `;
        return content;
    }

    const party_columns = () => { 
        const cur_lang_name = getLocalizedText(`parties_${item.id_name}_name`);
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${cur_lang_name}</td>
            <td>${item.location}</td>
        `;
        return content;
    }

    const custom_locations_columns = () => { 
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${item.name}</td>
            <td>${item.sketch}</td>
        `;
        return content;
    }

    const schedules_columns = () => { 
        const cur_lang_name = getLocalizedText(`characters_${item.character_idn}_name`);
        const content = `    
            <td><p class="constructor-table__cell-idn">${item.id_name}</p></td>
            <td>${cur_lang_name}</td>
        `;
        return content;
    }


    switch (cur_entity) {
        case 'quests': return quest_columns();
        case 'items': return item_columns();
        case 'sketches': return sketch_columns();
        case 'tasks': return task_columns();
        case 'characters': return character_columns();
        case 'parties': return party_columns();
        case 'custom_locations': return custom_locations_columns();
        case 'schedules': return schedules_columns();
        default: 
            console.error(`Wrong entity: "${cur_entity}" !!!`);
    }
}
/* twine-user-script #59: "control.js" */
	// Test of hiding  State.variables

	// State.variables.money = {value: 3}
	// State.variables.money = new Proxy(State.variables.money, {
	// 	get: function(target, prop) {
	// 		return target[prop];
	// 	},
	// 	set: function(target, prop, value) {
	// 		console.warn("Cannot set State.variables.money directly. Use a function to update it.");
	// 		return true; // Returning true indicates success
	// 	}
	// });

	// Object.defineProperty(State.variables, 'money', {
	// 	get: function() {
	// 		// Return the value of money from wherever it is stored
	// 		return 0;
	// 	},
	// 	set: function(value) {
	// 		console.warn("Cannot set State.variables.money directly. Use a function to update it.");
	// 	},
	// 	configurable: false, // This prevents the property from being deleted
	// 	enumerable: true // This makes the property visible during enumeration
	// });

// Variable access control
	// working one

	// (function() {
	// 	// Private variable to store the player's money
	// 	var hiddenMoney = 100;
	
	// 	// Function to get the player's money
	// 	function getMoney() {
	// 		return hiddenMoney;
	// 	}
	
	// 	// Function to add money
	// 	function addMoney(amount) {
	// 		if (typeof amount === 'number' && amount >= 0) {
	// 			hiddenMoney += amount;
	// 		} else {
	// 			console.log("Invalid amount for adding money");
	// 		}
	// 	}
	
	// 	// Function to subtract money
	// 	function subtractMoney(amount) {
	// 		if (typeof amount === 'number' && amount >= 0 && hiddenMoney >= amount) {
	// 			hiddenMoney -= amount;
	// 		} else {
	// 			console.log("Invalid amount for subtracting money");
	// 		}
	// 	}
	
	// 	// Expose a read-only property to get the player's money
	// 	Object.defineProperty(State.variables, 'playerMoney', {
	// 		get: getMoney,
	// 		set: function() {
	// 			console.log("Direct modification of playerMoney is not allowed");
	// 		},
	// 		configurable: false,
	// 		enumerable: true
	// 	});

		
	// 	console.log('defineProperty', State.variables.playerMoney)
	
	// 	// Expose functions to add and subtract money
	// 	State.variables.addMoney = addMoney;
	// 	State.variables.subtractMoney = subtractMoney;
	// })();
/* twine-user-script #60: "countdownObserver.js" */


const countdown_observer = new EventObserver();
countdown_observer.subscribe(countdownObsesrvingFunction);

setup.updateBroadcastCountdown = function() {
    setup.countdown_broadcast = function() {
        try {     
            countdown_observer.broadcast();           // runs  countdownObsesrvingFunction(cd) function
        } catch (err) {
            alert(`Error has occurred during updateBroadcastCountdown!`); 
            console.error(err);
        }
    };
}


function countdownProcessFunction() {
    const countdowns = State.variables.temp.countdowns;
    $.each(countdowns, function(countdown_key, countdown_value){
        if (countdown_value > 0) countdowns[countdown_key] -= 1;
    });

    if (setup.countdown_broadcast) setup.countdown_broadcast(); 
}

function countdownObsesrvingFunction() {
    $.each(State.variables.temp.countdowns, function(countdown_key, countdown_value){
        if (countdown_value == 0) finishCountdown(countdown_key);
    });
}

function finishCountdown(countdown_key) {
    // Comment out the line below if countdowns that are over should not be removed, and should be saved with '0' values
    delete State.variables.temp.countdowns[countdown_key]; 
    
    // Possibly show notification that certain thing is ready (by finding through 'countdown_key')
    // But only for quests/tasks, for activities for example it a bat practice
}



function createCountdown(idn, hours) {
    State.variables.temp.countdowns[idn] = hours;
}

function passCountdown(idn) {
    const cur_countdown = State.variables.temp.countdowns[idn];
    const is_countdown_over = (typeof cur_countdown === "undefined");

    // Uncomment below if countdowns that are over should not be removed, and should be saved with '0' values
    // const is_countdown_over = (typeof cur_countdown !== "undefined") ? (cur_countdown == 0) : false; 

    return is_countdown_over;
}
/* twine-user-script #61: "fight.js" */

$(document).on(":passagestart", function (event) {
	if (tags().includes("Fight")) {
        const party_enemy = State.variables.party_enemy.party;
        const party_hero = State.variables.party_hero.party;

        $(document).ready(function(){
            setup.getParty(party_enemy, 'enemy');
            setup.getParty(party_hero, 'hero');
            startOrder();
        });

        reUpdateBroadcastTask(State.variables.temp.cur_tasks_fight);

        if (State.variables.battleMode == 2) {
            if (isFightTask()) finalizeFightBroacast();
            updateCharactersParameters();
            deleteEnemyParty();
            showCharactersThatDead();
        }

	}
});


function updateCharactersParameters() {
    const party_hero = State.variables.party_hero;
    $.each(party_hero.party, function(index, member) {
        delete member.out;
        State.variables.characters[member.id_name] = member;
    })
}

function deleteEnemyParty() {
    const party_enemy = State.variables.party_enemy;
    const cur_party = State.variables.parties[party_enemy.id_name];
    // Careful! Removing party completely!
    if (cur_party.can_disband) delete State.variables.parties[party_enemy.id_name];
}

function showCharactersThatDead() {    
    const party_hero = State.variables.party_hero;
    $.each(party_hero.party, function(index, member) {
        const character = State.variables.characters[member.id_name];

        // Because dead flag uploads not in time
        setTimeout(() => {
            if (character.dead) showModal('dead_member', {character: character});
        }, 0);  
    });
}


function finalizeFightBroacast() {
    const cur_task = getFightTask();
    try {     
        setup.tasks_broadcast[cur_task.id_name](cur_task); 
    } catch (err) {
        alert(`Error has occurred during battleMode=2!`); 
        console.error(err);
    }
}

// --- Actions on Click on Enemy Block ---
setup.activeTarget = function (_this) {
    refreshPlayerActions(_this);    
    highlightCurentTarget(_this);
};

$(document).on('click', `.fight__participant--enemy`, function(){
    if ( (!$(this).hasClass('.fight__participant--out')) && ($(this).hasClass('fight__participant--available')) ) {
        setup.activeTarget(this);
    }
});


// --- Higlight Current Target ---
function highlightCurentTarget(current_target_block) {        
    const higlight_class = 'fight__participant--target';
    const enemy_block = 'fight__participant--enemy';
    $(`.${enemy_block}`).removeClass(higlight_class);
    $(current_target_block).addClass(higlight_class);
}


// --- Refresh Player's Block of Actions ---
function refreshPlayerActions(current_target_block) { 
    const actions_parent_block = 'heroTurn';
    const current_target_id = $(current_target_block).attr('data-participant-id-name');

    //  STYLE ACTIONS BLOCK LATER !!!

    const actionList = State.variables.actions;

    let heroTurnMoves = ``;

    $.each(actionList, function () {
        heroTurnMoves += `
            <button class="hero-turn" data-action="${this.action}">${this.title}</button>
        `
    });

    $(`#${actions_parent_block}`)
        .empty()
        .attr('data-action-id-name', current_target_id)
        .append(heroTurnMoves);
}




// --- Rewrite Temporary Global Variables of Sugarcube ---
function updateTemp(party_enemy_temp, party_hero_temp) {
    State.variables.party_enemy_temp = party_enemy_temp;
    State.variables.party_hero_temp = party_hero_temp;
}



function checkFightTaskBroadcast(party_participant) {
    
    $.each(State.variables.temp.cur_tasks_fight, function(index, task_idn) {
        const cur_task = getTaskByIdn(task_idn);
    
        if (cur_task.type == 'eliminate') {  
            if (party_participant.kind) {
                if (party_participant.kind == cur_task.subject) {
                    cur_task.increaseCount(1);
                } 
            } else if (party_participant.id_name == cur_task.subject) {
                cur_task.increaseCount(1);  
            }

            try {     
                setup.tasks_broadcast[cur_task.id_name](cur_task); 
            } catch (err) {
                alert(`Error has occurred during checkFightTaskBroadcast!`); 
                console.error(err);
            }

        } else if (cur_task.type == 'fight') {  
            cur_task.increaseCount(1);
        }
    
    });
}
 

function isFightTask() {
    let result = false; 
    $.each(State.variables.temp.cur_tasks_fight, function(index, task_idn) {
        const cur_task = getTaskByIdn(task_idn);
        if (cur_task.type == 'fight') result = true;
    });
    return result;
}

function getFightTask() {
    let result = false; 
    $.each(State.variables.temp.cur_tasks_fight, function(index, task_idn) {
        const cur_task = getTaskByIdn(task_idn);
        if (cur_task.type == 'fight') result = cur_task;
    });
    return result;
}


// --- Check if Participant Health Dropped to Zero  ---
function checkZeroHealth(party_participant, party_id_name) {
    let party_enemy_temp = State.variables.party_enemy_temp;
    let party_hero_temp = State.variables.party_hero_temp;
    const player = State.variables.player;

    if ((!party_participant.out) && (party_participant.health <= 0)) {            // reset parties while fighting
        if (party_id_name == 'enemy') {
            party_enemy_temp = party_enemy_temp.filter(participant => participant.id_name !== party_participant.id_name);
            checkFightTaskBroadcast(party_participant);
            // Or move out from here and kill all npc after end of battle

        } else if (party_id_name == 'hero') {
            party_hero_temp = party_hero_temp.filter(participant => participant.id_name !== party_participant.id_name);
        }        

        party_participant.out = true;
        if (party_participant.can_die) killCharacter(party_participant);

        updateTemp(party_enemy_temp, party_hero_temp);
        if (party_participant.id_name == player.id_name) State.variables.player.health = party_participant.health;      
    }
}

function killCharacter(character) {
    const is_character = !!(State.variables.characters[character.id_name]);
    const is_enemy = !!(State.variables.enemies[character.id_name]);

    if (is_character) State.variables.characters[character.id_name].dead = true;
    if (is_enemy) State.variables.enemies[character.id_name].dead = true;
}


// --- Output Parties ---
setup.getParty = function (party, party_id_name) {
    const $partySideBlock = $(`.fight__side--${party_id_name}`);

    $.each(party, function (index, party_participant) { 
        checkZeroHealth(party_participant, party_id_name);

        let participant_block = createParticipantBlock(party_participant, party_id_name);
        $partySideBlock.append(participant_block);           
    });
};


function getfightPortrait(party_participant) {
    let result = '';
    const is_character = !!(State.variables.characters[party_participant.id_name]);

    if (party_participant.kind) {
        result = `media/characters/_kind/${party_participant.kind}.jpg`;
    } else if (is_character) {
        result = `media/characters/${party_participant.id_name}/default.jpg`
    } else {        
        result = `media/characters/default.png`;
    }

    return result;
}


function createParticipantBlock(party_participant, party_id_name) {
    const stat_health = `health-${party_participant.id_name}` ;
    const stat_stamina = `stamina-${party_participant.id_name}` ;
    const participant_name = (party_participant.kind) 
        ? getLocalizedSystemText('kind_list', party_participant.kind) 
        : getLocalizedText(`characters_${party_participant.id_name}_name`);

    const portrait_path = getfightPortrait(party_participant);

    const participant_block = `
        <div 
            class="
                fight__participant fight__participant--${party_id_name} 
                ${(party_participant.out) ? 'fight__participant--out' : ''} 
            " 
            data-participant-id-name=${party_participant.id_name}
        >
            <img 
                class="fight__participant-image" 
                src="${portrait_path}" 
                onerror="this.src = 'media/characters/default.png'"
            >
            <div class="fight__participant-info">
                <div class="fight__participant-info-header">    
                    ${(party_participant.kind) ?
                        `<p class="fight__participant-name ${party_participant.kind}">${participant_name}</p>`
                    :
                        `<p class="fight__participant-name ${party_participant.id_name}">${participant_name}</p>`
                    }

                    ${(party_participant.lvl != 'unrecognized') ?
                        `<p>lvl: <span>${party_participant.lvl}</span></p>`
                    : ''}
                </div>
                
                
                <div>                
                    <p>health: <span>${party_participant.health}/${party_participant.health_max}</span></p>   
                    <div class="bar">
                        <span class="bar-line" data-stat='${stat_health}'/>
                    </div>
                </div>
                <div>                
                    <p>stamina: <span>${party_participant.stamina}/${party_participant.stamina_max}</span></p>    
                    <div class="bar">
                        <span class="bar-line" data-stat='${stat_stamina}'/>
                    </div>
                </div>
                <div class="fight__participant-stats"> 
                    <p>attack: <span>${party_participant.battle.attack}</span></p>
                    <p>defence: <span>${party_participant.battle.defence}</span></p>
                    <p>magic_attack: <span>${party_participant.battle.magic_attack}</span></p>
                    <p>magic_defence: <span>${party_participant.battle.magic_defence}</span></p>
                </div>
            </div>
            
            <img class="fight__participant-out-image" src="media/misc/out.png">
        </div>
    `;

    
	// setup.drawBar(party_participant.health, party_participant.health_max, stat_health, 90, 45);
    // setup.drawBar(party_participant.stamina, party_participant.stamina_max, stat_stamina, 60, 35);

    return participant_block;

            // For more complex calculaton inside `` use constraction below:

            // ${(() => {
            //     if (party_participant.lvl) {
            //         return 
            //         `<p>lvl: <span id="enemy_lvl--${party_participant.id_name}">${party_participant.lvl}</span></p>`                                
            //     }
            // })()}  
};


setup.removeParty = function (party_id_name) {
    let $partySide = $(`.fight__side--${party_id_name}`);
    $partySide.empty();
};

setup.refreshParty = function () { 
    const party_enemy = State.variables.party_enemy.party;
    const party_hero = State.variables.party_hero.party;
    
    setup.removeParty('enemy');
    setup.removeParty('hero');

    setup.getParty(party_enemy, 'enemy');
    setup.getParty(party_hero, 'hero');
};


function canEscape() {
    let escapeChance = random(1,10);
    if (escapeChance == 1) {
        return true
    } else {
        return false
    }
} 

function tryEscape($logBlock, enemy_participant_target, player) {  
    if (canEscape()) {
        State.variables.battleMode = 4; 
        
        if (isFightTask()) {
            const task = getFightTask();
            clearTempTask(task, 'cur_tasks_fight');
        }

        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span>  escaped successfully. 
            <span class="npc_text ${enemy_participant_target.kind}">
                ${enemy_participant_target.name}
            </span> 
            tried to catch him, but failed.` 
        );  
        updateBattleState();
        
        return;
    } else {
        // This message could not be seen LOL
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span> 
            tried to escape from 
            <span class="npc_text ${enemy_participant_target.kind}">
                ${enemy_participant_target.name}
            </span> 
            , but failed.` 
        );
    }
}



$(document).on('click', '.hero-turn', function () {
    const party_hero_temp = State.variables.party_hero_temp;
    const party_enemy_temp = State.variables.party_enemy_temp;
    const player = State.variables.player;

    const player_attack = player.battle.attack; 
    const player_magical_attack = player.battle.magic_attack; 
    const player_weapon = State.variables.player.inventory.in_use.primary; 
    const enemy_party = State.variables.party_enemy.party;

    const $logBlock = $("#last_action");

    const enemy_participant_target_id_name = $(this).closest('#heroTurn').attr('data-action-id-name');
    let enemy_participant_target = party_enemy_temp.find( ({id_name}) => id_name === enemy_participant_target_id_name);
    
    const current_action = $(this).attr('data-action');
    let heroDamage = 0;


    if (current_action == 'attack') {
        heroDamage += player_attack;
        if (player_weapon) heroDamage += player_weapon.attack;
        State.variables.player.stamina -= 5;
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span>
            performed
            <span class="npc_text">
                ${current_action}
            </span>
            and damaged  
            <span class="npc_text ${enemy_participant_target.kind}">
                ${enemy_participant_target.name}
            </span>
            ${(player_weapon) ?
                `with
                <span class="npc_text">
                    ${player_weapon.id_name}
                </span>`
            : ''}
            by 
            ${heroDamage}
            health points` 
        );
    }

    if (current_action == 'magic_attack') {
        heroDamage += player_magical_attack;
        if (player_weapon) heroDamage += player_weapon.magic_attack;
        State.variables.player.stamina -= 10;
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span>
            performed
            <span class="npc_text">
                ${current_action}
            </span>
            and damaged  
            <span class="npc_text ${enemy_participant_target.kind}">
                ${enemy_participant_target.name}
            </span>
            <span class="npc_text">
            ${(player_weapon) ?
             `with ${player_weapon.id_name}`
            : ''}
            </span>
            by 
            ${heroDamage}
            health points` 
        );
    }

    if (current_action == 'specials') {
        // Add skills
        State.variables.player.stamina -= 20;
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span> 
            tried to use some special attack, but he isn't able to do it yet.` 
        );
    }

    if (current_action == 'heal') {
        // Use potions
        State.variables.player.stamina -= 10;
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span>
            tried to heal himself, but he isn't able to do it yet.` 
        );
    }

    if (current_action == 'rest') {
        State.variables.player.stamina += 10;        
        $logBlock.html(`
            <span class="npc_text ${player.id_name}">
                ${player.name}
            </span> 
            recovered stamina` 
        );
    }

    if (current_action == 'flee') {
        tryEscape($logBlock, enemy_participant_target, player);    
        State.variables.player.stamina -= 20;        
    }

    $("#heroTurn").empty();
    $("#autoTurn").show();

    actionGeneral(player, enemy_participant_target, heroDamage);
});



function defineRoundList() {    
    const party_hero_temp = State.variables.party_hero_temp;
    const party_enemy_temp = State.variables.party_enemy_temp;

    let roundList = '';    
    const roundListOld = State.variables.roundList;
    
    if ((typeof roundListOld !== 'undefined') && (roundListOld.length)) {
        roundList = State.variables.roundList;
    } else {
        let all_participants = party_hero_temp.concat(party_enemy_temp);
        roundList = all_participants.sort(function(first, next){
            if (first.lvl == 'unrecognized') {
                return -1;
            } else {
                return next.lvl - first.lvl;
            }
        });

    }

    State.variables.roundList = roundList;

    return roundList;
}

function fintSubject() {    
    let roundList = defineRoundList();
    
    let action_subject = roundList[0];
    return action_subject;
}

function startOrder() {
    let action_subject = fintSubject();
    const player = State.variables.player;

    if (action_subject.id_name === player.id_name) {
        $('#heroTurn').show();
        $('#autoTurn').hide();

        $('.fight__participant--enemy:not(.fight__participant--out)').addClass('fight__participant--available');
        $('.fight__participant--enemy:not(.fight__participant--out)').addClass('fight__participant--animation');
    } else {
        $('#heroTurn').hide();
        $('#autoTurn').show();

        $('.fight__participant--enemy').removeClass('fight__participant--available');
        $('.fight__participant--enemy').removeClass('fight__participant--animation');
    }
}

$(document).on('click', '.autoAction', function () {
    const party_hero_temp = State.variables.party_hero_temp;
    const party_enemy_temp = State.variables.party_enemy_temp;

    const $logBlock = $("#last_action");
    
    let action_subject = fintSubject(party_hero_temp, party_enemy_temp);

    let action_subject_party = '';
    let action_subject_target = '';
    

    $.each(party_hero_temp, function (index, participant) {   
        if (participant.id_name == action_subject.id_name ) {
            action_subject_party = 'hero';
        }
    });

    $.each(party_enemy_temp, function (index, participant) {
        if (participant.id_name == action_subject.id_name ) {
            action_subject_party = 'enemy';
        }
    });

    if (action_subject_party == 'hero') {
        action_subject_target = party_enemy_temp[Math.floor(Math.random() * party_enemy_temp.length)]; // temp
    }

    if (action_subject_party == 'enemy') {
        action_subject_target = party_hero_temp[Math.floor(Math.random() * party_hero_temp.length)]; // temp
    }

    let action_subject_damage = 0; 
    
    // let actions = ['attack', 'magic_attack', 'rest', 'flee' ];    // Add variety of how npc can action !!!!!!!!!!!!

    let actions = ['attack', 'magic_attack'];

    // if (needStamina(action_subject)) {
    //     action.push('rest');
    // }


    let action_subject_choice = actions[Math.floor(Math.random() * actions.length)];
    
    if (action_subject_choice == 'attack') {        
        action_subject_damage += action_subject.battle.attack;
        $logBlock.html(`
            <span class="npc_text ${action_subject.id_name}">
                ${action_subject.name} 
            </span>        
            damaged 
            <span class="npc_text ">
                ${action_subject_target.name}
            </span> 
            with 
            <span class="npc_text ">
                ${action_subject_choice}
            </span> 
            by 
            ${action_subject_damage}
            health points` 
        );
    } 
    

    if (action_subject_choice == 'magic_attack') {      

        action_subject_damage += action_subject.battle.magic_attack;
        $logBlock.html(`
            <span class="npc_text ${action_subject.id_name}">
                ${action_subject.name} 
            </span>        
            damaged 
            <span class="npc_text ">
                ${action_subject_target.name}
            </span> 
            with 
            <span class="npc_text ">
                ${action_subject_choice}
            </span> 
            by 
            ${action_subject_damage}
            health points` 
        );
    }

    if (action_subject_choice == 'rest') {
        let stamina_points = needStamina(action_subject);
        action_subject.stamina = stamina_points;

        $logBlock.html(`
            <span class="npc_text ${action_subject.id_name}">
                ${action_subject.name} 
            </span>        
            respawned 
            ${stamina_points}
            stamina points` 
        );
    }

    if (action_subject_choice == 'flee') {
        // tryEscape($logBlock, action_subject, action_subject_taget);
    }
    

    actionGeneral(action_subject, action_subject_target, action_subject_damage);
});

function actionGeneral(action_subject, action_subject_target, action_subject_damage) {
    action_subject_target.health -= action_subject_damage;
    setup.refreshParty(); 

    let roundList = State.variables.roundList;

    if (action_subject_target.health <= 0) {
        roundList = roundList.filter(participant => participant.id_name !== action_subject_target.id_name);
        State.variables.roundList = roundList;
    }
    
    const player_health = State.variables.player.health;   
    const battleEnded = checkEndBattle(player_health);

    if (!battleEnded) {  
        $('#currentTurn').text(`${action_subject.name}`);

        changeTurn();
        startOrder();
    }
}

function changeTurn() {
    let roundList = State.variables.roundList;
    roundList.shift();
    State.variables.roundList = roundList;
}

function needStamina(action_subject) {
    let required_stamina = 10;
    let stamina_limit = action_subject.stamina_max/100*10;  // return 10% of stamina max

    if (action_subject.stamina < stamina_limit) {
        required_stamina = stamina_limit;
    }
    return required_stamina;
}


function checkEndBattle(player_health) {   
    const party_hero_temp = State.variables.party_hero_temp;
    const party_enemy_temp = State.variables.party_enemy_temp;   
    
    if (party_enemy_temp.length <= 0) {
        $('#finishBattle').show();
        $('#autoTurn').hide();   
        $('#heroTurn').hide();          
        State.variables.battleMode = 2;           
        const battle_xp = getPropSum(State.variables.party_enemy.party, 'xp');
        State.variables.battle_xp = battle_xp;    

        return true;
    }
    if (player_health <= 0) {
        $('#finishBattle').show();
        $('#autoTurn').hide(); 
        $('#heroTurn').hide(); 
        State.variables.battleMode = 3;  
        return true;
    }

    return false;
}


function updateBattleState() {
    Engine.display(passage(), true);
}

$(document).on('click', '#finishBattle', function () {
    updateBattleState();
});

/* twine-user-script #62: "general_funcs.js" */
// --- Automute videos ---
setup.mutePage = function () {
    var videos = document.querySelectorAll("video");
    [].forEach.call(videos, function (video) {
        video.muted = true;
    });
};

$(document.head).append("<link rel='icon' href='media/icons/browser_tab.png'>");

// To capitalize some words
function capitalize(string) {
    return (string && string[0].toUpperCase() + string.slice(1)) || "";
}

// To format string into 'class names like' format string
function classnaming(string) {
    return string.split("_").join(' ').replace(/(^\w{1})|(\s+\w{1})/g, letter => letter.toUpperCase()).replaceAll(' ', '');
}


function createEnemyByIdn(kind) {
    const enemy_class = classnaming(kind);
    const enemy_params = {};
    const enemy = Reflect.construct(eval(enemy_class), [enemy_params]);

    return enemy;
}


function transformMembersFromIdnToClass(party) {
    const enemy_kinds = State.variables.lists.enemy_kinds;

    $.each(party.members, function (index, member) {
        // check if the member is only a specimen of some enemy kind
        const is_kind = (enemy_kinds.filter(kind => kind == member).length);
        if (is_kind) {
            const enemy = createEnemyByIdn(member);
            State.variables.enemies[enemy.id_name] = enemy;
            party.members.push(enemy.id_name);
        }

        party.members = party.members.filter(function (m) { return m !== member })

        // check for correct character idn from json
        if (!is_kind) party.members.push(State.variables.characters[member].id_name);
    });
}


function isParty(task_subject) {
    const party = State.variables.parties[task_subject];
    return (party) ? true : false;
}

function getParty(task_subject) {
    const party = State.variables.parties[task_subject];
    return (party) ? party : false;
}


function isItemInUse(item_idn, character_idn = "player") {
    const player = State.variables.player;
    const characters = State.variables.characters;
    const inventory = (character_idn == 'player') ? player.inventory : characters[character_idn].inventory;

    const in_use_items = Object.values(inventory.in_use);
    const result = in_use_items.some(item => item.id_name == item_idn);
    return result;
}




function getPartyByMemberIdn(member_idn) {
    let result = {};
    $.each(State.variables.parties, function (party_idn, party) {
        result = (party.members.some((member) => member = member_idn)) ? party : false;
    });
    return result;
}


function getCurrentLocation() {
    const location = (passage() == 'Uni_Location') ? State.variables.temp.custom_location : passage();
    return location;
}

function moveToLocation(location) {
    const isPassageLocation = State.variables.lists.location_list.includes(location) || location == "Uni_Sketch" || location == "Talk_Menu" || location == "Uni_Deadend";
    const custom_location_list = Object.values(State.variables.lists.custom_locations).map(location => location.id_name);
    const isCustomLocation = custom_location_list.includes(location);

    if (isPassageLocation) {
        Engine.play(location);
    } else if (isCustomLocation) {
        State.variables.temp.custom_location = location;
        Engine.play('Uni_Location');
    } else {
        console.error(`Cannot move to location: "${location}" !`);
        alert(`Cannot move to location: "${location}" !`);
    }
}


function isPlayerOnLocation(destination_location) {
    return (destination_location == getCurrentLocation());
}

function getPlayerLocation() {
    const custom_location = State.variables.temp.custom_location;
    const last_location_passage = State.variables.temp.last_location_passage;
    let result = '';

    if (custom_location) {
        result = custom_location;
    } else if (tags().includes("Location")) {
        result = passage();
    } else if (passage() != last_location_passage) {
        result = last_location_passage;
    } else {
        console.error(`getPlayerLocation" !`);
        alert(`getPlayerLocation" !`);
    }
    return result;
}


function getIdFromIndex(string) {
    return string.split('_').pop();
}


function nobr(content) {
    return `<<nobr>>${content}<</nobr>> `
}




function refreshSketches() {
    State.variables.sketches = sketch_list; // Probably rework to injection with button, like Update Sketches data !!!
}



function updateHours() {
    const time = State.variables.time;
    if (time.minute >= 60) {
        const temp_hours = Math.floor(time.minute / 60);
        const temp_minute = time.minute % 60;

        if (temp_hours) {
            time.minute = temp_minute;
            time.hour += temp_hours;

            if (setup.countdown_broadcast) countdownProcessFunction();
        }
    }
}

function updateDays() {
    const time = State.variables.time;
    if (time.hour > 23) {
        const temp_days = Math.floor(time.hour / 24);
        const temp_hour = time.hour % 24;

        if (temp_days) {
            time.hour = temp_hour;
            time.total_day += temp_days;
            time.month_day += temp_days;

            updateDailyFunctions(); 
        }
    }
}

function updateDailyFunctions() { 
    refreshDailyVariables();
    setTodaySchedule(); // generate schedule for the new day
}

function refreshDailyVariables() {
    // if daily available
    const daily = State.variables.temp.daily;
    daily.bath = true;
}

function isDailyAvailable(daily_var) {
    const result = State.variables.temp.daily[daily_var];
    if (result == 'undefined') {
        console.error(`No such daily variable as '${daily_var}'`);
        alert(`No such daily variable as '${daily_var}'`); 
    } else {
        return result;
    }
}

function activateDailyVariables(daily_var) {
    const daily = State.variables.temp.daily;
    daily[daily_var] = false;
}

function updateMonths() {
    const time = State.variables.time;
    const lists = State.variables.lists;
    const days_in_month = lists.month_list_days[time.month_id];

    if (time.month_day >= days_in_month) {
        time.month_day = 1;
        time.month_id += 1;
    }
}


function updateDayOfWeek() {
    const time = State.variables.time;
    const lists = State.variables.lists;
    const day_of_week_length = (Object.values(lists.day_of_week_list).length);

    if (time.new_day != time.total_day) {
        if (time.day_of_week_id >= day_of_week_length) time.day_of_week_id = 1;
        else time.day_of_week_id += 1;

        time.new_day = time.total_day;
    }

}


function getListOfAnyDepth(object, prop_key, prop_value, result = []) {
    if ((object.hasOwnProperty(prop_key)) && (object[prop_key] == prop_value))
        result.push(object);

    for (var i = 0; i < Object.keys(object).length; i++) {
        if (typeof object[Object.keys(object)[i]] == "object") {
            getListOfAnyDepth(object[Object.keys(object)[i]], prop_key, prop_value, result);
        }
    }

    return result;
}



function isInTimeFrame(period, time_param) {
    const time = State.variables.time;
    const check_start = (period.start) ? (period.start <= time[time_param]) : true;
    const check_end = (period.end) ? (period.end > time[time_param]) : true;

    return check_start && check_end;
}




function runClassesFunction(function_name, data) {

    // Items classes
    const item_types_list = State.variables.lists.items.types;
    $.each(item_types_list, function (type_index, type_name) {
        const cur_type = State.variables.lists.items[type_name];
        const hasSubCategory = (cur_type.constructor === Object);
        if (data) data.type_name = type_name;

        if (hasSubCategory) {
            $.each(cur_type, function (i, sub_categories) {
                $.each(sub_categories, (i, sub_category_name) => eval(function_name)(sub_category_name, data));
            });
        } else {
            $.each(cur_type, (i, category_name) => eval(function_name)(category_name, data));
        }
    });

    // Enemy classes
    const enemy_list = State.variables.lists.enemies;
    $.each(enemy_list, (i, enemy_kind) => eval(function_name)(enemy_kind, data));
}


// function setClassCounter(name) {
//     const classname = classnaming(name);
//     if (window[classname] && window[classname].class_id_counter) {
//         localStorage.setItem(classname, window[classname].class_id_counter);
//     } 
// }

// function getClassCounter(name) {
//     const classname = classnaming(name);
//     if (window[classname] && window[classname].class_id_counter)  {
//         const saved_value = Number(localStorage.getItem(classname));
//         if (saved_value) {
//             window[classname].class_id_counter = saved_value;
//             localStorage.removeItem(classname);  
//         }
//     }
// }

function setTypeByClass(name, data) {
    if (name == data.item_class) State.temporary.resulted_type = data.type_name;
}


function reverseObject(obj) {
    const reversed_entries = Object.entries(obj).reverse();
    const reversed_obj = {};

    reversed_entries.forEach(([key, value]) => (reversed_obj[key] = value));

    return reversed_obj;
}




function updateCharacterByPlayer() {
    const cur_player = State.variables.player.id_name;
    State.variables.characters[cur_player] = State.variables.player;
}


function updatePlayerByCharacter() {
    const cur_player = State.variables.player.id_name;
    State.variables.player = State.variables.characters[cur_player];
}

function changePlayerName(player_idn = 'mc') {    
    // updating both character in a list of characters and player shell
    updateCharacterByPlayer();
    updatePlayerByCharacter();

    const lang = State.variables.settings.lang;
    const entered_name = State.variables.misc.player_name;

    localization_text[lang][`characters_${player_idn}_name`] = entered_name;
}

setup.changePlayerName = (player_idn) =>  changePlayerName(player_idn);


function getPlayerName(default_lang=State.variables.settings.lang) {
    const lang = default_lang ?? 'en';
    const player = State.variables.player;

    let player_name = !!(State.variables.misc.player_name) ? State.variables.misc.player_name : localization_text[lang][`characters_mc_name`];
    if (player.id_name !== 'mc') {
        player_name = localization_text[lang][`characters_${player.id_name}_name`]
    }

    return player_name;
}

setup.getPlayerName = (lang) => getPlayerName(lang)



setup.dialogModeSelect = function () {
    $(document).ready(function () {
        const dialog_style = State.variables.settings.dialog_style;
        const content = `
            <select>
                <option value="0" ${(dialog_style == 0) ? 'selected' : ''}>
                    ${getLocalizedSystemText('dialog_style_list', '0')}
                </option>
                <option value="1" ${(dialog_style == 1) ? 'selected' : ''}>
                    ${getLocalizedSystemText('dialog_style_list', '1')}
                </option>                
            </select>
        `;

        $('.dialog-mode-select').append(content);
    });
}

$(document).on('change', '.dialog-mode-select select', function () {
    const selected_dialog_style = this.value;
    State.variables.settings.dialog_style = selected_dialog_style;
});



// Sum of certain PROPERTY of all OBJECTS in one ARRAY
function getPropSum(items, prop) {
    return items.reduce((prev_val, item) => {
        return prev_val + (item[prop] ?? 0)
    }, 0);
};

// Sum of all properties of one object
function sumObjectValues(obj) {
    return Object.values(obj).reduce((a, b) => a + b, 0);
}



setup.getNameSC = function (character_idn) {
    const name = getCharacterName(character_idn);
    return name;
};

function getCharacterName(character_idn) {
    const character = State.variables.characters[character_idn] ?? {};
    const character_name = (character.id_name) ? getLocalizedText(`characters_${character.id_name}_name`) : getLocalizedText(`characters_${character_idn}_name`);
    return character_name;
}




function getRandomValueOfArray(Array) {
    const random_index = (Array.length > 1) ? Math.floor(Math.random() * Array.length) : 0;
    return Array[random_index];
}


setup.addMenuTabs = function (amount, category, key) {
    $(document).ready(function () {
        const parent = $('.menu-tabs');
        const cur_tab_menu_index = State.variables.temp.menu_tab;

        for (let i = 1; i <= amount; i++) { 
            const content = `
                <a 
                    data-passage=passage() 
                    data-setter="$temp.menu_tab to ${i}" 
                    data-thelper="menu_tab__${category}__${key}_${i}" 
                    ${cur_tab_menu_index == i ? 'class="menu-tabs__item--active"' : ""}
                > 
                   ${getLocalizedSystemText(category, `${key}_${i}`) }
                </a>
            `;

            parent.wiki(nobr(content));
        }
    });
}

setup.getMenuItemArrow = function (passage, tab_index, category, item_name, item_status=false) {
    const content = `        
    <div class="list-arrow__container ${(!tab_index) ? "list-arrow__container--disabled" : "" }">
        <div class="list-arrow__start">
            <div class="list-arrow__arrow-down"></div>
            <div class="list-arrow__arrow-up"></div>
        </div>
        <div class="list-arrow__body">
            <a ${(tab_index) ? `data-passage=${passage}` : "" }  data-setter="$temp.menu_tab to ${tab_index}">
                <span>${getLocalizedSystemText(category, item_name)}</span>
            </a> 
            ${(item_status) ? `<span>${getLocalizedSystemText(category, item_status)}</span>` : '' }
        </div>
        <div class="list-arrow__arrow-right"></div>
    </div>
    `;
    
    return nobr(content);
}



setup.drawMirrorReturnSC = () => drawMirrorReturn();

function drawMirrorReturn() {
    $(document).ready(function () {
        const default_mirror_return_passage = 'Home_Bedroom';
        const mirror_return_passage = State.variables.temp.mirror_return_passage ?? default_mirror_return_passage;

        const content = `
            <<br>>
            <<passage 'passages' 'passage_home_mirror_return' ${mirror_return_passage}>><</passage>> 
        `;

        $('#passages').wiki(content);
    });
}




function getSketchPersonalIdn(target_location, character_idn=false) {
    if (!character_idn) {
        if (target_location == "Mirror_Room")  character_idn = 'mc';
        if (target_location == "Talk_Menu")  character_idn = State.variables.temp.cur_speaker;
    }

    const character_sketch_idn = `sketch_personal_${character_idn}`;    
    return character_idn ? character_sketch_idn : false;
}


function ifUserOnPage() {
    const isVisibilityHiddenState = 'hidden';
    const sec_to_notify = 20;
    let time_leave = 0;
    let time_return = 0;

    const handleVisibility = () => {
        if (document.visibilityState === isVisibilityHiddenState) {
            // User leaves  the page
            time_leave = Date.now();
        } else { 
            // User returns to the page
            time_return = Date.now();    
            const seconds = Math.floor((time_return - time_leave) / 1000);
            const restricted_passages = ['index', 'Info_Disclaimer', 'Info_Project', 'Info_Interface', 'Info_Story', 'Uni_Constructor', 'Uni_Constructor_Table'];

            const pass_settings = (State.variables.settings.return_notification == 1);
            const pass_timer = (seconds >= sec_to_notify);
            const pass_passages = !restricted_passages.includes(passage());  

            if (pass_settings && pass_timer && pass_passages) showUserReturnNotification(seconds);
        }
    }
    
    document.addEventListener('visibilitychange', handleVisibility);
} 

ifUserOnPage()  // Should be started only once, not on passage change!

function showUserReturnNotification(seconds) {
    const is_active_modal = !($('#modal-container').css('display') == 'none'); // Condition is used for not to add modal with tips in queue and show it only once
    if (!is_active_modal) showModal('show_clues');
}


function updateJsonLists() {
	State.variables.lists.activities = activity_list;
	State.variables.lists.assignments = assignment_list;
	State.variables.lists.custom_locations = custom_location_list;
	State.variables.lists.image_list = image_list;
	State.variables.lists.video_list = video_list;
}



function getSocialLink(social) {
    const company_socials = {
        discord: "https://discordapp.com/channels/1172881425998037094/1172881425998037096",
        itchio: "https://2cake-gems.itch.io/",
        jira: "https://2cake.atlassian.net"
    }

    const result =  company_socials[social] ?? '';
    return result;
}


setup.getSocialLink = (social) => getSocialLink(social);
/* twine-user-script #63: "global_variables.js" */
function getAjaxGlobal() {
    $.ajax({
        url: `global.json`,
        async: false,
        method: 'GET',
        dataType: 'json' 
    }).done(function(data) {
        updateGlobalVariables(data);
    }).fail(function() {        
        console.warn("If you see error 'Access to XMLHttpRequest at...' running the game locally on computer, then it's okay.");
        console.warn("If you this error on a game server, please contact developer.");
    });
};


function updateGlobalVariables(data) {
    $.each(data, function(key, value) {      
        if (State.variables.settings[key])  State.variables.settings[key] = value ;
    })
}
/* twine-user-script #64: "help.js" */

setup.showRarityLegend = function () {
    $(document).ready(function(){
        const rarity_list =  State.variables.lists.rarity_list;
        const rarity_list_description =  State.variables.rarity_list_description;
        const $list_body = $('#rarity_legend'); 

        let list = ``;

        $.each(rarity_list, function(item_index, item){
            list += `<p><span class="${item.toLowerCase()}">${item}</span> — ${rarity_list_description[item]}</p>`;
        })

        $list_body.append(list);
    });
}
/* twine-user-script #65: "images.js" */

function drawLocationImage() {
    $(document).ready(function(){
        const mirror_passage = (passage() == "Mirror_Room");

        const image = `
            <img class="location-image ${(mirror_passage) ? 'location-image--mirror' : ''}" src='media/locations/${passage()}.jpg' >
        `;

        $('.passage-list__image').empty().wiki( nobr(image));
    });
}
/* twine-user-script #66: "json_items_default.js" */



// #region Weapon 

const default_table_dagger = {
    description: '...',      
    lvl: 1, 
    cost: 30, 
    battle: { 
        attack: 3,
        defence: 0,
        magic_attack: 0,
        magic_defence: 0,                
        length: .3,
        weight: 1,
    },
    specials: false
}

const default_table_stiletto = {
    description: '...',      
    lvl: 1, 
    cost: 30, 
    battle: { 
        attack: 3,
        defence: 0,
        magic_attack: 0,
        magic_defence: 0,                
        length: .3,
        weight: 1,
    },
    specials: false
}

// #endregion



// #region Armor 

const default_table_helmet = {
    description: '...',     
    cost: 50, 
    lvl: 3, 
    battle: { 
        attack: 0,
        defence: 3,
        magic_attack: 0,
        magic_defence: 0, 
        weight: 2,
    },
    specials: false
};

const default_table_sabatons = {
    description: '...',      
    lvl: 4,  
    cost: 100, 
    battle: { 
        attack: 0,
        defence: 2,
        magic_attack: 0,
        magic_defence: 0, 
        weight: 2,
    },
    specials: false 
};

// #endregion




let default_tables = {
    weapons: {
        knife: {
            dagger: default_table_dagger,
            stiletto: default_table_stiletto
        }
    },
    armor: {
        head: {
            helmet: default_table_helmet
        },
        foot: {
            sabatons: default_table_sabatons
        }
    }, 
    potions: [], 
    food: [],
    materials: [],
    special_items: [],
    quest_items: []
};




Object.freeze(default_table_helmet); // to check that the table values are just copied and not overwritten
/* twine-user-script #67: "json_items_rarity.js" */

// #region Weapon 

const rarity_table_knife = {
    1: {
        lvl: 2,         
        cost: 0.5,               
        battle: { 
            attack: 0,
            defence: 4,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
            length: 1
        },
        specials: false
    },
    2: {
        lvl: 3,          
        cost: 0.75,                     
        battle: { 
            attack: 0,
            defence: 5,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
            length: 1
        },
        specials: false

    },
    3: {
        lvl: 4,      
        cost: 1,                        
        battle: { 
            attack: 0,
            defence: 6,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
            length: 1
        },
        specials: false

    },
    4: {
        lvl: 5,            
        cost: 1.5,                 
        battle: { 
            attack: 0,
            defence: 7,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
            length: 1
        },
        specials: false

    },
    5: {
        lvl: 6,          
        cost: 2.5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
            length: 1
        },
        specials: false
    }, 
    6: {
        lvl: 6,          
        cost: 5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
            length: 1
        },
        specials: false
    },
    7: {
        lvl: 60,  
        cost: 20,                      
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
            length: 1
        },
        specials: false
    }
};

// #endregion



// #region Armor 

const rarity_table_head = {
    1: {
        lvl: 2,         
        cost: 0.5,               
        battle: { 
            attack: 0,
            defence: 4,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false
    },
    2: {
        lvl: 5,          
        cost: 0.75,                     
        battle: { 
            attack: 0,
            defence: 5,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    3: {
        lvl: 7,      
        cost: 1,                        
        battle: { 
            attack: 0,
            defence: 6,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    4: {
        lvl: 8,            
        cost: 1.5,                 
        battle: { 
            attack: 0,
            defence: 7,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    5: {
        lvl: 12,          
        cost: 2.5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    }, 
    6: {
        lvl: 20,          
        cost: 5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    },
    7: {
        lvl: 60,  
        cost: 20,                      
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    }
};

const rarity_table_foot = {
    1: {
        lvl: 2,         
        cost: 0.5,               
        battle: { 
            attack: 0,
            defence: 4,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false
    },
    2: {
        lvl: 3,          
        cost: 0.75,                     
        battle: { 
            attack: 0,
            defence: 5,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    3: {
        lvl: 4,      
        cost: 1,                        
        battle: { 
            attack: 0,
            defence: 6,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    4: {
        lvl: 5,            
        cost: 1.5,                 
        battle: { 
            attack: 0,
            defence: 7,
            magic_attack: 0,
            magic_defence: 0, 
            weight: 2,
        },
        specials: false

    },
    5: {
        lvl: 6,          
        cost: 2.5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    }, 
    6: {
        lvl: 6,          
        cost: 5,                     
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    },
    7: {
        lvl: 60,  
        cost: 20,                      
        battle: { 
            attack: 0,
            defence: 8,
            magic_attack: 0,
            magic_defence: 1, 
            weight: 2,
        },
        specials: false
    }
};

// #endregion



let rarity_tables = {
    weapons: {
        knife: rarity_table_knife
    },
    armor: {
        head: rarity_table_head,
        foot: rarity_table_foot
    }, 
    potions: [], 
    food: [],
    materials: [],
    special_items: [],
    quest_items: []
};








// function raretyPotions(defaultConfig, config) {         // potions on rarety

//     const health_potions_data = {
//         effect: 'addHealth',
//         rarety_list: {
//             Defective: 10,
//             Junk: 40,
//             Common: 100,
//             Uncommon: 250,
//             Rare: 500,
//             Epic: 1000,
//             Legendary: 5000,
//             Artifact: 50000,
//             Divine: 1000000
//         }
//     };

//     const stamina_potions_data = {
//         effect: 'addStamina',
//         rarety_list: {
//             Defective: 12,
//             Junk: 60,
//             Common: 150,
//             Uncommon: 300,
//             Rare: 750,
//             Epic: 1500,
//             Legendary: 8000,
//             Artifact: 80000,
//             Divine: 1500000
//         }
//     };

//     const mana_potions_data = {
//         effect: 'addMana',
//         rarety_list: {
//             Defective: 10,
//             Junk: 60,
//             Common: 150,
//             Uncommon: 300,
//             Rare: 750,
//             Epic: 1500,
//             Legendary: 8000,
//             Artifact: 80000,
//             Divine: 1500000
//         }
//     };


//     const potions_lists = [
//         health_potions_data, 
//         stamina_potions_data,
//         mana_potions_data
//     ];            

//     let cur_potion_list = {};

//     for (let i=0; i<defaultConfig.effects.length; i++) {  
//         const cur_effect = defaultConfig.effects[i];

//         cur_potion_list = potions_lists.filter(item => item.effect == cur_effect.effect);
        
//         if (cur_potion_list) {
//             defaultConfig.effects[i].value = cur_potion_list[0].rarety_list[config.rarity_id];
//         }  
//     }
// }
/* twine-user-script #68: "file_system.js" */
// fs.js v1.1.0; for SugarCube 2, by chapel

(function () {
    
    // core functions
    
    function bail (err) {
        console.error(err);
        return null;
    }
    
    function stringify (o) {
        try {
            return JSON.stringify(o);
        } catch (err) {
            return bail(err);
        }
    }
    
    function b64ify (objOrStr) {
        try {
            var str;
            if (objOrStr === undefined) {
                return null;
            } else if (typeof objOrStr !== 'string') {
                str = stringify(objOrStr);
            } else {
                str = objOrStr;
            }
            if (str != null) {
                return LZString.compressToBase64(str);
            }
        } catch (err) {
            return bail(err);
        }
    }
    
    function decompressB64 (data) {
        try {
            return LZString.decompressFromBase64(data);
        } catch (err) {
            return bail(err);
        }
    }
    
    function parse (data) {
        try {
            return JSON.parse(data);
        } catch (err) {
            try {
                return JSON.parse(decompressB64(data));
            } catch (err) {
                return bail(err);
            }
        }
    }
    
    function saveToState (objOrStr, varName) {
        try {
            if (varName[0] !== '$' && varName[0] !== '_') {
                throw new Error('Invalid stateful variable');
            }
            if (State.setVar) {
                State.setVar(varName, clone(objOrStr));
            } else {
                if (varName[0] === '$') {
                    State.variables[varName.substr(1)] = clone(objOrStr);
                } else {
                    State.temporary[varName.substr(1)] = clone(objOrStr);
                }
            }
        } catch (err) {
            return bail(err);
        }
    }
    
    function saveToFile (fileName, data) {
        if (typeof data !== 'string') {
            data = stringify(data);
        }
        if (data == null) {
            return;
        }
        if (!fileName || typeof fileName !== 'string') {
            fileName = 'file.twinedata';
        } else {
            fileName = Util.slugify(fileName.trim()).toLowerCase();
        }
        if (!fileName.includes('.')) {
            fileName = fileName + '.twinedata';
        }
        try {
            saveAs(new Blob([data], { type : 'text/plain;charset=UTF-8'}), fileName);
        } catch (err) {
            return bail(err);
        }
    }
    
    function readData (dataType, data) {
        if (data == null) {
            return null;
        }
        switch (dataType) {
            case 'json':
                return parse(data);
            case 'base64':
            case 'b64':
            case '64':
                return parse(decompressB64(data));
            default:
                return data;
        }
    }
    
    function loadFromFile (e) {
        var file = e.target.files[0],
            reader = new FileReader(),
            storyVar = e.storyVar || '$fileData',
            dataType = e.dataType || 'text';
        
        $(reader).on('load', function (event) {
            try {
                var target = event.currentTarget;
                if (!target.result) {
                    return;
                }
                
                var data = readData(dataType, target.result);
                
                saveToState(data, storyVar);

                $(document).trigger({
                    type : ':import-macro',
                    success : true,
                    data : clone(data),
                    raw : target.result,
                    storyVar : storyVar
                });

            } catch (err) {

                saveToState(null, storyVar);

                $(document).trigger({
                    type : ':import-macro',
                    success : false,
                    data : null,
                    raw : null,
                    storyVar : storyVar
                });
                
                return bail(err);

            }
        });
        
        reader.readAsText(file);
    }
    
    function createImportButton (text, storyVar, dataType, asLink) {
        var $btn = $(document.createElement(asLink ? 'a' : 'button'))
                .wiki(text),
            $label = $(document.createElement('label'))
                .attr('for', 'file-import')
                .addClass('upload-file')
                .append($btn),
            $input = $(document.createElement('input'))
                .attr({
                    id : 'file-import',
                    type : 'file',
                    'data-format' : dataType
                }).css('display', 'none').on('change', function (e) {
                    var ev = Object.assign(clone(e), {
                        storyVar : storyVar,
                        dataType : $(this).attr('data-format')
                    });
                    loadFromFile(ev);
                }),
            $wrapper = $(document.createElement('span'))
                .append($label, $input);
        
        $btn.ariaClick(function () {
            $label.trigger('click');
        });
        
        return $wrapper;
    }
    
    function exportToFile (data, fileName, dataType) {
        var str;
        switch (dataType) {
            case 'json':
                str = stringify(data);
                break;
            case 'base64':
            case 'b64':
            case '64':
                str = b64ify(stringify(data) || data);
                break;
            default:
                str = (typeof data === 'string') ? data : stringify(data);
        }
        saveToFile(fileName, str);
    }
    
    function importFromFile (targetOnPage, text, storyVar, dataType, asLink) {
        var $importElement = createImportButton(text, storyVar, dataType, asLink),
            target;
        if (targetOnPage && typeof targetOnPage === 'string') {
            target = $(targetOnPage);
        } else if (targetOnPage) {
            target = targetOnPage;
        } else {
            target = '#passages';
        }
        
        $importElement.appendTo(target);
    }
    
    // setup API
    
    setup.fileSystem = {
        config : {
            defaultText : 'Import',
            renderAsLink : false
        },
        JSON : {
            stringify : stringify,
            parse : parse
        }, 
        b64 : {
            compress : b64ify,
            decompress : decompressB64
        }, 
        toState : saveToState,
        toFile : saveToFile,
        fromFile : loadFromFile
    };
    
    // global API
    
    window.Chapel = window.Chapel || {};
    Chapel.fileSystem = Chapel.fileSystem || setup.fileSystem;
    
    // macros
    
    Macro.add('import', {
        handler : function () {
            
            var target = this.output,
                linkText = this.args[2], 
                storyVar = this.args[0], 
                dataType = this.args[1];
            
            if (!linkText || typeof linkText !== 'string') {
                linkText = setup.fileSystem.config.defaultText;
            }
            if (!storyVar || typeof storyVar !== 'string' || (storyVar[0] !== '$' && storyVar[0] !== '_')) {
                return this.error('Invalid variable name.');
            }
            if (!dataType || typeof dataType !== 'string') {
                dataType = 'text';
            } else {
                dataType = dataType.trim();
            }
            importFromFile(target, linkText, storyVar, dataType, setup.fileSystem.config.renderAsLink);
            
        }
    });
    
    Macro.add('export', {
        handler : function () {
            
            var data = this.args[0],
                file = this.args[1],
                type = this.args[2];
            
            if (!data) {
                return this.error('No data to save...');
            }
            if (!type || typeof type !== 'string') {
                type = 'text';
            } else {
                type = type.trim();
            }
            if (!file || typeof file !== 'string') {
                file = 'file.twinedata';
            } else {
                file = file.trim();
            }
            
            exportToFile(data, file, type);
            
        }
    });
}());
/* twine-user-script #69: "select2.min.js" */
/*! Select2 4.0.13 | https://github.com/select2/select2/blob/master/LICENSE.md */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(jQuery)}(function(d){var e=function(){if(d&&d.fn&&d.fn.select2&&d.fn.select2.amd)var e=d.fn.select2.amd;var t,n,i,h,o,s,f,g,m,v,y,_,r,a,w,l;function b(e,t){return r.call(e,t)}function c(e,t){var n,i,r,o,s,a,l,c,u,d,p,h=t&&t.split("/"),f=y.map,g=f&&f["*"]||{};if(e){for(s=(e=e.split("/")).length-1,y.nodeIdCompat&&w.test(e[s])&&(e[s]=e[s].replace(w,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),u=0;u<e.length;u++)if("."===(p=e[u]))e.splice(u,1),--u;else if(".."===p){if(0===u||1===u&&".."===e[2]||".."===e[u-1])continue;0<u&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((h||g)&&f){for(u=(n=e.split("/")).length;0<u;--u){if(i=n.slice(0,u).join("/"),h)for(d=h.length;0<d;--d)if(r=(r=f[h.slice(0,d).join("/")])&&r[i]){o=r,a=u;break}if(o)break;!l&&g&&g[i]&&(l=g[i],c=u)}!o&&l&&(o=l,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function A(t,n){return function(){var e=a.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),s.apply(h,e.concat([t,n]))}}function x(t){return function(e){m[t]=e}}function D(e){if(b(v,e)){var t=v[e];delete v[e],_[e]=!0,o.apply(h,t)}if(!b(m,e)&&!b(_,e))throw new Error("No "+e);return m[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return e?u(e):[]}return e&&e.requirejs||(e?n=e:e={},m={},v={},y={},_={},r=Object.prototype.hasOwnProperty,a=[].slice,w=/\.js$/,f=function(e,t){var n,i,r=u(e),o=r[0],s=t[1];return e=r[1],o&&(n=D(o=c(o,s))),o?e=n&&n.normalize?n.normalize(e,(i=s,function(e){return c(e,i)})):c(e,s):(o=(r=u(e=c(e,s)))[0],e=r[1],o&&(n=D(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},g={require:function(e){return A(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:(t=e,function(){return y&&y.config&&y.config[t]||{}})};var t}},o=function(e,t,n,i){var r,o,s,a,l,c,u,d=[],p=typeof n;if(c=S(i=i||e),"undefined"==p||"function"==p){for(t=!t.length&&n.length?["require","exports","module"]:t,l=0;l<t.length;l+=1)if("require"===(o=(a=f(t[l],c)).f))d[l]=g.require(e);else if("exports"===o)d[l]=g.exports(e),u=!0;else if("module"===o)r=d[l]=g.module(e);else if(b(m,o)||b(v,o)||b(_,o))d[l]=D(o);else{if(!a.p)throw new Error(e+" missing "+o);a.p.load(a.n,A(i,!0),x(o),{}),d[l]=m[o]}s=n?n.apply(m[e],d):void 0,e&&(r&&r.exports!==h&&r.exports!==m[e]?m[e]=r.exports:s===h&&u||(m[e]=s))}else e&&(m[e]=n)},t=n=s=function(e,t,n,i,r){if("string"==typeof e)return g[e]?g[e](t):D(f(e,S(t)).f);if(!e.splice){if((y=e).deps&&s(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=h}return t=t||function(){},"function"==typeof n&&(n=i,i=r),i?o(h,e,t,n):setTimeout(function(){o(h,e,t,n)},4),s},s.config=function(e){return s(e)},t._defined=m,(i=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),b(m,e)||b(v,e)||(v[e]=[e,t,n])}).amd={jQuery:!0},e.requirejs=t,e.require=n,e.define=i),e.define("almond",function(){}),e.define("jquery",[],function(){var e=d||$;return null==e&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),e}),e.define("select2/utils",["jquery"],function(o){var r={};function u(e){var t=e.prototype,n=[];for(var i in t){"function"==typeof t[i]&&"constructor"!==i&&n.push(i)}return n}r.Extend=function(e,t){var n={}.hasOwnProperty;function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},r.Decorate=function(i,r){var e=u(r),t=u(i);function o(){var e=Array.prototype.unshift,t=r.prototype.constructor.length,n=i.prototype.constructor;0<t&&(e.call(arguments,i.prototype.constructor),n=r.prototype.constructor),n.apply(this,arguments)}r.displayName=i.displayName,o.prototype=new function(){this.constructor=o};for(var n=0;n<t.length;n++){var s=t[n];o.prototype[s]=i.prototype[s]}function a(e){var t=function(){};e in o.prototype&&(t=o.prototype[e]);var n=r.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),n.apply(this,arguments)}}for(var l=0;l<e.length;l++){var c=e[l];o.prototype[c]=a(c)}return o};function e(){this.listeners={}}e.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},e.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},e.prototype.invoke=function(e,t){for(var n=0,i=e.length;n<i;n++)e[n].apply(this,t)},r.Observable=e,r.generateChars=function(e){for(var t="",n=0;n<e;n++){t+=Math.floor(36*Math.random()).toString(36)}return t},r.bind=function(e,t){return function(){e.apply(t,arguments)}},r._convertData=function(e){for(var t in e){var n=t.split("-"),i=e;if(1!==n.length){for(var r=0;r<n.length;r++){var o=n[r];(o=o.substring(0,1).toLowerCase()+o.substring(1))in i||(i[o]={}),r==n.length-1&&(i[o]=e[t]),i=i[o]}delete e[t]}}return e},r.hasScroll=function(e,t){var n=o(t),i=t.style.overflowX,r=t.style.overflowY;return(i!==r||"hidden"!==r&&"visible"!==r)&&("scroll"===i||"scroll"===r||(n.innerHeight()<t.scrollHeight||n.innerWidth()<t.scrollWidth))},r.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},r.appendMany=function(e,t){if("1.7"===o.fn.jquery.substr(0,3)){var n=o();o.map(t,function(e){n=n.add(e)}),t=n}e.append(t)},r.__cache={};var n=0;return r.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++n),t=n.toString())),t},r.StoreData=function(e,t,n){var i=r.GetUniqueElementId(e);r.__cache[i]||(r.__cache[i]={}),r.__cache[i][t]=n},r.GetData=function(e,t){var n=r.GetUniqueElementId(e);return t?r.__cache[n]&&null!=r.__cache[n][t]?r.__cache[n][t]:o(e).data(t):r.__cache[n]},r.RemoveData=function(e){var t=r.GetUniqueElementId(e);null!=r.__cache[t]&&delete r.__cache[t],e.removeAttribute("data-select2-id")},r}),e.define("select2/results",["jquery","./utils"],function(h,f){function i(e,t,n){this.$element=e,this.data=n,this.options=t,i.__super__.constructor.call(this)}return f.Extend(i,f.Observable),i.prototype.render=function(){var e=h('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e},i.prototype.clear=function(){this.$results.empty()},i.prototype.displayMessage=function(e){var t=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=h('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(e.message);n.append(t(i(e.args))),n[0].className+=" select2-results__message",this.$results.append(n)},i.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},i.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var i=e.results[n],r=this.option(i);t.push(r)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},i.prototype.position=function(e,t){t.find(".select2-results").append(e)},i.prototype.sort=function(e){return this.options.get("sorter")(e)},i.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");0<t.length?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},i.prototype.setClasses=function(){var t=this;this.data.current(function(e){var i=h.map(e,function(e){return e.id.toString()});t.$results.find(".select2-results__option[aria-selected]").each(function(){var e=h(this),t=f.GetData(this,"data"),n=""+t.id;null!=t.element&&t.element.selected||null==t.element&&-1<h.inArray(n,i)?e.attr("aria-selected","true"):e.attr("aria-selected","false")})})},i.prototype.showLoading=function(e){this.hideLoading();var t={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},n=this.option(t);n.className+=" loading-results",this.$results.prepend(n)},i.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},i.prototype.option=function(e){var t=document.createElement("li");t.className="select2-results__option";var n={role:"option","aria-selected":"false"},i=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(var r in(null!=e.element&&i.call(e.element,":disabled")||null==e.element&&e.disabled)&&(delete n["aria-selected"],n["aria-disabled"]="true"),null==e.id&&delete n["aria-selected"],null!=e._resultId&&(t.id=e._resultId),e.title&&(t.title=e.title),e.children&&(n.role="group",n["aria-label"]=e.text,delete n["aria-selected"]),n){var o=n[r];t.setAttribute(r,o)}if(e.children){var s=h(t),a=document.createElement("strong");a.className="select2-results__group";h(a);this.template(e,a);for(var l=[],c=0;c<e.children.length;c++){var u=e.children[c],d=this.option(u);l.push(d)}var p=h("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});p.append(l),s.append(a),s.append(p)}else this.template(e,t);return f.StoreData(t,"data",e),t},i.prototype.bind=function(t,e){var l=this,n=t.id+"-results";this.$results.attr("id",n),t.on("results:all",function(e){l.clear(),l.append(e.data),t.isOpen()&&(l.setClasses(),l.highlightFirstItem())}),t.on("results:append",function(e){l.append(e.data),t.isOpen()&&l.setClasses()}),t.on("query",function(e){l.hideMessages(),l.showLoading(e)}),t.on("select",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("open",function(){l.$results.attr("aria-expanded","true"),l.$results.attr("aria-hidden","false"),l.setClasses(),l.ensureHighlightVisible()}),t.on("close",function(){l.$results.attr("aria-expanded","false"),l.$results.attr("aria-hidden","true"),l.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=l.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var e=l.getHighlightedResults();if(0!==e.length){var t=f.GetData(e[0],"data");"true"==e.attr("aria-selected")?l.trigger("close",{}):l.trigger("select",{data:t})}}),t.on("results:previous",function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e);if(!(n<=0)){var i=n-1;0===e.length&&(i=0);var r=t.eq(i);r.trigger("mouseenter");var o=l.$results.offset().top,s=r.offset().top,a=l.$results.scrollTop()+(s-o);0===i?l.$results.scrollTop(0):s-o<0&&l.$results.scrollTop(a)}}),t.on("results:next",function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e)+1;if(!(n>=t.length)){var i=t.eq(n);i.trigger("mouseenter");var r=l.$results.offset().top+l.$results.outerHeight(!1),o=i.offset().top+i.outerHeight(!1),s=l.$results.scrollTop()+o-r;0===n?l.$results.scrollTop(0):r<o&&l.$results.scrollTop(s)}}),t.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),t.on("results:message",function(e){l.displayMessage(e)}),h.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=l.$results.scrollTop(),n=l.$results.get(0).scrollHeight-t+e.deltaY,i=0<e.deltaY&&t-e.deltaY<=0,r=e.deltaY<0&&n<=l.$results.height();i?(l.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):r&&(l.$results.scrollTop(l.$results.get(0).scrollHeight-l.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(e){var t=h(this),n=f.GetData(this,"data");"true"!==t.attr("aria-selected")?l.trigger("select",{originalEvent:e,data:n}):l.options.get("multiple")?l.trigger("unselect",{originalEvent:e,data:n}):l.trigger("close",{})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(e){var t=f.GetData(this,"data");l.getHighlightedResults().removeClass("select2-results__option--highlighted"),l.trigger("results:focus",{data:t,element:h(this)})})},i.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},i.prototype.destroy=function(){this.$results.remove()},i.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]").index(e),n=this.$results.offset().top,i=e.offset().top,r=this.$results.scrollTop()+(i-n),o=i-n;r-=2*e.outerHeight(!1),t<=2?this.$results.scrollTop(0):(o>this.$results.outerHeight()||o<0)&&this.$results.scrollTop(r)}},i.prototype.template=function(e,t){var n=this.options.get("templateResult"),i=this.options.get("escapeMarkup"),r=n(e,t);null==r?t.style.display="none":"string"==typeof r?t.innerHTML=i(r):h(t).append(r)},i}),e.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),e.define("select2/selection/base",["jquery","../utils","../keys"],function(n,i,r){function o(e,t){this.$element=e,this.options=t,o.__super__.constructor.call(this)}return i.Extend(o,i.Observable),o.prototype.render=function(){var e=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=i.GetData(this.$element[0],"old-tabindex")?this._tabindex=i.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),e.attr("title",this.$element.attr("title")),e.attr("tabindex",this._tabindex),e.attr("aria-disabled","false"),this.$selection=e},o.prototype.bind=function(e,t){var n=this,i=e.id+"-results";this.container=e,this.$selection.on("focus",function(e){n.trigger("focus",e)}),this.$selection.on("blur",function(e){n._handleBlur(e)}),this.$selection.on("keydown",function(e){n.trigger("keypress",e),e.which===r.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){n.update(e.data)}),e.on("open",function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",i),n._attachCloseHandler(e)}),e.on("close",function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.trigger("focus"),n._detachCloseHandler(e)}),e.on("enable",function(){n.$selection.attr("tabindex",n._tabindex),n.$selection.attr("aria-disabled","false")}),e.on("disable",function(){n.$selection.attr("tabindex","-1"),n.$selection.attr("aria-disabled","true")})},o.prototype._handleBlur=function(e){var t=this;window.setTimeout(function(){document.activeElement==t.$selection[0]||n.contains(t.$selection[0],document.activeElement)||t.trigger("blur",e)},1)},o.prototype._attachCloseHandler=function(e){n(document.body).on("mousedown.select2."+e.id,function(e){var t=n(e.target).closest(".select2");n(".select2.select2-container--open").each(function(){this!=t[0]&&i.GetData(this,"element").select2("close")})})},o.prototype._detachCloseHandler=function(e){n(document.body).off("mousedown.select2."+e.id)},o.prototype.position=function(e,t){t.find(".selection").append(e)},o.prototype.destroy=function(){this._detachCloseHandler(this.container)},o.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},o.prototype.isEnabled=function(){return!this.isDisabled()},o.prototype.isDisabled=function(){return this.options.get("disabled")},o}),e.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,i){function r(){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},r.prototype.bind=function(t,e){var n=this;r.__super__.bind.apply(this,arguments);var i=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",i).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",i),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),t.on("focus",function(e){t.isOpen()||n.$selection.trigger("focus")})},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return e("<span></span>")},r.prototype.update=function(e){if(0!==e.length){var t=e[0],n=this.$selection.find(".select2-selection__rendered"),i=this.display(t,n);n.empty().append(i);var r=t.title||t.text;r?n.attr("title",r):n.removeAttr("title")}else this.clear()},r}),e.define("select2/selection/multiple",["jquery","./base","../utils"],function(r,e,l){function n(e,t){n.__super__.constructor.apply(this,arguments)}return l.Extend(n,e),n.prototype.render=function(){var e=n.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},n.prototype.bind=function(e,t){var i=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){i.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(e){if(!i.isDisabled()){var t=r(this).parent(),n=l.GetData(t[0],"data");i.trigger("unselect",{originalEvent:e,data:n})}})},n.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},n.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},n.prototype.selectionContainer=function(){return r('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},n.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=this.selectionContainer(),o=this.display(i,r);r.append(o);var s=i.title||i.text;s&&r.attr("title",s),l.StoreData(r[0],"data",i),t.push(r)}var a=this.$selection.find(".select2-selection__rendered");l.appendMany(a,t)}},n}),e.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(1<t.length||n)return e.call(this,t);this.clear();var i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},t}),e.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(r,i,a){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){i._handleClear(e)}),t.on("keypress",function(e){i._handleKeyboardClear(e,t)})},e.prototype._handleClear=function(e,t){if(!this.isDisabled()){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();var i=a.GetData(n[0],"data"),r=this.$element.val();this.$element.val(this.placeholder.id);var o={data:i};if(this.trigger("clear",o),o.prevented)this.$element.val(r);else{for(var s=0;s<i.length;s++)if(o={data:i[s]},this.trigger("unselect",o),o.prevented)return void this.$element.val(r);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},e.prototype._handleKeyboardClear=function(e,t,n){n.isOpen()||t.which!=i.DELETE&&t.which!=i.BACKSPACE||this._handleClear(t)},e.prototype.update=function(e,t){if(e.call(this,t),!(0<this.$selection.find(".select2-selection__placeholder").length||0===t.length)){var n=this.options.get("translations").get("removeAllItems"),i=r('<span class="select2-selection__clear" title="'+n()+'">&times;</span>');a.StoreData(i[0],"data",t),this.$selection.find(".select2-selection__rendered").prepend(i)}},e}),e.define("select2/selection/search",["jquery","../utils","../keys"],function(i,a,l){function e(e,t,n){e.call(this,t,n)}return e.prototype.render=function(e){var t=i('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></li>');this.$searchContainer=t,this.$search=t.find("input");var n=e.call(this);return this._transferTabIndex(),n},e.prototype.bind=function(e,t,n){var i=this,r=t.id+"-results";e.call(this,t,n),t.on("open",function(){i.$search.attr("aria-controls",r),i.$search.trigger("focus")}),t.on("close",function(){i.$search.val(""),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.trigger("focus")}),t.on("enable",function(){i.$search.prop("disabled",!1),i._transferTabIndex()}),t.on("disable",function(){i.$search.prop("disabled",!0)}),t.on("focus",function(e){i.$search.trigger("focus")}),t.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")}),this.$selection.on("focusin",".select2-search--inline",function(e){i.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){i._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){if(e.stopPropagation(),i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented(),e.which===l.BACKSPACE&&""===i.$search.val()){var t=i.$searchContainer.prev(".select2-selection__choice");if(0<t.length){var n=a.GetData(t[0],"data");i.searchRemoveChoice(n),e.preventDefault()}}}),this.$selection.on("click",".select2-search--inline",function(e){i.$search.val()&&e.stopPropagation()});var o=document.documentMode,s=o&&o<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){s?i.$selection.off("input.search input.searchcheck"):i.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){if(s&&"input"===e.type)i.$selection.off("input.search input.searchcheck");else{var t=e.which;t!=l.SHIFT&&t!=l.CTRL&&t!=l.ALT&&t!=l.TAB&&i.handleSearch(e)}})},e.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},e.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},e.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.trigger("focus")},e.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},e.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},e.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";""!==this.$search.attr("placeholder")?e=this.$selection.find(".select2-selection__rendered").width():e=.75*(this.$search.val().length+1)+"em";this.$search.css("width",e)},e}),e.define("select2/selection/eventRelay",["jquery"],function(s){function e(){}return e.prototype.bind=function(e,t,n){var i=this,r=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],o=["opening","closing","selecting","unselecting","clearing"];e.call(this,t,n),t.on("*",function(e,t){if(-1!==s.inArray(e,r)){t=t||{};var n=s.Event("select2:"+e,{params:t});i.$element.trigger(n),-1!==s.inArray(e,o)&&(t.prevented=n.isDefaultPrevented())}})},e}),e.define("select2/translation",["jquery","require"],function(t,n){function i(e){this.dict=e||{}}return i.prototype.all=function(){return this.dict},i.prototype.get=function(e){return this.dict[e]},i.prototype.extend=function(e){this.dict=t.extend({},e.all(),this.dict)},i._cache={},i.loadPath=function(e){if(!(e in i._cache)){var t=n(e);i._cache[e]=t}return new i(i._cache[e])},i}),e.define("select2/diacritics",[],function(){return{"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Œ":"OE","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","œ":"oe","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ώ":"ω","ς":"σ","’":"'"}}),e.define("select2/data/base",["../utils"],function(i){function n(e,t){n.__super__.constructor.call(this)}return i.Extend(n,i.Observable),n.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},n.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},n.prototype.bind=function(e,t){},n.prototype.destroy=function(){},n.prototype.generateResultId=function(e,t){var n=e.id+"-result-";return n+=i.generateChars(4),null!=t.id?n+="-"+t.id.toString():n+="-"+i.generateChars(4),n},n}),e.define("select2/data/select",["./base","../utils","jquery"],function(e,a,l){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return a.Extend(n,e),n.prototype.current=function(e){var n=[],i=this;this.$element.find(":selected").each(function(){var e=l(this),t=i.item(e);n.push(t)}),e(n)},n.prototype.select=function(r){var o=this;if(r.selected=!0,l(r.element).is("option"))return r.element.selected=!0,void this.$element.trigger("input").trigger("change");if(this.$element.prop("multiple"))this.current(function(e){var t=[];(r=[r]).push.apply(r,e);for(var n=0;n<r.length;n++){var i=r[n].id;-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("input").trigger("change")});else{var e=r.id;this.$element.val(e),this.$element.trigger("input").trigger("change")}},n.prototype.unselect=function(r){var o=this;if(this.$element.prop("multiple")){if(r.selected=!1,l(r.element).is("option"))return r.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].id;i!==r.id&&-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("input").trigger("change")})}},n.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},n.prototype.destroy=function(){this.$element.find("*").each(function(){a.RemoveData(this)})},n.prototype.query=function(i,e){var r=[],o=this;this.$element.children().each(function(){var e=l(this);if(e.is("option")||e.is("optgroup")){var t=o.item(e),n=o.matches(i,t);null!==n&&r.push(n)}}),e({results:r})},n.prototype.addOptions=function(e){a.appendMany(this.$element,e)},n.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup")).label=e.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=e.text:t.innerText=e.text,void 0!==e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);var n=l(t),i=this._normalizeItem(e);return i.element=t,a.StoreData(t,"data",i),n},n.prototype.item=function(e){var t={};if(null!=(t=a.GetData(e[0],"data")))return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var n=e.children("option"),i=[],r=0;r<n.length;r++){var o=l(n[r]),s=this.item(o);i.push(s)}t.children=i}return(t=this._normalizeItem(t)).element=e[0],a.StoreData(e[0],"data",t),t},n.prototype._normalizeItem=function(e){e!==Object(e)&&(e={id:e,text:e});return null!=(e=l.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),l.extend({},{selected:!1,disabled:!1},e)},n.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},n}),e.define("select2/data/array",["./select","../utils","jquery"],function(e,f,g){function i(e,t){this._dataToConvert=t.get("data")||[],i.__super__.constructor.call(this,e,t)}return f.Extend(i,e),i.prototype.bind=function(e,t){i.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},i.prototype.select=function(n){var e=this.$element.find("option").filter(function(e,t){return t.value==n.id.toString()});0===e.length&&(e=this.option(n),this.addOptions(e)),i.__super__.select.call(this,n)},i.prototype.convertToOptions=function(e){var t=this,n=this.$element.find("option"),i=n.map(function(){return t.item(g(this)).id}).get(),r=[];function o(e){return function(){return g(this).val()==e.id}}for(var s=0;s<e.length;s++){var a=this._normalizeItem(e[s]);if(0<=g.inArray(a.id,i)){var l=n.filter(o(a)),c=this.item(l),u=g.extend(!0,{},a,c),d=this.option(u);l.replaceWith(d)}else{var p=this.option(a);if(a.children){var h=this.convertToOptions(a.children);f.appendMany(p,h)}r.push(p)}}return r},i}),e.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,o){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return o.extend({},e,{q:e.term})},transport:function(e,t,n){var i=o.ajax(e);return i.then(t),i.fail(n),i}};return o.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(n,i){var r=this;null!=this._request&&(o.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var t=o.extend({type:"GET"},this.ajaxOptions);function e(){var e=t.transport(t,function(e){var t=r.processResults(e,n);r.options.get("debug")&&window.console&&console.error&&(t&&t.results&&o.isArray(t.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),i(t)},function(){"status"in e&&(0===e.status||"0"===e.status)||r.trigger("results:message",{message:"errorLoading"})});r._request=e}"function"==typeof t.url&&(t.url=t.url.call(this.$element,n)),"function"==typeof t.data&&(t.data=t.data.call(this.$element,n)),this.ajaxOptions.delay&&null!=n.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(e,this.ajaxOptions.delay)):e()},n}),e.define("select2/data/tags",["jquery"],function(u){function e(e,t,n){var i=n.get("tags"),r=n.get("createTag");void 0!==r&&(this.createTag=r);var o=n.get("insertTag");if(void 0!==o&&(this.insertTag=o),e.call(this,t,n),u.isArray(i))for(var s=0;s<i.length;s++){var a=i[s],l=this._normalizeItem(a),c=this.option(l);this.$element.append(c)}}return e.prototype.query=function(e,c,u){var d=this;this._removeOldTags(),null!=c.term&&null==c.page?e.call(this,c,function e(t,n){for(var i=t.results,r=0;r<i.length;r++){var o=i[r],s=null!=o.children&&!e({results:o.children},!0);if((o.text||"").toUpperCase()===(c.term||"").toUpperCase()||s)return!n&&(t.data=i,void u(t))}if(n)return!0;var a=d.createTag(c);if(null!=a){var l=d.option(a);l.attr("data-select2-tag",!0),d.addOptions([l]),d.insertTag(i,a)}t.results=i,u(t)}):e.call(this,c,u)},e.prototype.createTag=function(e,t){var n=u.trim(t.term);return""===n?null:{id:n,text:n}},e.prototype.insertTag=function(e,t,n){t.unshift(n)},e.prototype._removeOldTags=function(e){this.$element.find("option[data-select2-tag]").each(function(){this.selected||u(this).remove()})},e}),e.define("select2/data/tokenizer",["jquery"],function(d){function e(e,t,n){var i=n.get("tokenizer");void 0!==i&&(this.tokenizer=i),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},e.prototype.query=function(e,t,n){var r=this;t.term=t.term||"";var i=this.tokenizer(t,this.options,function(e){var t,n=r._normalizeItem(e);if(!r.$element.find("option").filter(function(){return d(this).val()===n.id}).length){var i=r.option(n);i.attr("data-select2-tag",!0),r._removeOldTags(),r.addOptions([i])}t=n,r.trigger("select",{data:t})});i.term!==t.term&&(this.$search.length&&(this.$search.val(i.term),this.$search.trigger("focus")),t.term=i.term),e.call(this,t,n)},e.prototype.tokenizer=function(e,t,n,i){for(var r=n.get("tokenSeparators")||[],o=t.term,s=0,a=this.createTag||function(e){return{id:e.term,text:e.term}};s<o.length;){var l=o[s];if(-1!==d.inArray(l,r)){var c=o.substr(0,s),u=a(d.extend({},t,{term:c}));null!=u?(i(u),o=o.substr(s+1)||"",s=0):s++}else s++}return{term:o}},e}),e.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(){i._checkIfMaximumSelected()})},e.prototype.query=function(e,t,n){var i=this;this._checkIfMaximumSelected(function(){e.call(i,t,n)})},e.prototype._checkIfMaximumSelected=function(e,n){var i=this;this.current(function(e){var t=null!=e?e.length:0;0<i.maximumSelectionLength&&t>=i.maximumSelectionLength?i.trigger("results:message",{message:"maximumSelected",args:{maximum:i.maximumSelectionLength}}):n&&n()})},e}),e.define("select2/dropdown",["jquery","./utils"],function(t,e){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return e.Extend(n,e.Observable),n.prototype.render=function(){var e=t('<span class="select2-dropdown"><span class="select2-results"></span></span>');return e.attr("dir",this.options.get("dir")),this.$dropdown=e},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),e.define("select2/dropdown/search",["jquery","../utils"],function(o,e){function t(){}return t.prototype.render=function(e){var t=e.call(this),n=o('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=n,this.$search=n.find("input"),t.prepend(n),t},t.prototype.bind=function(e,t,n){var i=this,r=t.id+"-results";e.call(this,t,n),this.$search.on("keydown",function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(e){o(this).off("keyup")}),this.$search.on("keyup input",function(e){i.handleSearch(e)}),t.on("open",function(){i.$search.attr("tabindex",0),i.$search.attr("aria-controls",r),i.$search.trigger("focus"),window.setTimeout(function(){i.$search.trigger("focus")},0)}),t.on("close",function(){i.$search.attr("tabindex",-1),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.val(""),i.$search.trigger("blur")}),t.on("focus",function(){t.isOpen()||i.$search.trigger("focus")}),t.on("results:all",function(e){null!=e.query.term&&""!==e.query.term||(i.showSearch(e)?i.$searchContainer.removeClass("select2-search--hide"):i.$searchContainer.addClass("select2-search--hide"))}),t.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")})},t.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},t.prototype.showSearch=function(e,t){return!0},t}),e.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,i){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,i)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),i=t.length-1;0<=i;i--){var r=t[i];this.placeholder.id===r.id&&n.splice(i,1)}return n},e}),e.define("select2/dropdown/infiniteScroll",["jquery"],function(n){function e(e,t,n,i){this.lastParams={},e.call(this,t,n,i),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return e.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("query",function(e){i.lastParams=e,i.loading=!0}),t.on("query:append",function(e){i.lastParams=e,i.loading=!0}),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},e.prototype.loadMoreIfNeeded=function(){var e=n.contains(document.documentElement,this.$loadingMore[0]);if(!this.loading&&e){var t=this.$results.offset().top+this.$results.outerHeight(!1);this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore()}},e.prototype.loadMore=function(){this.loading=!0;var e=n.extend({},{page:1},this.lastParams);e.page++,this.trigger("query:append",e)},e.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},e.prototype.createLoadingMore=function(){var e=n('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),t=this.options.get("translations").get("loadingMore");return e.html(t(this.lastParams)),e},e}),e.define("select2/dropdown/attachBody",["jquery","../utils"],function(f,a){function e(e,t,n){this.$dropdownParent=f(n.get("dropdownParent")||document.body),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("open",function(){i._showDropdown(),i._attachPositioningHandler(t),i._bindContainerResultHandlers(t)}),t.on("close",function(){i._hideDropdown(),i._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},e.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},e.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},e.prototype.render=function(e){var t=f("<span></span>"),n=e.call(this);return t.append(n),this.$dropdownContainer=t},e.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},e.prototype._bindContainerResultHandlers=function(e,t){if(!this._containerResultsHandlersBound){var n=this;t.on("results:all",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:append",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:message",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("select",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("unselect",function(){n._positionDropdown(),n._resizeDropdown()}),this._containerResultsHandlersBound=!0}},e.prototype._attachPositioningHandler=function(e,t){var n=this,i="scroll.select2."+t.id,r="resize.select2."+t.id,o="orientationchange.select2."+t.id,s=this.$container.parents().filter(a.hasScroll);s.each(function(){a.StoreData(this,"select2-scroll-position",{x:f(this).scrollLeft(),y:f(this).scrollTop()})}),s.on(i,function(e){var t=a.GetData(this,"select2-scroll-position");f(this).scrollTop(t.y)}),f(window).on(i+" "+r+" "+o,function(e){n._positionDropdown(),n._resizeDropdown()})},e.prototype._detachPositioningHandler=function(e,t){var n="scroll.select2."+t.id,i="resize.select2."+t.id,r="orientationchange.select2."+t.id;this.$container.parents().filter(a.hasScroll).off(n),f(window).off(n+" "+i+" "+r)},e.prototype._positionDropdown=function(){var e=f(window),t=this.$dropdown.hasClass("select2-dropdown--above"),n=this.$dropdown.hasClass("select2-dropdown--below"),i=null,r=this.$container.offset();r.bottom=r.top+this.$container.outerHeight(!1);var o={height:this.$container.outerHeight(!1)};o.top=r.top,o.bottom=r.top+o.height;var s=this.$dropdown.outerHeight(!1),a=e.scrollTop(),l=e.scrollTop()+e.height(),c=a<r.top-s,u=l>r.bottom+s,d={left:r.left,top:o.bottom},p=this.$dropdownParent;"static"===p.css("position")&&(p=p.offsetParent());var h={top:0,left:0};(f.contains(document.body,p[0])||p[0].isConnected)&&(h=p.offset()),d.top-=h.top,d.left-=h.left,t||n||(i="below"),u||!c||t?!c&&u&&t&&(i="below"):i="above",("above"==i||t&&"below"!==i)&&(d.top=o.top-h.top-s),null!=i&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+i),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+i)),this.$dropdownContainer.css(d)},e.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},e.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},e}),e.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(e,t,n,i){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,i)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.children?n+=e(r.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e}),e.define("select2/dropdown/selectOnClose",["../utils"],function(o){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("close",function(e){i._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var n=t.originalSelect2Event;if("select"===n._type||"unselect"===n._type)return}var i=this.getHighlightedResults();if(!(i.length<1)){var r=o.GetData(i[0],"data");null!=r.element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r})}},e}),e.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(e){i._selectTriggered(e)}),t.on("unselect",function(e){i._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),e.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching…"},removeAllItems:function(){return"Remove all items"}}}),e.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(c,u,d,p,h,f,g,m,v,y,s,t,_,w,$,b,A,x,D,S,C,E,O,T,q,j,L,I,e){function n(){this.reset()}return n.prototype.apply=function(e){if(null==(e=c.extend(!0,{},this.defaults,e)).dataAdapter){if(null!=e.ajax?e.dataAdapter=$:null!=e.data?e.dataAdapter=w:e.dataAdapter=_,0<e.minimumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,x)),0<e.maximumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,D)),0<e.maximumSelectionLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,S)),e.tags&&(e.dataAdapter=y.Decorate(e.dataAdapter,b)),null==e.tokenSeparators&&null==e.tokenizer||(e.dataAdapter=y.Decorate(e.dataAdapter,A)),null!=e.query){var t=u(e.amdBase+"compat/query");e.dataAdapter=y.Decorate(e.dataAdapter,t)}if(null!=e.initSelection){var n=u(e.amdBase+"compat/initSelection");e.dataAdapter=y.Decorate(e.dataAdapter,n)}}if(null==e.resultsAdapter&&(e.resultsAdapter=d,null!=e.ajax&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,T)),null!=e.placeholder&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,O)),e.selectOnClose&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,L))),null==e.dropdownAdapter){if(e.multiple)e.dropdownAdapter=C;else{var i=y.Decorate(C,E);e.dropdownAdapter=i}if(0!==e.minimumResultsForSearch&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,j)),e.closeOnSelect&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,I)),null!=e.dropdownCssClass||null!=e.dropdownCss||null!=e.adaptDropdownCssClass){var r=u(e.amdBase+"compat/dropdownCss");e.dropdownAdapter=y.Decorate(e.dropdownAdapter,r)}e.dropdownAdapter=y.Decorate(e.dropdownAdapter,q)}if(null==e.selectionAdapter){if(e.multiple?e.selectionAdapter=h:e.selectionAdapter=p,null!=e.placeholder&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,f)),e.allowClear&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,g)),e.multiple&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,m)),null!=e.containerCssClass||null!=e.containerCss||null!=e.adaptContainerCssClass){var o=u(e.amdBase+"compat/containerCss");e.selectionAdapter=y.Decorate(e.selectionAdapter,o)}e.selectionAdapter=y.Decorate(e.selectionAdapter,v)}e.language=this._resolveLanguage(e.language),e.language.push("en");for(var s=[],a=0;a<e.language.length;a++){var l=e.language[a];-1===s.indexOf(l)&&s.push(l)}return e.language=s,e.translations=this._processTranslations(e.language,e.debug),e},n.prototype.reset=function(){function a(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return t[e]||e})}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:y.escapeMarkup,language:{},matcher:function e(t,n){if(""===c.trim(t.term))return n;if(n.children&&0<n.children.length){for(var i=c.extend(!0,{},n),r=n.children.length-1;0<=r;r--)null==e(t,n.children[r])&&i.children.splice(r,1);return 0<i.children.length?i:e(t,i)}var o=a(n.text).toUpperCase(),s=a(t.term).toUpperCase();return-1<o.indexOf(s)?n:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},n.prototype.applyFromElement=function(e,t){var n=e.language,i=this.defaults.language,r=t.prop("lang"),o=t.closest("[lang]").prop("lang"),s=Array.prototype.concat.call(this._resolveLanguage(r),this._resolveLanguage(n),this._resolveLanguage(i),this._resolveLanguage(o));return e.language=s,e},n.prototype._resolveLanguage=function(e){if(!e)return[];if(c.isEmptyObject(e))return[];if(c.isPlainObject(e))return[e];var t;t=c.isArray(e)?e:[e];for(var n=[],i=0;i<t.length;i++)if(n.push(t[i]),"string"==typeof t[i]&&0<t[i].indexOf("-")){var r=t[i].split("-")[0];n.push(r)}return n},n.prototype._processTranslations=function(e,t){for(var n=new s,i=0;i<e.length;i++){var r=new s,o=e[i];if("string"==typeof o)try{r=s.loadPath(o)}catch(e){try{o=this.defaults.amdLanguageBase+o,r=s.loadPath(o)}catch(e){t&&window.console&&console.warn&&console.warn('Select2: The language file for "'+o+'" could not be automatically loaded. A fallback will be used instead.')}}else r=c.isPlainObject(o)?new s(o):o;n.extend(r)}return n},n.prototype.set=function(e,t){var n={};n[c.camelCase(e)]=t;var i=y._convertData(n);c.extend(!0,this.defaults,i)},new n}),e.define("select2/options",["require","jquery","./defaults","./utils"],function(i,d,r,p){function e(e,t){if(this.options=e,null!=t&&this.fromElement(t),null!=t&&(this.options=r.applyFromElement(this.options,t)),this.options=r.apply(this.options),t&&t.is("input")){var n=i(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=p.Decorate(this.options.dataAdapter,n)}}return e.prototype.fromElement=function(e){var t=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),p.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),p.StoreData(e[0],"data",p.GetData(e[0],"select2Tags")),p.StoreData(e[0],"tags",!0)),p.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",p.GetData(e[0],"ajaxUrl")),p.StoreData(e[0],"ajax-Url",p.GetData(e[0],"ajaxUrl")));var n={};function i(e,t){return t.toUpperCase()}for(var r=0;r<e[0].attributes.length;r++){var o=e[0].attributes[r].name,s="data-";if(o.substr(0,s.length)==s){var a=o.substring(s.length),l=p.GetData(e[0],a);n[a.replace(/-([a-z])/g,i)]=l}}d.fn.jquery&&"1."==d.fn.jquery.substr(0,2)&&e[0].dataset&&(n=d.extend(!0,{},e[0].dataset,n));var c=d.extend(!0,{},p.GetData(e[0]),n);for(var u in c=p._convertData(c))-1<d.inArray(u,t)||(d.isPlainObject(this.options[u])?d.extend(this.options[u],c[u]):this.options[u]=c[u]);return this},e.prototype.get=function(e){return this.options[e]},e.prototype.set=function(e,t){this.options[e]=t},e}),e.define("select2/core",["jquery","./options","./utils","./keys"],function(o,c,u,i){var d=function(e,t){null!=u.GetData(e[0],"select2")&&u.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),t=t||{},this.options=new c(t,e),d.__super__.constructor.call(this);var n=e.attr("tabindex")||0;u.StoreData(e[0],"old-tabindex",n),e.attr("tabindex","-1");var i=this.options.get("dataAdapter");this.dataAdapter=new i(e,this.options);var r=this.render();this._placeContainer(r);var o=this.options.get("selectionAdapter");this.selection=new o(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,r);var s=this.options.get("dropdownAdapter");this.dropdown=new s(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,r);var a=this.options.get("resultsAdapter");this.results=new a(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var l=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){l.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),u.StoreData(e[0],"select2",this),e.data("select2",this)};return u.Extend(d,u.Observable),d.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+u.generateChars(2):u.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},d.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},d.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var i=this._resolveWidth(e,"style");return null!=i?i:this._resolveWidth(e,"element")}if("element"==t){var r=e.outerWidth(!1);return r<=0?"auto":r+"px"}if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(e[0]).width;var o=e.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var c=s[a].replace(/\s/g,"").match(n);if(null!==c&&1<=c.length)return c[1]}return null},d.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},d.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=u.bind(this._syncAttributes,this),this._syncS=u.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=e?(this._observer=new e(function(e){t._syncA(),t._syncS(null,e)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},d.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerSelectionEvents=function(){var n=this,i=["toggle","focus"];this.selection.on("toggle",function(){n.toggleDropdown()}),this.selection.on("focus",function(e){n.focus(e)}),this.selection.on("*",function(e,t){-1===o.inArray(e,i)&&n.trigger(e,t)})},d.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerEvents=function(){var n=this;this.on("open",function(){n.$container.addClass("select2-container--open")}),this.on("close",function(){n.$container.removeClass("select2-container--open")}),this.on("enable",function(){n.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){n.$container.addClass("select2-container--disabled")}),this.on("blur",function(){n.$container.removeClass("select2-container--focus")}),this.on("query",function(t){n.isOpen()||n.trigger("open",{}),this.dataAdapter.query(t,function(e){n.trigger("results:all",{data:e,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(e){n.trigger("results:append",{data:e,query:t})})}),this.on("keypress",function(e){var t=e.which;n.isOpen()?t===i.ESC||t===i.TAB||t===i.UP&&e.altKey?(n.close(e),e.preventDefault()):t===i.ENTER?(n.trigger("results:select",{}),e.preventDefault()):t===i.SPACE&&e.ctrlKey?(n.trigger("results:toggle",{}),e.preventDefault()):t===i.UP?(n.trigger("results:previous",{}),e.preventDefault()):t===i.DOWN&&(n.trigger("results:next",{}),e.preventDefault()):(t===i.ENTER||t===i.SPACE||t===i.DOWN&&e.altKey)&&(n.open(),e.preventDefault())})},d.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},d.prototype._isChangeMutation=function(e,t){var n=!1,i=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&0<t.addedNodes.length)for(var r=0;r<t.addedNodes.length;r++){t.addedNodes[r].selected&&(n=!0)}else t.removedNodes&&0<t.removedNodes.length?n=!0:o.isArray(t)&&o.each(t,function(e,t){if(i._isChangeMutation(e,t))return!(n=!0)});else n=!0;return n}},d.prototype._syncSubtree=function(e,t){var n=this._isChangeMutation(e,t),i=this;n&&this.dataAdapter.current(function(e){i.trigger("selection:update",{data:e})})},d.prototype.trigger=function(e,t){var n=d.__super__.trigger,i={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in i){var r=i[e],o={prevented:!1,name:e,args:t};if(n.call(this,r,o),o.prevented)return void(t.prevented=!0)}n.call(this,e,t)},d.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},d.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},d.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},d.prototype.isEnabled=function(){return!this.isDisabled()},d.prototype.isDisabled=function(){return this.options.get("disabled")},d.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},d.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},d.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},d.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},d.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var t=[];return this.dataAdapter.current(function(e){t=e}),t},d.prototype.val=function(e){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==e||0===e.length)return this.$element.val();var t=e[0];o.isArray(t)&&(t=o.map(t,function(e){return e.toString()})),this.$element.val(t).trigger("input").trigger("change")},d.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",u.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),u.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},d.prototype.render=function(){var e=o('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return e.attr("dir",this.options.get("dir")),this.$container=e,this.$container.addClass("select2-container--"+this.options.get("theme")),u.StoreData(e[0],"element",this.$element),e},d}),e.define("select2/compat/utils",["jquery"],function(s){return{syncCssClasses:function(e,t,n){var i,r,o=[];(i=s.trim(e.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0===this.indexOf("select2-")&&o.push(this)}),(i=s.trim(t.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(r=n(this))&&o.push(r)}),e.attr("class",o.join(" "))}}}),e.define("select2/compat/containerCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(e){var t=e.call(this),n=this.options.get("containerCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var i=this.options.get("adaptContainerCssClass");if(i=i||l,-1!==n.indexOf(":all:")){n=n.replace(":all:","");var r=i;i=function(e){var t=r(e);return null!=t?t+" "+e:e}}var o=this.options.get("containerCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/dropdownCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(e){var t=e.call(this),n=this.options.get("dropdownCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var i=this.options.get("adaptDropdownCssClass");if(i=i||l,-1!==n.indexOf(":all:")){n=n.replace(":all:","");var r=i;i=function(e){var t=r(e);return null!=t?t+" "+e:e}}var o=this.options.get("dropdownCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/initSelection",["jquery"],function(i){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=n.get("initSelection"),this._isInitialized=!1,e.call(this,t,n)}return e.prototype.current=function(e,t){var n=this;this._isInitialized?e.call(this,t):this.initSelection.call(null,this.$element,function(e){n._isInitialized=!0,i.isArray(e)||(e=[e]),t(e)})},e}),e.define("select2/compat/inputData",["jquery","../utils"],function(s,i){function e(e,t,n){this._currentData=[],this._valueSeparator=n.get("valueSeparator")||",","hidden"===t.prop("type")&&n.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),e.call(this,t,n)}return e.prototype.current=function(e,t){function i(e,t){var n=[];return e.selected||-1!==s.inArray(e.id,t)?(e.selected=!0,n.push(e)):e.selected=!1,e.children&&n.push.apply(n,i(e.children,t)),n}for(var n=[],r=0;r<this._currentData.length;r++){var o=this._currentData[r];n.push.apply(n,i(o,this.$element.val().split(this._valueSeparator)))}t(n)},e.prototype.select=function(e,t){if(this.options.get("multiple")){var n=this.$element.val();n+=this._valueSeparator+t.id,this.$element.val(n),this.$element.trigger("input").trigger("change")}else this.current(function(e){s.map(e,function(e){e.selected=!1})}),this.$element.val(t.id),this.$element.trigger("input").trigger("change")},e.prototype.unselect=function(e,r){var o=this;r.selected=!1,this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.id!=i.id&&t.push(i.id)}o.$element.val(t.join(o._valueSeparator)),o.$element.trigger("input").trigger("change")})},e.prototype.query=function(e,t,n){for(var i=[],r=0;r<this._currentData.length;r++){var o=this._currentData[r],s=this.matches(t,o);null!==s&&i.push(s)}n({results:i})},e.prototype.addOptions=function(e,t){var n=s.map(t,function(e){return i.GetData(e[0],"data")});this._currentData.push.apply(this._currentData,n)},e}),e.define("select2/compat/matcher",["jquery"],function(s){return function(o){return function(e,t){var n=s.extend(!0,{},t);if(null==e.term||""===s.trim(e.term))return n;if(t.children){for(var i=t.children.length-1;0<=i;i--){var r=t.children[i];o(e.term,r.text,r)||n.children.splice(i,1)}if(0<n.children.length)return n}return o(e.term,t.text,t)?n:null}}}),e.define("select2/compat/query",[],function(){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.callback=n,this.options.get("query").call(null,t)},e}),e.define("select2/dropdown/attachContainer",[],function(){function e(e,t,n){e.call(this,t,n)}return e.prototype.position=function(e,t,n){n.find(".dropdown-wrapper").append(t),t.addClass("select2-dropdown--below"),n.addClass("select2-container--below")},e}),e.define("select2/dropdown/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);this.$dropdown.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),e.define("select2/selection/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);this.$selection.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),l=function(p){var h,f,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],g=Array.prototype.slice;if(p.event.fixHooks)for(var n=e.length;n;)p.event.fixHooks[e[--n]]=p.event.mouseHooks;var m=p.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],i,!1);else this.onmousewheel=i;p.data(this,"mousewheel-line-height",m.getLineHeight(this)),p.data(this,"mousewheel-page-height",m.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],i,!1);else this.onmousewheel=null;p.removeData(this,"mousewheel-line-height"),p.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var t=p(e),n=t["offsetParent"in p.fn?"offsetParent":"parent"]();return n.length||(n=p("body")),parseInt(n.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return p(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function i(e){var t,n=e||window.event,i=g.call(arguments,1),r=0,o=0,s=0,a=0,l=0;if((e=p.event.fix(n)).type="mousewheel","detail"in n&&(s=-1*n.detail),"wheelDelta"in n&&(s=n.wheelDelta),"wheelDeltaY"in n&&(s=n.wheelDeltaY),"wheelDeltaX"in n&&(o=-1*n.wheelDeltaX),"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(o=-1*s,s=0),r=0===s?o:s,"deltaY"in n&&(r=s=-1*n.deltaY),"deltaX"in n&&(o=n.deltaX,0===s&&(r=-1*o)),0!==s||0!==o){if(1===n.deltaMode){var c=p.data(this,"mousewheel-line-height");r*=c,s*=c,o*=c}else if(2===n.deltaMode){var u=p.data(this,"mousewheel-page-height");r*=u,s*=u,o*=u}if(t=Math.max(Math.abs(s),Math.abs(o)),(!f||t<f)&&y(n,f=t)&&(f/=40),y(n,t)&&(r/=40,o/=40,s/=40),r=Math[1<=r?"floor":"ceil"](r/f),o=Math[1<=o?"floor":"ceil"](o/f),s=Math[1<=s?"floor":"ceil"](s/f),m.settings.normalizeOffset&&this.getBoundingClientRect){var d=this.getBoundingClientRect();a=e.clientX-d.left,l=e.clientY-d.top}return e.deltaX=o,e.deltaY=s,e.deltaFactor=f,e.offsetX=a,e.offsetY=l,e.deltaMode=0,i.unshift(e,r,o,s),h&&clearTimeout(h),h=setTimeout(v,200),(p.event.dispatch||p.event.handle).apply(this,i)}}function v(){f=null}function y(e,t){return m.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}p.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof e.define&&e.define.amd?e.define("jquery-mousewheel",["jquery"],l):"object"==typeof exports?module.exports=l:l(d),e.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(r,e,o,t,s){if(null==r.fn.select2){var a=["open","close","destroy"];r.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var e=r.extend(!0,{},t);new o(r(this),e)}),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var n,i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=s.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=e[t].apply(e,i)}),-1<r.inArray(t,a)?this:n}}return null==r.fn.select2.defaults&&(r.fn.select2.defaults=t),o}),{define:e.define,require:e.require}}(),t=e.require("jquery.select2");return d.fn.select2.amd=e,t});
/* twine-user-script #70: "macro.js" */

// Macro
// notify macro, for SugarCube 2
(function () {
    // notify.js, by chapel; for sugarcube 2
    // version 1.1.1
    // requires notify.css / notify.min.css

    var DEFAULT_TIME = 2000; // default notification time (in MS)

    var isCssTime = /\d+m?s$/;
		
    $(document.body).append("<div id='notify'></div>");
    $(document).on(':notify', function (ev) {
        if (ev.message && typeof ev.message === 'string') {
            // trim message
            ev.message.trim();
            // classes
            if (ev.class) {
                if (typeof ev.class === 'string') {
                    ev.class = 'open macro-notify ' + ev.class;
                } else if (Array.isArray(ev.class)) {
                    ev.class = 'open macro-notify ' + ev.class.join(' ');
                } else {
                    ev.class = 'open macro-notify';
                }
            } else {
                ev.class = 'open macro-notify';
            }
            
            // delay
            if (ev.delay) {
                if (typeof ev.delay !== 'number') {
                    ev.delay = Number(ev.delay);
                }
                if (Number.isNaN(ev.delay)) {
                    ev.delay = DEFAULT_TIME;
                }
            } else {
                ev.delay = DEFAULT_TIME;
            }
            
            $('#notify')
                .empty()
                .wiki(ev.message)
                .addClass(ev.class);
                    
            setTimeout(function () {
                $('#notify').removeClass();
            }, ev.delay);
        }
    });

    function notify (message, time, classes) {
        if (typeof message !== 'string') {
            return;
        }

        if (typeof time !== 'number') {
            time = false;
        }

        $(document).trigger({
            type    : ':notify',
            message : message,
            delay   : time,
            class   : classes || ''
        });
    }

    // <<notify delay 'classes'>> message <</notify>>
    Macro.add('notify', {
           tags : null,
        handler : function () {
            
            // set up
            var msg     = this.payload[0].contents, 
                time    = false, 
                classes = false, i;
            
            // arguments
            if (this.args.length > 0) {
                var cssTime = isCssTime.test(this.args[0]);
                if (typeof this.args[0] === 'number' || cssTime) {
                    time    = cssTime ? Util.fromCssTime(this.args[0]) : this.args[0];
                    classes = (this.args.length > 1) ? this.args.slice(1).flatten() : false;
                } else {
                    classes = this.args.flatten().join(' ');
                }
            }
            // fire event
            notify(msg, time, classes);
            
        }
    });

    setup.notify = notify;
}());



// fading macro set, by chapel; for SugarCube 2
// version 1.1.0
// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#fading-macros

// <<fadein>> macro
Macro.add('fadein', {
       tags : null,
    handler : function () {

        var $wrapper = $(document.createElement('span'));
        var content  = this.payload[0].contents, time, delay;

        if (this.args.length === 0) {
            return this.error('no arguments given');
        }
        
        time  = Util.fromCssTime(this.args[0]);
        delay = (this.args.length > 1) ?  Util.fromCssTime(this.args[1]) : 0;

        $wrapper
            .wiki(content)
            .addClass('macro-' + this.name)
            .appendTo(this.output)
            .hide()
            .delay(delay)
            .fadeIn(time);

    }
});

// <<fadeout>> macro
Macro.add('fadeout', {
       tags : null,
    handler : function () {

        var $wrapper = $(document.createElement('span'));
        var content  = this.payload[0].contents, time, delay;

        if (this.args.length === 0) {
            return this.error('no arguments given');
        }
        
        time  = Util.fromCssTime(this.args[0]);
        delay = (this.args.length > 1) ?  Util.fromCssTime(this.args[1]) : 0;

        $wrapper
            .wiki(content)
            .addClass('macro-' + this.name)
            .appendTo(this.output)
            .delay(delay)
            .fadeOut(time);

    }
});



// first macro, by chapel; for sugarcube 2
// version 1.1.1
// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#first-macro

// <<first>> macro
Macro.add('first', {
    skipArgs : true,
        tags : ['then', 'finally'],
     handler : function () {

        var $wrapper = $(document.createElement('span')),
            last     = this.payload[this.payload.length - 1],
            visits   = visited() - 1, 
            content;
            
            if (visits < this.payload.length) {
                content = this.payload[visits].contents;
            } else {
                content = (last.name === 'finally') ? last.contents : '';
            }

        $wrapper
            .wiki(content)
            .addClass('macro-' + this.name)
            .appendTo(this.output);
    }

});


// dialog API macro set, by chapel; for sugarcube 2
// version 1.3.0
// see the documentation: https://github.com/ChapelR/custom-macros-for-sugarcube-2#dialog-api-macros

// <<dialog>> macro
Macro.add('dialog', {
        tags : ['onopen', 'onclose'],
    handler : function () {
     
        // handle args (if any)
        var errors = [];
        var content = '', onOpen = null, onClose = null;
        var title = (this.args.length > 0) ? this.args[0] : '';
        var classes = (this.args.length > 1) ? this.args.slice(1).flatten() : [];

        this.payload.forEach( function (pl, idx) {
            if (idx === 0) {
                content = pl.contents;
            } else {
                if (pl.name === 'onopen') {
                    onOpen = onOpen ? onOpen + pl.contents : pl.contents;
                } else {
                    onClose = onClose ? onClose + pl.contents : pl.contents;
                }
            }
        });
     
        // add the macro- class
        classes.push('macro-' + this.name);
        
        // dialog box
        Dialog.setup(title, classes.join(' '));
        Dialog.wiki(content);

        // should these be shadowWrapper-aware?
        if (onOpen && typeof onOpen === 'string' && onOpen.trim()) {
            $(document).one(':dialogopened', function () {
                $.wiki(onOpen);
            });
        }

        if (onClose && typeof onClose === 'string' && onClose.trim()) {
            $(document).one(':dialogclosed', function () {
                $.wiki(onClose);
            });
        }

        Dialog.open();
     
 }

});

// <<popup>> macro
Macro.add('popup', {
    handler : function () {
     
        // errors
        if (this.args.length < 1) {
            return this.error('need at least one argument; the passage to display');
        }
        if (!Story.has(this.args[0])) {
            return this.error('the passage ' + this.args[0] + 'does not exist');
        }
        
        // passage name and title
        var psg   = this.args[0];
        var title = (this.args.length > 1) ? this.args[1] : '';
        var classes = (this.args.length > 2) ? this.args.slice(2).flatten() : [];
        
        // add the macro- class
        classes.push('macro-' + this.name);
        
        // dialog box
        Dialog.setup(title, classes.join(' '));
        Dialog.wiki(Story.get(psg).processText());
        Dialog.open();
     
    }

});

// <<dialogclose>> macro
Macro.add('dialogclose', { 
    skipArgs : true, 
    handler : function () {
        Dialog.close();
    } 
});
/* twine-user-script #71: "menu_inventory.js" */

setup.showWeapons = function (items, equiped, items_type) {
    $(document).ready(function(){
        addWeaponItem(items, equiped, items_type);
    });
};

setup.showArmor = function (items, equiped, items_type) {
    $(document).ready(function(){
        addArmorItem(items, equiped, items_type);
    });
};

setup.showPotions = function (items, items_type) {
    $(document).ready(function(){
        addPotionItem(items, items_type);
    });
};


function addWeaponItem(weapons, equiped, items_type) {
    $.each(weapons, function (weapon_index, weapon) {  
        addWeaponRow(weapon_index, weapon, equiped);
        addUseAction(weapon_index, weapon, items_type, 'primary');      
        addUseAction(weapon_index, weapon, items_type, 'secondary');     
    });
}

function addArmorItem(armor, equiped, items_type) {
    $.each(armor, function (armor_item_index, armor_item) {  
        addArmorRow(armor_item_index, armor_item, equiped);
        addUseAction(armor_item_index, armor_item, items_type, 'head');      
        addUseAction(armor_item_index, armor_item, items_type, 'foot');  
        addUseAction(armor_item_index, armor_item, items_type, 'arms');  
        addUseAction(armor_item_index, armor_item, items_type, 'legs');  
    });
}

function addPotionItem(potion, items_type) {
    $.each(potion, function (potion_item_index, potion_item) {  
        addPotionRow(potion_item_index, potion_item);
        addUseAction(potion_item_index, potion_item, items_type, 'health_potion'); 
    });
}


function addWeaponRow(weapon_index, weapon, equiped) {
    const $tbody = $('#weapon-rows'); 

    let weapon_row = `
        <tr>
            <td class="flx-c"> 
                <img 
                    src="media/equipment/${weapon.type}/${weapon.category}/${weapon.sub_category}.${'jpg'||'png'||'gif'||'webm'}" 
                    alt="${weapon.sub_category}-image"
                    class="store-item__image"   
                    onerror="this.src = 'media/equipment/${weapon.type}/${weapon.category}/${weapon.sub_category}.png'"
                >
            </td>
            <td> <span class="${weapon.name.toLowerCase()}"> ${weapon.name} </span> </td> 
            <td> ${weapon.description} </td>
            <td> ${weapon.battle.attack} </td>
            <td> ${weapon.battle.magic_attack} </td>
            <td> ${weapon.battle.length} </td>
            <td> ${weapon.battle.weight} </td>
            <td> ${weapon.be_secondary} </td> 
            <td> ${weapon.with_secondary} </td> 
            <td> 
            ${(weapon.specials) ?
                `NEED to OUTPUT`
            : 'None'}
            </td>
        `;

        
    if (equiped.secondary.id_name != weapon.id_name) {
        weapon_row += `
            <td> 
                ${(equiped.primary.id_name != weapon.id_name) ?
                    `<p id="inventory-item-use-${'primary'}-${weapon_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    } else {
        weapon_row += `
        <td>N/a</td> 
        `;
    }

    if ((weapon.be_secondary) && (equiped.primary.id_name != weapon.id_name) && ((equiped.primary.with_secondary || !equiped.primary))) {
        weapon_row += `
            <td> 
                ${(equiped.secondary.id_name != weapon.id_name) ?
                    `<p id="inventory-item-use-${'secondary'}-${weapon_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    } else {
        weapon_row += `
        <td>N/a</td> 
        `;
    }

    weapon_row += `</tr>`;

    $tbody.append(weapon_row);
}

function addArmorRow(armor_item_index, armor_item, equiped) {
    const $tbody = $('#armor-rows'); 

    let armor_item_row = `
        <tr>
            <td class="flx-c"> 
                <img 
                    src="media/equipment/${armor_item.type}/${armor_item.category}/${armor_item.sub_category}.${'jpg'||'png'||'gif'||'webm'}" 
                    alt="${armor_item.sub_category}-image"
                    class="store-item__image"   
                    onerror="this.src = 'media/equipment/${armor_item.type}/${armor_item.category}/${armor_item.sub_category}.png'"
                >
            </td>
            <td> <span class="${armor_item.name.toLowerCase()}"> ${armor_item.name} </span> </td> 
            <td> ${armor_item.description} </td>
            <td> ${armor_item.battle.defence} </td>
            <td> ${armor_item.battle.magic_defence} </td>
            <td> ${armor_item.battle.weight} </td>
            <td> 
            ${(armor_item.specials) ?
                `NEED to OUTPUT`
            : 'None'}
            </td>
        `;


    if (armor_item.category == 'head') {
        armor_item_row += `
            <td> 
                ${(equiped.head.id_name != armor_item.id_name) ?
                    `<p id="inventory-item-use-${'head'}-${armor_item_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    }

    if (armor_item.category == 'foot') {
        armor_item_row += `
            <td> 
                ${(equiped.foot.id_name != armor_item.id_name) ?
                    `<p id="inventory-item-use-${'foot'}-${armor_item_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    }

    if (armor_item.category == 'arms') {
        armor_item_row += `
            <td> 
                ${(equiped.foot.id_name != armor_item.id_name) ?
                    `<p id="inventory-item-use-${'arms'}-${armor_item_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    }

    if (armor_item.category == 'legs') {
        armor_item_row += `
            <td> 
                ${(equiped.foot.id_name != armor_item.id_name) ?
                    `<p id="inventory-item-use-${'legs'}-${armor_item_index}" class="flx-c"></p> `
                : 'Equipped'}
            </td> 
        `;
    }

    armor_item_row += `</tr>`;
    
    $tbody.append(armor_item_row);
}

function addPotionRow(potion_item_index, potion_item) {
    const $tbody = $('#potions-rows'); 

    let potions_item_row = `
        <tr>
            <td class="flx-c"> 
                <img 
                    src="media/equipment/${potion_item.type}/${potion_item.category}.${'jpg'||'png'||'gif'||'webp'}" 
                    alt="${potion_item.category}-image"
                    class="store-item__image"   
                    onerror="this.src = 'media/equipment/${potion_item.type}/${potion_item.category}.png'"
                >
            </td>
            <td> <span class="${potion_item.name.toLowerCase()}"> ${potion_item.name} </span> </td> 
            <td> ${potion_item.description} </td>
            <td> ${potion_item.weight} </td>            
        `;

    potions_item_row += `<td>`; 

        for (let i=0; i<potion_item.effects.length; i++) {
            const cur_potion_item = potion_item.effects[i];

            potions_item_row += `  ${cur_potion_item.effect} ${cur_potion_item.value} <br>     `
        }

    potions_item_row += `</td>`; 

    if (potion_item.category == 'health_potion') {
        potions_item_row += `
            <td> 
                <p id="inventory-item-use-${'health_potion'}-${potion_item_index}" class="flx-c"></p>
            </td> 
        `;
    }


    potions_item_row += `</tr>`;
    
    $tbody.append(potions_item_row);
}



function addUseAction(item_index, item, items_type, slot) {
    const cur_passage = "Menu_Inventory"; //passage()

    const $buy_button = $(`#inventory-item-use-${slot}-${item_index}`); 

    let buy_link = `
        <<link "Use" "${cur_passage}">>
            <<set $player.inventory.in_use.${slot} = $player.inventory.${items_type}[${item_index}]; >>
            ${(item.with_secondary == false) ? 
                `<<set $player.inventory.in_use.secondary = false; >>`
            : '' }
        <</link>>
    `;

    


    if (item.category == 'health_potion') {
        const item_effects_length = item.effects.length;

        State.temporary[`effects_${item_index}`] = item.effects;
        
        buy_link = `
            <<link "Use" "${cur_passage}">>
                <<for _cur_effect range _effects_${item_index}>>   
                    <<run setup[_cur_effect.effect](_cur_effect.value)>>         
                <</for>>
                <<set $player.inventory.potions = $player.inventory.potions.filter((potion, potion_index) => potion_index != ${item_index}) >>
            <</link>>
        `;
    }

    

    
    $buy_button.wiki(buy_link);
}

setup.addHealth = function (effect_value) {
    State.variables.player.health += effect_value;
}

setup.addStamina = function (effect_value) {
    State.variables.player.stamina += effect_value;
}
/* twine-user-script #72: "menu_party.js" */
setup.showParty = function (party_list) {
    $(document).ready(function() {
        const player = State.variables.player;
        const $party_container = $('#party-container');
        const head_text = getLocalizedSystemText('menu_party', 'party_consists'); 
        const talk_text = getLocalizedSystemText('menu_party', 'talk'); 
    
        let party_info = `<h2>${head_text}</h2>`;
    
        party_list.forEach((character) => {
            const characterName = getCharacterName(character.id_name);
    
            party_info += `
                <div class="party-member__block">
                    <img src="media/characters/${character.id_name}/default.png"/>
                    <p class="${character.id_name}">${characterName}</p>
                    ${(character.id_name !== player.id_name) ? `
                        <a 
                            data-location="Talk_Menu" 
                            data-character="${character.id_name}"
                            class="link-internal party-talk-link" 
                            tabindex="0"
                        >
                            ${talk_text}
                        </a>`
                        : ''}
                </div>`;
        });
    
        $party_container.append(party_info);
    });
}


function addCharacterTalkLinkListener() {
    $('body').on('click', '.party-talk-link', function() {
        const cur_char = $(this).data('character');
        const location = $(this).data('location');
        State.variables.temp.cur_speaker = cur_char;
        State.variables.temp.cur_sketch = getSketchPersonalIdn(location, cur_char);
        moveToLocation(location);
    });
}
/* twine-user-script #73: "menu_questlog.js" */
setup.showQuestlog = function (quests) {
    $(document).ready(function() {
        const $questlog_container = $('#questlog-container');

        const $questlog_active = $('#questlog-active');
        const $questlog_completed = $('#questlog-completed');
        const $questlog_failed = $('#questlog-failed');
        const $questlog_non_active = $('#questlog-non_active');

        let questlog = ''; 


        $.each(quests, function (index, quest) { 
            if (quest.status == 1) {
                questlog += `
                    <div class="questlog__quest" data-quest="${quest.id_name}">
                        <div class="quest__main ${(quest.chosen) ? 'quest__main--current' : ''}"> 
                            <p>name: ${quest.name}</p>
                            ${(quest.chosen) ?  '<p class="quest__main-chosen">Chosen</p>' : ''}
                        </div>
                        <div class="quest__detail">
                            <p>id_name: ${quest.id_name}</p>    
                            <p>Type: ${quest.type}</p>   
                            <p>status: ${quest.status}</p>
                            <p>description: ${quest.description}</p>
                            <button class="quest__choose-btn">Choose</button>
                        </div>
                    </div>
                `;
            }
        });
        $questlog_active.append(questlog);

        questlog = ''; 
        $.each(quests, function (index, quest) { 
            if (quest.status == 2) {
                questlog += `
                    <div class="questlog__quest" data-quest="${quest.id_name}">
                        <div class="quest__main ${(quest.chosen) ? 'quest__main--current' : ''}"> 
                            <p>name: ${quest.name}</p>
                        </div>
                        <div class="quest__detail">
                            <p>id_name: ${quest.id_name}</p>    
                            <p>Type: ${quest.type}</p>   
                            <p>status: ${quest.status}</p>
                            <p>description: ${quest.description}</p>
                        </div>
                    </div>
                `;
            }
        });        
        $questlog_completed.append(questlog);

        questlog = ''; 
        $.each(quests, function (index, quest) { 
            if (quest.status == 3) {
                questlog += `
                    <div class="questlog__quest" data-quest="${quest.id_name}">
                        <div class="quest__main ${(quest.chosen) ? 'quest__main--current' : ''}"> 
                            <p>name: ${quest.name}</p>
                        </div>
                        <div class="quest__detail">
                            <p>id_name: ${quest.id_name}</p>    
                            <p>Type: ${quest.type}</p>   
                            <p>status: ${quest.status}</p>
                            <p>description: ${quest.description}</p>
                        </div>
                    </div>
                `;
            }
        });        
        $questlog_failed.append(questlog);

        questlog = ''; 
        $.each(quests, function (index, quest) { 
            if (quest.status == 0) {
                questlog += `
                    <div class="questlog__quest" data-quest="${quest.id_name}">
                        <div class="quest__main ${(quest.chosen) ? 'quest__main--current' : ''}"> 
                            <p>name: ${quest.name}</p>
                        </div>
                        <div class="quest__detail">
                            <p>id_name: ${quest.id_name}</p>    
                            <p>Type: ${quest.type}</p>   
                            <p>status: ${quest.status}</p>
                            <p>description: ${quest.description}</p>
                        </div>
                    </div>
                `;
            }
        });        
        $questlog_non_active.append(questlog);


        const quest_main_class = '.quest__main';
        const quest_class = '.questlog__quest';

        $(quest_main_class).on('click', function() {
            const quest_block = this;
            const quest_detail_class = '.quest__detail';

            const quest_detailed = $(quest_block).parent(quest_class).find(quest_detail_class)[0];
            
            $(quest_detailed).toggle();
            $(quest_block).find(quest_detail_class).show();

        });


        const choose_button = '.quest__choose-btn';
        $questlog_container.on('click', choose_button, function() {
            const cur_quest = $(this).parents('.questlog__quest').data('quest');
            const $quest_block = $(this).parents('.questlog__quest').find('.quest__main');
            
            $quest_block.addClass('quest__main--current');

            $.each(State.variables.quests, function(index, quest) {
                quest.chosen = false;
            });
            State.variables.quests[cur_quest].chosen = true;
            
            Engine.show();
        });


    });
}
/* twine-user-script #74: "modals.js" */


function showModal(type, params={}) {
    $(document).ready(function() { 
        const $modal_container = $('#modal-container');
        const modal_quantity = $modal_container.children().length;
        const content = getModalContent(type, params);    

        $modal_container.append(content);
        checkStowed();
     
        // Only for first modal in a queue
        if (modal_quantity == 0) {     
            $modal_container.children().hide();
            $modal_container.fadeIn(500).css('display', 'flex');

            showModalContent($modal_container);
        }
    });
}

function showModalContent($modal_container) {
    const milliseconds_to_unlock_modal_closing = 1000;
    setTimeout(() => {$modal_container.attr('data-closing-unlocked', '1');}, milliseconds_to_unlock_modal_closing);
    const $modal_content_last = $modal_container.children().last();
    $modal_content_last.show(); 
}


function getModalContent(type, params) {

    const modal_no_valid_items = () => { 
        const task = params.task;
        const items = (typeof params.items === "undefined") ? [] : params.items;

        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">${getLocalizedSystemText('modals', 'no_valid_items_title')}</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>${getLocalizedSystemText('modals', 'no_valid_items_1_1')} "${task.subject}" ${getLocalizedSystemText('modals', 'no_valid_items_1_2')}</p>
                    <p>${getLocalizedSystemText('modals', 'no_valid_items_2_1')} ${items.length} ${getLocalizedSystemText('modals', 'no_valid_items_2_2')} ${task.amount}</p>
                </div>
                <div class="modal-footer">
                    <h3>${getLocalizedSystemText('modals', 'modal_footer')}</h3>
                </div>
            </div>
        `;

        return result;
    }
    

    const modal_confirm_items = () => { 
        const rarity_list = State.variables.lists.rarity_list;
        const task = params.task;
        const items = (typeof params.items === "undefined") ? [] : params.items;

        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">${getLocalizedSystemText('modals', 'confirm_items_title')}</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body" data-task_idn="${task.id_name}">
                    <p>${getLocalizedSystemText('modals', 'confirm_items_1')} </p>
                    ${items.map(function(item, index) {
                        const item_rarity_id = (item.rarity_id) ?? 3;
                        const rarity_style_class = rarity_list[item_rarity_id].toLowerCase()    
                        const item_list_key = item.sub_category ?? item.category;         
                        const name_localized = getLocalizedSystemText('item_list', item_list_key);

                        return `<div class="modal__item" data-item_idn="${item.id_name}">
                                    <p class="${rarity_style_class}">
                                        ${name_localized}
                                        ${(isItemInUse(item)) ? '<span class="highlight-bold">(In Use)</span>' : ''}
                                    </p>
                                </div>`;
                    }).join('')}
                </div>
                <div class="modal-footer">
                    <div class="modal__buttons">
                        <button id="modal_confirm-items-btn">${getLocalizedSystemText('modals', 'modal_accept')}</button>
                    </div>
                </div>
            </div>
        `;

        return result;
    }
    
    const modal_select_items = () => {
        const task = params.task;
        const items = (typeof params.items === "undefined") ? [] : params.items;

        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">${getLocalizedSystemText('modals', 'select_items_title')}</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body" data-task_idn="${task.id_name}">
                    <p>${getLocalizedSystemText('modals', 'select_items_1_1')} ${task.amount} ${getLocalizedSystemText('modals', 'select_items_1_2')} '${task.subject}' ${getLocalizedSystemText('modals', 'select_items_1_3')}</p>
                    <div class="multiselect-container">
                        <div class="multiselect-block multiselect__left">
                            ${items.map((item, index) => (
                                `<div class="multiselect-option" data-item_idn="${item.id_name}">
                                    ${item.id_name}
                                    ${(isItemInUse(item)) ? '<span class="highlight-bold">In Use</span>' : ''}
                                </div>`
                            )).join('')}   
                        </div>        
                        <div class="multiselect__move">
                            <button class="multiselect__forward">🠖</button>
                            <button class="multiselect__return">🠔</button>                        
                        </div>
                        <div class="multiselect-block multiselect__right">                            
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="modal__buttons">
                        <button id="modal_select-items-btn" disabled>${getLocalizedSystemText('modals', 'modal_accept')}</button>
                    </div>
                </div>
            </div>
        `;

        return result;
    }

    // Not used
    const modal_dead_member = () => {
        const character = params.character;

        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">Character's death!</h2>
                    <span class="close">&times;</span>
                </div>      
                
                <div class="modal-body">    
                    <p class="text__large-bold">"${character.id_name}" had died!</p>
                    <br/>
                    <p>With this character's death, the thread of prophecy is severed.</p> 
                    <p>Restore a saved game to restore the weave of fate, or persist in the doomed world you have created</p>
                </div>
                
                <div class="modal-footer">
                    <h3>${getLocalizedSystemText('modals', 'modal_footer')}</h3>
                </div>
            </div>                     
        `;

        return result;
    }

    // Do not need localizations as it's only for constructor
    const modal_confirm_remove_constructor_item = () => {        
        const entity = params.entity ?? false;
        const item = params.item ?? false;
        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">Remove item</h2>
                    <span class="close">&times;</span>
                </div>      
                
                <div class="modal-body" data-entity="${entity}" data-item="${item}">    
                    <p class="text__large-bold">You will remove this item permanently!</p>
                    <br/>
                    <p>*You will be not able to restore it in any way!</p> 
                    <br/>
                </div>
                
                <div class="modal-footer">
                    <div class="modal__buttons">
                        <button id="modal_confirm-remove-btn">Accept</button>
                    </div>
                </div>
            </div>                     
        `;

        return result;
    }

    // Do not need localizations as it's only for constructor
    const modal_confirm_localization_remove = () => {     
        const item = params.item ?? false;
        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">Remove item</h2>
                    <span class="close">&times;</span>
                </div>      
                
                <div class="modal-body" data-item="${item}">    
                    <p class="text__large-bold">You will remove this localization item permanently!</p>
                    <br/>
                    <p>*You will be not able to restore it in any way!</p> 
                    <br/>
                </div>
                
                <div class="modal-footer">
                    <div class="modal__buttons">
                        <button id="modal_confirm-localization-remove-btn">Accept</button>
                    </div>
                </div>
            </div>                     
        `;

        return result;
    }

    
    const modal_show_clues = () => {
        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">${getLocalizedSystemText('modals', 'show_clues_title')}</h2>
                    <span class="close">&times;</span>
                </div>      
                
                <div class="modal-body">    
                    ${getClueModalBody()}
                </div>
                
                <div class="modal-footer">
                    <h3>&nbsp;</h3>
                </div>
            </div>                     
        `;

        return result;
    }

    
    // Not used
    const modal_test = () => {
        const result = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-header__title">Test</h2>
                    <span class="close">&times;</span>
                </div>      
                
                <div class="modal-body">    
                    <p class="text__large-bold">Test Modal</p>
                    <br/>
                    <p>With this character's death, the thread of prophecy is severed.</p> 
                    <p>Restore a saved game to restore the weave of fate, or persist in the doomed world you have created</p>
                </div>
                
                <div class="modal-footer">
                    <h3>Modal Footer</h3>
                </div>
            </div>                     
        `;

        return result;
    }

    // no_valid_items: () => modal_no_valid_items(), for sending functions with arguments

    return {        
        no_valid_items: modal_no_valid_items,
        confirm_items: modal_confirm_items,
        select_items: modal_select_items,
        dead_member: modal_dead_member,
        confirm_remove_constructor_item: modal_confirm_remove_constructor_item,
        confirm_localization_remove: modal_confirm_localization_remove,
        show_clues: modal_show_clues,
        test: modal_test
    }[type]
}


function getClueModalBody() {
    const link_discord = getSocialLink('discord');

    const clues = {
        1: `
            <p class="text__large-bold"> ${getLocalizedSystemText('game_clues', 'clue_1_1')} </p>
            <br>
            <img src="media/misc/clues/character_block.png" alt="tip-image-1" style="width: 240px;">
            <p>${getLocalizedSystemText('game_clues', 'clue_1_2')}</p>
        `,
        2: `
            <p class="text__large-bold">${getLocalizedSystemText('game_clues', 'clue_2_1')} </p>
            <br>
            <a target="_blank" href="${link_discord}">${getLocalizedSystemText('socials', 'link_to_discord')}</a>
            <p>${getLocalizedSystemText('game_clues', 'clue_2_2')}</p>
        `,
        3: `
            <p class="text__large-bold">${getLocalizedSystemText('game_clues', 'clue_3_1')}</p>
            <p>${getLocalizedSystemText('game_clues', 'clue_3_2')}</p>
            <p>${getLocalizedSystemText('game_clues', 'clue_3_3')}</p>
            <br>
            <a target="_blank" href="${link_discord}">${getLocalizedSystemText('socials', 'link_to_discord')}</a>
            <p>${getLocalizedSystemText('game_clues', 'clue_3_4')}</p>
        `,
        4: `
            <p class="text__large-bold">${getLocalizedSystemText('game_clues', 'clue_4_1')}</p>
            <br>
            <a target="_blank" href="${link_discord}">${getLocalizedSystemText('socials', 'link_to_discord')}</a>
            <p>${getLocalizedSystemText('game_clues', 'clue_4_2')}</p>
        `,
        5: `
            <p class="text__large-bold">${getLocalizedSystemText('game_clues', 'clue_2_1')}</p>
            <br>
            <a target="_blank" href="${link_discord}">${getLocalizedSystemText('socials', 'link_to_discord')}</a>
            <p>${getLocalizedSystemText('game_clues', 'clue_2_2')}</p>
        `,
    };    

    const rand = random(1, Object.entries(clues).length);
    const random_clue_content = clues[rand];

    return random_clue_content;
}

// Left side bar toggle case 
$('#ui-bar-toggle').on('click', function() {
    const $modal_container = $('#modal-container');
    $modal_container.toggleClass('modal--ml');
    $modal_container.toggleClass('modal--ml-back');
});


function checkStowed() {
    if ($('#ui-bar').hasClass('stowed')) {
        $('#modal-container').addClass('modal--ml');
    } else {
        $('#modal-container').addClass('modal--ml-back');            
    }
}



$('#passages').on('click', '.close', function() {
    const $modal_container = $(this).closest('#modal-container');
    const $modal_content = $(this).closest('.modal-content');
    closeModal($modal_content, $modal_container);
});


// For close on click outside modal window
$(document).click(function (e) {
    const is_modal_element = !!($(e.target).parents('.modal-content').length);
    if (!is_modal_element) {
        const $modal_content = $(".modal-content:visible");
        closeModal($modal_content);
    }
});

function closeModal($modal_content) {
    const $modal_container = $modal_content.closest('#modal-container');
    const ready_to_close = ($modal_container.attr('data-closing-unlocked') == 1);
    const fade_out_time = 800;

    if (ready_to_close) {
        $modal_content
            .fadeOut(fade_out_time)
            .promise().done(() => {      
                $modal_container.attr('data-closing-unlocked', '0');      
                $modal_content.remove(); 
                afterModalClose($modal_container);
            }); 
    }

}

function afterModalClose($modal_container) {
    const modal_quantity = $modal_container.children().length;

    if (modal_quantity > 0) {
        showModalContent($modal_container);
    } else if (modal_quantity == 0) {
        $modal_container.hide();
    }
}



$('#passages').on('click', '#modal_confirm-items-btn', function() {
    const $modal_container = $(this).closest('#modal-container');
    const required_items = $modal_container.find('.modal__item');
    
    $modal_container.hide();
    finishDistribute($modal_container, required_items);
});


$('#passages').on('click', '#modal_select-items-btn', function() {
    const $modal_container = $(this).closest('#modal-container');
    const required_items = $modal_container.find('.multiselect__right').find('.multiselect-option');
    
    $modal_container.hide();
    finishDistribute($modal_container, required_items);
});

$('#passages').on('click', '#modal_confirm-remove-btn', function() {
    const $modal_container = $(this).closest('#modal-container');
    const entity = $modal_container.find('.modal-body').data('entity');
    const item = $modal_container.find('.modal-body').data('item');
    
    $modal_container.hide();
    delete State.variables[entity][item];   
    Engine.play(passage());
});


$('#passages').on('click', '#modal_confirm-localization-remove-btn', function() {
    const $modal_container = $(this).closest('#modal-container');
    const item = $modal_container.find('.modal-body').data('item');
    
    $modal_container.hide();

    $.each(localization_text, function(lang, lang_list) {
        delete localization_text[lang][item]; 
        delete State.variables.temp.localization_text[lang][item];
    });

    Engine.play(passage());
});




// #region Distribute 
// Functionality for 'distribute' type of tasks
function finishDistribute($modal_container, required_items) {
    const items_to_confirm = required_items.map((index, item) => item.dataset.item_idn).get();
    const task_idn = $modal_container.find('.modal-body').data('task_idn');

    removeInventoryNestedObjects(State.variables.player.inventory, 'id_name', items_to_confirm);
    distributeTaskBroadcast(task_idn);
}


function removeInventoryNestedObjects(object, prop_key, values) {              // remove nested objects by inner property value
    try {        
        for(let i=0; i<Object.keys(object).length; i++){
            const new_object = object[Object.keys(object)[i]];
            if (typeof new_object == "object") {
                if (new_object.hasOwnProperty(prop_key) && values.includes(new_object[prop_key]) ) {
                    if (isNaN(Object.keys(object)[i])) {
                        object[Object.keys(object)[i]] = false;
                    } else {                            
                        object.splice(Object.keys(object)[i], 1);
                    }
                    removeInventoryNestedObjects(object, prop_key, values)
                } else {
                    removeInventoryNestedObjects(new_object, prop_key, values);
                }
            }
        }
    } catch (err) {
        alert(`Error has occurred during removeInventoryNestedObjects!`); 
        console.error(err);
        
    }
}


function distributeTaskBroadcast(task_idn) {
    const task = getTaskByIdn(task_idn);
    try {     
        setup.tasks_broadcast[task.id_name](task); 
        Engine.play(passage()); 
    } catch (err) {
        alert(`Error has occurred during distributeTaskBroadcast!`); 
        console.error(err);
    }
};

// #endregion



// #region Select 
// Functionality for 'select' modal type

$('#passages').on('click', '.multiselect-option', function() {
    $('.multiselect-option').removeClass('multiselect-option--selected');
    $(this).addClass('multiselect-option--selected');
});


$('#passages').on('click', '.multiselect__forward', function() {
    const cur_item_element = $('.multiselect__left').find('.multiselect-option--selected')[0];
    $('.multiselect__right').append(cur_item_element);

    undisabledSelectButton(this);
});



$('#passages').on('click', '.multiselect__return', function() {
    const cur_item_element = $('.multiselect__right').find('.multiselect-option--selected')[0]; 
    $('.multiselect__left').append(cur_item_element);

    undisabledSelectButton(this);
});


function undisabledSelectButton(move_btn) {
    const task_idn = $(move_btn).closest('#modal-container').find('.modal-body').data('task_idn');
    const cur_task = getTaskByIdn(task_idn);
    
    const select_button = '#modal_select-items-btn';
    const selected_items = $('.multiselect__right').find('.multiselect-option').length;

    (cur_task.amount == selected_items) ? $(select_button).prop("disabled", false) : $(select_button).prop("disabled", true);
};

// #endregion
/* twine-user-script #75: "on_hold.js" */

// Set check also for correct passage to not triger it eveytime

$(document).on(":passagestart", function (event) {
    $(document).ready(function () {
        // Declaration here because declarations of tag-wide variables should be after document.ready 
        const button_start = $('#onhold-button');
        const onhold_layer = $(".onhold-layer");
        
        initOnHold(button_start, onhold_layer);
    });
});

function initOnHold(button_start, onhold_layer) {
    let timeoutId = 0;
    
    button_start.on('mousedown', function() {
        timeoutId = setTimeout(animateOnHold(onhold_layer), 10);
    }).on('mouseup mouseleave', function() {
        stopOnHold(onhold_layer, timeoutId);
    });
}

function stopOnHold(onhold_layer, timeoutId) {
    onhold_layer.stop();
    onhold_layer.animate({ height: "0px" }, 300 );
    onhold_layer.animate({ 'border-top-width': "0px" }, 300 );
    clearTimeout(timeoutId);
}

function animateOnHold(onhold_layer) {
    onhold_layer.animate({
        height: "100px",
        'border-top-width': "10px"
    }, {
        duration: 3000,
        complete: onHoldFinish
    });
}

function onHoldFinish() {
    alert('Item has been crafted!');
}

// To put into location:

/* 
<button id="onhold-button">Craft</button>

<div class="onhold-block">
    <img class="onhold-image" src="media\equipment\weapons\knife\stiletto.jpg" alt="test"/>
    <div class="onhold-layer"></div>
</div> 
*/

// ---
/* twine-user-script #76: "page_reload.js" */

 
function reloadPage() {
    window.location.reload();
} 

// to check on reload
const pageAccessedByReload = (
    (window.performance.navigation && window.performance.navigation.type === 1) ||
      window.performance
        .getEntriesByType('navigation')
        .map((nav) => nav.type)
        .includes('reload')
);
  
if (pageAccessedByReload) {
    $(document).on(":passageinit", function () {
        updateJsonLists();
    });
}
/* twine-user-script #77: "passage_dialogs.js" */


// setup.checkPageDialog = function () {
//     $(document).ready(function(){
//         const hasDialog = (document.getElementsByClassName('speech').length) ? true : false;
//         if (hasDialog) drawPageDialog();
//     });
// };


function getSpeechBlock(prop_character, text_idn, posture, character_name_specific) {
    const is_player = (prop_character == 'player');
    const is_name_specific = (typeof character_name_specific !== 'undefined');

    const character_key = is_player ? State.variables.player.id_name : prop_character;
    const character = State.variables.characters[character_key] ?? {};
    const character_idn = character.id_name ?? prop_character;

    const is_character_exists = Boolean(character.id_name);

    const character_name_specific_localized = (is_name_specific) ? getLocalizedText(`characters_${character_name_specific}_name`) : false;
    const character_name = (is_name_specific)  ? character_name_specific_localized : getCharacterName(character_idn);  

    const default_format = 'png';
    const picture_path = (!character.enemy) ? `media/characters/${character_idn}/${posture}` : `media/characters/_kind/${character.kind}`;
    const is_default_picture = !(is_character_exists);
    const picture_path_default = `media/characters/default.png`;
    const picture_path_w_format = (!is_default_picture) ? `${picture_path}.${default_format}` : picture_path_default;

    const dialog_style = State.variables.settings.dialog_style; 

    return  getSpeechBlockStyled(dialog_style, character_name, character_idn, text_idn, picture_path_w_format);
}


function getSpeechBlockStyled(dialog_style, character_name, character_idn, text_idn, picture_path_w_format) {
    const dialog_text = getLocalizedText(text_idn);

    const speech_inner_0 = `
        <div class="speech__container speech-style--0"> 
            <div>
                <p class="speech__image-placeholder"></p>
                <img src="${picture_path_w_format}"  class="speech__character-image">
            </div>
            <div style="width: 100%">
                <p class="speech__name ${character_idn}">${character_name}</p>
                <hr>
                <p>${dialog_text}</p>
            </div>
        </div>
    `;

    const speech_inner_1 = `            
        <div class="speech__container  speech-style--1">
            <div>
                <p class="speech__image-placeholder"></p>
                <img src="${picture_path_w_format}" class="speech__character-image">
            </div>
            <div>
                <p class="speech__name ${character_idn}">${character_name}</p>
                <hr class="speech__line">
                <p class="speech__text">${dialog_text}</p>
            </div>
        </div>
    `;


    return {        
        0: speech_inner_0,
        1: speech_inner_1
    }[dialog_style]
}




$(document).on(":passagestart", function() {
    $(document).ready(function(){
        $(".speech__character-image").on("error", (e) => {imgError(e.target)});
    });
});

function imgError(image) {
    const path_full = $(image).attr('src');
    const path_non_format = path_full.split(".")[0];
    const old_format = path_full.split(".")[1];
    // const new_format = 'webp';
    const formats_list = ['png', 'jpg', 'webp', 'gif'];
    const formats_list_new_format_index = formats_list.indexOf(old_format);
    const formats_list_new_format_next_index = formats_list_new_format_index + 1;
    const new_format = formats_list[formats_list_new_format_next_index];

    if (formats_list_new_format_next_index < formats_list.length) {
        if (new_format != old_format && formats_list_new_format_next_index ) {
            image.src = `${path_non_format}.${new_format}`;
        }    
    }

    return false;
}


// function drawPageDialog() {
//     $.each($('.speech'), function (index, speech_block) {   
//         const prop_character = $(speech_block).data('character'); 
//         const posture = $(speech_block).data('posture');
//         const text_idn = $(speech_block).data('text');
//         const character_name_specific = $(speech_block).data('specname');

//         const is_player = (prop_character == 'player'.toLowerCase());
//         const character = (is_player) ? 
//             State.variables.characters[State.variables.player.id_name] : 
//             State.variables.characters[prop_character] ?? {};
//         const character_idn = character.id_name ?? prop_character;
//         const character_name_specific_localized = (character_name_specific) ? getLocalizedText(`characters_${character_name_specific}_name`) : false;
//         const character_name = (!character_name_specific) ? getCharacterName(character_idn) : character_name_specific_localized; 

//         const dialog_text = getLocalizedText(text_idn);

//         const picture_path = (!character.enemy) ? `media/characters/${character_idn}/${posture}` : `media/characters/_kind/${character.kind}`;
//         const picture_path_default = `media/characters/default`;

//         function drawSpeechBlock(format, default_picture=false) {
//             const dialog_style = State.variables.settings.dialog_style; 
//             const picture_source = (!default_picture) ? `${picture_path}.${format}` : `${picture_path_default}.${format}`;
            
//             const speech_inner_0 = `
//                 <div class="speech__container speech-style--0"> 
//                     <div>
//                         <p class="speech__image-placeholder"></p>
//                         <img src="${picture_source}" class="speech__character-image">
//                     </div>
//                     <div style="width: 100%">
//                         <p class="speech__name ${character_idn}">${character_name}</p>
//                         <hr>
//                         <p>${dialog_text}</p>
//                     </div>
//                 </div>
//             `;

//             const speech_inner_1 = `            
//                 <div class="speech__container  speech-style--1">
//                     <div>
//                         <p class="speech__image-placeholder"></p>
//                         <img src="${picture_source}" class="speech__character-image">
//                     </div>
//                     <div>
//                         <p class="speech__name ${character_idn}">${character_name}</p>
//                         <hr class="speech__line">
//                         <p class="speech__text">${dialog_text}</p>
//                     </div>
//                 </div>
//             `;

//             if (dialog_style == 0) $(speech_block).wiki( nobr(speech_inner_0));
//             if (dialog_style == 1) $(speech_block).wiki( nobr(speech_inner_1));
//         }

//         function checkPicture(path, arrayFormat) {                     
//             const cur_format = arrayFormat[0];
//             arrayFormat.shift();

//             const done = () => drawSpeechBlock(cur_format)
//             const fail = () => {
//                 if (arrayFormat.length) {
//                     checkPicture(path, arrayFormat);
//                 } else {
//                     drawSpeechBlock('png', true);
//                 }
//             };

//             checkImageExist(path, done, fail, cur_format);  
//         }

//         function checkImageExist(path, done, fail, format) {
//             const img = new Image();
//             img.src = `${path}.${format}`;
//             img.onload = done; 
//             img.onerror = fail;
//         }

//         const arrayFormat = ['jpg', 'png', 'webp', 'svg', 'gif'];
//         checkPicture(picture_path, arrayFormat);
//     });
// };







setup.checkPageText = function () {
    $(document).ready(function(){
        const hasText = (document.getElementsByClassName('text').length) ? true : false;
        if (hasText) drawPageText();

        const hasSystemText = (document.getElementsByClassName('passage-text-system').length) ? true : false;
        if (hasSystemText) drawPageSystemText();
    });
};

function drawPageText() {
    $.each($('.text'), function (index, text_block) { 
        const text_idn = $(text_block).data('string');     
        const text = getLocalizedText(text_idn);

        $(text_block).wiki(text);
    });
};


function drawPageSystemText() {
    $.each($('.passage-text-system'), function (index, text_block) { 
        const text_list = $(text_block).data('list');     
        const text_idn = $(text_block).data('string');     
        const text = getLocalizedSystemText(text_list, text_idn);

        $(text_block).html(text);
    });
};

/* twine-user-script #78: "passage_sketch.js" */



State.variables.temp.cur_sketch = 'sketch_warning';

$(document).on(":passagedisplay", function () {

    const custom_location = State.variables.temp.custom_location;
    setPreSketchPassage();
    if (passage() == "Uni_Sketch") {
        displaySketch();
    } else if ( (passage() == "Uni_Location" || passage() == "Uni_Sketch") && custom_location) {
        displaySketch(custom_location);
    } else if (passage() == "Talk_Menu") {
        const character_idn = State.variables.temp.cur_speaker;
        const character_sketch_idn = getSketchPersonalIdn("Talk_Menu", character_idn);
        State.variables.temp.cur_sketch = character_sketch_idn;
        
        displaySketch();
    } else if (passage() == "Mirror_Room") {
        const character_sketch_idn = getSketchPersonalIdn("Mirror_Room");
        State.variables.temp.cur_sketch = character_sketch_idn;

        displaySketch();
    }
});

function setPreSketchPassage() {
    const location_passages = Story.lookupWith(pas => { if (!pas.tags.includes("noreturn")) return pas.tags; });
    const location_list = location_passages.map(passage => passage.title);
    const restricted_passages = ["Uni_Location", 'Uni_Sketch'];
    const passage_list_unskatched = State.passages.filter(passage => (location_list.includes(passage) && !restricted_passages.includes(passage)));

    State.variables.temp.pre_sketch_passage = passage_list_unskatched.at(-1); 
}


function displaySketch(custom_location = false) {
    refreshSketches();

    const sketch_idn = (custom_location) ? State.variables.lists.custom_locations[custom_location]['sketch'] : State.variables.temp.cur_sketch;
    const cur_sketch = State.variables.sketches[sketch_idn];
    try {
        const cur_page_idn = State.variables.temp.cur_page ?? Object.keys(cur_sketch.pages)[0]; // get necessary page id_name (eg., string - "page_1")
        const cur_page_id = cur_page_idn.split("_").pop();      // (eg., integer - 1 )
        const cur_page = cur_sketch.pages[cur_page_idn];


        if (cur_sketch) addSketchParams(cur_page, cur_sketch.id_name, cur_page_id);

        const temp_task_sketch_array = [State.variables.temp.cur_task_sketch]; // function accepts array only
        reUpdateBroadcastTask(temp_task_sketch_array);
    } catch (err) {
        console.error(`Error has occurred during displaySketch(), sketch is not found - ${(typeof cur_sketch == "undefined")}, sketch_idn - ${sketch_idn}`);
        alert(`Error has occurred during displaySketch(), sketch is not found - ${(typeof cur_sketch == "undefined")}, sketch_idn - ${sketch_idn} `);
        console.error(err);
    }
}



function addSketchParams(sketch_page, sketch_idn, page_id) {
    const sketch_passages_default = ["Uni_Location", 'Uni_Sketch'];
    const sketch_passages_personals = ["Talk_Menu", 'Mirror_Room'];

    const $sketch_container = sketch_passages_default.includes(passage())
        ? $("#sketch_container")
        : sketch_passages_personals.includes(passage())
            ? $(".talk-menu__personals")
            : '';

    let sketch_content = ``;
    $.each(sketch_page, function (element_key, element) {
        const cur_element_block = getSketchHtmlBlockByType(element, sketch_idn, page_id, element_key);
        const cur_element_block_indented = (element.injection || element.link_type) ? cur_element_block : cur_element_block + '<br>';
        if (isSketchElementConditionsPassed(element.conditions)) sketch_content += cur_element_block_indented;
    });

    $sketch_container.wiki(nobr(sketch_content));
}



function getSketchHtmlBlockByType(element, sketch_idn, page_id, element_key) {
    const element_text = `sk_${sketch_idn}_p_${page_id}_${element_key}_text`;

    // const speech_block = () => { return `<<speech '${element.character}' '${element_text}' '${element.posture}' '${(element.character_name_specific) ? element.character_name_specific : ''}'>>` }; 
    const speech_block = () => { return getSpeechBlock(element.character, element_text, element.posture, element.character_name_specific)  }; 

    const injection_block = () => { return element.injection };

    const text_block = () => { return `<<text '${element_text}' '${element.text_type}' >>` };

    const image_block = () => {
        const imgClass = (!element.img_style || element.img_style === 'default') ? "sketch__image" :
            (element.img_style === 'location') ? 'location-image' :
                (element.img_style === 'other') ? 'other__image' : '';

        const image = `
            <img 
                style="width: ${(!!element.width) ? `${element.width}px` : 'auto'}; height: ${(!!element.height) ? `${element.height}px` : 'auto'}" 
                class="${imgClass}" 
                src="media/sketches/${element.media_folder}/${element.media_file}" 
                alt="${element.media_file}" 
            />
        `;

        return nobr(image);
    };

    const video_block = () => {
        const video = `
            <video 
                style="width: ${(!!element.width) ? `${element.width}px` : 'auto'}; height: ${(!!element.height) ? `${element.height}px` : 'auto'}" 
                class="sketch__video" 
                src="media/sketches/${element.media_folder}/${element.media_file}" 
                alt="${element.media_file}" 
                autoplay loop muted
            />
        `;

        return nobr(video);
    };


    const choice_block = () => {
        const localized_text = getLocalizedText(element_text);
        const choice_link_content = getChoiceLinkContent(element, localized_text);

        return nobr(choice_link_content);
    }


    switch (element.type) {
        case 'speech':
            return speech_block();
        case 'injection':
            return injection_block();
        case 'text':
            return text_block();
        case 'image':
            return image_block();
        case 'video':
            return video_block();
        case 'choice':
            return choice_block();
        default:
            console.error(`No Sketch Type Match!!!`);
            alert(`No Sketch Type Match!!!`);
    }
}

function passQuestLinkInnerConditions(element) {
    const target_action = element.actions.find((action) => action.type === "start_quest");
    let cur_quest = null;

    if (target_action) {
        cur_quest = target_action.quest;
    } else {
        alert("No 'start_quest' action found.");
        console.error("No 'start_quest' action found.", element);
    }

    const passConditionQuestStatus = isPassQuestConditionActivationFlag(cur_quest);
    const passQuestStatusNotActivated = !(State.variables.quests[cur_quest]);

    const passQuestConditions = (passQuestStatusNotActivated && passConditionQuestStatus); 
    return passQuestConditions;
}



function getChoiceLinkContent(element, localized_text) {
    const temp = State.variables.temp;
    let next_location = '';
    if (element.move_to == 'passage') next_location = element.passage;
    if (element.move_to == 'page') next_location = "Uni_Sketch";
    if (element.move_to == 'sketch') next_location = "Uni_Sketch";
    if (next_location == 'pre_sketch_passage') next_location = temp.pre_sketch_passage;
    if (next_location == 'pre_talk_passage') {
        next_location = (temp.pre_sketch_passage == "Talk_Menu") ? temp.last_location_passage : temp.pre_sketch_passage
    }

    const next_page = (element.move_to == 'page') ? element.page_link : '';
    const next_sketch = (element.move_to == 'sketch') ? element.sketch_idn : '';
    const actions_json = JSON.stringify(element.actions) ?? '';     // To avoid undefined type errors

    let action_with_quest, quest_idn = '';
    if (element.actions) {
        action_with_quest = element.actions.find(action => action.quest !== undefined && action.task === undefined);
        quest_idn = action_with_quest ? action_with_quest.quest : undefined;
    }


    // Rework functions below for more correct approach of getting LinkContent()

    if (element.link_type == "quest") {
        const draw_quest_link = passQuestLinkInnerConditions(element);
        if (!draw_quest_link) return ``; // Stop the function from continuing and return empty string that will not be displayed
    }

    if (element.link_type == "personal_quest") {
        if (!elementHasSketchThatHasAvailableQuests(element)) {
            return ''; // Return empty string to the whole function
        }
    }

    const is_deadend_seen = (element.link_type == "dead_end") ? isDeadEndLinkStyleSeen(next_sketch) : false;


    // href are included because of SEO thing

    const choice_link_default = `
        <a 
            href="${next_location}" 
            data-location="${next_location}" 
            class="link-internal choice-link choice-link--default" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
        >\
            <span> ${localized_text} </span>
        </a>\
    `;

    const choice_link_location = `
        <a         
            href="${next_location}" 
            data-location="${next_location}" 
            class="link-icon choice-link link-contents link-pixel-border link-underline link-internal" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
        >
            <div class="link-content-wrapper">
                <div class="link-content-container link-underline-container">   
                    <i class="ra ra-location"></i>                 
                    <span>${localized_text}</span>
                </div>
            </div>
        </a>
    `;

    const choice_link_quest = `
        <a 
            href="${next_location}" 
            class="quest-btn choice-link link-internal"
            data-thelper="quest_link"
            data-location="${next_location}" 
            data-quest="${quest_idn}" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
        >	
            ${getQuestMarkContent()}

            <span> ${localized_text} </span>
        </a>
    `;

    const choice_link_dead_end = `
        <a 
            href="${next_location}" 
            data-location="${next_location}" 
            class="link-internal choice-link ${(is_deadend_seen) ? 'deadend-link' : 'choice-link--default'}" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
            data-link-type="deadend"
            ${(is_deadend_seen) ? 'data-thelper="dead_end"' : '' }
        >\
            <span> ${localized_text} </span>
            ${(is_deadend_seen) ? '<img src="media/icons/sketch/deadend.png">' : '' }
        </a>\
    `;

    const choice_link_personal = `
        <a 
            href="${next_location}" 
            data-location="${next_location}" 
            class="link-internal choice-link chat-link personal-chat-link" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
            data-thelper="talk__personal_question"
        >\
            <img class="chat-link__img" src="media/icons/talk_menu/personal.png" >
            <span>${localized_text}</span>
        </a>\
    `;

    const choice_link_personal_quest = `
        <a 
            href="${next_location}" 
            data-location="${next_location}" 
            class="link-internal choice-link chat-link personal-chat-link personal_quest-link" 
            data-actions='${actions_json}'
            data-page="${next_page}"
            data-sketch="${next_sketch}"
            data-thelper="talk__personal_question"
        >\
            <img class="chat-link__img" src="media/icons/talk_menu/personal_quest.png" >
            <span>${localized_text}</span>      
            ${getQuestMarkContent()}
        </a>\
    `;

    return {
        default: choice_link_default,
        location: choice_link_location,
        quest: choice_link_quest,
        dead_end: choice_link_dead_end,
        personal: choice_link_personal,
        personal_quest: choice_link_personal_quest,
        // fight: choice_link_fight,
        // danger: choice_link_danger,
        // end_conversation: choice_link_danger
    }[element.link_type]
}


function addChoiceLinkListener() {
    $('body').on('click', '.choice-link', function (e) {
        e.preventDefault(); //to stop from executing 'href' 

        const location = $(this).data('location');
        const actions = $(this).data('actions');
        const page = $(this).data('page');
        const next_sketch = $(this).data('sketch');
        const custom_location = State.variables.temp.custom_location;
        const sketch_dialog = State.variables.temp.sketch_dialog; // for dialogs in Talk_Menu and test     
        const is_deadend = ($(this).data('link-type') == 'deadend');
        

        if (is_deadend) {
            const someMetadata = {"deadend_sketch": next_sketch}; // workaround to pass data to save file
            State.variables.temp.dead_end = true; // to go to 'deadend' interface mode 
             
            Save.autosave.save(`Autosave_1`, someMetadata);
        }

        if (!page) State.variables.temp.cur_page = "page_1";

        if (actions) $.each(actions, function (index, action) { executeActionByType(action) });

        if (next_sketch) State.variables.temp.cur_sketch = next_sketch;

        if (!custom_location) {
            if (page) State.variables.temp.cur_page = page;

            if (!page && !sketch_dialog && !next_sketch) {
                if (State.variables.temp.cur_task_sketch) {

                    const task_idn = State.variables.temp.cur_task_sketch;
                    const cur_task = getTaskByIdn(task_idn);

                    try {
                        setup.tasks_broadcast[cur_task.id_name](cur_task);
                    } catch (err) {
                        alert(`Error has occurred during addChoiceLinkListener broadcasting`);
                        console.error(err);
                    }
                }
            }
        }

        moveToLocation(location);
    });
}


function isDeadEndLinkStyleSeen(deadend_sketch) {
    const deadends_seen = State.variables.record_lists.deadends_seen;
    const is_cur_deadend_seen = deadends_seen.includes(deadend_sketch);

    return is_cur_deadend_seen
}


function isSketchElementConditionsPassed(conditions = []) {
    const result = conditions.every((condition) => { return checkCondition(condition) });
    return result;
}

function checkCondition(condition) {
    switch (condition.type) {
        case 'check_param':
            return passConditionCheckParam(condition);
        case 'check_flag':
            return passConditionCheckFlag(condition);
        case 'in_party':
            return passConditionInParty(condition);
        case 'on_location':
            return passConditionOnLocation(condition);
        case 'timeline':
            return passConditionTimeline(condition);
        case 'has_item_idn':
            return passConditionHasItemIdn(condition);
        case 'has_item_class':
            return passConditionHasItemClass(condition);
        case 'time_countdown':
            return passConditionTimeCountdown(condition);
        case 'check_quest_status':
            return passCheckQuestStatus(condition);
        case 'check_task_status':
            return passCheckTaskStatus(condition);
        case 'check_task_counter':
            return passCheckTaskCounter(condition);
        default:
            console.error(`No Condition Type Match!!! [${condition.type}]`);
            alert(`No Condition Type Match!!! [${condition.type}]`);
    }


    function passConditionCheckParam(condition) {
        const character_idn = (condition.character == 'player') ? State.variables.player.id_name : condition.character;

        let param_value = State.variables.characters[character_idn][condition.param];
        if (condition.relation) param_value = State.variables.characters[character_idn]['relations'][condition.relation];
        if (condition.battle) param_value = State.variables.characters[character_idn]['battle'][condition.battle];

        return {
            greater: param_value > condition.value,
            less: param_value < condition.value,
            equal: param_value == condition.value,
            greater_equal: param_value >= condition.value,
            less_equal: param_value <= condition.value
        }[condition.comparatives]
    }

    function passConditionCheckFlag(condition) {
        const flag_value = State.variables.flags[condition.flag] ?? 0;

        return {
            greater: flag_value > condition.value,
            less: flag_value < condition.value,
            equal: flag_value == condition.value,
            greater_equal: flag_value >= condition.value,
            less_equal: flag_value <= condition.value
        }[condition.comparatives]
    }

    function passConditionInParty(condition) {
        const result = (condition.character == 'player') ? true : isInParty(condition.character);
        return result;
    }

    function passConditionOnLocation(condition) {
        let character_location = getCharacterCurrentScheduledLocation(condition.character);
        if ((condition.character == 'player') || (isInParty(condition.character))) character_location = getPlayerLocation();
        const isOnConditionLocation = (character_location == condition.location);

        return isOnConditionLocation;
    }

    function passConditionTimeline(condition) {
        const passMonth = isInTimeFrame({ start: condition.month_start, end: condition.month_end }, 'month_id');
        const passDayOfWeek = isInTimeFrame({ start: condition.day_of_week_start, end: condition.day_of_week_end }, 'day_of_week_id');
        const passHour = isInTimeFrame({ start: condition.hour_start, end: condition.hour_end }, 'hour');

        const passTimeline = (passMonth && passDayOfWeek && passHour);
        return passTimeline;
    }

    function passConditionHasItemIdn(condition) {
        const result = isInInventoryIdn(condition.item_idn, condition.character);
        return result;
    }

    function passConditionHasItemClass(condition) {
        const result = isInInventoryClass(condition.item_class, condition.character);
        return result;
    }

    function passConditionTimeCountdown(condition) {        
        const countdown_idn = condition.input;

        return passCountdown(countdown_idn);
    }

    function passCheckQuestStatus(condition) {
        const cur_quest = getQuestByIdn(condition.quest) ?? false;
        const quest_status = (cur_quest) ? cur_quest.status : 0;

        if ((getQuestByIdn(condition.quest) == "undefined") && (State.variables.quest_list[condition.quest] == "undefined")) {
            console.error(`Quest "${condition.quest}" does not exist`);
            alert(`Quest "${condition.quest}" does not exist`);
        }

        return {
            greater: quest_status > condition.value,
            less: quest_status < condition.value,
            equal: quest_status == condition.value,
            greater_equal: quest_status >= condition.value,
            less_equal: quest_status <= condition.value
        }[condition.comparatives]
    }

    function passCheckTaskStatus(condition) {
        const cur_task = getTaskByIdn(condition.task);
        const task_status = cur_task.status ?? 0; 

        console.log(condition, cur_task)

        return {
            greater: task_status > condition.value,
            less: task_status < condition.value,
            equal: task_status == condition.value,
            greater_equal: task_status >= condition.value,
            less_equal: task_status <= condition.value
        }[condition.comparatives]
    }

    function passCheckTaskCounter(condition) {
        const cur_task = getTaskByIdn(condition.task);
        const task_counter = cur_task.counter;

        return {
            greater: task_counter > condition.value,
            less: task_counter < condition.value,
            equal: task_counter == condition.value,
            greater_equal: task_counter >= condition.value,
            less_equal: task_counter <= condition.value
        }[condition.comparatives]
    }

    function passCheckQuestStatus(condition) {
        const cur_quest = getQuestByIdn(condition.quest) ?? false;
        const quest_status = (cur_quest) ? cur_quest.status : 0;

        if ((getQuestByIdn(condition.quest) == "undefined") && (State.variables.quest_list[condition.quest] == "undefined")) {
            console.error(`Quest "${condition.quest}" does not exist`);
            alert(`Quest "${condition.quest}" does not exist`);
        }

        return {
            greater: quest_status > condition.value,
            less: quest_status < condition.value,
            equal: quest_status == condition.value,
            greater_equal: quest_status >= condition.value,
            less_equal: quest_status <= condition.value
        }[condition.comparatives]
    }
}

function isInInventoryIdn(item_idn, character_idn = 'player') {
    const player = State.variables.player;
    const characters = State.variables.characters;
    const inventory = (character_idn == 'player') ? player.inventory : characters[character_idn].inventory;
    const { in_use, ...inventory_type_lists } = inventory;

    let result = false;

    $.each(inventory_type_lists, function (item_type_index, item_type) {
        const item_type_has_item = result = item_type.some(item => item.id_name == item_idn);
        return !item_type_has_item;         // to break $.each if item is found
    });

    return result;
}


function isInInventoryClass(item_class, character_idn = 'player') {
    const player = State.variables.player;
    const characters = State.variables.characters;
    const inventory = (character_idn == 'player') ? player.inventory : characters[character_idn].inventory;
    const { in_use, ...inventory_type_lists } = inventory;

    let result = false;

    $.each(inventory_type_lists, function (item_type_index, item_type) {
        const item_type_has_item = result = item_type.some(item => {
            return item.category == item_class || item.sub_category == item_class
        });
        return !item_type_has_item;         // to break $.each if item is found
    });

    return result;
}



function executeActionByType(action) {

    switch (action.type) {
        case 'change_param':
            executeActionChangeParam(action);
            break;
        case 'add_time':
            executeActionAddTime(action);
            break;
        case 'set_time':
            executeActionSetTime(action);
            break;
        case 'change_flag':
            executeActionChangeFlag(action);
            break;
        case 'change_schedule':
            executeActionChangeSchedule(action);
            break;
        case 'change_schedule_daily':
            executeActionChangeScheduleDaily(action);
            break;
        case 'change_schedule_current_hour':
            executeActionChangeScheduleCurrentHour(action);
            break;
        case 'add_inventory_idn':
            executeActionAddInventoryByIdn(action);
            break;
        case 'add_inventory_class':
            executeActionAddInventoryByClass(action);
            break;
        case 'remove_inventory_idn':
            executeActionRemoveInventoryByIdn(action);
            break;
        case 'add_to_party':
            executeActionAddToParty(action);
            break;
        case 'remove_from_party':
            executeActionRemoveFromParty(action);
            break;
        case 'start_quest':
            executeActionStartQuest(action);
            break;
        case 'fail_task':
            executeActionFailTask(action);
            break;
        case 'finish_task':
            executeActionFinishTask(action);
            break;
        case 'time_countdown':
            executeActionTimeCountdown(action);
            break;
        case 'injection_action':
            executeActionInjection(action);
            break;
        default:
            console.error(`No Action Type Match!!! [${action.type}]`);
            alert(`No Action Type Match!!! [${action.type}]`);
    }


    function executeActionChangeParam(action) {
        const character_idn = (action.character == 'player') ? State.variables.player.id_name : action.character;

        if (!action.change_type) {
            console.error('Action with error: ', action);
            throw new Error(`Action does not have change type!`);
        }

        const targetObject = action.relation ? State.variables.characters[character_idn]['relations'] :
            action.battle ? State.variables.characters[character_idn]['battle'] :
                State.variables.characters[character_idn];


        switch (action.change_type) {
            case "set":
                targetObject[action.relation || action.battle || action.param] = Number(action.value);
                break;
            case "add":
                targetObject[action.relation || action.battle || action.param] += Number(action.value);
                break;
            case "reduce":
                targetObject[action.relation || action.battle || action.param] -= Number(action.value);
                break;
            default:
                console.error(`"${action.change_type}" change type does not exist! Please correct!`);
                throw new Error("Invalid change type!");
        }

        updatePlayerByCharacter();
    }

    function executeActionAddTime(action) {
        const time = State.variables.time;
        time.minute += Number(action.minute);
        time.hour += Number(action.hour);
        time.month_day += Number(action.day);
    }

    function executeActionSetTime(action) {
        const time = State.variables.time;
        time.hour = Number(action.hour);
        time.minute = Number(action.minute);
    }

    function executeActionChangeFlag(action) {
        State.variables.flags[action.flag] = action.value;
    }

    function executeActionChangeSchedule(action) {
        const schedule_update_idn = action.schedule_idn;
        if (!validateScheduleUpdateIdn(schedule_update_idn)) {
            return;
        }
        State.variables.record_lists.schedule_update_added.push(schedule_update_idn);
    }

    function executeActionChangeScheduleDaily(action) {
        const schedule_update_idn = action.schedule_idn; 
        if (!validateScheduleUpdateIdn(schedule_update_idn)) {
            return;
        }
        const schedule_update_list = [schedule_update_idn]; // function require array
        updateDailySchedule(schedule_update_list);
    }

    function executeActionChangeScheduleCurrentHour(action) {
        const character_idn = action.character;
        const assignment_idn = action.assignment;
        const assignment = State.variables.lists.assignments[assignment_idn];
        const random_location_index = random(0, assignment.locations.length - 1);

        const cur_hour = State.variables.time.hour;
        const character_daily_schedule = State.variables.temp?.schedule_day[character_idn];

        if (!character_daily_schedule) {
            console.error(`No daily schedule for ${character_idn}!`)
            alert(`No daily schedule for ${character_idn}!`)
        }

        const cur_period = character_daily_schedule.find(period => period.hours.includes(cur_hour.toString()));

        if (!cur_period) {
            console.error(`No schedule entry found for ${character_idn} at hour ${cur_hour}!`);
            alert(`No schedule entry found for ${character_idn} at hour ${cur_hour}!`);
            return;
        }

        Object.assign(cur_period, {
            location: assignment.locations[random_location_index],
            availability: assignment.availability ?? true,
            activity: assignment.activity
        });
    }


    function executeActionAddInventoryByIdn(action) {
        addInventoryItemByIdn(action.character, action.item_idn);
        updatePlayerByCharacter();
    }



    function executeActionAddInventoryByClass(action) {
        const player = State.variables.player;
        const characters = State.variables.characters;
        const inventory = (action.character == 'player') ? characters[player.id_name].inventory : characters[action.character].inventory;
        const item_classname = classnaming(action.item_class);
        const new_item = Reflect.construct(eval(item_classname), [{}]);

        inventory[new_item.type].push(new_item);

        updatePlayerByCharacter();
    }

    function executeActionRemoveInventoryByIdn(action) {
        const player = State.variables.player;
        const characters = State.variables.characters;
        const inventory = (action.character == 'player') ? characters[player.id_name].inventory : characters[action.character].inventory;
        const { in_use, ...inventory_type_lists } = inventory;

        const requsted_items = getListOfAnyDepth(inventory_type_lists, 'id_name', action.item_idn);
        const item = requsted_items[0];

        if (item) {
            inventory[item.type] = inventory[item.type].filter(item => item.id_name !== action.item_idn);
        } else {
            console.error(`No Matched Item Had Been Removed!!! [ID: ${action.item_idn}]`);
            alert(`No Matched Item Had Been Removed!!! [ID: ${action.item_idn}]`);
        }

        updatePlayerByCharacter();
    }

    function executeActionAddToParty(action) {
        if (isInParty(action.character)) addToParty(action.character);
    }

    function executeActionRemoveFromParty(action) {
        if (isInParty(action.character)) removeFromParty(action.character);
    }

    function executeActionStartQuest(action) {
        activateQuest(action.quest);
    }

    function executeActionFailTask(action) {
        const task = getTaskByIdn(action.task);
        if (task.status == 1) failTask(action.task)
    }

    function executeActionFinishTask(action) {
        const task = getTaskByIdn(action.task);
        if (task.status == 1) finishTask(action.task)
    }

    function executeActionTimeCountdown(action) {
        const countdown_idn = action.input;
        const countdown_hours = action.value;

        createCountdown(countdown_idn, countdown_hours);
    }

    function executeActionInjection(action) {
        $('#passages').wiki(action.injection_action);
    }
}


function addInventoryItemByIdn(character_idn = "player", item_idn) {
    const item_params_json = State.variables.items[item_idn];

    if (item_params_json) {
        const player = State.variables.player;
        const characters = State.variables.characters;
        const inventory = (character_idn == 'player') ? characters[player.id_name].inventory : characters[character_idn].inventory;
        const item_classname = (item_params_json.sub_category) ? classnaming(item_params_json.sub_category) : classnaming(item_params_json.category);
        const cloned_item_params = Object.assign({}, item_params_json);        // deep cloning for not to change item params in json
        const new_item = Reflect.construct(eval(item_classname), [cloned_item_params]);

        inventory[new_item.type].push(new_item);
    } else {
        console.error(`No Matched Item Had Been Created!!! [ID: ${item_idn}]`);
        alert(`No Matched Item Had Been Created!!! [ID: ${item_idn}]`);
    }
}
/* twine-user-script #79: "passage_start.js" */

// --- Index passage refresh ---
// So that all javascript features would be initialized (in case someone go back and forth though history and reload page)
$(document).on(":passagestart", function (event) {
	if (passage() == 'index') {	
        UIBar.stow(); // hide left sidebar	

        (function() { 
            if (window.localStorage) {
                if (!localStorage.getItem('firstLoad')) {
                    localStorage['firstLoad'] = true;
                    reloadPage();
                }  
            } else {
                localStorage.removeItem('firstLoad');
            }
        })();
	} else {        
        if (localStorage.getItem('firstLoad')) {
            const is_index_passage_in_history = Object.values(State.history).some(state => state.title === 'index');
            if (!is_index_passage_in_history)  localStorage.removeItem('firstLoad');
        }
    }
    
});


$(document).on(":passagestart", function () {
    const is_deadend = State.variables.temp.dead_end;
    const deadend_interface = {
        menu_story: {
            inventory: 0,
            questlog: 0,
            party: 0,
            help: 1,
            info: 1
        },
        menu_core: {
            saves: 1,
            settings: 0,
            restart: 1,
            share: 1
        },
        history: {
            backward: 0,
            forward: 0
        }
    }

    if (is_deadend) State.variables.settings.interface = { ...State.variables.settings.interface, ...deadend_interface }; 
});

 
// --- Return For Menu Pages ---
$(document).on(":passagestart", function () {
	/* Make sure the current passage doesn't have a "noreturn" tag. */
	if (!tags().includes("noreturn")) {
		/* If it doesn't, then set $return to the current passage name. */
		State.variables.return_passage = passage();
	}
    
    const mirror_locations = [ "Home_Bedroom", "Forest_Hut_Witch_Bedroom"];
    if (mirror_locations.includes( passage() )) {
        State.variables.temp.mirror_return_passage = passage();
    }

    if (tags().includes("Location")) {
		State.variables.temp.last_location_passage = getPlayerLocation();
        
        if (passage() != 'Talk_Menu') drawLocationImage(); // Autoshowing location bg images
	}

    

    if (!tags().includes("menu_tab")) State.variables.temp.menu_tab = 1;
});



$(document).on(":passagedisplay", function () {    
    updateInterfaceDisplay();
});



$(document).on(":passagedisplay", function () {
    updateCharacterByPlayer();
});


$(document).on(":passagestart", function () { // It should be exactly passagestart for any time updates 
    updateHours();
    updateDays();
    updateMonths();
    updateDayOfWeek();

    const hasCountdowns = (Object.values(State.variables.temp.countdowns).length);
    if (hasCountdowns) setup.updateBroadcastCountdown();
});





$(document).on(":passagedisplay", function () {
    const cur_speaker = State.variables.temp.cur_speaker;
    const cur_passage = getCurrentLocation();
    let passage_tasks = [];
    
    $.each(State.variables.quests, function (index, quest) {   
        if (quest.status == 1) {
            const passage_task = quest.states[quest.state].filter(function (cur_task) {
                const passTaskLocationCondition = (cur_task.location == cur_passage);
                const passTaskLocationCharacterCondition = (cur_passage == 'Talk_Menu') ? (cur_speaker == cur_task.location_character) : true; // only for task in 'Talk_Menu'
                const passTaskStatusCondition = (cur_task.status == 1);

                const passTaskConditions = ( passTaskLocationCondition && passTaskLocationCharacterCondition && passTaskStatusCondition );

                return  passTaskConditions;
            });            

            if (passage_task) {
                passage_tasks = passage_tasks.concat(passage_task); 
            }   
        }
    });

    if (passage_tasks.length) {
        $.each(passage_tasks, function (index, cur_task) { 
            if (cur_task.status == 1) {
                if (cur_task.no_start_link) {      
                    runTask(cur_task);     
                    setup.updateBroadcastTask(cur_task);      
                } else {
                    addTaskLink(cur_task); 
                    setup.updateBroadcastTask(cur_task);    
                }
            }
        });  
        
        addTaskLinkListener();      
    }
});



// Add Links to Start Quests
$(document).on(":passagedisplay", function () {
    const cur_speaker = State.variables.temp.cur_speaker;
    const cur_passage = getCurrentLocation();

    $.each(State.variables.quest_list, function (index, quest) { 
        const quest_start_location = quest.activation_flag.location;   
        const quest_start_character = quest.activation_flag.location_character;   
        
        const passQuestLocationCondition = (quest_start_location == cur_passage);
        if (passQuestLocationCondition) {
            const passQuestLocationCharacterCondition = (cur_passage == 'Talk_Menu') ? (cur_speaker == quest_start_character) : true; // only for quest in 'Talk_Menu'
            const passQuestStatusNotActivated = !(State.variables.quests[quest.id_name]);
            
            // Temporary condition until set conditions for quests
            const passConditionQuestStatus = isPassQuestConditionActivationFlag(quest.id_name);    

            const passQuestConditions = ( passQuestLocationCondition && passQuestLocationCharacterCondition && passQuestStatusNotActivated && passConditionQuestStatus );
            const quest_start_text = getLocalizedText(`quests_${quest.id_name}_start_text`);
            
            // Temporary part for 'start_sketch' in quests
            if (quest.start_sketch) State.variables.temp.cur_sketch = quest.start_sketch;
            const quest_location = (quest.start_sketch) ? 'Uni_Sketch' : cur_passage;


            if (passQuestConditions) addQuestLink(quest.id_name, quest_location, quest_start_text);   


            // if (passQuestStatusNotActivated && !quest_start_location) {    
            //     console.error(`No location for activation of quest: '${quest.id_name}'`);
            //     alert(`No location for activation of quest: '${quest.id_name}'`);
            // }
        }
    });
    
});





// Check escortFailQuest
$(document).on(":passagedisplay", function () {
    const escort_tasks = State.variables.temp.cur_tasks_escort;
    $.each(escort_tasks, function (index, escort_task) {        
        const cur_task = getTaskByIdn(escort_task);
        const task_character = State.variables.characters[cur_task.subject];

        if (task_character.health <= 0) {
            failTask(cur_task.id_name);
        }
    })
})



// Update Classes inner functions. Eg., static_counter. (Otherwise they are refreshed on page reload).
// Should be called after all steps
// $(window).on('beforeunload',function() {
    // runClassesFunction('setClassCounter');
// });

// $(document).ready(function(){  
    // runClassesFunction('getClassCounter');
    // changePlayerName();
// });



addQuestLinkListener();
addChoiceLinkListener();
addEditorLinkListener();
addCharacterTalkLinkListener();
addPartyLinkListener();
addChatLinkListener();
addActivityLinkListener();




// Clear temp variables
$(document).on(":passagedisplay", function () {

    if ((passage() != "Uni_Store") && (!tags().includes("noreturn"))) { 
        if (State.variables.temp.cur_store)  delete State.variables.temp.cur_store;
    } 

    if (( !["Uni_Sketch", "Talk_Menu"].includes(passage()) )  && (!tags().includes("noreturn"))) { 
        if (State.variables.temp.cur_speaker)  delete State.variables.temp.cur_speaker;
    }  

    if (( !["Uni_Sketch", "Mirror_Room", "Talk_Menu"].includes(passage()) ) && (!tags().includes("noreturn"))) { 
        if (State.variables.temp.cur_sketch) delete State.variables.temp.cur_sketch;
    } 

    if ((passage() != "Uni_Sketch") && (!tags().includes("noreturn"))) { 
        if (State.variables.temp.cur_page) delete State.variables.temp.cur_page;
    } 

    if ((passage() != "Uni_Location") && (!tags().includes("noreturn"))) { 
        if (State.variables.temp.custom_location) delete State.variables.temp.custom_location;
    }  

    if ((passage() != "Uni_Sketch") && (passage() != "Uni_Location")) { 
        if (State.variables.temp.dead_end) delete State.variables.temp.dead_end;
    }  

});
/* twine-user-script #80: "passage_store.js" */

setup.showStore = function (cur_items, items_type, store_variable) {
    $(document).ready(function(){
        addStoreItems(cur_items, items_type, store_variable);
    });
};

function addStoreItems(cur_items, items_type, store_variable) {
    $.each(cur_items, function (cur_item_index, cur_item) {        
        addStoreItem(cur_item_index, cur_item, items_type);
    });
    addBuyAction(cur_items, items_type, store_variable);
}


function addStoreItem (cur_item_index, cur_item, items_type) {
    const $store = $(`.store_items-${items_type}`); 
    const player_lvl = State.variables.player.lvl;
    const rarety_list = State.variables.lists.rarity_list;
    const cur_item_rarity = rarety_list[cur_item.rarity_id];

    const item_name = getLocalizedItemName(cur_item);

    let store_item = ``;

    
    if (items_type == 'weapons') {

        store_item = `
            <div class="store_item">
                <div>
                    <img 
                        src="media/equipment/${cur_item.type}/${cur_item.category}/${cur_item.sub_category}.${'jpg'||'png'||'gif'||'webp'}" 
                        alt="${cur_item.sub_category}-image"
                        class="store-item__image"  
                        onerror="this.src = 'media/equipment/${cur_item.type}/${cur_item.category}/${cur_item.sub_category}.png'"
                    >
                    <p>${item_name}</p>
                </div>
                <p>Store price: ${cur_item.price}</p>                
                <p>Base Cost: ${cur_item.cost}</p>
                <p>rarity: <span class="${cur_item_rarity.toLowerCase()}"> ${cur_item_rarity}</p>
                <p>Description: ${cur_item.description}</p>    
            `;

        store_item +=       
            `<p>Level: <span class="${(cur_item.lvl > player_lvl) ? 'store-item__underlevel': ''}"> ${cur_item.lvl}</span> </p>      `; 

        store_item +=               
                `<p>[Attack: ${cur_item.battle.attack}, Length: ${cur_item.battle.length}, Weight: ${cur_item.battle.weight}]</p>            
                <p>[Can BE secondary weapon: ${cur_item.be_secondary}]</p>  
                <p>[Can be equipped WITH secondary weapon: ${cur_item.with_secondary}]</p>  
                <p id="store-item-buy-${items_type}-${cur_item_index}"></p>
            </div> 
        `;

        
    } else if (items_type == 'armor')  {

        store_item = `
            <div class="store_item">
                <div>
                    <img 
                        src="media/equipment/${cur_item.type}/${cur_item.category}/${cur_item.sub_category}.${'jpg'||'png'||'gif'||'webp'}" 
                        alt="${cur_item.sub_category}-image"
                        class="store-item__image"  
                        onerror="this.src = 'media/equipment/${cur_item.type}/${cur_item.category}/${cur_item.sub_category}.png'"
                    >
                    <p>${item_name}</p>
                </div>
                <p>Store price: ${cur_item.price}</p>                
                <p>Base Cost: ${cur_item.cost}</p>
                <p>rarity: <span class="${cur_item_rarity.toLowerCase()}"> ${cur_item_rarity}</p>
                <p>Description: ${cur_item.description}</p>    
            `;

        store_item +=       
            `<p>Level: <span class="${(cur_item.lvl > player_lvl) ? 'store-item__underlevel': ''}"> ${cur_item.lvl}</span> </p>      `; 

        store_item +=                    
                `<p>[Defence: ${cur_item.battle.defence}, magic_defence: ${cur_item.battle.magic_defence}, Weight: ${cur_item.battle.weight}]</p>   
                <p id="store-item-buy-${items_type}-${cur_item_index}"></p>
            </div>
        `;

    } else if (items_type == 'potions')  {
        store_item = ` 
            <div class="store_item">
                <div>
                    <img 
                        src="media/equipment/${cur_item.type}/${cur_item.category}.${'jpg'||'png'||'gif'||'webp'}" 
                        alt="${cur_item.category}-image"
                        class="store-item__image"  
                        onerror="this.src = 'media/equipment/${cur_item.type}/${cur_item.category}.png'"
                    >
                    <p>${item_name}</p>
                </div>
                <p>Store price: ${cur_item.price}</p>                
                <p>Base Cost: ${cur_item.cost}</p>
                <p>rarity: <span class="${cur_item_rarity.toLowerCase()}"> ${cur_item_rarity}</p>
                <p>Description: ${cur_item.description}</p>    
            `;

        store_item +=       
            `<p>Level: <span class="${(cur_item.lvl > player_lvl) ? 'store-item__underlevel': ''}"> ${cur_item.lvl}</span> </p>      `; 

        store_item +=             
                `<p>Weight: ${cur_item.weight} </p>       
            `;

        store_item += `<p>[ Effects:`; 

            for (let i=0; i<cur_item.effects.length; i++) {
                const cur_effect = cur_item.effects[i];

                store_item += `  ${cur_effect.effect} ${cur_effect.value} ;     `
            }

        store_item += ` ] </p>`; 

        store_item += `
                <p id="store-item-buy-${items_type}-${cur_item_index}"></p>
            </div>
        `;

    }

    $store.append(store_item);
}


function addBuyAction (cur_items, items_type, store_variable) {
    const cur_passage = passage();

    $.each(cur_items, function (cur_item_index, cur_item) {   
        const $buy_button = $(`#store-item-buy-${items_type}-${cur_item_index}`); 
        const item_name = getLocalizedItemName(cur_item);
        console.log(cur_item, item_name)

        
        let buy_link = `
            <<link "Buy ${item_name}" "${cur_passage}">>
                <<set $characters[$player.id_name].inventory.${items_type}.push($${store_variable}['${items_type}'][${cur_item_index}]) >>
                <<set $characters[$player.id_name].money -= $${store_variable}['${items_type}'][${cur_item_index}].price >>

                <<set $player =  $characters[$player.id_name];>>

                <<set $${store_variable}['${items_type}'].splice(${cur_item_index}, 1)  >>
            <</link>>
        `;
        

        // For fun :))
        if (cur_item.price > State.variables.money) {
            buy_link = `
            <<link "Buy ${item_name}" "${cur_passage}">>
                <<dialog "Not enough money">>
                    @@.speech;
                    <<run $dialog('morshu', "<p>Sorry "+$player.name+", you don't have enough money. </p> Come back when you're a little mmm richer.")>>
                    @@\
                    <<onclose>>
                        <<audio 'morshu' volume 1 play>>
                <</dialog>>
            <</link>>
            `;
        }
         
       // <<audio "morshu" play>>
        
        $buy_button.wiki(buy_link);                             // Is used to move code to sugarcube so it could work
    });
}


// Later on need to improve generation of items (less rare, at least one type of each, etc.) 
setup.generateStore = function (store_list, store_variable) {
    let store_items_result = {};                                // Result variable
    const store_types = Object.keys(store_list);                // Number of items types that store supports

    for (let i=0; i<store_types.length; i++) {                  // For each supported store type  
        let store_type_result = [];                             // Initialize list of items of current type for current store

        const store_type_key = Object.keys(store_list)[i];                          // Current store type naming ('weapon', 'armor', etc.)
        const store_type = store_list[store_type_key];
        const store_type_list = store_type.list;                                    // Current type list of available items for current store
        const store_type_list_length = store_type_list.length;        
        const store_type_amount = store_type.amount;                                 // Amount of items available for current type

        for (let j=0; j<store_type_amount; j++)   {                                 // Add random items of current type from available for current limited by allowed amount  
            let store_random_item_index = random(0, store_type_list_length - 1);        
            store_type_result.push(store_type_list[store_random_item_index]);            
        }            
            
        store_items_result[store_type_key] = [];                                    // Initialize list for current type in result variable

        const rarity_list = State.variables.lists.rarity_list;                            // Get rarety list from global values of SugarCube
        const rarity_list_keys = Object.keys(rarity_list);
        
        const rarity_list_type_limit_upper = store_type.rarity_level_max; 
        const rarity_list_type_value_upper = rarity_list_keys.find(key => rarity_list[key] === rarity_list_type_limit_upper) ?? rarity_list_keys.at(-3);     // Get index of rarty value to which need to limit
        
        const rarity_list_type_limit_lower = store_type.rarity_level_min;    
        const rarity_list_type_value_lower = rarity_list_keys.find(key => rarity_list[key] === rarity_list_type_limit_lower) ?? rarity_list_keys.at(3);     // Get index of rarty value to which need to limit
        
        for (let j=0; j<store_type_result.length; j++) {                                // For current store type       
            const store_random_rarity_index = random(rarity_list_type_value_lower, rarity_list_type_value_upper);       
            const store_random_rarity_value = rarity_list[store_random_rarity_index]; 
            // const store_random_rarity_args = {rarity: store_random_rarity_value};       // Set random rarety value as an argument for item class
            const store_random_rarity_args = {rarity_id: store_random_rarity_index};       // Set random rarety value as an argument for item class

            const cur_classname = classnaming(store_type_result[j].item_class);
            let store_item = Reflect.construct(eval(cur_classname), [store_random_rarity_args]);        // Creating item as an object of class using 'reflection' from javascript
                                                                                                                    // 'eval' is necessary to put class(function) in constructor, not a string!

            //   NEED TO IMPROVE PRICING SYSTEM SO IT WOULD BE MORE FLEXIBLE
            let cur_item_price = store_type_result[j].price;                              // Add price to the item from store_list
            if (store_type.discount_percent) {                                            // Multipy price on percents from store default discoun values
                cur_item_price = cur_item_price*(1 + store_type.discount_percent/100).toFixed(2);
            }

            store_item.price = cur_item_price;

            // console.log(store_item)

            store_items_result[store_type_key].push(store_item);                        // Add resulted item to current type's list in result variable
        }
    }

    State.variables[`${store_variable}`] = store_items_result;
};



// Later on need to improve generation of items (less rare, at least one type of each, etc.) 
setup.updateStore = function (store_list_initial, store_list_update, store_variable) {
    const update_store_types = Object.keys(store_list_update);  

    for (let i=0; i<update_store_types.length; i++) {                                   // For each store type from update input  
        const store_update_type_key = Object.keys(store_list_update)[i];                // Current store type naming ('weapon', 'armor', etc.)
        const store_type_update = store_list_update[store_update_type_key];             

        store_list_initial[store_update_type_key] ??= {};                               // Set empty object if previously there was no such type for current store 

        const store_type_list = store_list_initial[store_update_type_key].list ?? [];   // Set empty array if previously there was no such type for current store 
        let updated_store_type_list = store_type_list;                                  // Initialize variable for new list of current type
        
// Probably rework into a function
        const store_update_type_add_edit = store_list_update[store_update_type_key].add_edit;       // List of items to add or change

        if (store_update_type_add_edit) {        
            const store_update_type_add_edit_length = store_update_type_add_edit.length;

            for (let j=0; j<store_update_type_add_edit_length; j++) {  
                const cur_item = store_update_type_add_edit[j];
                updated_store_type_list = updated_store_type_list.filter(item => item.name != cur_item.name);
                updated_store_type_list.push(cur_item);
            }

        }


// Probably rework into a function  
        const store_update_type_remove = store_list_update[store_update_type_key].remove;           // List of items to remove

        if (store_update_type_remove) {
            const store_update_type_remove_length = store_update_type_remove.length;

            for (let j=0; j<store_update_type_remove_length; j++) {  
                const cur_item = store_update_type_remove[j];
                updated_store_type_list = updated_store_type_list.filter(item => item.name != cur_item.name);
            }

        }
// Probably rework to creating a new variable and moving all changes there instead of using the initial one
        store_list_initial[store_update_type_key].list = updated_store_type_list;                   // Change store type list to an updated one


        const store_type_params = ['rarity_level_min', 'rarity_level_max', 'amount', 'discount_percent', 'store_days'];            // List of store params 
                                                                                                    // If new params will appear for store lists, they need to be added to that list manualy.

        $.each(store_type_params, function (cur_param_index, cur_param ) {                          // Check if updated input change some params value in store type params set new value to that param
            if (store_type_update[cur_param]) {
                store_list_initial[store_update_type_key][cur_param] = store_type_update[cur_param];
            }
        });                
    }

    setup.generateStore(store_list_initial, store_variable);
};

/* twine-user-script #81: "popups.js" */


const popups_queue = [];


function showPopup(type, data={}) {
    const popup_set_interval_delay = 100;       // Frequency of popup call 
    let popup_set_interval_id = 0;              // To remove Interval and break checkPopup calls
    let delay_between_popups_timer = 0;

    const is_exist_popup_container = ($(".popup-container")[0] == null);

    if (is_exist_popup_container) {
        const popup_container_block = `<div class="popup-container"></div>`;
        $(document.body).append(popup_container_block);     // To show popups even if change passage 

        popup_set_interval_id = window.setInterval(
            checkPopup,
            popup_set_interval_delay
        );
    }

    popups_queue.push({type, data});


    function checkPopup() {
        const max_number_of_active_popups = 3;      // Additional restriction to limit number of displayed popups at the same time
        const delay_between_popups = 2000;
        const popup_stay_duration = 4000;           // Duration of popup fixed position (for user to read the text in it)
        const popup_transition_duration = 1000;     // Duration of popup block transition

        delay_between_popups_timer -= popup_set_interval_delay;
        if ((delay_between_popups_timer) < 0) {
            const popup_container = $(".popup-container");
            const number_of_active_popups = popup_container.children().length;

            if (popups_queue.length > 0) {
                if (number_of_active_popups < max_number_of_active_popups) {
                    delay_between_popups_timer = delay_between_popups;
                    const popup_type = popups_queue[0].type;
                    const popup_data = popups_queue[0].data;

                    createPopup(popup_type, popup_data);
                    activateThelpersListener();
                    animatePopup(popup_stay_duration, popup_transition_duration);
                    
                    popups_queue.shift();
                }
            } else if (number_of_active_popups == 0) {
                $(".popup-container").remove();
                window.clearInterval(popup_set_interval_id);
                delay_between_popups_timer = 0;
                popup_set_interval_id = 0;
            }
        }
    }
}

function createPopup(type, data) {
    const popup_text = getPopupText(type, data);
    const has_type = (popup_text != undefined);
    const text = (has_type) ? popup_text : "Popup type is not defined!!!" ;

    const popup_block = `
        <div class="popup ${(has_type) ? `popup--${type}` : ''}">
            <img class="popup-icon" src="media/icons/popup/${type}.png" alt="${type}" data-thelper="${'popup__'+type}" title="${'popup__'+type}">
            <p class="popup-text">${text}</p>
        </div>
    `;
    const popup_container = $(".popup-container");
    popup_container.append(popup_block);
    $( ".popup-container .popup-text" ).last().text(text);
}

async function animatePopup(stay_duration, transition_duration) {
    const popup_container = $(".popup-container");
    const opened_class = "popup--opened";
    const top_transition_duration = transition_duration / 2;
    const cur_popup = popup_container.children().last();

    cur_popup.css("transition-duration", `${transition_duration / 1000}s`);

    await new Promise((resolve) => {
        window.setTimeout(() => {
            cur_popup.addClass(opened_class);
            resolve();
        }, 100);        // if "0" popup block teleports in undefined cases
    });

    await new Promise((resolve) => {
        window.setTimeout(() => {
            cur_popup.removeClass(opened_class);
            resolve();
        }, stay_duration + transition_duration);
    });

    await new Promise((resolve) => {
        window.setTimeout(() => {
            cur_popup.animate(
                {
                    height: "0px",
                    padding: "0px",
                    border: "0px",
                    fontSize: "0px",
                    marginBottom: "0px"
                },
                top_transition_duration
            );
            resolve();
        }, transition_duration);
    });

    await new Promise((resolve) => {
        window.setTimeout(() => {
            cur_popup.remove();
            resolve();
        }, transition_duration);
    });
}

function getPopupText(type, data) {
    const get_health_low_text = () => {
        const text = getLocalizedSystemText('popups', 'health_low');
        return text;
    }

    const get_stamina_low_text = () => {
        const text = getLocalizedSystemText('popups', 'stamina_low');
        return text;
    }

    const get_mana_low_text = () => {
        const text = getLocalizedSystemText('popups', 'mana_low');
        return text;
    }

    const get_stamina_not_enough_text = () => {
        const text = getLocalizedSystemText('popups', 'stamina_not_enough');
        return text;
    }

    const get_task_created_text = () => {
        const text = getLocalizedSystemText('popups', 'task_created');
        return text;
    }

    const get_add_party_text = () => {
        const character = State.variables.characters[data.character];
        const character_name = getCharacterName(character.id_name);
        const result = `${character_name} ${getLocalizedSystemText('popups', 'add_party')}`;
        return result;
    }

    const get_remove_party_text = () => {    
        const character = State.variables.characters[data.character];
        const character_name = getCharacterName(character.id_name);
        const result = `${character_name} ${getLocalizedSystemText('popups', 'remove_party')}`;
        return result;
    }

    const get_quest_start_text = () => {        
        const quest = getQuestByIdn(data.quest_idn);
        const quest_name = (quest) ? getLocalizedText(`quests_${data.quest_idn}_name`) : `!!!ERROR: ${data.quest_idn}`;
        const result = `${getLocalizedSystemText('popups', 'popup_quest')}: "${quest_name}" ${getLocalizedSystemText('popups', 'quest_start')}`;
        return result;
    }

    const get_quest_complete_text = () => {        
        const quest = getQuestByIdn(data.quest_idn);
        const quest_name = (quest) ? getLocalizedText(`quests_${data.quest_idn}_name`) : `!!!ERROR: ${data.quest_idn}`;
        const result = `${getLocalizedSystemText('popups', 'popup_quest')}: "${quest_name}" ${getLocalizedSystemText('popups', 'quest_complete')}`;
        return result;
    }

    const get_quest_fail_text = () => {        
        const quest = getQuestByIdn(data.quest_idn);
        const quest_name = (quest) ? getLocalizedText(`quests_${data.quest_idn}_name`) : `!!!ERROR: ${data.quest_idn}`;
        const result = `${getLocalizedSystemText('popups', 'popup_quest')}: "${quest_name}" ${getLocalizedSystemText('popups', 'quest_fail')}`;
        return result;
    }

    const get_quest_next_state_text = () => {
        const quest = getQuestByIdn(data.quest_idn);
        const quest_name = (quest) ? getLocalizedText(`quests_${data.quest_idn}_name`) : `!!!ERROR: ${data.quest_idn}`;
        const result = `${getLocalizedSystemText('popups', 'quest_next_state_1')}  "${quest_name}" ${getLocalizedSystemText('popups', 'quest_next_state_2')}`;
        return result;
    }

    const get_task_fail_text = () => {
        const task = getTaskByIdn(data.task_idn);
        const task_name = getLocalizedEntityText(task.id_name, 'task', 'name');
        const result = `${getLocalizedSystemText('popups', 'popup_task')} "${task_name}" ${getLocalizedSystemText('popups', 'task_fail')}`; 
        return result;
    }

    const get_task_gather_text = () => {        
        const task = getTaskByIdn(data.task_idn);
        const ls_gather = getLocalizedSystemText('popups', 'task_gather');
        const ls_item = getLocalizedSystemText('item_list', task.subject);
        
        const result = `${ls_gather}: ${data.gather_amount} ${ls_item}`;
        return result;
    }

    const get_task_escort_finished_text = () => {
        const task = getTaskByIdn(data.task_idn);
        const character = State.variables.character[task.subject];
        const character_name = getCharacterName(character.id_name);
        const result = `${character_name} ${getLocalizedSystemText('popups', 'task_escort_finished')}`;
        return result;
    }

    const get_task_escort_location_text = () => {
        const task = getTaskByIdn(data.task_idn);
        const character = State.variables.character[task.subject];
        const character_name = getCharacterName(character.id_name);
        const result = `${getLocalizedSystemText('popups', 'task_escort_location_1')} <br> ${getLocalizedSystemText('popups', 'task_escort_location_2')} ${character_name}.`;
        return result;
    }

    return {
        health_low: get_health_low_text, 
        stamina_low: get_stamina_low_text,
        mana_low: get_mana_low_text,
        stamina_not_enough: get_stamina_not_enough_text,
        task_created: get_task_created_text,
        add_party: get_add_party_text ,
        remove_party: get_remove_party_text,
        quest_start: get_quest_start_text,
        quest_complete: get_quest_complete_text,
        quest_fail: get_quest_fail_text,
        task_fail: get_task_fail_text,
        quest_next_state: get_quest_next_state_text,
        task_gather: get_task_gather_text,
        task_escort_finished: get_task_escort_finished_text,
        task_escort_location: get_task_escort_location_text

    }[type]
    
    // no_valid_items: () => modal_no_valid_items(), for sending functions with arguments
}
/* twine-user-script #82: "quests.js" */

setup.activateQuest = (quest_idn) => activateQuest(quest_idn);

function activateQuest (quest_idn) {
    const quest_params = State.variables.quest_list[quest_idn];
    const new_quest = new Quest(quest_params); 
    State.variables.quests[new_quest.id_name] = new_quest;

    $.each(new_quest.states[new_quest.state], function (index, task) {
        activateTask(task);
    });

    showPopup('quest_start', {quest_idn});
}




setup.activateTask = (task_json) => activateQuest(task_json);

function activateTask (task_json) {

    // Conditions
    // const cur_element_block = getSketchHtmlBlockByType(element, sketch_idn, page_id, element_key) + '<<br>>';        
    // if (isSketchElementConditionsPassed(element.conditions) ) $sketch_container.wiki(cur_element_block);

    // replacing task of json format to full task instance inside the quest
    const task = new Task(task_json);
    const cur_quest_data = getTaskQuest(task_json.id_name);  
    const cur_quest = State.variables.quests[cur_quest_data.id_name]; 
    task.status = 1;

    const update_task = {
        counter: 0,
        increaseCount: function(num=1) { this.counter += Number(num) }
    }
    Object.assign(task, update_task);

    if (task.type === 'escort') {
        const checkEscortRepeat = (State.variables.temp.cur_tasks_escort.filter(cte => cte == task.id_name).length)
        
        if (!checkEscortRepeat) {
            State.variables.temp.cur_tasks_escort.push(task.id_name);  
        }
    }

    cur_quest.states[cur_quest_data.state][cur_quest_data.state_task_index] = task;


};



// Observers for tasks types
const tasks_types = State.variables.lists.task_types;  
const tasks_observers = {};

for (const type of tasks_types) {
    const observer = `${type}Observer`;

    tasks_observers[observer] = new EventObserver();
    tasks_observers[observer].subscribe(eval('ObsEventGeneral'));
}



function ObsEventGeneral(task) {
    const observer_event_function = `${task.type}ObsEventFunc`;
    eval(observer_event_function)(task);
}


// Generate functions to put broadcast calls on global functions using 'setup' storage        
setup.updateBroadcastTask = function(task) {
    if (task.status == 1) {
        setup.tasks_broadcast[task.id_name] = function(task) {
            const observer = `${task.type}Observer`;
            try {     
                tasks_observers[observer].broadcast(task);         
            } catch (err) {
                alert(`Error has occurred during updateBroadcastTask!`); 
                console.error(err);
            }
        };
    }
}

// Used for updating broacast when move back and forth trough hostory (eg., in 'fight' type of task)
function reUpdateBroadcastTask(temp_cur_tasks) {    
    $.each(temp_cur_tasks, function(index, task_idn) {
        if ((!setup.tasks_broadcast[task_idn]) && (task_idn)) {
            const task = getTaskByIdn(task_idn);
            setup.updateBroadcastTask(task);
        }
    }); 
}


// Subscribe functions that executes on calling broadcast
function sketchObsEventFunc(task) {
    console.log(`Sketch has been finished ${task.subject}`); 
    // delete State.variables.temp.cur_sketch;
    finishTask(task.id_name);
}

// function interactObsEventFunc(task) {
//     console.log(`Interacted with ${task.subject}`);
//     finishTask(task.id_name);
// }

function gatherObsEventFunc(task) {
    console.log(`Gathered ${task.counter} out of ${task.amount} of ${task.subject}`);
    if (task.counter >= task.amount) {
        finishTask(task.id_name);
    }
}

function distributeObsEventFunc(task) {
    console.log(`Distributed ${task.subject}`);
    finishTask(task.id_name);
}

function fightObsEventFunc(task) {
    console.log(`Fight with ${task.subject} ${task.counter} out of ${task.amount}`);
    if (task.counter >= task.amount) {
        console.log('Finished fightObsEventFunc', task.counter, task.amount);
        clearTempTask(task, 'cur_tasks_fight');
        finishTask(task.id_name);
    }
}

function eliminateObsEventFunc(task) {
    console.log(`Eliminate ${task.subject} ${task.counter} out of ${task.amount} `);
    if (task.counter >= task.amount) {
        console.log('Finished eliminateObsEventFunc', task.counter, task.amount);
        clearTempTask(task, 'cur_tasks_fight');
        finishTask(task.id_name);
    }
}

function searchObsEventFunc(task) {
    console.log(`Searched ${task.location} ${task.counter} out of ${task.amount}`);
    
    if (task.counter >= task.amount) {
        finishTask(task.id_name);
    }
}

function escortObsEventFunc(task) {
    console.log(`Escorted ${task.subject} to ${task.location}`);

    showPopup('task_escort_finished', {task_idn: task.id_name});

    clearTempTask(task, 'cur_tasks_escort');
    finishTask(task.id_name);
}





// Clear task temp records
function clearTempTask(task, temp_type) {
    State.variables.temp[temp_type] = State.variables.temp[temp_type].filter(task_idn => task_idn !== task.id_name);
}


function failTask(task_idn) {    
    console.log('failTask');
    const task = getTaskByIdn(task_idn);
    task.status = 3;

    if (task.type === 'escort') clearTempTask(task, 'cur_tasks_escort');
    
    delete setup.tasks_broadcast[task.id_name];   
    
    const copy_task = Object.assign({}, task);
    showPopup('task_fail', {task_idn: copy_task.id_name});

    if (!task.is_optional) {
        const cur_quest_data = getTaskQuest(task.id_name);
        failQuest(cur_quest_data.id_name); 
    }
}

function failQuest(quest_idn) {
    const quest = State.variables.quests[quest_idn];  
    quest.status = 3;

    showPopup('quest_fail', {quest_idn: quest.id_name});
}

 

function finishTask(task_idn) {
    const quest_data = getTaskQuest(task_idn); 
    const cur_quest = State.variables.quests[quest_data.id_name]; 
    const cur_task = cur_quest.states[quest_data.state][quest_data.state_task_index];

    // Actions 
    const actions = cur_task.actions;
    if (actions) $.each(actions, function(index, action) {  executeActionByType(action) });

    cur_task.status = 2;
    delete setup.tasks_broadcast[cur_task.id_name];  
    if (State.variables.temp.cur_task_sketch) delete State.variables.temp.cur_task_sketch; 
    
       
    const all_state_tasks_completed = cur_quest.states[cur_quest.state].every(function (task) {
        return (task.status == 2) || (task.is_optional);
    });

    const last_quest_state = Object.keys(cur_quest.states).pop();

    if (all_state_tasks_completed) {
        if (last_quest_state > cur_quest.state) {
            console.log("Next state of quest is started");
            showPopup('quest_next_state', {quest_idn: cur_quest.id_name});
            cur_quest.state += 1; 

            $.each(cur_quest.states[cur_quest.state], function (index, task) {
                activateTask(task);
            });
        } else {
            finishQuest(cur_quest.id_name);
        }
    }

    // State.variables.quests[quest_data.id_name] = cur_quest;
}

function finishQuest(quest_idn) {
    const quest = State.variables.quests[quest_idn];
    quest.status = 2;

    if (quest.action) {
        State.variables.player.money += Number(quest.action.money);
        State.variables.player.exp += Number(quest.action.xp);
    }

    State.variables.player.money += 10;        
    State.variables.player.exp += 10;
    
    showPopup('quest_complete', {quest_idn: quest.id_name});
}




// ..TaskFunc functions executes on link click

function sketchTaskFunc(cur_task) {  
    State.variables.temp.cur_sketch = cur_task.subject;
    State.variables.temp.cur_task_sketch = cur_task.id_name;   
}

// function interactTaskFunc(cur_task) {
//     setup.tasks_broadcast[cur_task.id_name](cur_task);
// }


function getWeightedRandom(weights) {  
    const sum = sumObjectValues(weights) ;

    let pick = Math.random()*sum;
    for(let j in weights){
        pick -= weights[j];
        if(pick <= 0){
            return Number(j);
        }
    }
}

function getGatherTaskAmount(cur_task) {    
    const weight_matrix = {
        1: { 
            1: 1.0 
        },
        2: {
            1: 1.0
        },
        3: {
            1: 0.9,
            2: 0.1
        },
        4: {
            1: 0.85,
            2: 0.1,
            3: 0.05
        },
        5: {
            1: 0.75,
            2: 0.15,
            3: 0.05,
            4: 0.05
        },
        6: {
            1: 0.65,
            2: 2,
            3: 1,
            4: 0.05
        }
    }
    
    const weight_amount = (cur_task.counter) ? cur_task.amount - cur_task.counter : cur_task.amount;
    const weight_matrix_amount_index = (weight_amount <= 6) ? weight_amount : Object.keys(weight_matrix).length;
    const weights = weight_matrix[weight_matrix_amount_index];

    let gather_amount = getWeightedRandom(weights);

    if ((cur_task.counter + gather_amount) > Number(cur_task.amount)) {
        // limit gather_amount (so eg., 4 items out of 2 possible couldn't be gathered)
        const weight_list = Object.entries(weights); // convert to array
        const items_left_to_gather = cur_task.amount - cur_task.counter;
        const filtered_weight_list = weight_list.filter(([gather_value, gather_weight]) => (gather_value <= items_left_to_gather));
        const filtered_weights = Object.fromEntries(filtered_weight_list); // convert to object
        gather_amount = getWeightedRandom(filtered_weights);
    }        

    return gather_amount;
}


function gatherTaskFunc(cur_task) {    
    if (cur_task.amount == 0) {
        cur_task.amount = 1;
        console.error(`For "${cur_task.type}" type of tasks 0 is not allowed!`)
        console.warn(`Amount has been set to 1`);
    }

    const gather_amount = getTempTaskCounter('gather_amount', cur_task.id_name); 
    const minutes_per_amount = 5;
    const gather_stamina = minutes_per_amount * gather_amount; 
    const gather_time = gather_amount * (random(2,3) * 5);
    deleteTempTaskCounter('gather_amount', cur_task.id_name);  
    


    if (!gather_stamina) {
        showPopup('task_gather', {task_idn: cur_task.id_name, gather_amount: gather_amount});

    } else if (State.variables.player.stamina > gather_stamina) {
        showPopup('task_gather', {task_idn: cur_task.id_name, gather_amount: gather_amount});

        cur_task.increaseCount(gather_amount);
        State.variables.player.stamina -= gather_stamina;
        State.variables.time.minute += gather_time;

        // Check if still required
        for (let i = 0; i < gather_amount; i++) {
            const item_params = {category: cur_task.subject };
            const item_classname = eval(classnaming(cur_task.subject));
            const item = Reflect.construct(item_classname, [item_params]);
            State.variables.player.inventory.quest_items.push(item);
        }

        setup.tasks_broadcast[cur_task.id_name](cur_task);
    } else {
        showPopup('stamina_not_enough');
    }
}

function distributeTaskFunc(cur_task) {
    if (cur_task.amount == 0) {
        cur_task.amount = 1;
        console.error(`For "${cur_task.type}" type of tasks 0 is not allowed!`)
        console.warn(`Amount has been set to 1`);
    }

    const { in_use, ...restInventory } = State.variables.player.inventory;    
    const requsted_items_sub_category = getListOfAnyDepth(restInventory, 'sub_category', cur_task.subject);
    const requsted_items_category = getListOfAnyDepth(restInventory, 'category', cur_task.subject);
    const requsted_items = (requsted_items_sub_category.length) ? requsted_items_sub_category : requsted_items_category;
   
    
    if (cur_task.amount > requsted_items.length ) { showModal('no_valid_items', {task: cur_task, items: requsted_items}) } else 
    if (cur_task.amount == requsted_items.length) { showModal('confirm_items', {task: cur_task, items: requsted_items}) } else 
    if (cur_task.amount < requsted_items.length) { showModal('select_items', {task: cur_task, items: requsted_items}) }
}



function fightTaskFunc(cur_task) {
    State.variables.party_enemy.party = [];
    const subject_party = State.variables.parties[cur_task.subject];
    transformMembersFromIdnToClass(subject_party);

    $.each(subject_party.members, function(key, member) {        
        const is_character = !!(State.variables.characters[member]);
        const is_enemy = !!(State.variables.enemies[member]);
        let character = {};

        if (is_character) character = State.variables.characters[member];
        if (is_enemy) character = State.variables.enemies[member];

        State.variables.party_enemy.party.push(character);    
    });
    State.variables.party_enemy.id_name = subject_party.id_name;
    State.variables.party_enemy.description = subject_party.description;

    State.variables.temp.cur_tasks_fight.push(cur_task.id_name);   
}



function eliminateTaskFunc(cur_task) {
    console.log('eliminateTaskFunc')
    State.variables.temp.cur_tasks_fight.push(cur_task.id_name);   
}


function searchTaskFunc(cur_task) {    
    console.log('searchTaskFunc')
    const search_stamina = getTempTaskCounter('search_stamina', cur_task.id_name); 
    const search_time = (random(6,8) * 60/2); // 3-4 hours 

    State.variables.player.stamina -= search_stamina;
    State.variables.time.minute += search_time;
    cur_task.increaseCount();

    setup.tasks_broadcast[cur_task.id_name](cur_task);
    deleteTempTaskCounter('search_stamina', cur_task.id_name);  
}

function escortTaskFunc(cur_task) {  
    console.log('escortTaskFunc');
    if (isInParty(cur_task.subject)) showPopup('task_escort_location', {task_idn: cur_task.id_name});
}





function getTaskLink(cur_task) {
    const goto_passage = passage();       
    console.log( hasNonEmptyLocalizedText(cur_task.id_name, 'task', 'link_title'))
    const task_link_text = (hasNonEmptyLocalizedText(cur_task.id_name, 'task', 'link_title')) 
        ? getLocalizedEntityText(cur_task.id_name, 'task', 'link_title') 
        : getTaskLinkAutoText(cur_task);

    const link_content = `
        <a 
            data-location="${goto_passage}" 
            class="link-internal task-link task-link-listener task-link--${cur_task.type}" 
            data-task="${cur_task.id_name}" 
            tabindex="0"
        >\
            <img class="task-link__icon" src="media/icons/task/${cur_task.type}.png" data-thelper="${'task_type__'+cur_task.type}" alt="${cur_task.type}">
            <img class="task-link__icon--hover" src="media/icons/task/${cur_task.type}_hover.png" data-thelper="${'task_type__'+cur_task.type}" alt="${cur_task.type}">

            <p class="task-link__text">${task_link_text}</p>
        </a>\
    `;

    const task_conditions_text = getLocalizedSystemText('task_conditions', cur_task.type);
    const link_content_fake = `
        <div class="task-link task-link--${cur_task.type} task-link--fake">
            <p class="link-fake__tip-text tip_gen"> ${task_conditions_text} </p>
            <img class="task-link__icon" src="media/icons/task/${cur_task.type}.png" data-thelper="${'task_type__'+cur_task.type}" alt="${cur_task.type}">
            <p class="task-link__text">${task_link_text}</p>
        </div>
    `;

    const link_content_sketch = `
        <a 
            data-location="${goto_passage}" 
            class="link-internal task-link-listener task-link--${cur_task.type} chat-link personal-chat-link personal_quest-link" 
            data-task="${cur_task.id_name}" 
            tabindex="0"
        >
            <img class="chat-link__img" src="media/icons/talk_menu/personal_task.png" >

            <span>${task_link_text}</span>      
            ${getQuestMarkContent('task')}
        </a>
    `;

    const return_content = passTaskLinkConditions(cur_task)
    ? (cur_task.type === 'sketch' ? link_content_sketch : link_content)
    : link_content_fake;


    return return_content;
}




function getTaskLinkAutoText(cur_task) {
    
    const sketch_link_text = () => {
        const tasn_name = getLocalizedEntityText(cur_task.id_name, 'task', 'name');   
        const start_talk_about = getLocalizedSystemText('tasks', 'sketch'); 
        const result = `${start_talk_about} - '${tasn_name}'`;
        return result;
    } 

    // const interact_link_text = () => {
    //     const interact = getLocalizedSystemText('tasks', 'interact');
    //     const result = `${interact}`;
    //     return result;
    // } 

    const gather_link_text = () => {
        const gather = getLocalizedSystemText('tasks', 'gather');
        const item = getLocalizedSystemText('item_list', cur_task.subject);
        const result = `${gather} - ${item}`;
        return result;
    } 

    const distribute_link_text = () => {
        const distribute = getLocalizedSystemText('tasks', 'distribute');
        const item = getLocalizedSystemText('item_list', cur_task.subject);
        const result = `${distribute} - ${item}`;
        return result;
    } 
    
    const fight_link_text = () => {
        const fight = getLocalizedSystemText('tasks', 'fight');
        const result = `${fight} - ${cur_task.amount} ${cur_task.subject}`;
        return result;
    } 

    const search_link_text = () => {
        const result = getLocalizedSystemText('tasks', 'search');
        return result;
    } 
    
    return {
        sketch: sketch_link_text,
        // interact: interact_link_text,
        gather: gather_link_text,
        distribute: distribute_link_text,
        fight: fight_link_text,
        search: search_link_text,
    }[cur_task.type]()
}

function passTaskLinkConditions(cur_task) {
    
    const search_link_condition = (cur_task) => {
        const search_stamina = (random(15,18) * 10/2); // 75-90 stamina
        const result = (State.variables.player.stamina > search_stamina); 
        if (result) assignTempTaskCounter('search_stamina', cur_task.id_name, search_stamina);
        return result;
    } 

    const gather_link_condition = (cur_task) => {
        const gather_amount = getGatherTaskAmount(cur_task); 
        const minutes_per_amount = 5;
        const gather_stamina = minutes_per_amount * gather_amount;
        const result = (State.variables.player.stamina > gather_stamina); 
        if (result) assignTempTaskCounter('gather_amount', cur_task.id_name, gather_amount);
        return result;
    } 

    switch (cur_task.type) {
        case 'sketch':
            return true;
        case 'gather':
            return gather_link_condition(cur_task);
        case 'distribute':
            return true;
        case 'fight':
            return true;
        case 'search':
            return search_link_condition(cur_task);
        case 'eliminate':
            return true;
        case 'escort':
            return true;            
        default:
            console.error(`Task type not added to passTaskLinkConditions [${cur_task.type}]`);
            alert(`Task type not added to passTaskLinkConditions [${cur_task.type}]`);
    }  
}

// !!!!!
//  RECHECK THIS FUNCTION !!! IF REQUERE SWITCH !! CHECK IF cur_task.type = escort, eliminateTaskFunc is also functioning??
function runTask(cur_task) {

    switch (cur_task.type) {
        case 'eliminate':
            return eliminateTaskFunc(cur_task);
        case 'escort':
            return escortTaskFunc(cur_task);
        default:
            console.error(`Task type not added to passTaskLinkConditions [${cur_task.type}]`);
            alert(`Task type not added to passTaskLinkConditions [${cur_task.type}]`);
    }
}





// Add task`s link to certain locations on task start
function addTaskLink(cur_task) {
    const $link_parent = $('.passage-list__tasks'); // html element where the link will be appended to
    const link_content = getTaskLink(cur_task);

    $link_parent.append(link_content);
}



function addTaskLinkListener() {
    $('.task-link-listener').on('click', function () {
        const location = $(this).data('location');
        const task_idn = $(this).data('task');
        const cur_task = getTaskByIdn(task_idn);
        const passage_on_call_start = passage(); // set passage location on start of task link call
         
        if (cur_task.type == 'sketch') {
            sketchTaskFunc(cur_task);
            moveToLocation('Uni_Sketch');
        } else if (cur_task.type == 'interact') {
            interactTaskFunc(cur_task);
            updateTaskPassage(location, passage_on_call_start)
        } else if (cur_task.type == 'gather') {
            gatherTaskFunc(cur_task); 
            updateTaskPassage(location, passage_on_call_start)
        } else if (cur_task.type == 'distribute') {
            distributeTaskFunc(cur_task);    
            updateTaskPassage(location, passage_on_call_start, true)
        } else if (cur_task.type == 'fight') {
            fightTaskFunc(cur_task);
            updateTaskPassage(location, passage_on_call_start)
        } else if (cur_task.type == 'search') {
            searchTaskFunc(cur_task);
            updateTaskPassage(location, passage_on_call_start)
        }

    });
}

function updateTaskPassage(location, passage_on_call_start, noHistory=false) {
    const passage_on_call_end = passage(); // set passage location after task excecution, before final task redirect.    
    if (passage_on_call_start == passage_on_call_end) Engine.play(location, noHistory);  
}



function addQuestLink(quest_id_name, location, quest_text) {
    const $link_parent = $('.passage-list__quests');     // html element where the link will be appended to
    const quest_link = `
        <a 
            class="quest-btn quest-link link-internal"
            data-thelper="quest_link"
            data-location="${location}" 
            data-quest="${quest_id_name}" 
        >	
            ${getQuestMarkContent()}

            <span> ${quest_text} </span>
        </a>
    `;

    $link_parent.append(quest_link);
}

function addQuestLinkListener() {
    $(document).on('click', '.quest-link', function () {
        const location = $(this).data('location');
        const quest_idn = $(this).data('quest');

        activateQuest(quest_idn);
        moveToLocation(location);
    });
}



/* twine-user-script #83: "schedule.js" */


$(document).on(":passagedisplay", function () {
    if (!tags().includes("System")) {
        const characters_schedule_list = State.variables.characters_schedule_list;
        
        $.each(characters_schedule_list, function (character_idn, character_schedule) { 
            const character = State.variables.characters[character_idn];
            if (canShowSchedule(character.id_name)) { 
                if (character_schedule) { 
                    const character_cur_location = getCharacterCurrentScheduledLocation(character.id_name);
                    if (isPlayerOnLocation(character_cur_location)) addTalkMenuLink(character.id_name);
                } else {
                    console.warn(`Character "${character_idn}" do not help assignment for this hour! Please recheck schedule json!`);
                }            
            } else {
                if (character_idn != 'mc') console.warn(`Character "${character_idn}" cannot be scheduled!`);
            }
        });
    }
});



function canShowSchedule(character_idn) {
    const characters_schedule_list = State.variables.characters_schedule_list;
    const player = State.variables.player;
    const is_player = (player.id_name == character_idn);
    const has_schedule = !! (characters_schedule_list[character_idn]);
    const not_in_party = !isInParty(character_idn);

    const schedule_conditions_passed = (not_in_party && !is_player && has_schedule);

    return schedule_conditions_passed;
}



function getCharacterCurrentScheduledLocation(character_idn) {
    const period = getCharacterActivePeriod(character_idn);
    const scheduled_location = (period) ? period.location : 'location_undefined';

    return scheduled_location;
}

   
function getCharacterActivePeriod(character_idn) {
    const schedule_day = $.extend(true,{},State.variables.temp.schedule_day);  
    const character_schedule_day = schedule_day[character_idn];   
    const time = State.variables.time;
    const cur_hour = time.hour.toString();

    // Only the last period for the current time should be applied. Otherwise character will be in multiple locations at the same time.
    const active_period = character_schedule_day.findLast((period) => { // 'findLast()' - to show latest added changes
        const is_in_cur_hour = period.hours.includes(cur_hour);
        return  (is_in_cur_hour);
    });

    return active_period;
}



function setTodaySchedule() {    
    reassignCharactersScheduleList() // set 'base_' schedules 
    
    const schedule_update_list = State.variables.record_lists.schedule_update_added;
    updateDailySchedule(schedule_update_list); // updates daily schedules with list of updates
}

function updateDailySchedule(schedule_update_list) {
    const characters_schedule_list = State.variables.characters_schedule_list; 

    // Update base characters schedules with schedule updates that were in the record_lists
    $.each(schedule_update_list, function(index, schedule_update_idn) {
        const character_schedule_list = State.variables.schedule_list[schedule_update_idn];
        const schedule_update_record_list = character_schedule_list?.list;
        const schedule_update_character = character_schedule_list?.character_idn;
        $.each(schedule_update_record_list, function(index, schedule_update_record) {
            characters_schedule_list[schedule_update_character].push(schedule_update_record)
        });
    });

    const schedule_edited = $.extend(true,{},characters_schedule_list);      // deep cloning

    // Formatting and filtering to prepare for 'schedule_day' correct format
    $.each(schedule_edited, function(character, character_schedule) {
        const formated_character_schedule = getFormatedCharacterDaySchedule(character_schedule, character);        
        const filtered_character_schedule = getFilteredCharacterDaySchedule(formated_character_schedule, character);

        schedule_edited[character] = filtered_character_schedule;
    });

    State.variables.temp.schedule_day = schedule_edited;
}


function getFormatedCharacterDaySchedule(character_schedule, character) {    
    const time = State.variables.time;
    const cur_month_id = time.month_id.toString();
    const cur_day_of_week_id = time.day_of_week_id.toString();
    const assignments = State.variables.lists.assignments;

    const formated_character_schedule = character_schedule.filter(function(period, period_index) {
        const is_in_cur_month = Array.isArray(period.months) && period.months.includes(cur_month_id);
        const is_in_cur_day_of_week = Array.isArray(period.days_of_week) && period.days_of_week.includes(cur_day_of_week_id);

        if (is_in_cur_month && is_in_cur_day_of_week) {
            const assignment_idn = getRandomValueOfArray(period.assignments);
            const assignment = assignments[assignment_idn];
            if (!assignment) {
                alert(`Assignment ${assignment_idn} does not exist!`); 
                console.error(`Assignment '${assignment_idn}' that character '${character}' try to use, does not exist!`); 
            }
            const location = getRandomValueOfArray(assignment.locations);

            period.location = location;
            period.activity = assignment.activity;
            if (assignment.hasOwnProperty('availability')) period.availability = assignment.availability;

            delete period.months;
            delete period.days_of_week;
            delete period.assignments;

            return true; // Keep this period in the array
        } else {
            return false; // Remove this period from the array
        }
    });

    return formated_character_schedule;
}

function getFilteredCharacterDaySchedule(formated_character_schedule, character) {
    const reversed_character_schedule = formated_character_schedule.reverse();

    for (let i = 0; i < reversed_character_schedule.length; i++) {
        const cur_period_hours = reversed_character_schedule[i].hours;
        if (cur_period_hours.length === 0) {
            console.warn(`For character '${character}' period with activity "${reversed_character_schedule[i].activity}" was removed because its hours were empty.`);
            reversed_character_schedule.splice(i, 1);
            i--;
            continue;
        }
        for (let j = i + 1; j < reversed_character_schedule.length; j++) {
            const next_period_hours = reversed_character_schedule[j].hours;
            const overlap_hours = cur_period_hours.filter(hour => next_period_hours.includes(hour));
            if (overlap_hours.length > 0) {
                console.warn(`For character '${character}' hours '${overlap_hours.join(', ')}' were removed from "${reversed_character_schedule[j].activity}" due to overlap with "${reversed_character_schedule[i].activity}".`);
                reversed_character_schedule[j].hours = next_period_hours.filter(hour => !overlap_hours.includes(hour));
            }
        }
    }

    const filtered_today_character_schedule = reversed_character_schedule.reverse();

    return filtered_today_character_schedule;
}


// Reassigning schedule character list with 'schedule_list' json variable.
function reassignCharactersScheduleList() {
    State.variables.schedule_list = schedule_list;
	$.each(State.variables.characters, function(character_index, character) {	
		try {     
			State.variables.characters_schedule_list[character.id_name] = State.variables.schedule_list[`base_${character.id_name}`]?.list ?? [	];
		} catch (err) {
			alert(`Can't appoint schedule for ${character.id_name}`); 
			console.error(err);
		}
	});
}



function validateScheduleUpdateIdn(schedule_update_idn) {
    const schedule_update = State.variables.schedule_list[schedule_update_idn] ?? false;
    if (!schedule_update) {
        alert(`"${schedule_update_idn}" is not valid for the schedule_list!`);
        console.error(`"${schedule_update_idn}" is not valid for the schedule_list!`);
        return false;
    }

    const character_idn = State.variables.characters[schedule_update.character_idn]?.id_name ?? false;
    if (!character_idn) {
        alert(`"${schedule_update.character_idn}" character is not found among available characters!`);
        console.error(`"${schedule_update.character_idn}" character is not found among available characters!`);
        return false;
    }

    return true;
}
/* twine-user-script #84: "script_imports.js" */



// ---- PARAMS ----

// local
// let project_path = '/tweego'; 


// server
// let project_path = '/'; 


// ---- PARAMS END ----




//  Connect js files 
// setup.Path = project_path;

// const lockID = LoadScreen.lock();  // Lock loading screen

// $(document).ready(function(){
//     importScripts([
//             setup.Path + '/scripts/autosave.js',
//             setup.Path + '/scripts/fight.js',
//             setup.Path + '/scripts/macro.js',
//             setup.Path + '/scripts/classes_npc.js',
//             setup.Path + '/scripts/classes_weapon.js',
//             setup.Path + '/scripts/classes_enemy.js'
//         ])
//         .then(function() {
//             setup.JSLoaded = true;
//             LoadScreen.unlock(lockID);  // Unlock loading screen
//         })
//         .catch(function(error) {
//             LoadScreen.unlock(lockID);  // Unlock loading screen
//             alert("Error: Could not find js file");
//         }
//     );
// });




// Those scripts will be uploaded after StotyInit

// setup.LoadScreen = LoadScreen;

// setup.scriptJsLoaded = false;
// var lockID = LoadScreen.lock();  // Lock loading screen

// /*Provides a check to guard basic codepaths from running before script initialization is complete, or where we don't have proper game state.*/
// setup.initSafe = function () {
//     const reservedPages = ["Start" ,"Developer Notes", "Version Log", "reference saves" ];
//  	return reservedPages.indexOf(passage()) < 0 && setup.scriptJsLoaded;	
// }

// /** notifyDone is Used by loader.js to notify Sugarcube to allow gameplay to begin.*/
// Window.notifyDone = function(){
// 	// Reload current passage since imported scripts can function now.
// 	// console.clear();
	
// 	setup.scriptJsLoaded = true;
// 	Engine.play(SugarCube.State.passage);	
// 	LoadScreen.unlock(lockID);	
// }

// //Load extended scripts
// importScripts(["test/require.js", "test/loader.js", "test/test.js"])
// .catch(function(error) {alert(error);});
/* twine-user-script #85: "sidebar.js" */

setup.showDateSidebar = function () {
    const lists = State.variables.lists;
    const time = State.variables.time;
    const cur_week_day = lists.day_of_week_list[time.day_of_week_id];
    const cur_month = lists.month_list[time.month_id];

    const time_hour = (time.hour < 10) ? `0${time.hour}` : time.hour;
    const time_minute = (time.minute < 10) ? `0${time.minute}` : time.minute;

    const content = `
        <div id="sidebar__time-container">
            <span id="day_of_week" class="sidebar__text" data-thelper="day_of_week">${cur_week_day},</span> <br>
            <span id="month" class="sidebar__text" data-thelper="month" > ${cur_month}</span>, <span class="sidebar__text" data-thelper="day_of_month"> ${time.month_day}</span><br>
            <span id="hours" class="sidebar__numbers sidebar__time-hours" data-thelper="time" > ${time_hour}:${time_minute}</span>
        </div>
        <br>
    `;

    return nobr(content);
}


setup.showPlayerName = function () {
    const content = `
        <div id="player_name" class="sidebar__stats-container">
            <p id="player_name" class="sidebar__stats-player-name ${State.variables.player.id_name}">${getPlayerName()}</p>   
        </div>
    `;

    return nobr(content);
}

setup.showStatsValues = function () {
    const money = State.variables.player.money;

    const content = `
        <div id="money" class="sidebar__stats-container">
            <img class="sidebar-icon" src="media/icons/coin.png" alt="Money" data-thelper="money">             
            <span class="sidebar__stats-money-text" data-thelper="money">${money}</span> 
        </div>        
        <br>
    `;

    return nobr(content);
}


setup.showStatsBar = function () {

    const health_obj = {
        localization_item: 'caption_health',
        prop: 'health',
        prop_max: 'health_max',
        bar_bg_color: '#660000',
        bar_line_color: '#FF3333'
    }

    const stamina_obj = {
        localization_item: 'caption_stamina',
        prop: 'stamina',
        prop_max: 'stamina_max',
        bar_bg_color: '#006600',
        bar_line_color: '#66FF66'
    }

    const mana_obj = {
        localization_item: 'caption_mana',
        prop: 'mana',
        prop_max: 'mana_max',
        bar_bg_color: '#000044',
        bar_line_color: '#3366FF'
    }

    const content = getBarContent(health_obj) + getBarContent(stamina_obj) + getBarContent(mana_obj) + `<br>`;
    return content;
}



function getBarContent(stat_obj) {
    const player = State.variables.player;
    const localization_list = 'sidebar';

    const cur_stat = player[stat_obj.prop];
    const cur_stat_max = player[[stat_obj.prop_max]];
    const bar_text = getLocalizedSystemText(localization_list, stat_obj.localization_item);
    const stat_percent = (!!cur_stat || !!cur_stat_max) ? (cur_stat / cur_stat_max) * 100 : 0;

    const content = `
        <div id="${stat_obj.prop}" class="progress-bar-container">
            <span class="sidebar__text">${bar_text}</span> <span class="sidebar__numbers">${cur_stat}/${cur_stat_max}</span>
            <div class="progress-bar" style="background-color: ${stat_obj.bar_bg_color};"> 	
                <span class="progress-bar-line" data-stat="health" style="background-color: ${stat_obj.bar_line_color}; width: ${stat_percent}%;"></span> 
            </div>
        </div>
    `;
    
    return (cur_stat_max > 0) ? nobr(content) : '';
}





setup.showMenuStory = function () {
    const localization_list = 'passages';
    const parent = $('<div class="menu-story"></div>');
    const menu_list = {
        inventory: {
            text: 'passage_menu_inventory',
            passage: 'Menu_Inventory',
            icon: 'inventory',
        },
        questlog: {
            text: 'passage_menu_questlog',
            passage: 'Menu_Questlog',
            icon: 'questlog',
        },
        party: {
            text: 'passage_menu_party',
            passage: 'Menu_Party',
            icon: 'party',
        },
        skill: {
            text: 'passage_menu_skill',
            passage: 'Menu_Skill',
            icon: 'skill',
        },
        info: {
            text: 'passage_menu_info',
            passage: 'Menu_Info',
            icon: 'info',
        },
        help: {
            text: 'passage_menu_help',
            passage: 'Menu_Help',
            icon: 'help',
        },
        debug: {
            text: 'passage_menu_debug',
            passage: 'Menu_Debug',
            icon: 'debug',
        }
    }

    if (State.variables.settings.debug != 1) delete menu_list.debug;
    console.log('Test', State.variables.settings.debug, menu_list)

    $.each(menu_list, function (menu_list_item_index, menu_list_item) {
        const menu_item_text = getLocalizedSystemText(localization_list, menu_list_item.text);
        const content = `
            <a data-passage="${menu_list_item.passage}" class="link-internal macro-link menu-story__link" role="link" tabindex="0">
                <img class="menu-story__icon" src="media/icons/menu/${menu_list_item.icon}.png" alt="${menu_list_item_index}">
                <span> ${menu_item_text} </span>
            </a>
        `;

        parent.append(content);
    });

    const parent_html = nobr(parent.prop('outerHTML'));

    return parent_html;
}


setup.showMenuCore = function () {
    const parent = $('<div class="menu-core"></div>');

    const menu_list = {
        saves: {
            text: 'savesTitle',
            icon: 'saves'
        },
        settings: {
            text: 'settingsTitle',
            icon: 'settings'
        },
        restart: {
            text: 'restartTitle',
            icon: 'restart'
        },
        share: {
            text: 'shareTitle',
            icon: 'share'
        },
    }

    $.each(menu_list, function (menu_list_item_index, menu_list_item) {
        const menu_item_text = L10n.get(menu_list_item.text);
        const content = `
            <a data-func="${menu_list_item_index}" class="link-internal macro-link menu-story__link menu-core__link" role="link" tabindex="0">
                <img class="menu-story__icon" src="media/icons/menu/${menu_list_item.icon}.png">
                <span> ${menu_item_text} </span>
            </a>
        `;
        parent.append(content);
    });


    const parent_html = nobr(parent.prop('outerHTML'));

    return parent_html;
}



$('#ui-bar-body').on('click', '.menu-core__link', function () {
    const func = $(this).data('func');
    const settings_passage = 'Menu_Settings';

    if (func == 'saves') showSaveManagementWindow();
    if (func == 'settings') Engine.play(settings_passage);
    if (func == 'restart') UI.restart();
    if (func == 'share') UI.share();
});


setup.showSignature = function () {
    const company_name = `2caKe gems`;
    const version_string = getLocalizedSystemText('sidebar', 'caption_version');
    const version_number = '0.1.032';

    const content = `
        <div class='sidebar-signature'>
            <p id="company_name" data-thelper="company_name">[${company_name}]</p>
            <p id="game_version">${version_string}: ${version_number}</p>
        </div>
    `;

    return nobr(content);
}





function updateInterfaceDisplay() {
    const interface_settings = State.variables.settings.interface;

    for (const interface_block in interface_settings) {
        const interface_block_obj = interface_settings[interface_block];
        let at_least_one_block_element_visible = false;

        for (const interface_element in interface_block_obj) {
            if (interface_block_obj[interface_element] !== 0) {
                at_least_one_block_element_visible = true;
                break;
            }
        }

        if (!at_least_one_block_element_visible) {
            hideInterfacePart(interface_block);
        } else {
            for (const interface_element in interface_block_obj) {
                if (interface_block_obj[interface_element] === 0) {
                    hideInterfacePart(interface_element);
                }
            }
        }
    }
}


function hideInterfacePart(part) {
    const part_list = {
        time: '#sidebar__time-container',
        day_of_week: '#day_of_week',
        month: '#month',
        hours: '#hours',
        stats: '.sidebar__stats-container',
        player_name: '#player_name',
        money: '#money',
        bars: '.progress-bar-container',
        health: '#health',
        stamina: '#stamina',
        mana: '#mana',
        exp: '.level-container',
        level: '.level-container',
        menu_story: '.menu-story',
        inventory: '.menu-story a[data-passage="Menu_Inventory"]',
        questlog: '.menu-story a[data-passage="Menu_Questlog"]',
        party: '.menu-story a[data-passage="Menu_Party"]',
        skill: '.menu-story a[data-passage="Menu_Skill"]',
        help: '.menu-story a[data-passage="Menu_Help"]',
        info: '.menu-story a[data-passage="Menu_Info"]',
        menu_core: '.menu-core',
        saves: '.menu-core__link[data-func="saves"]',
        settings: '.menu-core__link[data-func="settings"]',
        restart: '.menu-core__link[data-func="restart"]',
        share: '.menu-core__link[data-func="share"]',
        sign: '.sidebar-signature',
        author: '#company_name',
        version: '#game_version',
        history: '#ui-bar-history',
        backward: '#history-backward',
        forward: '#history-forward'
    }

    $(document).ready(() => {
        const elem = part_list[part];
        $(`${elem}`).hide();


        if ($('.menu-story').css('display') === 'none') $('.menu-core').prepend(`<br>`);  // for better looking positioning of core-menu at the index page. 
        // setTimeout(() => {  if ( $(`${elem}`).css('display') != 'none' ) $(`${elem}`).hide() }, 50); // check because SugarCube rewrite menu links to display: list-item; in ~ 40 milisecond
    });


}
/* twine-user-script #86: "talk_menu.js" */



$(document).on(":passagedisplay", function () {
    if (passage() == "Talk_Menu") {
        if (checkCanJoin()) drawPartyLinks();
        checkCanJoin()
        showCharacterInfo();
        drawChatLinks();
        drawQuestionsLinks();
        
        // drawEducationLinks();
        drawStatsLinks();
        drawInventoryLinks();
        
        reUpdateBroadcastTask(State.variables.temp.cur_tasks_escort);
    }
}); 



function checkCanJoin() {
    const cur_speaker = State.variables.temp.cur_speaker;
    const character = State.variables.characters[cur_speaker] ?? {};
    const can_join = !!(character.can_join);

    return can_join;
}

function drawPartyLinks() {
    const cur_char = State.variables.temp.cur_speaker;

    const party_member_conditions = {
        inPartyAndInEscortTaskAndOnLocation : (isInParty(cur_char)) && (isInEscortTask(cur_char)) && (isOnEscortTaskLocation()),
        inPartyAndInEscortTaskNotOnLocation : (isInParty(cur_char)) && (isInEscortTask(cur_char)) && (!isOnEscortTaskLocation()),
        inPartyNotInEscortTask : (isInParty(cur_char)) && (!isInEscortTask(cur_char)),
        notInPartyAndInEscortTask : (!isInParty(cur_char)) && (isInEscortTask(cur_char)),
        notInPartyNotInEscortTask : (!isInParty(cur_char)) && (!isInEscortTask(cur_char))
    }

    const party_member_conditions_values = Object.values(party_member_conditions);
    const party_member_actual_condition_index = party_member_conditions_values.indexOf(true);
    const party_member_actual_conditions_property = Object.keys(party_member_conditions)[party_member_actual_condition_index];
    
    const $link_parent = $('.talk-menu__character_party');

    const link = nobr( getPartyLink(party_member_actual_conditions_property) );
    $link_parent.wiki( link );
}


function getPartyLink(property_name) {
    const party_join = `
        <div class="tip-wrapper__link">
            <a 
                class="link-internal chat-link party-link" 
                data-thelper="talk__join" 
            >            
                <img class="chat-link__img chat-link__img--medium" src="media/icons/talk_menu/join.png">             
                <span>${getLocalizedSystemText('talk_menu', 'join_party')}</span>         
            </a>

            ${getInfoTipContent('tip_functionality_wip_beta')}
        </div>
    `;

    const party_leave = `
        <div class="tip-wrapper__link">
            <a 
                class="link-internal chat-link party-link" 
                data-thelper="talk__leave" 
            >            
                <img class="chat-link__img chat-link__img--medium" src="media/icons/talk_menu/leave.png">             
                <span>${getLocalizedSystemText('talk_menu', 'leave_party')}</span>         
            </a>

            ${getInfoTipContent('tip_functionality_wip_beta')}
        </div>
    `;

    const party_join_escort = `
        <div class="tip-wrapper__link">
            <a 
                class="link-internal chat-link party-link" 
            >            
                <img class="chat-link__img chat-link__img--medium" src="media/icons/talk_menu/join_escort.png">             
                <span>${getLocalizedSystemText('talk_menu', 'join_escort')}</span>         
                
                ${getQuestMarkContent('task')}
            </a>
        </div>
    `;

    const party_leave_escort_finish = `
        <div class="tip-wrapper__link">
            <a 
                class="link-internal chat-link party-link" 
            >            
                <img class="chat-link__img chat-link__img--medium" src="media/icons/talk_menu/leave_escort.png">             
                <span>${getLocalizedSystemText('talk_menu', 'leave_escort_finish')}</span>       
                
                ${getQuestMarkContent('task')}
            </a>
        </div>
    `;

    const party_leave_escort_not_finish = `    
        <div class="tip-wrapper__link">
            <a 
                class="link-internal chat-link party-link" 
            >            
                <img class="chat-link__img chat-link__img--medium" src="media/icons/talk_menu/leave_escort.png">             
                <span>${getLocalizedSystemText('talk_menu', 'leave_escort_not_finish')}</span>         
            </a>

            ${getInfoTipContent('tip_leave_escort_not_finish')}
        </div>
    `;

    return {
        notInPartyNotInEscortTask: party_join,
        inPartyNotInEscortTask: party_leave,
        notInPartyAndInEscortTask: party_join_escort,
        inPartyAndInEscortTaskNotOnLocation: party_leave_escort_finish,
        inPartyAndInEscortTaskAndOnLocation: party_leave_escort_not_finish
    }[property_name]
}




function addPartyLinkListener() {
    $('body').on('click', '.party-link', function() {
        const cur_char = State.variables.temp.cur_speaker;
        const ready_finish_escort = isInEscortTask(cur_char) && isOnEscortTaskLocation();

        if (isInParty(cur_char)) {
            removeFromParty(cur_char);
            if (ready_finish_escort)  broadcastEscortTask(cur_char);
        } else {
            addToParty(cur_char);
        }
        
        if (!ready_finish_escort) Engine.play(passage());
    });
}



function addToParty(character_idn) {
    const cur_character = State.variables.characters[character_idn];    
    State.variables.party_hero.party.push(cur_character);
    showPopup('add_party', {character:  character_idn});
}

function removeFromParty(character_idn) {
    State.variables.party_hero.party = State.variables.party_hero.party.filter(char => char.id_name !== character_idn);
    showPopup('remove_party', {character:  character_idn});
}



function isInEscortTask(cur_char) {
    let result = false;

    $.each(State.variables.temp.cur_tasks_escort, function(index, task_idn) {
        const task = getTaskByIdn(task_idn);
        if (task.subject == cur_char) result = true;
    }); 

    return result;
}

function isOnEscortTaskLocation() {
    let result = false;

    const last_location_passage = State.variables.temp.last_location_passage; 
    $.each(State.variables.temp.cur_tasks_escort, function(index, task_idn) {
        const task = getTaskByIdn(task_idn);
        if (task.location == last_location_passage) result = true;
    }); 

    return result;
}


function isInParty(character_idn) {
    const party = State.variables.party_hero.party;
    const is_in_party = party.some(char => char.id_name === character_idn);
    return is_in_party;
}


function broadcastEscortTask(cur_char) {
    const last_location_passage = State.variables.temp.last_location_passage; 
    let can_refresh = false;
    $.each(State.variables.temp.cur_tasks_escort, function(index, task_idn) {
        const task = getTaskByIdn(task_idn);
        if ((task.location == last_location_passage) && (task.subject == cur_char)) { 
            setup.tasks_broadcast[task.id_name](task);  
            can_refresh = true;
        }
    }); 

    if (can_refresh) moveToLocation(location);
}


function showCharacterInfo() {
    const container = $('.talk-menu__info'); 
    const speaker = State.variables.temp.cur_speaker;
    const speaker_name = getCharacterName(speaker);
    const player = State.variables.player;
    const speaker_appellation = State.variables.characters[speaker]?.appellation ?? ' ';
    const player_relation = player.relations[speaker] ?? 0;
    const player_relation_level = getRelationLevel(player_relation);

    const content = `
        <div class="talk-menu__main-info">
            <img class="talk-menu__portrait" src="media/characters/${speaker}/default.png">
            <div>
                <p class="talk-menu__name ${speaker}">${speaker_name}</p>
                <div class="tip-wrapper__text"> 
                    <p>${getLocalizedSystemText('talk_menu', 'who_are_they')}: "<span>${speaker_appellation}</span>"</p> 
                    ${getInfoTipContent('tip_functionality_wip')} 
                </div>
                <div class="tip-wrapper__text">${getLocalizedSystemText('talk_menu', 'think_of_you')}: 
                    <p>"${player_relation_level}</span>" (${player_relation}/100)</p> 
                    ${getInfoTipContent('tip_functionality_wip')}
                </div>
            </div>
        </div>
    `;

    $(container).append(content);
}


function getRelationLevel(relation_value) {
    const relation_levels = {
        0: 'Stranger',
        10: 'Vaguely Familiar',
        20: 'Acquaintance',
        30: 'Associate',
        40: 'Fellow',
        50: 'Friend',
        60: 'Confidant',
        70: 'Cherished/Best friend',        
        80: 'Close one',
        90: 'Family',
        100: 'Soulbound',
        // 110: 'Beloved'
    };
    
    const relationLevel = Object.entries(relation_levels)
    .reverse() // Reverse to start from highest levels
    .find(([level_value]) => relation_value >= level_value) // Find the first level with value less than or equal to validRelationValue
    ?.[1] ?? 'Stranger'; // Extract the level name or default to 'Stranger'
  
  
    return relationLevel;
}



// Simple talks about general stuff
function drawChatLinks() {
    const container = $('.talk-menu__chat');
    const speaker = State.variables.temp.cur_speaker;
    const time = State.variables.time;
    const chat_time_interval = 8; // interval between chats 8 hours per character
    const speaker_last_chat_time = State.variables.temp.spoke_list[speaker] ?? null;    
    const time_hour = (time.hour >= speaker_last_chat_time) ? time.hour : time.hour+24; // if current hour is less than hour of last chat then it is a next day.
    const is_chat_available = ((speaker_last_chat_time + chat_time_interval) < time_hour);
    const chat_string = getLocalizedSystemText('talk_menu', 'chat');

    const content_chat_link = `
        <a 
            data-passage="Talk_Menu" 
            class="link-internal chat-link general-chat-link" 
            data-thelper="talk__chat" 
        >            
            <img class="chat-link__img" src="media/icons/talk_menu/chat.png">             
            <span>${chat_string}</span>         
        </a>
    `;

    const content_chat_link_blocked = `
        <div class="tip-wrapper__link" data-thelper="talk__already_chatted">
            <a 
                class="link-internal chat-link general-chat-link chat-link--blocked" 
            >            
                <img class="chat-link__img" src="media/icons/talk_menu/chat.png">             
                <span>${chat_string}</span>   
            </a>

            ${getInfoTipContent('tip_already_chatted')}
        </div>
    `;

    (is_chat_available) ? $(container).append(content_chat_link) : $(container).append(content_chat_link_blocked);
}


function addChatLinkListener() {
    $(document).on('click', '.general-chat-link:not(.chat-link--blocked)', function () {
        const passage = $(this).data('passage');
        
        updateRelationsChat();
        moveToLocation(passage);
    });
}

function updateRelationsChat() {
    const player = State.variables.player;
    const speaker = State.variables.temp.cur_speaker;
    const player_relation = player.relations[speaker];
    const time = State.variables.time;

    if (player_relation <5) State.variables.player.relations[speaker]+=3;
    else if (player_relation <15) State.variables.player.relations[speaker]+=2;
    else if (player_relation <30) State.variables.player.relations[speaker]+=1;
    else if (player_relation <50) State.variables.player.relations[speaker]+=0;

    // Add notification about improving relationship

    State.variables.temp.spoke_list[speaker] = time.hour;   
}


function drawQuestionsLinks() {
    const container = $('.talk-menu__questions');
    
    
    // Personal Questions [Array of question for each character with their story end options in dialog for MC to coose and get +- relation]
    // *Probably set as sketch with link types;

    // Create such sketches for test 
    // Sketches should be activated by some flags(opened new locations), completed quests or level of relationships with player.

    const content = `
        <a data-passage="Uni_Sketch">Questions (WIP)</a><br>   
    `;
    
    $(container).append(content);
}



function drawEducationLinks() {
    const container = $('.talk-menu__education');    
    const lstr_train = getLocalizedSystemText('talk_menu', 'train');
    const lstr_learn = getLocalizedSystemText('talk_menu', 'learn');

    
    
    // each train(swim, fight) and each learn(cook, gathering)
    // could be reqlised as tryouts of some type.

    const content = `
        <div class="tip-wrapper__link">
            <a 
                data-passage="Uni_Tryout1"
                class="link-internal chat-link chat-link--blocked" 
            >                 
                <span>${lstr_train}</span>   
            </a>

            ${getInfoTipContent('tip_functionality_tba')}
        </div>

        <br>
        
        <div class="tip-wrapper__link">
            <a 
                data-passage="Uni_Tryout1"
                class="link-internal chat-link chat-link--blocked" 
                tabindex="0"
            >                 
                <span>${lstr_learn}</span>   
            </a>

            ${getInfoTipContent('tip_functionality_tba')}
        </div>
    `;
    
    $(container).wiki( nobr(content) );
}


function drawStatsLinks() {
    const container = $('.talk-menu__stats');    
    const localized_string = getLocalizedSystemText('talk_menu', 'stats');

    
    // <img src="media/icons/talk_menu/stats.png">        
    const content = `
        <div class="tip-wrapper__link">
            <a 
                data-passage="Uni_Stats"
                class="link-internal chat-link chat-link--blocked" 
            >                 
                <span>${localized_string}</span>   
            </a>

            ${getInfoTipContent('tip_functionality_tba')}
        </div>
    `;
    
    $(container).wiki( nobr(content) );
}


function drawInventoryLinks() {
    const container = $('.talk-menu__inventory');
    const localized_string = getLocalizedSystemText('talk_menu', 'inventory');
    
    // const content = `<a data-passage="Uni_Inventory" data-setter="$temp.cur_inventory to $temp.cur_speaker">Inventory</a>`;
    // <img src="media/icons/talk_menu/inventory.png">   

    const content = `
        <div class="tip-wrapper__link">
            <a 
                data-passage="Uni_Inventory"
                class="link-internal chat-link chat-link--blocked" 
            >                      
                <span>${localized_string}</span>   
            </a>
        </div>
    `;
    
    $(container).wiki( nobr(content) );
}



function addTalkMenuLink(character_idn) {
    const character = State.variables.characters[character_idn];
    const character_schedule_day = State.variables.temp.schedule_day[character.id_name];
    const cur_hour = State.variables.time.hour.toString();

    const cur_period = character_schedule_day.findLast(period => period.hours.includes(cur_hour)); // 'findLast()' - to show latest added changes
    const activity = cur_period.activity;
    const availability = cur_period.availability ?? true;  
    const character_name = getCharacterName(character.id_name); 
    const talk_to_localized = (availability) ? getLocalizedSystemText('talk_menu', 'talk_to') : getLocalizedSystemText('talk_menu', 'talk_to_cant');
    const text_tip_na_localized = getLocalizedSystemText('tips', 'tip_character_na');
    const activity_localized = getLocalizedSystemText('character_activities', activity);
    const character_image_src = `media/characters/${character.id_name}/default.png`; 

    const has_available_quests = isAnyQuestAvailable("Talk_Menu", character.id_name); 
    const has_available_tasks = isAnyTaskAvailableForCharacter(character.id_name); 

    
    const talk_link_1 = `
        <div class="talk-link__type-1  ${(!availability) ? 'talk-link--unavailable' : ''}">
            <a 
                ${(!availability) ? 'inert' : ''} 
                data-location="Talk_Menu" 
                data-character="${character.id_name}"
                class="link-internal party-talk-link talk-link__type-1__link" 
                tabindex="0"
            >
                <img 
                    src="${character_image_src}" 
                    alt="${character_name}"    
                    class="talk-link__type-1__image"
                >  
                
                <div>
                    <p class="talk-link__type-1__name">
                        <span class="${character.id_name}">${character_name}</span>                         
                        <span class="talk-link__type-1__activity">${activity_localized}</span>                         
                    </p>
                    <div class="talk-link__type-1__lower-block">
                        <p class="talk-link__type-1__talk">${talk_to_localized}</p>
                        ${(has_available_tasks) ? getQuestMarkContent('task') : '' }
                        ${(has_available_quests) ? getQuestMarkContent() : '' }
                    </div>
                </div>
            </a>

            <span class="talk-link__na-tip tip_gen">${text_tip_na_localized}</span> 
        </div>
    `;

    const talk_link_2 = `
        <div class="talk-link__type-2 ${(!availability) ? 'talk-link--unavailable' : ''}">
            <a 
                ${(!availability) ? 'inert' : ''} 
                data-location="Talk_Menu" 
                data-character="${character.id_name}"
                class="link-internal party-talk-link talk-link__type-2__link" 
                tabindex="0"
            >
                <span class="${character.id_name} npc_text">${character_name} </span> 
                <img 
                    src="${character_image_src}" 
                    alt="${character_name}"        
                    class="talk-link__type-2__image"
                > 
            </a> 
            <span class="">&nbsp;${activity_localized}</span> 
            <span class="talk-link__na-tip tip_gen">${text_tip_na_localized}</span> 

            &nbsp; &nbsp;   
            ${(has_available_tasks) ? getQuestMarkContent('task') : '' }
            ${(has_available_quests) ? getQuestMarkContent() : '' }           
        </div>
    
    `;

    let talk_link = 'Empty talk link';
    if (character.inter_type == "type_1") talk_link = talk_link_1;
    if (character.inter_type == "type_2") talk_link = talk_link_2;


    const $link_parent = $('.passage-list__talk');
    $link_parent.wiki( nobr(talk_link) );
}
/* twine-user-script #87: "temp_costyl.js" */

// Should be removed once quests would have adequate conditions

function activateInitialQuestCostyl() {
    const quest_idn = 'initial';
    const quest_params = State.variables.quest_list[quest_idn];
    const new_quest = new Quest(quest_params); 
    State.variables.quests[new_quest.id_name] = new_quest;

    const quest = State.variables.quests[quest_idn];
    quest.status = 2;
}
/* twine-user-script #88: "thelper.js" */

$(document).on(":passagedisplay", function () {
    $(document).ready(function () {
        activateThelpersListener();
    });
});


function activateThelpersListener() {
    let timer;
    const parent_elem = $('body');
    const elem_identifier = '[data-thelper]';

    let can_clear_thelper = true;

    $(document).on('mouseenter', elem_identifier, function () {

        const thelper_pause_time = 600;
        const thelper_elem = this;
        const thelper_id = $(thelper_elem).data('thelper');
        const thelper_text = getLocalizedSystemText('thelper', thelper_id);
        const thelper_elem_position = thelper_elem.getBoundingClientRect();
        const helper_message_top = thelper_elem_position.top + window.scrollY;
        const helper_message_left = thelper_elem_position.left + window.scrollX;
        const additional_top_offset = (thelper_elem.tagName == "SPAN") ? -20 : -30;     // some elements have bigger height because of font-family
        const additional_left_offset = 10 + (Math.trunc(thelper_elem_position.width)/100*10);   // minimal of 10px + 10% from element width

        const helper_message_content = `
            <p 
                style="top: calc(${helper_message_top}px + ${additional_top_offset}px); left: calc(${helper_message_left}px + ${additional_left_offset}px)" 
                class="thelper-message thelper-message--style"
            >
                <span>${thelper_text}</spa>
            </p>
        `;

        timer = setTimeout(() => { 
            $(parent_elem).append(helper_message_content); 
            $(parent_elem).find('.thelper-message').stop().hide().fadeIn();   
            can_clear_thelper = true;
        }, thelper_pause_time);

    }).on('mouseleave mousedown', elem_identifier, function () {
        $(parent_elem).find('.thelper-message').stop().remove();
        clearTimeout(timer);
        can_clear_thelper = false;

    }).on('mouseenter', `:not(${elem_identifier})`, function () {
        if (can_clear_thelper) {
            $(parent_elem).find('.thelper-message').stop().remove();
            clearTimeout(timer); 
            can_clear_thelper = false;
        }        
    });

}

/* twine-user-script #89: "websystem_optimizations.js" */


$(document).on(":passagerender", function () {
    document.documentElement.setAttribute('lang', State.variables.settings.lang);
});

// To avoid blinking. Blinking happens because one data is loading faster then another.
$(document).on(":passagedisplay", function () {
    const $bar_body = $('#ui-bar-body');
    const $story = $('#story');    
    $bar_body.hide().fadeIn(1000);
    $story.hide().fadeIn(1000);
});


/* twine-user-script #90: "widgets.js" */

setup.getInfoTipContent = function(string_idn, size) {
    return nobr( getInfoTipContent(string_idn, size) );
}

function getInfoTipContent(string_idn, size) {
    const localized_string = getLocalizedSystemText('tips', string_idn);
    const extra_tip_class = (size == 'large') ? 'info_tip-container--large' : '';

    const content = `
        <div class="info_tip-wrapper">
            <div class="info_tip-container ${extra_tip_class}">
                <img class="info_tip-icon" src="media/icons/info_tip.png" alt="info_tip">
                <img class="info_tip-icon--hover" src="media/icons/info_tip_hover.png" alt="info_tip">
                <span class="info_tip-text tip_gen">${localized_string}</span>
            </div>
        </div>
    `;

    return content;
}


setup.getQuestMarkContent = function(entity) {
    return nobr( getQuestMarkContent(entity) );
}

function getQuestMarkContent(type='quest') {
    const content = `
        <div class="state-mark" data-state="${type}">
            <svg viewBox="0 0 100 100" class="state-mark__svg">
                <path d="M0, 20 Q50, 20 100, 20"></path>
                <path d="M0, 40 Q50, 40 100, 40"></path>
                <path d="M0, 60 Q50, 60 100, 60"></path>
                <path d="M0, 80 Q50, 80 100, 80"></path>
            </svg>
        </div>
    `;

    return content;
}</script><tw-tag name="option" color="red"></tw-tag><tw-tag name="NPC" color="yellow"></tw-tag><tw-tag name="NeedCheck" color="green"></tw-tag><tw-tag name="Sandbox" color="green"></tw-tag><tw-tag name="System" color="red"></tw-tag><tw-tag name="dialog" color="gray"></tw-tag><tw-tag name="Story" color="blue"></tw-tag><tw-tag name="DeadEnd" color="orange"></tw-tag><tw-tag name="Dialog" color="purple"></tw-tag><tw-tag name="Location" color="orange"></tw-tag><tw-tag name="Options" color="red"></tw-tag><tw-tag name="Script" color="blue"></tw-tag><tw-passagedata pid="1" name="City" tags="questionable" position="2400,1350" size="100,100">[[Return|Ferryman]]</tw-passagedata><tw-passagedata pid="2" name="Dream" tags="Location autosave nobr noreturn" position="1600,450" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_dream_out&#39; $return_passage&gt;&gt;
    &lt;&lt;set $player.health += 10;&gt;&gt;
    &lt;&lt;set $player.stamina=$player.stamina_max;&gt;&gt;
&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="3" name="Elf_House_Bloodhound" tags="Location nobr" position="3101,1898" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_village&#39; &#39;Elf_Village&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="4" name="Elf_House_Elder" tags="Location nobr" position="3101,1898" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_village&#39; &#39;Elf_Village&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="5" name="Elf_House_Herb" tags="Location nobr" position="2968,2099" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_store_herb&#39; &#39;Uni_Store&#39; &#39;gem&#39;&gt;&gt;
    &lt;&lt;set $temp.cur_store = &#39;elf_herb&#39;&gt;&gt;
&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_village&#39; &#39;Elf_Village&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="6" name="Elf_Store_Herb" tags="Store questionable" position="2799,2097" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_house_herb&#39; &#39;Elf_House_Herb&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="7" name="Elf_Village" tags="Location nobr" position="3101,1898" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_house_herb&#39; &#39;Elf_House_Herb&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_house_bloodhound&#39; &#39;Elf_House_Bloodhound&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_house_elder&#39; &#39;Elf_House_Elder&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_spring&#39; &#39;Forest_Spring&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="8" name="Fight" tags="System Fight NoSave" position="3000,100" size="100,100">&lt;&lt;nobr&gt;&gt;

	&lt;&lt;set $roundList = [];&gt;&gt;

	&lt;&lt;set $party_enemy_temp = $party_enemy.party &gt;&gt;  /* Check if possible to move to temp variables */
	&lt;&lt;set $party_hero_temp = $party_hero.party &gt;&gt;



	&lt;&lt;set $actions = {
		1: {
			action: &quot;attack&quot;,
			title: &quot;Attack&quot;
		},
		2: {
			action: &quot;magic_attack&quot;,
			title: &quot;Magical Attack&quot;
		},
		3: {
			action: &quot;specials&quot;,
			title: &quot;Specials&quot;
		},
		4: {
			action: &quot;heal&quot;,
			title: &quot;Heal&quot;
		},
		5: {
			action: &quot;rest&quot;,
			title: &quot;Rest a little&quot;
		},
		6: {
			action: &quot;flee&quot;,
			title: &quot;Flee&quot;
		}

	};&gt;&gt;

	&lt;&lt;if $battleMode == 0&gt;&gt;
		&lt;&lt;set $prevLocation = previous()&gt;&gt;
		&lt;&lt;set $currentTurn = $party_hero.side&gt;&gt;
		&lt;&lt;set $battleMode = 1&gt;&gt;

	&lt;&lt;elseif $battleMode == 2&gt;&gt;
		received &lt;&lt;print $battle_xp&gt;&gt; xp.
		/* &lt;&lt;set $player.exp += $enemy.exp&gt;&gt;   -- -- -- DEAL WITH XP -- -- -- */
		&lt;br&gt;

		&lt;br&gt;
		You beat the enemy, congratulations!
		&lt;br&gt;
		&lt;br&gt;

		&lt;&lt;link &quot;Return&quot; $prevLocation&gt;&gt;
			&lt;&lt;unset $party_enemy_temp &gt;&gt;
			&lt;&lt;unset $party_hero_temp &gt;&gt;

			&lt;&lt;set $battleMode = 0&gt;&gt;
			&lt;&lt;set $player.exp += $battle_xp&gt;&gt;		
			&lt;&lt;unset $battle_xp&gt;&gt;
		&lt;&lt;/link&gt;&gt;
		

		/* ADD widjet or Macro for DeadEND */
	&lt;&lt;elseif $battleMode == 3 &gt;&gt;
		*Remove smth*
		&lt;br&gt;
		&lt;&lt;fadein 2s 0.5s&gt;&gt; 
			@@.deadend;
			You died
			@@
			&lt;br&gt;
			&lt;br&gt;
			&lt;br&gt;
			..too bad!(
			&lt;br&gt;		
			&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;link &quot;Restart&quot;&gt;&gt;
				&lt;&lt;script&gt;&gt;Engine.restart()&lt;&lt;/script&gt;&gt;
			&lt;&lt;/link&gt;&gt;
			&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;link &quot;Saves&quot;&gt;&gt;
				&lt;&lt;script&gt;&gt;UI.saves()&lt;&lt;/script&gt;&gt;
			&lt;&lt;/link&gt;&gt;
		&lt;&lt;/fadein&gt;&gt;
	&lt;&lt;/if &gt;&gt;

	&lt;&lt;if $battleMode == 4&gt;&gt;
		Your party escaped the battle
		&lt;br&gt;
		*You loose stamina + money/equipment/xp
		&lt;br&gt;
		&lt;&lt;link &quot;Return&quot; $prevLocation&gt;&gt;
			&lt;&lt;unset $party_enemy_temp &gt;&gt;
			&lt;&lt;unset $party_hero_temp &gt;&gt;
			
			&lt;&lt;set $battleMode = 0&gt;&gt;
		&lt;&lt;/link&gt;&gt;

	&lt;&lt;/if &gt;&gt;


	&lt;&lt;if $battleMode == 1&gt;&gt;
		
		battle mod: $battleMode
		&lt;br&gt;
		previous location: $prevLocation
		&lt;br&gt;
		currentTurn: &lt;span id=&quot;currentTurn&quot;&gt;$currentTurn&lt;/span&gt;
		&lt;br&gt;
		&lt;br&gt;
		Log: &lt;span id=&#39;last_action&#39;&gt;&lt;/span&gt;
		&lt;br&gt;
		&lt;br&gt;

		&lt;div class=&quot;fight__area&quot;&gt;
			&lt;div class=&quot;fight__side fight__side--hero&quot;&gt;&lt;/div&gt;
			&lt;div class=&quot;fight__side fight__side--enemy&quot;&gt;&lt;/div&gt;
		&lt;/div&gt;
		
		&lt;br&gt;
		&lt;div id=&quot;heroTurn&quot; class=&quot;fight__action-block&quot;&gt;
			Choose enemy!
		&lt;/div&gt;

		&lt;div id=&quot;autoTurn&quot; class=&quot;fight__action-block&quot;&gt;
			&lt;br&gt;
			&lt;button class=&quot;autoAction&quot;&gt;Auto turn&lt;/button&gt;
			&lt;br&gt;
		&lt;/div&gt;

		&lt;div id=&quot;finishBattle&quot; class=&quot;fight__action-block&quot;&gt;
			&lt;br&gt;
			&lt;button&gt;Finish Battle&lt;/button&gt;
			&lt;br&gt;
		&lt;/div&gt;

	&lt;&lt;/if &gt;&gt;

&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="9" name="Forest" tags="Location nobr" position="3101,1394" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_lake&#39; &#39;Village_Outside_Lake&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_deep&#39; &#39;Forest_Deep&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;</tw-passagedata><tw-passagedata pid="10" name="Forest_Deep" tags="Location nobr" position="2895,1593" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_swamp&#39; &#39;Forest_Swamp&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_spring&#39; &#39;Forest_Spring&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="Forest_Edge" tags="Location nobr" position="3758,1900" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_deep&#39; &#39;Forest_Deep&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_hut_witch&#39; &#39;Forest_Hut_Witch&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="12" name="Forest_Hut_Witch" tags="Location nobr" position="3503,1801" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_hut_witch_bedroom&#39; &#39;Forest_Hut_Witch_Bedroom&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_swamp&#39; &#39;Forest_Swamp&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_edge&#39; &#39;Forest_Edge&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="13" name="Forest_Hut_Witch_Bedroom" tags="Location nobr" position="3503,1801" size="100,100">&lt;&lt;mirror_passage&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_hut_witch&#39; &#39;Forest_Hut_Witch&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="Forest_Spring" tags="Location nobr" position="2898,1798" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_elf_village&#39; &#39;Elf_Village&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_deep&#39; &#39;Forest_Deep&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="15" name="Forest_Swamp" tags="Location nobr" position="3295,1653" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_deep&#39; &#39;Forest_Deep&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest_hut_witch&#39; &#39;Forest_Hut_Witch&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="16" name="Home_Bedroom" tags="Location nobr" position="1400,450" size="100,100">&lt;&lt;mirror_passage&gt;&gt;

&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_hallway&#39; &#39;Home_Hallway&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;


/* &lt;&lt;passage &#39;passages&#39; &#39;passage_dream&#39; &#39;Dream&#39;&gt;&gt;
    &lt;&lt;set $player.health += 10&gt;&gt; 
    &lt;&lt;set $player.stamina += 30&gt;&gt;
    &lt;&lt;run setup.autosave() &gt;&gt;
&lt;&lt;/passage&gt;&gt; */</tw-passagedata><tw-passagedata pid="17" name="Home_Hallway" tags="Location nobr" position="1200,650" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_bedroom&#39; &#39;Home_Bedroom&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; 
    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_parents_room&#39; &#39;Home_Parents_Room&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; 
    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_kitchen&#39; &#39;Home_Kitchen&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;
    
    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="18" name="Home_Kitchen" tags="Location nobr" position="1200,500" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_hallway&#39; &#39;Home_Hallway&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="19" name="Home_Parents_Room" tags="Location nobr" position="1200,650" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_hallway&#39; &#39;Home_Hallway&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="20" name="Home_Yard" tags="Location nobr" position="1600,750" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_hallway&#39; &#39;Home_Hallway&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard_bath&#39; &#39;Home_Yard_Bath&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard_toilet&#39; &#39;Home_Yard_Toilet&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_shed&#39; &#39;Village_West_Shed&#39; &#39;location&#39; true true&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="21" name="Home_Yard_Bath" tags="Location nobr" position="1800,550" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="22" name="Home_Yard_Toilet" tags="Location nobr" position="1800,700" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="23" name="House_Alura" tags="Location nobr" position="900,1200" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="24" name="House_Baxter" tags="Location nobr" position="1300,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="25" name="House_Ferryman" tags="Location nobr" position="2400,1200" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_kennels&#39; &#39;Village_Kennels&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="26" name="House_Mercer" tags="Location nobr" position="1925,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_store_mercer&#39; &#39;Uni_Store&#39; &#39;gem&#39;&gt;&gt;
    &lt;&lt;set $temp.cur_store = &#39;village_mercer&#39;&gt;&gt;
&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="27" name="House_Ostler" tags="Location nobr" position="2525,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_stables&#39; &#39;Village_Stables&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="28" name="House_Smith" tags="Location nobr" position="725,1200" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_store_smith&#39; &#39;Uni_Store&#39; &#39;gem&#39; false &#39;tip_functionality_wip_beta&#39;&gt;&gt;
        &lt;&lt;set $temp.cur_store = &#39;village_smith&#39;&gt;&gt;
    &lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="29" name="House_Steward" tags="Location nobr" position="1800,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="House_Taylor" tags="Location nobr" position="1100,1200" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="31" name="House_Wizard" tags="Location nobr" position="2150,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="32" name="Info_Disclaimer" tags="System nobr" position="1325,250" size="100,100">&lt;div class=&quot;disclaimer-header&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_general_title&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;/div&gt;

&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_general_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_general_2&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_age_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_age_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_age_2&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_matches_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_matches_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_matches_2&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_nonencourage_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_nonencourage_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_nonencourage_2&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_violent_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_violent_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_violent_2&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_violent_3&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_2&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_3&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_4&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_assets_5&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_commercial_title&#39;&gt;&gt;
&lt;/div&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_commercial_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_commercial_2&#39;&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;&lt;br 2&gt;&gt;  
&lt;div class=&quot;disclaimer-title&quot;&gt;
	&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_to_players_title&#39;&gt;&gt;
&lt;/div&gt;

&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_to_players_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;u&gt;&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_to_players_2&#39;&gt;&gt;&lt;&lt;br&gt;&gt;&lt;/u&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_to_players_3&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_to_players_4&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;br 3&gt;&gt;



&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_end_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_end_2&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_disclaimer&#39; &#39;disclaimer_end_3&#39;&gt;&gt;&lt;&lt;br&gt;&gt;


&lt;&lt;br 2&gt;&gt;
 
&lt;button class=&quot;custom-btn btn-apply btn-thelper&quot; style=&quot;margin-right: 40px;&quot;&gt;		
  &lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_disclaimer_refuse&#39;&gt;&gt;&quot; `previous()`&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt;

&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_disclaimer_accept&#39;&gt;&gt;&quot; &#39;Info_Story&#39;&gt;&gt;    
    &lt;&lt;set $settings.interface.menu_core.settings = 1&gt;&gt;
    &lt;&lt;set $settings.interface.menu_core.restart = 1&gt;&gt;
    &lt;&lt;script&gt;&gt;UIBar.unstow();&lt;&lt;/script&gt;&gt;
  &lt;&lt;/link&gt;&gt;
&lt;/button&gt;</tw-passagedata><tw-passagedata pid="33" name="Info_Interface" tags="System nobr noreturn menu_tab" position="1325,250" size="100,100">&lt;&lt;menu_tabs 6 &#39;info_interface&#39;&gt;&gt;



&lt;&lt;if $temp.menu_tab == 1 &gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_main_list_1&#39;&gt;&gt;
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_main_list_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_main_list_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

    
    &lt;&lt;menu_item_arrow 2 &#39;info_interface&#39; &#39;info_main_list_item_1&#39; &#39;info_main_list_item_status_1&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 3 &#39;info_interface&#39; &#39;info_main_list_item_2&#39; &#39;info_main_list_item_status_1&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 4 &#39;info_interface&#39; &#39;info_main_list_item_3&#39; &#39;info_main_list_item_status_2&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow false &#39;info_interface&#39; &#39;info_main_list_item_4&#39; &#39;info_main_list_item_status_1&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow false &#39;info_interface&#39; &#39;info_main_list_item_5&#39; &#39;info_main_list_item_status_4&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow false &#39;info_interface&#39; &#39;info_main_list_item_6&#39; &#39;info_main_list_item_status_3&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow false &#39;info_interface&#39; &#39;info_main_list_item_7&#39; &#39;info_main_list_item_status_3&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow false &#39;info_interface&#39; &#39;info_main_list_item_8&#39; &#39;info_main_list_item_status_2&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 5 &#39;info_interface&#39; &#39;info_main_list_item_9&#39; &#39;info_main_list_item_status_2&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 6 &#39;info_interface&#39; &#39;info_main_list_item_10&#39; &#39;info_main_list_item_status_1&#39;&gt;&gt;

&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 2&gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_1&#39;&gt;&gt; 
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_2&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location.png&quot;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_3&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;
    
    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_title&#39;&gt;&gt;&lt;/u&gt;   &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_1&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location_characters.png&quot;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_2&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_3&#39;&gt;&gt;  &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_5&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_character_interaction_6&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location_characters_type2.png&quot;&gt; &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location_characters_type2_part2.png&quot;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_title&#39;&gt;&gt;&lt;/u&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_1&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;

    &lt;a class=&quot;link-internal link-contents link-activity&quot; tabindex=&quot;0&quot;&gt;     
       &lt;&lt;text_system &#39;activities&#39; &#39;wait&#39;&gt;&gt;  
    &lt;/a&gt;&lt;&lt;br&gt;&gt;

    &lt;div class=&quot;link-activity link-contents link-activity--fake&quot;&gt;             
        &lt;p class=&quot;link-fake__tip-text tip_gen&quot;&gt; &lt;&lt;text_system &#39;activity_reasons&#39; &#39;time&#39;&gt;&gt;   &lt;/p&gt;             
        &lt;div class=&quot;link-content-wrapper&quot;&gt;                 
            &lt;div class=&quot;link-content-container link-underline-container&quot;&gt;                               
                &lt;&lt;text_system &#39;activities&#39; &#39;sleep&#39;&gt;&gt;                 
            &lt;/div&gt;             
        &lt;/div&gt;         
    &lt;/div&gt;&lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_2&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_3&#39;&gt;&gt;&lt;/i&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_5&#39;&gt;&gt; &lt;/i&gt;&lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_activities_6&#39;&gt;&gt;  &lt;&lt;br&gt;&gt; 

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_title&#39;&gt;&gt;&lt;/u&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_1&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location_mirror_link.png&quot;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_2&#39;&gt;&gt;  &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_3&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
    
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_location_mirror_space_5&#39;&gt;&gt; &lt;/i&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/location_mirror_question.png&quot;&gt; &lt;&lt;br&gt;&gt;


&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 3&gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;    
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_1&#39;&gt;&gt; 
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;a 
        class=&quot;quest-btn link-internal&quot;
    &gt;	
        &lt;&lt;= setup.getQuestMarkContent()&gt;&gt;

        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_button&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;
    &lt;/a&gt;
    &lt;&lt;br&gt;&gt; 

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;i&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_7&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_8&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/i&gt; 

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_title&#39;&gt;&gt;&lt;/u&gt;   &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_1_1&#39;&gt;&gt;  &lt;i&gt;(&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_1_2&#39;&gt;&gt;)&lt;/i&gt;  &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_1_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;a class=&quot;link-internal task-link&quot; tabindex=&quot;0&quot;&gt;            
        &lt;img class=&quot;task-link__icon&quot; src=&quot;media/icons/task/fight.png&quot; data-thelper=&quot;task_type__fight&quot; alt=&quot;fight&quot;&gt;
        &lt;img class=&quot;task-link__icon--hover&quot; src=&quot;media/icons/task/fight_hover.png&quot; data-thelper=&quot;task_type__fight&quot; alt=&quot;fight&quot;&gt;
        
        &lt;p class=&quot;task-link__text&quot;&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_button&#39;&gt;&gt;&lt;/p&gt;
    &lt;/a&gt; 

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;div class=&quot;task-link task-link--search task-link--fake&quot;&gt;
        &lt;p class=&quot;link-fake__tip-text tip_gen&quot;&gt; &lt;&lt;text_system &#39;task_conditions&#39; &#39;search&#39;&gt;&gt; &lt;/p&gt;
        
        &lt;img class=&quot;task-link__icon&quot; src=&quot;media/icons/task/search.png&quot; data-thelper=&quot;task_type__search&quot; alt=&quot;search&quot;&gt;
        &lt;p class=&quot;task-link__text&quot;&gt;&lt;&lt;text_system &#39;tasks&#39; &#39;search&#39;&gt;&gt;&lt;/p&gt;
    &lt;/div&gt;
    &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;&lt;/i&gt;

    &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_6_1&#39;&gt;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_6_2&#39;&gt;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_6_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_7&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/i&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_tasks_8&#39;&gt;&gt; &lt;&lt;br&gt;&gt;  

    &lt;&lt;br 2&gt;&gt;  

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_title&#39;&gt;&gt;&lt;/u&gt;   &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;  
    &lt;i&gt;&lt;small&gt; *(&lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_2_1&#39;&gt;&gt; &lt;a data-passage=passage() data-setter=&quot;$temp.menu_tab to 2&quot;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_2_2&#39;&gt;&gt; &lt;/a&gt;  )&lt;/small&gt;&lt;/i&gt;  &lt;&lt;br&gt;&gt;  
    &lt;a class=&quot;passage-special passage-special--mirror link-internal&quot; data-thelper=&quot;mirror&quot; tabindex=&quot;0&quot; role=&quot;link&quot;&gt; 			
        &lt;img src=&quot;media/icons/mirror.png&quot;&gt; 			
        &lt;&lt;text_system &#39;misc&#39; &#39;mirror_reflect&#39;&gt;&gt;		 				
        &lt;&lt;= setup.getQuestMarkContent()&gt;&gt;		 		
    &lt;/a&gt; &lt;&lt;br&gt;&gt;


    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;  
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/quest_location_mirror_question.png&quot;&gt; &lt;&lt;br 2&gt;&gt;
    
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_mark_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;  
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/talk_link_quest.png&quot;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 4&gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_1&#39;&gt;&gt; 
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_3&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_5_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_5_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/i&gt; &lt;&lt;br&gt;&gt;


    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_6&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;&lt;/u&gt;

    &lt;div class=&quot;text-block&quot;&gt;
        &lt;div class=&quot;narration-block&quot;&gt; 					
            &lt;img class=&quot;narration-block_img&quot; src=&quot;media/icons/sketch/narration.png&quot; alt=&quot;narration&quot; data-thelper=&quot;narration&quot;&gt; 					
            &lt;span class=&quot;narration-block_text&quot;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_text_narration&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/span&gt; 				
        &lt;/div&gt; 
    &lt;/div&gt; &lt;&lt;br 2&gt;&gt;

    &lt;div class=&quot;text-block&quot;&gt;
        &lt;div class=&quot;thought-block&quot;&gt; 					
            &lt;img class=&quot;thought-block_img&quot; src=&quot;media/icons/sketch/thought.png&quot; alt=&quot;thought&quot; data-thelper=&quot;thought&quot;&gt; 					
            &lt;span class=&quot;thought-block_text&quot;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_text_thought&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/span&gt; 				
        &lt;/div&gt;
    &lt;/div&gt;  &lt;&lt;br 2&gt;&gt;

    &lt;div class=&quot;text-block&quot;&gt;
        &lt;div class=&quot;gesture-block&quot;&gt; 					
            &lt;img class=&quot;gesture-block_img&quot; src=&quot;media/icons/sketch/gesture.png&quot; alt=&quot;gesture&quot; data-thelper=&quot;gesture&quot;&gt; 					
            &lt;span class=&quot;gesture-block_text&quot;&gt; &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_text_gesture&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;/span&gt; 				
        &lt;/div&gt; 
    &lt;/div&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;br&gt;&gt;
    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_7&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;&lt;/u&gt;
    &lt;div class=&quot;speech&quot; data-character=&quot;barret&quot; data-text=&quot;setting_debug_mode_text&quot; data-posture=&quot;default&quot;&gt;&lt;/div&gt;


    &lt;&lt;br 2&gt;&gt;
    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_8&#39;&gt;&gt; &lt;&lt;br&gt;&gt;&lt;/u&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_9&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;
    
    &lt;a data-location=&quot;Uni_Sketch&quot; class=&quot;link-internal choice-link--default&quot; tabindex=&quot;0&quot;&gt; 
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_choice_default&#39;&gt;&gt;
    &lt;/a&gt; 
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_10&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;a class=&quot;link-internal deadend-link&quot;  tabindex=&quot;0&quot; data-thelper=&quot;dead_end&quot;&gt; 
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_choice_deadend&#39;&gt;&gt;   
        &lt;img src=&quot;media/icons/sketch/deadend.png&quot;&gt;         
    &lt;/a&gt; 
    
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_11&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_12&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_13&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_14&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;a style=&quot;margin-bottom: 20px&quot; class=&quot;link-icon link-contents link-pixel-border link-underline link-internal&quot; tabindex=&quot;0&quot;&gt; 
        &lt;div class=&quot;link-content-wrapper&quot;&gt;                 
            &lt;div class=&quot;link-content-container link-underline-container&quot;&gt;                        
                &lt;i class=&quot;ra ra-location&quot;&gt;&lt;/i&gt;           
                &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_choice_location&#39;&gt;&gt;           
            &lt;/div&gt;             
        &lt;/div&gt;
    &lt;/a&gt;&lt;&lt;br&gt;&gt;
    
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_15&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;a 
        class=&quot;quest-btn link-internal&quot;
    &gt;	
        &lt;&lt;= setup.getQuestMarkContent()&gt;&gt;

        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_qt_button&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;
    &lt;/a&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_16&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sketch_17&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 5&gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;        
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_title&#39;&gt;&gt; 
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_title&#39;&gt;&gt;&lt;/u&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/popup.png&quot;&gt; &lt;&lt;br 2&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;i&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_3&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt; &lt;/i&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_popup_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_modals_title&#39;&gt;&gt;&lt;/u&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_modals_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_modals_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/modal.png&quot;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_title&#39;&gt;&gt;&lt;/u&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/modal_game_clue.png&quot;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_game_clues_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_info_tips_title&#39;&gt;&gt;&lt;/u&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_info_tips_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_info_tips_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;info_tip &#39;tip_example&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_info_tips_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;br 2&gt;&gt;

    &lt;u&gt;&lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_thelpers_title&#39;&gt;&gt;&lt;/u&gt;  &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_thelpers_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_tips_thelpers_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/thelper.png&quot;&gt; &lt;&lt;br&gt;&gt;

    

&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 6&gt;&gt;

    &lt;div class=&quot;disclaimer-title&quot;&gt;
        &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_1&#39;&gt;&gt; 
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/title_n_logo.png&quot;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/timing.png&quot;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/main_stats_bars.png&quot;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/expirience_bar.png&quot;&gt; &lt;&lt;br 2&gt;&gt;

    &lt;&lt;text_system &#39;info_interface&#39; &#39;info_sidebar_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
    &lt;img class=&quot;interface-desc__image&quot; src=&quot;media/misc/author_n_version.png&quot;&gt; &lt;&lt;br 2&gt;&gt;

&lt;&lt;/if&gt;&gt;



&lt;&lt;br 3&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="34" name="Info_Project" tags="System nobr noreturn menu_tab" position="1600,450" size="100,100">&lt;&lt;menu_tabs 4 &#39;info_project&#39;&gt;&gt;



&lt;&lt;if $temp.menu_tab == 1 &gt;&gt;
    &lt;div class=&quot;disclaimer-title&quot;&gt;
        &lt;&lt;text_system &#39;info_project&#39; &#39;info_main_list_1&#39;&gt;&gt;
    &lt;/div&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;text_system &#39;info_project&#39; &#39;info_main_list_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;


    &lt;&lt;menu_item_arrow 2 &#39;info_project&#39; &#39;main_list_item_1&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 3 &#39;info_project&#39; &#39;main_list_item_2&#39;&gt;&gt;
    &lt;&lt;menu_item_arrow 4 &#39;info_project&#39; &#39;main_list_item_3&#39;&gt;&gt;

&lt;&lt;br 3&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;if $temp.menu_tab == 2 &gt;&gt;
  &lt;div class=&quot;disclaimer-title&quot;&gt;
    &lt;&lt;text_system &#39;info_project&#39; &#39;company_1&#39;&gt;&gt; 
  &lt;/div&gt; &lt;&lt;br&gt;&gt;

  &lt;&lt;text_system &#39;info_project&#39; &#39;company_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;company_3&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

  &lt;&lt;text_system &#39;info_project&#39; &#39;company_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;company_5&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

  &lt;&lt;text_system &#39;info_project&#39; &#39;company_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;if $temp.menu_tab == 3 &gt;&gt;
  &lt;div class=&quot;disclaimer-title&quot;&gt;
    &lt;&lt;text_system &#39;info_project&#39; &#39;project_1&#39;&gt;&gt; 
  &lt;/div&gt; &lt;&lt;br&gt;&gt;
  
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_3&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

  &lt;div class=&quot;disclaimer-subtitle&quot;&gt; 
    &lt;&lt;text_system &#39;info_project&#39; &#39;project_story_title&#39;&gt;&gt; 
  &lt;/div&gt; 
  
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_story_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_story_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;


  &lt;div class=&quot;disclaimer-subtitle&quot;&gt;
    &lt;&lt;text_system &#39;info_project&#39; &#39;project_structure_title&#39;&gt;&gt; 
  &lt;/div&gt; 

  &lt;&lt;text_system &#39;info_project&#39; &#39;project_structure_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_structure_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;i&gt; &lt;&lt;text_system &#39;info_project&#39; &#39;project_structure_3&#39;&gt;&gt; &lt;/i&gt;  &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_structure_4&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;


  &lt;div class=&quot;disclaimer-subtitle&quot;&gt; 
    &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_title&#39;&gt;&gt; 
  &lt;/div&gt; 
  
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3_1&#39;&gt;&gt;; &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3_2&#39;&gt;&gt;; &lt;&lt;br&gt;&gt; 
  - &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3_3&#39;&gt;&gt;; &lt;&lt;br&gt;&gt; 
  - &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3_4&#39;&gt;&gt;; &lt;&lt;br&gt;&gt; 
  - &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_3_5&#39;&gt;&gt;; &lt;&lt;br 2&gt;&gt; 
  
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4_0&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_distribution_4_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt;


  &lt;&lt;br 2&gt;&gt;
  &lt;div class=&quot;disclaimer-subtitle&quot;&gt; 
    &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_title&#39;&gt;&gt; 
  &lt;/div&gt; 

  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_4&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;
  
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
  &lt;&lt;text_system &#39;info_project&#39; &#39;project_tags_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;/if&gt;&gt;



&lt;&lt;if $temp.menu_tab == 4 &gt;&gt;
  &lt;div class=&quot;disclaimer-title&quot;&gt; 
    &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_1&#39;&gt;&gt; 
  &lt;/div&gt; &lt;&lt;br&gt;&gt;

  &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_1&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_2&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_3&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_5&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_6&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_7&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
  - &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_2_8&#39;&gt;&gt;  &lt;&lt;br 3&gt;&gt;

  /* &lt;&lt;set _link_jira = setup.getSocialLink(&#39;jira&#39;)&gt;&gt; */
  /* &lt;&lt;text_system &#39;info_project&#39; &#39;next_release_3&#39;&gt;&gt; &lt;a style=&quot;display: inline-block !important;&quot; class=&quot;social_link&quot; @href=_link_jira&gt;Jira&lt;/a&gt; &lt;&lt;br&gt;&gt; */
  *&lt;&lt;text_system &#39;info_project&#39; &#39;next_release_4&#39;&gt;&gt;  &lt;&lt;br&gt;&gt;
&lt;&lt;/if&gt;&gt;


&lt;&lt;br 3&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="35" name="Info_Story" tags="System nobr tab_menu" position="1325,250" size="100,100">&lt;div class=&quot;disclaimer-title&quot;&gt;&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_title&#39;&gt;&gt; &lt;/div&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_2&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_geoposition&#39; &#39;large&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_3&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_4&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_5&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_6&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;br&gt;&gt; 

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_7&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_8&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;br&gt;&gt; 

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_9&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_10&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_11_1&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_trespassers&#39; &#39;large&#39;&gt;&gt; &lt;&lt;text_system &#39;info_story&#39; &#39;info_story_11_2&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;br&gt;&gt; 

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_12&#39;&gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;br&gt;&gt; 

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_13&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_name&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_name&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 
&lt;div class=&quot;mc&quot;&gt; &lt;&lt;textbox &quot;$misc.player_name&quot; setup.getPlayerName()&gt;&gt; &lt;/div&gt;&lt;&lt;br 2&gt;&gt;
&lt;&lt;br 4&gt;&gt;

&lt;&lt;text_system &#39;info_story&#39; &#39;info_story_wake_up&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;passage &#39;info_story&#39; &#39;info_story_link_bedroom&#39; &#39;Uni_Location&#39;&gt;&gt;
    &lt;&lt;set $temp.custom_location = &#39;prologue_1&#39;&gt;&gt;
    &lt;&lt;set $settings.interface.time.day_of_week = 1, $settings.interface.time.month = 1, $settings.interface.time.hours = 1,
      $settings.interface.stats.player_name = 1,
      $settings.interface.bars.health = 1, $settings.interface.bars.stamina = 1, $settings.interface.bars.mana = 1,
      $settings.interface.exp.level = 1,
      $settings.interface.menu_story.help = 1
    &gt;&gt;
		&lt;&lt;run setup.changePlayerName()&gt;&gt;
&lt;&lt;/passage&gt;&gt;


&lt;&lt;if $settings.debug == 1&gt;&gt;
&lt;&lt;br 2&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
  &lt;&lt;link &quot;&lt;&lt;text_system &#39;info_story&#39; &#39;info_skip_passage&#39;&gt;&gt;&quot; &#39;Uni_Location&#39;&gt;&gt;
      &lt;&lt;set $temp.custom_location = &#39;skip_passage&#39;&gt;&gt;
  &lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 2&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* &#39;Skip Passage&#39; */</tw-passagedata><tw-passagedata pid="36" name="InitialDream" tags="Story" position="1500,250" size="100,100">You wake up in you room. 
You&#39;ve seen a strange dream it seems like  you have been introduced to this new world. 
This is a little strange, because although you know little about the variety of things in this world, it is the world where you&#39;ve been living all your life.

...
@@.mind;
Maybe it doesn&#39;t really metter. 
@@\
...
@@.mc;
 - A dream is just a dream.
@@\

[[WakeUp|InitialQuest1]]</tw-passagedata><tw-passagedata pid="37" name="Menu_Debug" tags="System nobr noreturn" position="0,1300" size="100,100">[[Constructors|Uni_Constructor_List]]


&lt;&lt;br 2&gt;&gt;
[[Cheat Room|Test_Room]]


&lt;&lt;br 2&gt;&gt;
Test passages: 
&lt;&lt;br&gt;&gt;
[[Custom location|Uni_Location][$temp.custom_location = &#39;test_1&#39;]]
&lt;&lt;br&gt;&gt;
[[Uni_Store|Uni_Store]]
&lt;&lt;br&gt;&gt;
[[Uni_Sketch][$temp.sketch_dialog = true; $temp.cur_sketch = &#39;sketch_demo_1&#39;]]



&lt;&lt;br 3&gt;&gt;
Extra return passage: &lt;&lt;br&gt;&gt;
&lt;&lt;link &#39;Home Bedroom&#39; &#39;Home_Bedroom&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;

&lt;&lt;br 3&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="38" name="Menu_Help" tags="System nobr noreturn" position="0,1175" size="100,100">/* &lt;div class=&quot;disclaimer-subtitle&quot;&gt;
   &lt;p&gt; Need help? Yeah, me too( &lt;/p&gt;
&lt;/div&gt; &lt;&lt;br 3&gt;&gt; */

&lt;div class=&quot;disclaimer-title&quot;&gt;
 &lt;p&gt; -- THIS PAGE IS IN DEVELOPMENT -- &lt;/p&gt; &lt;&lt;br 3&gt;&gt;
&lt;/div&gt;

/* &lt;&lt;first&gt;&gt;
    &lt;&lt;set $rarity_list_description = {
        &#39;Defective&#39;: &#39;Extremely terrible quality or significantly damaged items.&#39;, 
        &#39;Junk&#39;: &#39;Poor quality or slightly damaged items.&#39;, 
        &#39;Common&#39;: &#39;Base quality items.&#39;, 
        &#39;Uncommon&#39;: &#39;Good quality items.&#39;,
        &#39;Rare&#39;: &#39;Excellent quality items.&#39;,
        &#39;Epic&#39;: &#39;Supreme quality items. Could turn the tide of the battle.&#39;,
        &#39;Legendary&#39;: &quot;Items that are national treasures. Only small amount of people in the world can create them ... in few dozens years each.&quot;,
        &#39;Artifact&#39;: &#39;Items that are unrepeatable, unbreakable, extremely difficult to handle and endowed with enormous power.&#39;,
        &#39;Divine&#39;: &#39;It is said that those items were received directly from gods.&#39;
    };&gt;&gt;
&lt;&lt;/first&gt;&gt;


The higher the rarity, the more difficult it is to use (level check).
&lt;br&gt;
&lt;br&gt;

Items rarity:
&lt;br&gt;
&lt;br&gt;

&lt;div id=&quot;rarity_legend&quot;&gt;&lt;/div&gt;
&lt;&lt;run setup.showRarityLegend()&gt;&gt;

&lt;br&gt;
&lt;br&gt; */


&lt;&lt;text_system &#39;menu_help&#39; &#39;menu_help_info_interface_suggest&#39;&gt;&gt; &lt;&lt;br&gt;&gt; 

&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_interface&#39;&gt;&gt;&quot; &#39;Info_Interface&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 3&gt;&gt;

&lt;&lt;text_system &#39;menu_help&#39; &#39;menu_help_info_interface_discord&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;a target=&quot;_blank&quot; href=&quot;https://discordapp.com/channels/1172881425998037094/1172881425998037096&quot;&gt;&lt;&lt;text_system &#39;socials&#39; &#39;link_to_discord&#39;&gt;&gt;&lt;/a&gt;  &lt;&lt;br&gt;&gt;


&lt;&lt;br 3&gt;&gt;
&lt;&lt;text_system &#39;index&#39; &#39;index_info_project_text&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_project&#39;&gt;&gt;&quot; &#39;Info_Project&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 4&gt;&gt;


&lt;&lt;br 4&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="39" name="Menu_Info" tags="System nobr noreturn" position="0,1425" size="100,100">&lt;div class=&quot;disclaimer-title&quot;&gt;
 &lt;p&gt; -- THIS PAGE IS IN DEVELOPMENT -- &lt;/p&gt; &lt;&lt;br 4&gt;&gt;
&lt;/div&gt;


/* Days in game: &lt;&lt;print $total_day&gt;&gt;&lt;&lt;br&gt;&gt; */
/* Total expierence: &lt;&lt;print $player.total_exp&gt;&gt;&lt;&lt;br&gt;&gt; */



&lt;&lt;br 4&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="40" name="Menu_Inventory" tags="System nobr noreturn" position="0,1675" size="100,100">-- THIS PAGE IS IN DEVELOPMENT  -- &lt;&lt;br 2&gt;&gt;


Equiped:
&lt;br&gt;
&lt;br&gt;
Primary weapon: &lt;&lt;print $player.inventory.in_use.primary.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.primary.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.primary = false; ]] 
    &lt;&lt;/if&gt;&gt;
    &lt;br&gt;
Secondary weapon: &lt;&lt;print $player.inventory.in_use.secondary.name&gt;&gt; 
    &lt;&lt;if ($player.inventory.in_use.secondary.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.secondary = false; ]]   
    &lt;&lt;/if&gt;&gt;
&lt;br&gt;
head: &lt;&lt;print $player.inventory.in_use.head.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.head.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.head = false; ]]   
    &lt;&lt;/if&gt;&gt;
&lt;br&gt;
body: &lt;&lt;print $player.inventory.in_use.body.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.body.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.body = false; ]]   
    &lt;&lt;/if&gt;&gt;
&lt;br&gt;
arms: &lt;&lt;print $player.inventory.in_use.arms.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.arms.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.arms = false; ]]   
    &lt;&lt;/if&gt;&gt;
&lt;br&gt;
legs: &lt;&lt;print $player.inventory.in_use.legs.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.legs.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.legs = false; ]]   
    &lt;&lt;/if&gt;&gt;
&lt;br&gt;
foot: &lt;&lt;print $player.inventory.in_use.foot.name&gt;&gt;
    &lt;&lt;if ($player.inventory.in_use.foot.name)  &gt;&gt;
        [[Uneqip|Menu_Inventory][$player.inventory.in_use.foot = false; ]]   
    &lt;&lt;/if&gt;&gt;

&lt;br&gt;
&lt;br&gt;

/* ADD ABILITY TO STUCK CONSUMABLES with identic properties - !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11111*/

Weapons:

&lt;&lt;run setup.showWeapons($player.inventory.weapons, $player.inventory.in_use, &#39;weapons&#39;)&gt;&gt;

&lt;&lt;run setup.showArmor($player.inventory.armor, $player.inventory.in_use, &#39;armor&#39;)&gt;&gt;

&lt;&lt;run setup.showPotions($player.inventory.potions, &#39;potions&#39;)&gt;&gt;

/* &lt;&lt;run setup.showMisc($player.inventory.misc.food, &#39;misc&#39;, &#39;food&#39;)&gt;&gt; */

/* &lt;&lt;run setup.showMisc($player.inventory.misc.materials, &#39;misc&#39;, &#39;materials&#39;)&gt;&gt; */


&lt;table class=&quot;table-items&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th scope=&quot;col&quot; class=&quot;table-items__image&quot;&gt;Image&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Name&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Attack&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Magic Attack&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Length&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Weight&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Be Secondary&lt;/th&gt;            
            &lt;th scope=&quot;col&quot;&gt;With Secondary&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Specials&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Equip Primary&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Equip Secondary&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    &lt;tbody id=&quot;weapon-rows&quot;&gt;


    &lt;/tbody&gt;
&lt;/table&gt;


Armor:

&lt;table class=&quot;table-items&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th scope=&quot;col&quot; class=&quot;table-items__image&quot;&gt;Image&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Name&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Defence&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Magic Defence&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Weight&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Specials&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Equip&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    &lt;tbody id=&quot;armor-rows&quot;&gt;


    &lt;/tbody&gt;
&lt;/table&gt;


Potions:

&lt;table class=&quot;table-items&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th scope=&quot;col&quot; class=&quot;table-items__image&quot;&gt;Image&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Name&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Weight&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Effects&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Apply&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    &lt;tbody id=&quot;potions-rows&quot;&gt;


    &lt;/tbody&gt;
&lt;/table&gt;

/* Misc:

&lt;table class=&quot;table-items&quot;&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th scope=&quot;col&quot; class=&quot;table-items__image&quot;&gt;Image&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Name&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Weight&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Effects&lt;/th&gt;
            &lt;th scope=&quot;col&quot;&gt;Apply&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    
    &lt;tbody id=&quot;misc-rows&quot;&gt;


    &lt;/tbody&gt;
&lt;/table&gt; */
&lt;&lt;br&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="41" name="Menu_Party" tags="System nobr noreturn" position="0,1675" size="100,100">-- THIS PAGE IS IN DEVELOPMENT  -- &lt;&lt;br 2&gt;&gt;

&lt;&lt;run setup.showParty($party_hero.party)&gt;&gt;

&lt;div id=&quot;party-container&quot;&gt;&lt;/div&gt;


&lt;&lt;br 2&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="42" name="Menu_Questlog" tags="System nobr noreturn" position="0,1550" size="100,100">-- THIS PAGE IS IN DEVELOPMENT  -- &lt;&lt;br 2&gt;&gt;

Quest Info:


&lt;&lt;run setup.showQuestlog($quests)&gt;&gt;

&lt;div id=&quot;questlog-container&quot;&gt;
	&lt;p&gt;Active quest:&lt;/p&gt;
	&lt;div id=&quot;questlog-active&quot;&gt;&lt;/div&gt;

	&lt;&lt;br 2&gt;&gt;

	&lt;p&gt;Completed quest:&lt;/p&gt;
	&lt;div id=&quot;questlog-completed&quot;&gt;&lt;/div&gt;

	&lt;&lt;br 2&gt;&gt;

	&lt;p&gt;Failed quest:&lt;/p&gt;
	&lt;div id=&quot;questlog-failed&quot;&gt;&lt;/div&gt;

	&lt;&lt;br 2&gt;&gt;

	&lt;p&gt;Non_active quest:&lt;/p&gt;
	&lt;div id=&quot;questlog-non_active&quot;&gt;&lt;/div&gt;
&lt;/div&gt;


&lt;&lt;br&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="43" name="Menu_Settings" tags="System nobr noreturn" position="771,6" size="100,100">&lt;&lt;text_system &#39;setting&#39; &#39;setting_select_name&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_mc_name_change&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;textbox &quot;$misc.player_name&quot; setup.getPlayerName() autofocus&gt;&gt; &lt;&lt;br 2&gt;&gt;

&lt;&lt;text_system &#39;setting&#39; &#39;setting_lang&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_language_warning&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;div class=&quot;language-select__container&quot; @data-lang=$settings.lang&gt;&lt;/div&gt;
&lt;&lt;br 2&gt;&gt;

&lt;&lt;text_system &#39;setting&#39; &#39;setting_return_notification&#39;&gt;&gt;  &lt;&lt;info_tip &#39;tip_return_notification&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;toggle &#39;setting_return_notification_btn&#39; &#39;$settings.return_notification&#39; $settings.return_notification&gt;&gt; 
&lt;&lt;br 2&gt;&gt;


&lt;&lt;text_system &#39;setting&#39; &#39;setting_dialog_style&#39;&gt;&gt;
&lt;div class=&quot;dialog-mode-select&quot;&gt;&lt;/div&gt;
&lt;&lt;run setup.dialogModeSelect()&gt;&gt; &lt;&lt;br&gt;&gt; &lt;div style=&quot;margin-bottom: 10px;&quot;&gt;&lt;/div&gt;

&lt;&lt;speech &#39;Barret&#39; &#39;setting_debug_mode_text&#39;&gt;&gt;
&lt;&lt;br&gt;&gt;



&lt;&lt;br 2&gt;&gt;

&lt;button class=&quot;custom-btn btn-apply&quot; style=&quot;margin-right: 40px;&quot; data-thelper=&quot;accept&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;misc&#39; &#39;accept&#39;&gt;&gt;&quot; $return_passage&gt;&gt;
		&lt;&lt;run setup.changePlayerName()&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;/button&gt;

&lt;button class=&quot;custom-btn btn-apply&quot; data-thelper=&quot;apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;misc&#39; &#39;apply&#39;&gt;&gt;&quot; `passage()`&gt;&gt;
		&lt;&lt;run setup.changePlayerName()&gt;&gt;
		&lt;&lt;script&gt;&gt;window.location.reload();&lt;&lt;/script&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;/button&gt;</tw-passagedata><tw-passagedata pid="44" name="Menu_Skill" tags="System nobr noreturn" position="0,1425" size="100,100">&lt;div class=&quot;disclaimer-title&quot;&gt;
 &lt;p&gt; -- THIS PAGE IS IN DEVELOPMENT -- &lt;/p&gt; &lt;&lt;br 4&gt;&gt;
&lt;/div&gt;


/* Days in game: &lt;&lt;print $total_day&gt;&gt;&lt;&lt;br&gt;&gt; */
/* Total expierence: &lt;&lt;print $player.total_exp&gt;&gt;&lt;&lt;br&gt;&gt; */



&lt;&lt;br 4&gt;&gt;
&lt;&lt;system_return&gt;&gt;</tw-passagedata><tw-passagedata pid="45" name="Mirror_Room" tags="Location nobr" position="1400,450" size="100,100">/* &lt;&lt;set _is_quests = setup.isAnyQuestAvailable()&gt;&gt;
&lt;&lt;if _is_quests &gt;&gt; &lt;&lt;text_system &#39;misc&#39; &#39;mirror_room_text&#39;&gt;&gt; &lt;&lt;/if&gt;&gt;
&lt;&lt;if !_is_quests &gt;&gt; &lt;&lt;text_system &#39;misc&#39; &#39;mirror_room_no_quest&#39;&gt;&gt; &lt;&lt;/if&gt;&gt; */

/* Think about new abilities, where people more oblivious to you. */
/* It&#39;s easier to persuide them and they easier to ignore details about you, like changes to your appearence  and peek you ar liying. */

&lt;div class=&quot;talk-menu__item talk-menu__info&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;talk-menu__item talk-menu__personals&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;talk-menu__item talk-menu__education&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;talk-menu__item talk-menu__character_party&quot;&gt;&lt;/div&gt;

&lt;div class=&quot;talk-menu__item talk-menu__stats&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;talk-menu__item talk-menu__inventory&quot;&gt;&lt;/div&gt;

&lt;&lt;run setup.drawMirrorReturnSC()&gt;&gt;</tw-passagedata><tw-passagedata pid="46" name="PassageDone" tags="System questionable" position="600,0" size="100,100">/* Probably replace all of that with js functions */

&lt;&lt;if ($player.stamina &gt; $player.stamina_max)&gt;&gt; 
  &lt;&lt;set $player.stamina = $player.stamina_max&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ($player.stamina &lt; 0)&gt;&gt; 
  &lt;&lt;set $player.stamina = 0&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* &lt;&lt;if ($player.stamina &lt; 20) &amp;&amp; ($player.stamina &gt; 0)&gt;&gt;
    &lt;&lt;notify 2s &#39;inventory-update&#39;&gt;&gt;Your stamina at critical level&lt;&lt;/notify&gt;&gt;
        showPopup(&#39;stamina_low&#39;);
&lt;&lt;/if&gt;&gt; */



&lt;&lt;if ($player.health &gt; $player.health_max)&gt;&gt; 
  &lt;&lt;set $player.health = $player.health_max&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ($player.health) &lt; 0&gt;&gt; 
  &lt;&lt;set $player.health = 0&gt;&gt;
  &lt;&lt;= &#39;Dead ENd&#39;&gt;&gt;
&lt;&lt;/if&gt;&gt;


/* &lt;&lt;if ($player.health &lt; 25) &amp;&amp; ($player.health &gt; 0)&gt;&gt;
  &lt;&lt;notify 2s &#39;inventory-update&#39;&gt;&gt;Your health at critical level&lt;&lt;/notify&gt;&gt;
        showPopup(&#39;health_low&#39;);
&lt;&lt;/if&gt;&gt; */


&lt;&lt;if ($player.mana &gt; $player.mana_max)&gt;&gt; 
  &lt;&lt;set $player.mana = $player.mana_max&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ($player.mana) &lt; 0&gt;&gt; 
  &lt;&lt;set $player.mana = 0&gt;&gt;
&lt;&lt;/if&gt;&gt;

/* &lt;&lt;run setup.checkPageDialog()&gt;&gt; */
&lt;&lt;run setup.checkPageText()&gt;&gt;


/* &lt;&lt;run setup.checkLanguageChange()&gt;&gt; */

&lt;&lt;set $player.money = Math.round($player.money)&gt;&gt;</tw-passagedata><tw-passagedata pid="47" name="PassageFooter" tags="System nobr" position="0,0" size="100,100">&lt;&lt;if passage() != &#39;Talk_Menu&#39;&gt;&gt;
&lt;div class=&quot;passage-list passage-list__talk&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__activity&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__events&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__quests&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__tasks&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__map&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__misc&quot;&gt;&lt;/div&gt; 

&lt;&lt;/if&gt;&gt;

/* has tag noreturn */
/* &lt;&lt;if passage() == &#39;Talk_Menu&#39;&gt;&gt;
    &lt;&lt;br&gt;&gt;
    &lt;&lt;link &quot;Return&quot; $return_passage&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;/if&gt;&gt; */</tw-passagedata><tw-passagedata pid="48" name="PassageHeader" tags="System nobr" position="425,0" size="100,100">&lt;div id=&quot;modal-container&quot; class=&quot;modal&quot;&gt;&lt;/div&gt;


&lt;div class=&quot;passage-list passage-list__image&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__description&quot;&gt;&lt;/div&gt; 

/* &lt;div class=&quot;passage-list passage-list__narration&quot;&gt;&lt;/div&gt; */

/* &lt;div class=&quot;passage-list passage-list__locations&quot;&gt;&lt;/div&gt; */</tw-passagedata><tw-passagedata pid="49" name="StoryBanner" tags="System questionable" position="25,125" size="100,100">&lt;img src=&quot;media/icons/logo.svg&quot; style=&quot;width: 64px; height: 64px;&quot; alt=&quot;Fanthira Tales: wRight on cue&quot;&gt;</tw-passagedata><tw-passagedata pid="50" name="StoryCaption" tags="System nobr" position="650,125" size="100,100">&lt;&lt;if $settings.debug == 1&gt;&gt;
	&lt;span&gt;&lt;&lt;print passage()&gt;&gt;&lt;/span&gt;:
	&lt;&lt;link &quot;refresh&quot;&gt;&gt;&lt;&lt;goto `passage()`&gt;&gt;&lt;&lt;/link&gt;&gt;&lt;&lt;br&gt;&gt;
	
	&lt;&lt;if passage() == &#39;Uni_Location&#39;&gt;&gt; &lt;&lt;= $temp.custom_location&gt;&gt;, &lt;&lt;= $temp.cur_page ?? &#39;page_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;	&lt;&lt;/if&gt;&gt; 
	&lt;&lt;if passage() == &#39;Uni_Sketch&#39;&gt;&gt;   &lt;&lt;= $temp.cur_sketch&gt;&gt;, &lt;&lt;= $temp.cur_page&gt;&gt;	&lt;&lt;br&gt;&gt;	&lt;&lt;/if&gt;&gt;

    &lt;&lt;text_system &#39;sidebar&#39; &quot;caption_lang&quot;&gt;&gt;: &quot;&lt;&lt;text_system &#39;lang_list&#39; $settings.lang&gt;&gt;&quot; &lt;&lt;br&gt;&gt;
	&lt;&lt;text_system &#39;sidebar&#39; &quot;caption_name&quot;&gt;&gt;: &lt;span&gt;&lt;&lt;print $misc.player_name&gt;&gt;&lt;/span&gt; 

	&lt;&lt;link &quot;+30&quot; `passage()`&gt;&gt;&lt;&lt;set $time.minute += 30 &gt;&gt; &lt;&lt;/link&gt;&gt;&lt;&lt;br 2&gt;&gt;

&lt;&lt;/if&gt;&gt;


&lt;&lt;= setup.showDateSidebar()&gt;&gt; 

&lt;&lt;= setup.showPlayerName()&gt;&gt; 

&lt;&lt;= setup.showStatsValues()&gt;&gt; 

&lt;&lt;= setup.showStatsBar()&gt;&gt; 


/* &lt;&lt;= setup.showExpBar()&gt;&gt; */


/* ------------------------------- EXP bar -------------------------------*/

&lt;&lt;set _nextLevel = $player.lvl+1&gt;&gt;
&lt;&lt;if ($player.exp != 0 )&gt;&gt;
	&lt;&lt;set $temp_xp = $levels[_nextLevel] - $player.exp&gt;&gt;
	&lt;&lt;if ($temp_xp &gt;= 0)&gt;&gt;
		&lt;&lt;set $player.lvl_exp += $player.exp &gt;&gt;
		&lt;&lt;set _tempExp = $player.exp &gt;&gt;	
	&lt;&lt;else&gt;&gt;
		&lt;&lt;set $player.lvl_exp += $player.exp &gt;&gt;
		&lt;&lt;set _tempExp = $player.exp &gt;&gt;	
		/* &lt;&lt;set $player.lvl_exp += $levels[_nextLevel] &gt;&gt;
		&lt;&lt;set _tempExp = $levels[_nextLevel] &gt;&gt;	
		&lt;&lt;set $player.exp -= $levels[_nextLevel] &gt;&gt;	 */
	&lt;&lt;/if&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;set _expLeft = ($levels[_nextLevel]) ? $levels[_nextLevel] - $player.lvl_exp : &#39;???&#39;&gt;&gt;
&lt;&lt;set _expPercent = $player.lvl_exp/$levels[_nextLevel] * 100&gt;&gt;


&lt;div class=&quot;level-container&quot;&gt;
	&lt;div id=&quot;current-level&quot; class=&quot;level-round&quot;&gt;
		&lt;&lt;print $player.lvl&gt;&gt;
	&lt;/div&gt;
	&lt;div class=&quot;level-line&quot;&gt;			
		&lt;p class=&quot;level-info&quot;&gt;
			&lt;span id=&quot;current-exp&quot; class=&quot;sidebar__numbers sidebar__numbers--small&quot;&gt;&lt;&lt;print $player.lvl_exp&gt;&gt;&lt;/span&gt; 
			&lt;span class=&quot;sidebar__text sidebar__text--small sidebar_xp-text&quot; &gt; XP&lt;/span&gt; 
		&lt;/p&gt;	
		&lt;p class=&quot;level-info-next&quot;&gt;
			&lt;span id=&quot;left-exp&quot; class=&quot;sidebar__numbers sidebar__numbers--small&quot;&gt;&lt;&lt;= _expLeft&gt;&gt;&lt;/span&gt; 
			&lt;span class=&quot;sidebar__text sidebar__text--small sidebar_xp-text&quot; &gt; XP&lt;/span&gt; 
		&lt;/p&gt;	

		/* &lt;div class=&quot;bar&quot;&gt;
			&lt;span id=&quot;level-bar&quot; class=&quot;bar-line&quot; data-stat=&#39;level&#39;/&gt;
		&lt;/div&gt;
		&lt;&lt;run setup.drawBar($player.lvl_exp, $levels[_nextLevel], &#39;level&#39;, $saturation=60, $lightness=35)&gt;&gt;
			*/
		&lt;&lt;print 
			&#39;&lt;div class=&quot;progress-bar&quot;&gt;
				&lt;span id=&quot;level-bar&quot; class=&quot;progress-bar-line&quot; style=&quot;width:&#39; + _expPercent + &#39;%;&quot;/&gt;
			&lt;/div&gt;&#39;
		&gt;&gt;
	&lt;/div&gt;

	&lt;div id=&quot;next-level&quot; class=&quot;level-round level-round--next&quot;&gt;
		&lt;&lt;print _nextLevel&gt;&gt;
	&lt;/div&gt;
&lt;/div&gt;  

&lt;&lt;if ($player.exp != 0 )&gt;&gt;
	&lt;&lt;run $getExp($player.lvl_exp, $levels[_nextLevel], _tempExp, _expLeft, _expPercent)&gt;&gt;
	/* &lt;&lt;if ($temp_xp &gt;= 0)&gt;&gt; */
		&lt;&lt;set $player.exp = 0 &gt;&gt;
	/* &lt;&lt;/if&gt;&gt;	 */
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $player.lvl_exp &gt;= $levels[_nextLevel] &gt;&gt;
	&lt;&lt;set _exp_to_next_lvl = $player.lvl_exp - $levels[_nextLevel] &gt;&gt;
	&lt;&lt;set $player.lvl += 1 &gt;&gt;
	&lt;&lt;set $player.total_exp += $levels[$player.lvl] &gt;&gt;
	&lt;&lt;set $player.lvl_exp = 0 &gt;&gt;	
	&lt;&lt;set $player.lvl_exp = _exp_to_next_lvl &gt;&gt;
	&lt;&lt;set $player.health_max += 10 &gt;&gt; /* Temporary */
	&lt;&lt;set $player.stamina_max += 10 &gt;&gt; /* Temporary */
	&lt;&lt;set _levelUp = setup.levelUp($player.lvl)&gt;&gt;
	&lt;&lt;run _levelUp.then(result =&gt; {	
		let nextLevel = $player.lvl+1;
		let expLeft = $levels[nextLevel] - $player.lvl_exp;
		let expPercent = Math.round($player.lvl_exp/$levels[nextLevel] * 100);
		$getExp($player.lvl_exp, $levels[nextLevel], _exp_to_next_lvl, expLeft, expPercent);
	})&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;br 2&gt;&gt;



&lt;&lt;= setup.showMenuStory()&gt;&gt;

&lt;&lt;= setup.showMenuCore()&gt;&gt;

&lt;&lt;= setup.showSignature()&gt;&gt;</tw-passagedata><tw-passagedata pid="51" name="StoryInit" tags="System" position="775,125" size="100,100">&lt;&lt;set $consoleLog = (item, item_2) =&gt; ((item_2) ? console.log(item, item_2) : console.log(item)) ;&gt;&gt;

/* &lt;&lt;run $consoleLog(&#39;StoryInit&#39;)&gt;&gt; */




/* Audio */
&lt;&lt;cacheaudio &quot;morshu&quot; &quot;media/audio/morshu.mp3&quot;&gt;&gt;





&lt;&lt;set $battleMode = 0&gt;&gt;




&lt;&lt;set $levels = {
	1: 100,
	2: 200,
	3: 300,
	4: 400,
	5: 500,
	6: 600,
	7: 700,
	8: 800,
	9: 900,
	10: 1000,
	220: 22000,
	221: 22100,
	222: 22200
} &gt;&gt;



&lt;&lt;set $getExp = function(playerLvlExp, levelNextExpBorder, playerExp, ExpLeftEnd, expPercent) {
	const ExpLeftStart = ExpLeftEnd + playerExp,
		PrevLvlExp = playerLvlExp - playerExp,
	 	CurExpPercent = (PrevLvlExp/levelNextExpBorder) * 100,
	 	timeset = 1000;
		
	(expPercent &gt; 100) ? (expPercent = 100) : expPercent;
	(ExpLeftEnd &lt; 0) ? (ExpLeftEnd = 0) : ExpLeftEnd;
	(playerLvlExp &gt; levelNextExpBorder) ? (playerLvlExp = levelNextExpBorder) : expPercent;

	$(&#39;#level-bar&#39;).css( &quot;width&quot;, CurExpPercent + &quot;%&quot; );

	$(&#39;#level-bar&#39;).animate({
	  width: expPercent + &#39;%&#39;
	}, timeset
	);
		
	$(&#39;#left-exp&#39;).prop(&#39;Counter&#39;, ExpLeftStart).animate({
		Counter: ExpLeftEnd
	}, {
		duration: timeset,
		easing: &#39;swing&#39;,
		step: function(now) {
			$(&#39;#left-exp&#39;).text(Math.ceil(now));
		}
	});
	
	$(&#39;#current-exp&#39;).prop(&#39;Counter&#39;, playerExp).animate({
		Counter: playerLvlExp
	}, {
		duration: timeset,
		easing: &#39;swing&#39;,
		step: function(now) {
		  $(&#39;#current-exp&#39;).text(Math.ceil(now));
		}
	});

}&gt;&gt;


&lt;&lt;set setup.levelUp = async function (curLevel) {

	const timeset = 1000,
     	animElem = $(&#39;#next-level&#39;),
     	curLevelEl = $(&#39;#current-level&#39;),
     	barLineElem = $(&#39;.level-line&#39;),
        animClassFirst = &#39;lvl-animate&#39;,
        animClassSecond = &#39;lvl-animate-2&#39;;
		
	animElem.css(&#39;transition-duration&#39;, `${timeset/1000}s`);
	
    await new Promise(function(resolve) {
       	animElem.addClass(animClassFirst);
      	curLevelEl.fadeOut(timeset);
      	barLineElem.fadeOut(timeset);
      	resolve();
    });

    await new Promise(function(resolve) {             
    	window.setTimeout(function () {	
           	animElem.removeClass(animClassFirst);
           	animElem.addClass(animClassSecond);
           	curLevelEl.fadeIn(timeset);
           	barLineElem.fadeIn(timeset);	
			curLevelEl.text(curLevel);			
			animElem.text(curLevel+1);
            resolve();
		}, timeset);
	});

	await new Promise(function(resolve) {             
        window.setTimeout(function () {	          
        	animElem.removeClass(animClassSecond);
			resolve();
        }, timeset);
    });
}&gt;&gt;

&lt;&lt;run setup.initOnce()&gt;&gt;</tw-passagedata><tw-passagedata pid="52" name="StoryShare" tags="System questionable" position="400,125" size="100,100">&lt;&lt;set _link_itchio = setup.getSocialLink(&#39;itchio&#39;)&gt;&gt;
&lt;&lt;set _link_discord = setup.getSocialLink(&#39;discord&#39;)&gt;&gt;

&lt;a class=&quot;social_link&quot; @href=_link_itchio&gt;&lt;img class=&quot;social_link__icon&quot; src=&quot;media/icons/socials/itchio.svg&quot;&gt;&lt;/a&gt;
&lt;a class=&quot;social_link&quot; @href=_link_discord&gt;&lt;img class=&quot;social_link__icon&quot; src=&quot;media/icons/socials/discord.svg&quot;&gt;&lt;/a&gt;</tw-passagedata><tw-passagedata pid="53" name="Talk_Generated" tags="Location nobr" position="3600,1200" size="100,100">&lt;&lt;set _phrase_num = random(0,$current_speaker.phrases.length-1)&gt;&gt;
&lt;&lt;print $current_speaker.name&gt;&gt; says to you &lt;strong&gt; &lt;&lt;print $current_speaker.phrases[_phrase_num]&gt;&gt; &lt;/strong&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;br&gt;&gt;
[[Return|previous()]]</tw-passagedata><tw-passagedata pid="54" name="Talk_Menu" tags="nobr" position="3600,1500" size="100,100">&lt;div class=&quot;talk-menu__item talk-menu__info&quot;&gt;&lt;/div&gt; 


&lt;div class=&quot;talk-menu__item talk-menu__chat&quot;&gt;&lt;/div&gt; 


&lt;div class=&quot;talk-menu__item talk-menu__personals&quot;&gt;&lt;/div&gt; 

&lt;div class=&quot;passage-list passage-list__tasks&quot;&gt;&lt;/div&gt;

&lt;&lt;br&gt;&gt;
&lt;div class=&quot;talk-menu__item talk-menu__education&quot;&gt;&lt;/div&gt; 


&lt;div class=&quot;talk-menu__item talk-menu__character_party&quot;&gt;&lt;/div&gt;


&lt;div class=&quot;talk-menu__item talk-menu__stats&quot;&gt;&lt;/div&gt; 


&lt;div class=&quot;talk-menu__item talk-menu__inventory&quot;&gt;&lt;/div&gt;


&lt;&lt;br 2&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;misc&#39; &#39;return&#39;&gt;&gt;&quot; $temp.last_location_passage&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 2&gt;&gt;</tw-passagedata><tw-passagedata pid="55" name="Test_Fight" tags="System questionable" position="3200,100" size="100,100"></tw-passagedata><tw-passagedata pid="56" name="Test_Room" tags="System nobr noreturn" position="1400,0" size="100,100">Spend: [[&#39;+1&#39;|Test_Room][$time.minute += 1]] 
[[&#39;+5&#39;|Test_Room][$time.minute += 5]]
[[&#39;+20&#39;|Test_Room][$time.minute += 20]] minutes; 
[[&#39;+1&#39;|Test_Room][$time.hour += 1]] 
[[&#39;+3&#39;|Test_Room][$time.hour += 3]] 
[[&#39;+6&#39;|Test_Room][$time.hour += 6]] hours

&lt;&lt;br&gt;&gt;

Set to: [[23:00|Test_Room][$time.hour = 23]] ; 
[[28th day|Test_Room][$time.month_day = 28]] &lt;&lt;br&gt;&gt;

Add stamina 
[[&#39;+1&#39;|Test_Room][$player.stamina += 1]]  
[[&#39;+15&#39;|Test_Room][$player.stamina += 15]]  
[[&#39;+100&#39;|Test_Room][$player.stamina += 100]]  &lt;&lt;br&gt;&gt;

Remove stamina 
[[&#39;-1&#39;|Test_Room][$player.stamina -= 1]]
[[&#39;-9&#39;|Test_Room][$player.stamina -= 9]]  
[[&#39;-30&#39;|Test_Room][$player.stamina -= 30]]   &lt;&lt;br&gt;&gt;

Add health 
[[&#39;+1&#39;|Test_Room][$player.health += 1]]  
[[&#39;+15&#39;|Test_Room][$player.health += 15]]  
[[&#39;+100&#39;|Test_Room][$player.health += 100]]  &lt;&lt;br&gt;&gt;

Remove health 
[[&#39;-1&#39;|Test_Room][$player.health -= 1]]
[[&#39;-15&#39;|Test_Room][$player.health -= 15]]  
[[&#39;-100&#39;|Test_Room][$player.health -= 100]]   &lt;&lt;br&gt;&gt;

Add exp
[[&#39;+1&#39;|Test_Room][$player.exp += 1]]
[[&#39;+25&#39;|Test_Room][$player.exp += 25]]
[[&#39;+150&#39;|Test_Room][$player.exp += 150]] &lt;&lt;br&gt;&gt;

Remove exp 
[[&#39;-1&#39;|Test_Room][$player.exp -= 1]] 
[[&#39;-20&#39;|Test_Room][$player.exp -= 20]]  
[[&#39;-200&#39;|Test_Room][$player.exp -= 200]]  &lt;&lt;br&gt;&gt;


&lt;&lt;br 2&gt;&gt;
[[Switch to sister|ddd][$player = $characters.melissa]]


&lt;&lt;br 6&gt;&gt;
[[Return to Debug Menu|Menu_Debug]]</tw-passagedata><tw-passagedata pid="57" name="Uni_Constructor" tags="constructor noreturn" position="0,800" size="100,100">[[Uni_Constructor_List]]

&lt;form id=&quot;constructor&quot;&gt;&lt;/form&gt;</tw-passagedata><tw-passagedata pid="58" name="Uni_Constructor_List" tags="constructor nobr noreturn" position="0,500" size="100,100">Constructors:
&lt;&lt;br 2&gt;&gt;

[[Constructor_Localization_Table|Uni_Constructor][$temp.constructor_entity = &#39;localization&#39;]]
&lt;&lt;br 2&gt;&gt;
[[Constructor_Sketch_Table|Uni_Constructor_Table][$temp.constructor_entity = &#39;sketches&#39;]]
&lt;&lt;br&gt;&gt;
[[Constructor_Item_Table|Uni_Constructor_Table][$temp.constructor_entity = &#39;items&#39;]]
&lt;&lt;br&gt;&gt;
[[Constructor_Character_Table|Uni_Constructor_Table][$temp.constructor_entity = &#39;characters&#39;]]
&lt;&lt;br&gt;&gt;
[[Constructor_Party_Table|Uni_Constructor_Table][$temp.constructor_entity = &#39;parties&#39;]]
&lt;&lt;br&gt;&gt;
[[Constructor_Schedule_Table|Uni_Constructor_Table][$temp.constructor_entity = &#39;schedules&#39;]]
&lt;&lt;br 2&gt;&gt;
[[Constructor_Task_Table(WIP)|Uni_Constructor_Table][$temp.constructor_entity = &#39;tasks&#39;]]
&lt;&lt;br&gt;&gt;
[[Constructor_Quest_Table(WIP)|Uni_Constructor_Table][$temp.constructor_entity = &#39;quests&#39;]]
&lt;&lt;br 2&gt;&gt;

[[Constructor_Location_Table (Need to be redone)|Uni_Constructor_Table][$temp.constructor_entity = &#39;custom_locations&#39;]]



&lt;&lt;br 4&gt;&gt;
[[Menu_Debug]]</tw-passagedata><tw-passagedata pid="59" name="Uni_Constructor_Table" tags="constructor noreturn" position="0,500" size="100,100">[[Uni_Constructor_List]]

&lt;div id=&quot;constructor-table__container&quot;&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="60" name="Uni_Deadend" tags="System nobr" position="3800,1700" size="100,100">/* &lt;div id=&quot;deadend_container&quot;&gt;&lt;/div&gt; */

&lt;&lt;set $player.health = 0&gt;&gt;
&lt;&lt;set $player.stamina = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.inventory = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.questlog = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.party = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.skill = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.help = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_story.info = 0&gt;&gt;
&lt;&lt;set $settings.interface.menu_core.settings = 0&gt;&gt;
&lt;&lt;set $settings.interface.exp.level = 0&gt;&gt;



&lt;&lt;fadein 6s&gt;&gt; 
    &lt;p class=&quot;deadend&quot;&gt; &lt;&lt;text_system &#39;deadend&#39; &#39;you_died&#39;&gt;&gt;&lt;/p&gt;
&lt;&lt;/fadein&gt;&gt;


&lt;&lt;br 2&gt;&gt;
&lt;&lt;fadein 3s 3s&gt;&gt; 
    &lt;&lt;text_system &#39;deadend&#39; &#39;desc_1&#39;&gt;&gt;&lt;&lt;br&gt;&gt;
&lt;&lt;/fadein&gt;&gt;

&lt;&lt;fadein 3s 5s&gt;&gt; 
    &lt;&lt;text_system &#39;deadend&#39; &#39;desc_2&#39;&gt;&gt; &lt;span class=&quot;mc&quot;&gt; &lt;&lt;= $misc.player_name&gt;&gt;.&lt;/span&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;/fadein&gt;&gt;

&lt;&lt;br 2&gt;&gt;
&lt;&lt;fadein 3s 8s&gt;&gt; 
    &lt;&lt;set _has_autosave = Save.autosave.has()&gt;&gt;
    &lt;&lt;if _has_autosave&gt;&gt;
    &lt;button class=&quot;custom-btn btn-apply&quot;&gt;
        &lt;&lt;link &quot;&lt;&lt;text_system &#39;deadend&#39; &#39;load_autosave&#39;&gt;&gt;&quot;&gt;&gt; 
            &lt;&lt;script&gt;&gt; Save.autosave.load()&lt;&lt;/script&gt;&gt;
        &lt;&lt;/link&gt;&gt;	
    &lt;/button&gt;  
    &lt;&lt;info_tip &#39;tip_autosave&#39;&gt;&gt;
    &lt;&lt;br&gt;&gt;
    &lt;&lt;/if&gt;&gt;
 
    &lt;button class=&quot;custom-btn btn-apply&quot;&gt;
        &lt;&lt;link &quot;&lt;&lt;text_system &#39;deadend&#39; &#39;select_save&#39;&gt;&gt;&quot;&gt;&gt;
            &lt;&lt;script&gt;&gt;UI.saves()&lt;&lt;/script&gt;&gt;
        &lt;&lt;/link&gt;&gt;	
    &lt;/button&gt; &lt;&lt;br 4&gt;&gt;
&lt;&lt;/fadein&gt;&gt;


&lt;&lt;fadein 3s 10s&gt;&gt; 
    &lt;button class=&quot;custom-btn btn-apply&quot;&gt;
        &lt;&lt;link &quot;&lt;&lt;text_system &#39;deadend&#39; &#39;restart_the_game&#39;&gt;&gt;&quot;&gt;&gt;
            &lt;&lt;script&gt;&gt;UI.restart()&lt;&lt;/script&gt;&gt;
        &lt;&lt;/link&gt;&gt;	
    &lt;/button&gt; 
&lt;&lt;/fadein&gt;&gt;</tw-passagedata><tw-passagedata pid="61" name="Uni_Location" tags="System nobr" position="3800,1700" size="100,100">&lt;div id=&quot;sketch_container&quot;&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="62" name="Uni_Sketch" tags="nobr" position="3800,1500" size="100,100">&lt;div id=&quot;sketch_container&quot;&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="63" name="Uni_Store" tags="System Store" position="550,1400" size="100,100">&lt;&lt;nobr&gt;&gt;
    
    
    /* ------------------------------------------------  Store initialization ------------------------------------------------------------- */



    &lt;&lt;first&gt;&gt;

        /* Store initialization */

        &lt;&lt;set $mercener_store_variable = &#39;mercener_store_items&#39;&gt;&gt;

        &lt;&lt;set $mercener_store_list = {
            weapons: {
                rarity_level_max: &#39;Common&#39;,
                amount: 3,
                store_days: &#39;&#39;,
                discount_percent: -20,
                list: [                     
                    { item_class: &#39;Dagger&#39;, price: 30 },
                    { item_class: &#39;Stiletto&#39;, price: 50 }
                ]
            },
            armor: {   
                rarity_level_max: &#39;Common&#39;,
                amount: 4,
                store_days: &#39;&#39;,
                discount_percent: -40,
                list: [         
                    { item_class: &#39;Helmet&#39;, price: 100 }
                ]  
            }, 
            potions: {
                rarity_level_max: &#39;Common&#39;,
                rarity_level_min: &#39;Junk&#39;,
                amount: 4,
                store_days: &#39;&#39;,
                discount_percent: 0,
                stack: true,                    
                list: [        
                    { item_class: &#39;HealthPotion&#39;, price: 200 },
                ] 
            },
            /* food: {
                rarity_level_max: &#39;Common&#39;,
                amount: 4,
                store_days: &#39;&#39;,
                discount_percent: 0,
                list: [        
                    { item_class: &#39;Bread&#39;, price: 20 },
                    { item_class: &#39;Meat&#39;, price: 25 },
                ] 
            }  */


        }&gt;&gt;


        &lt;&lt;run setup.generateStore($mercener_store_list, $mercener_store_variable)&gt;&gt;

        
        /* For test */
        &lt;&lt;set $test_weapon_1 = new Stiletto($items.test_weapon_1);&gt;&gt;
        &lt;&lt;set $mercener_store_items.weapons.push($test_weapon_1);&gt;&gt;

    &lt;&lt;/first&gt;&gt;




    
    /* ------------------------------------------------  Store update conditions  ------------------------------------------------------------- */





    /* Sets For Store Updates */


        /* Event discount 20% for armor     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event new weapons - swords       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event reset store after N days   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 




    



    /* Show Store Items */
    &lt;&lt;set _cur_store_types = Object.keys($mercener_store_list);&gt;&gt;
    

    




    &lt;&lt;for _i=0;_i&lt;_cur_store_types.length;_i++&gt;&gt;  
        &lt;&lt;set _cur_type = _cur_store_types[_i]&gt;&gt;
        &lt;&lt;set _cur_type_items = $mercener_store_items[_cur_type]&gt;&gt;

        &lt;&lt;print &#39;&lt;div class=&quot;store_items-&#39;+_cur_type+&#39;&quot;&gt;&lt;/div&gt;&#39;&gt;&gt;
        &lt;&lt;run setup.showStore(_cur_type_items, _cur_type, $mercener_store_variable)&gt;&gt;
    &lt;&lt;/for&gt;&gt; 

    
    /* &lt;&lt;for _cur_type range _cur_store_types&gt;&gt;  
        &lt;&lt;set _cur_type_items = $mercener_store_items[_cur_type]&gt;&gt;

        &lt;&lt;print &#39;&lt;div class=&quot;store_items-&#39;+_cur_type+&#39;&quot;&gt;&lt;/div&gt;&#39;&gt;&gt;
        &lt;&lt;run setup.showStore(_cur_type_items, _cur_type, $mercener_store_variable)&gt;&gt;
    &lt;&lt;/for&gt;&gt;  */


&lt;&lt;/nobr&gt;&gt;


[[Return|House_Smith]]</tw-passagedata><tw-passagedata pid="64" name="Uni_Tryout" tags="System nobr" position="3800,1500" size="100,100">&lt;div id=&quot;play_tryout&quot;&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="65" name="Village_Center" tags="Location nobr" position="1600,998" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_steward&#39; &#39;House_Steward&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_baxter&#39; &#39;House_Baxter&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_tavern&#39; &#39;Village_Tavern&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_church&#39; &#39;Village_Church&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_infirmary&#39; &#39;Village_Infirmary&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_square&#39; &#39;Village_Square&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_mercer&#39; &#39;House_Mercer&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;

&lt;/div&gt;</tw-passagedata><tw-passagedata pid="66" name="Village_Church" tags="Location nobr" position="1600,998" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_church_godfrey_room&#39; &#39;Village_Church_Godfrey_Room&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_church_nun_room&#39; &#39;Village_Church_Nun_Room&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="67" name="Village_Church_Godfrey_Room" tags="Location nobr" position="1600,998" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_church&#39; &#39;Village_Church&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="68" name="Village_Church_Nun_Room" tags="Location nobr" position="1600,998" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_church&#39; &#39;Village_Church&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="69" name="Village_East" tags="Location nobr" position="2300,1000" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_warders_entry&#39; &#39;Village_Warders_Entry&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_house_wizard&#39; &#39;House_Wizard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_house_ferryman&#39; &#39;House_Ferryman&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_house_ostler&#39; &#39;House_Ostler&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;</tw-passagedata><tw-passagedata pid="70" name="Village_Infirmary" tags="Location nobr" position="1550,1196" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="71" name="Village_Kennels" tags="Location nobr" position="2275,1200" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_house_ferryman&#39; &#39;House_Ferryman&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="72" name="Village_Outside" tags="Location nobr" position="3098,994" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_fields&#39; &#39;Village_Outside_Fields&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_river&#39; &#39;Village_Outside_River&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_meadow&#39; &#39;Village_Outside_Meadow&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_graveyard&#39; &#39;Village_Outside_Graveyard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; 
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_house_shikari&#39; &#39;Village_Outside_House_Shikari&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; 
&lt;&lt;passage &#39;passages&#39; &#39;passage_forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard__straight&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; 
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;</tw-passagedata><tw-passagedata pid="73" name="Village_Outside_Fields" tags="Location nobr" position="3600,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_grazing&#39; &#39;Village_Outside_Grazing&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="74" name="Village_Outside_Graveyard" tags="Location nobr" position="3283,1401" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="75" name="Village_Outside_Grazing" tags="Location nobr" position="3600,1198" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_fields&#39; &#39;Village_Outside_Fields&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="76" name="Village_Outside_House_Fisher" tags="Location nobr" position="3500,1398" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="77" name="Village_Outside_House_Shikari" tags="Location nobr" position="2791,1191" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="78" name="Village_Outside_Lake" tags="Location nobr" position="3283,1401" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_forest&#39; &#39;Forest&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="79" name="Village_Outside_Meadow" tags="Location nobr" position="3003,1189" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="80" name="Village_Outside_River" tags="Location nobr" position="3400,1196" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside_house_fisher&#39; &#39;Village_Outside_House_Fisher&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_outside&#39; &#39;Village_Outside&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="81" name="Village_Square" tags="Location nobr" position="1600,998" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="82" name="Village_Stables" tags="Location nobr" position="2275,1200" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_house_ostler&#39; &#39;House_Ostler&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="83" name="Village_Store_Mercer" tags="Store questionable" position="700,1400" size="100,100">&lt;&lt;nobr&gt;&gt;
    
    
    /* ------------------------------------------------  Store initialization ------------------------------------------------------------- */



    &lt;&lt;first&gt;&gt;

        /* Store initialization */

        &lt;&lt;set $mercener_store_variable = &#39;mercener_store_items&#39;&gt;&gt;

        &lt;&lt;set $mercener_store_list = {
            weapons: {
                rarity_level_max: &#39;Common&#39;,
                amount: 3,
                store_days: &#39;&#39;,
                discount_percent: -20,
                list: [                     
                    { item_class: &#39;Dagger&#39;, price: 30 },
                    { item_class: &#39;Stiletto&#39;, price: 50 }
                ]
            },
            armor: {   
                rarity_level_max: &#39;Common&#39;,
                amount: 4,
                store_days: &#39;&#39;,
                discount_percent: -40,
                list: [         
                    { item_class: &#39;Helmet&#39;, price: 100 }
                ]  
            }, 
            potions: {
                rarity_level_max: &#39;Common&#39;,
                rarity_level_min: &#39;Junk&#39;,
                amount: 4,
                store_days: &#39;&#39;,
                discount_percent: 0,
                /* stack: true, */
                list: [        
                    { item_class: &#39;HealthPotion&#39;, price: 200 },
                ] 
            }


        }&gt;&gt;


        &lt;&lt;run setup.generateStore($mercener_store_list, $mercener_store_variable)&gt;&gt;

    &lt;&lt;/first&gt;&gt;




    
    /* ------------------------------------------------  Store update conditions  ------------------------------------------------------------- */





    /* Sets For Store Updates */


        /* Event discount 20% for armor     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event new weapons - swords       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event reset store after N days   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 




    



    /* Show Store Items */
    &lt;&lt;set _cur_store_types = Object.keys($mercener_store_list);&gt;&gt;

    &lt;&lt;for _i=0;_i&lt;_cur_store_types.length;_i++&gt;&gt;  
        &lt;&lt;set _cur_type = _cur_store_types[_i]&gt;&gt;
        &lt;&lt;set _cur_type_items = $mercener_store_items[_cur_type]&gt;&gt;

        &lt;&lt;print &#39;&lt;div class=&quot;store_items-&#39;+_cur_type+&#39;&quot;&gt;&lt;/div&gt;&#39;&gt;&gt;
        &lt;&lt;run setup.showStore(_cur_type_items, _cur_type, $mercener_store_variable)&gt;&gt;
    &lt;&lt;/for&gt;&gt; 

    
    /* &lt;&lt;for _cur_type range _cur_store_types&gt;&gt;  
        &lt;&lt;set _cur_type_items = $mercener_store_items[_cur_type]&gt;&gt;

        &lt;&lt;print &#39;&lt;div class=&quot;store_items-&#39;+_cur_type+&#39;&quot;&gt;&lt;/div&gt;&#39;&gt;&gt;
        &lt;&lt;run setup.showStore(_cur_type_items, _cur_type, $mercener_store_variable)&gt;&gt;
    &lt;&lt;/for&gt;&gt;  */


&lt;&lt;/nobr&gt;&gt;

[[index]]


[[Return|Mercer]]</tw-passagedata><tw-passagedata pid="84" name="Village_Store_Smith" tags="Store questionable" position="850,1400" size="100,100">&lt;&lt;nobr&gt;&gt;

    /* all store types 
        weapon 
        armor 
        potion 
        trash 
        consumable
        fish
        wood
    */


    /* Add autogeneration of updates after certain time */


    /* ------------------------------------------------  Store initialization ------------------------------------------------------------- */

    &lt;&lt;first&gt;&gt;
        
        &lt;&lt;set $quest.store = {}&gt;&gt;
        &lt;&lt;set $quest.store.smith = {}&gt;&gt;
        &lt;&lt;set $quest.store.smith.update_1 = {}&gt;&gt;

        &lt;&lt;set $smith_store_variable = &#39;smith_store_items&#39;&gt;&gt;

        &lt;&lt;set $smith_store_list = {
            weapons: {
                rarity_level_max: &#39;Uncommon&#39;,
                amount: 5,
                store_days: 14,
                discount_percent: 20,
                list: [
                    { item_class: &#39;Dagger&#39;, price: 30 },
                    { item_class: &#39;Stiletto&#39;, price: 50 },
                    { item_class: &#39;Glaive&#39;, price: 150 }, 
                    { item_class: &#39;Spear&#39;, price: 100 }
                ]
            },
            armor: {   
                rarity_level_max: &#39;Common&#39;,
                amount: 3,
                store_days: &#39;&#39;,
                discount_percent: -10,
                list: [        
                    { item_class: &#39;Helmet&#39;, price: 100 },
                    { item_class: &#39;Sabatons&#39;, price: 150 }
                ] 
            }          
        }&gt;&gt;

        /* &lt;&lt;set $smith_store_list = {
            weapons: {
                rarity_level_max: &#39;Uncommon&#39;,
                amount: 5,
                store_days: 14,
                discount_percent: 20,
                list: [
                    {
                        item_class: &#39;Dagger&#39;,
                        price: 30
                    },
                    {
                        item_class: &#39;Stiletto&#39;,
                        price: 50
                    },
                    {
                        item_class: &#39;Glaive&#39;,
                        price: 150
                    }, 
                    {
                        item_class: &#39;Spear&#39;,
                        price: 100
                    }
                ] 
            }        
        }&gt;&gt; */
  

        &lt;&lt;run setup.generateStore($smith_store_list, $smith_store_variable)&gt;&gt;

    &lt;&lt;/first&gt;&gt;


    






    
    /* ------------------------------------------------  Store update conditions  ------------------------------------------------------------- */





    /* Sets For Store Updates */


        /* Event discount 20% for armor     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event new weapons - swords       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 

        /* Event reset store after N days   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! */ 




    
    &lt;&lt;set _update_smith_store = { 
        weapons: {
            rarity_level_max: &#39;Rare&#39;,
            amount: 6,
            discount_percent: 40,
            add_edit: [
                { item_class: &#39;Sword&#39;, price: 100 },
                { item_class: &#39;Stiletto&#39;, price: 70 }
            ], 
            remove: [                
                { item_class: &#39;Glaive&#39;, price: 150 }
            ]
        },
        armor: {   
            rarity_level_max: &#39;Junk&#39;,
            amount: 2,
            add_edit: [         
                { item_class: &#39;Gauntlets&#39;, price: 120 }
            ]  
        } 
    } &gt;&gt; 
/* 
    &lt;&lt;run $consoleLog($smith_store_list)&gt;&gt; */
    &lt;&lt;if ($quest.store.smith.update_1.status == 1)&gt;&gt;
        &lt;&lt;set setup.updateStore($smith_store_list, _update_smith_store, $smith_store_variable)&gt;&gt;
        &lt;&lt;set $quest.store.smith.update_1.status += 1&gt;&gt;
    &lt;&lt;/if&gt;&gt;



    /* &lt;&lt;set _update_smith_store_1 = { 
        armor: {   
            rarity_level_max: &#39;Junk&#39;,
            amount: 2,
            add_edit: [         
                0: {
                    item_class: &#39;Gauntlets&#39;,
                    price: 120
                }
            ]
        } 
    } &gt;&gt;  */





    /* ------------------------------------------------  Store displayin to user ------------------------------------------------------------- */
    


    Per test: 
    &lt;br&gt;
    Store Smith Update_1 status: &lt;&lt;if ($quest.store.smith.update_1.status)&gt;&gt; &lt;&lt;print $quest.store.smith.update_1.status&gt;&gt; &lt;&lt;else&gt;&gt; Not initialized &lt;&lt;/if&gt;&gt; 
    &lt;br&gt;
    &lt;&lt;if ($smith_store_items)&gt;&gt; 
        Amount weapons: &lt;&lt;if ($smith_store_items.weapons)&gt;&gt;  &lt;&lt;print Object.keys($smith_store_items.weapons).length&gt;&gt; &lt;&lt;else&gt;&gt; None &lt;&lt;/if&gt;&gt; 
        &lt;br&gt;
        Amount armor: &lt;&lt;if ($smith_store_items.armor)&gt;&gt;  &lt;&lt;print Object.keys($smith_store_items.armor).length&gt;&gt; &lt;&lt;else&gt;&gt; None &lt;&lt;/if&gt;&gt; 
        &lt;br&gt;
        &lt;br&gt;
    &lt;&lt;/if&gt;&gt; 

    Mr. Smith show you the goods he can sell you:
    &lt;br&gt;
    &lt;br&gt;


    /* Show Store Items */
    &lt;&lt;set _cur_store_types = Object.keys($smith_store_list);&gt;&gt;

    &lt;&lt;for _i=0;_i&lt;_cur_store_types.length;_i++&gt;&gt;  
        &lt;&lt;set _cur_type = _cur_store_types[_i]&gt;&gt;
        &lt;&lt;set _cur_type_items = $smith_store_items[_cur_type]&gt;&gt;

        &lt;&lt;print &#39;&lt;div class=&quot;store_items-&#39;+_cur_type+&#39;&quot;&gt;&lt;/div&gt;&#39;&gt;&gt;
        &lt;&lt;run setup.showStore(_cur_type_items, _cur_type, &#39;smith_store_items&#39;)&gt;&gt;
    &lt;&lt;/for&gt;&gt; 
    		

&lt;&lt;/nobr&gt;&gt; 


[[Update Smith Store|passage()][$quest.store.smith.update_1.status = 1; ]]		



[[index]]

[[Return|Smith]]</tw-passagedata><tw-passagedata pid="85" name="Village_Tavern" tags="Location nobr" position="1550,1196" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_tavern_bedroom&#39; &#39;Village_Tavern_Bedroom&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="86" name="Village_Tavern_Bedroom" tags="Location nobr" position="1540,1499" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_tavern&#39; &#39;Village_Tavern&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="87" name="Village_Warders_Barracks" tags="Location nobr" position="1699,1495" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_warders_entry&#39; &#39;Village_Warders_Entry&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="88" name="Village_Warders_Entry" tags="Location nobr" position="1699,1495" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_warders_training_field&#39; &#39;Village_Warders_Training_Field&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;&lt;passage &#39;passages&#39; &#39;passage_village_warders_barracks&#39; &#39;Village_Warders_Barracks&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;&lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_east&#39; &#39;Village_East&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="89" name="Village_Warders_Training_Field" tags="Location nobr" position="1699,1495" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_village_warders_entry&#39; &#39;Village_Warders_Entry&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="90" name="Village_West" tags="Location nobr" position="1000,1000" size="100,100">&lt;div class=&quot;passage-list passage-list__locations&quot;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard__go_home&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_shed&#39; &#39;Village_West_Shed&#39; &#39;location&#39; true true&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_alura&#39; &#39;House_Alura&#39; &gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_taylor&#39; &#39;House_Taylor&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt;
    &lt;&lt;passage &#39;passages&#39; &#39;passage_house_smith&#39; &#39;House_Smith&#39;&gt;&gt;&lt;&lt;set $time.minute += 2&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

    &lt;&lt;passage &#39;passages&#39; &#39;passage_village_center&#39; &#39;Village_Center&#39; &#39;location&#39; true true &gt;&gt;&lt;&lt;/passage&gt;&gt;
&lt;/div&gt;</tw-passagedata><tw-passagedata pid="91" name="Village_West_Shed" tags="Location nobr" position="1800,850" size="100,100">&lt;&lt;passage &#39;passages&#39; &#39;passage_home_yard&#39; &#39;Home_Yard&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;passage &#39;passages&#39; &#39;passage_village_west&#39; &#39;Village_West&#39;&gt;&gt;&lt;&lt;/passage&gt;&gt;</tw-passagedata><tw-passagedata pid="92" name="Widgets" tags="System widget" position="300,0" size="100,100">&lt;&lt;nobr&gt;&gt;

	&lt;&lt;widget &quot;toggle&quot;&gt;&gt;		
		&lt;&lt;set _text = $args[0]&gt;&gt;		
		&lt;&lt;set _variable = $args[1]&gt;&gt;	
		&lt;&lt;set _status = $args[2]&gt;&gt;	

		&lt;&lt;if _status is 1&gt;&gt;
			&lt;label class=&quot;toggle-button&quot;&gt;
				&lt;&lt;checkbox &quot;$settings.return_notification&quot; 0 1 checked&gt;&gt;
				&lt;&lt;text_system &#39;setting&#39; _text&gt;&gt;
			&lt;/label&gt;
		&lt;&lt;else&gt;&gt;
			&lt;label class=&quot;toggle-button&quot;&gt;
				&lt;&lt;checkbox &quot;$settings.return_notification&quot; 0 1&gt;&gt;
				&lt;&lt;text_system &#39;setting&#39; _text&gt;&gt;
			&lt;/label&gt;
		&lt;&lt;/if&gt;&gt; 
	&lt;&lt;/widget&gt;&gt;

	/* &lt;&lt;widget &quot;updatebar&quot;&gt;&gt;
		&lt;&lt;silently&gt;&gt;
			&lt;&lt;replace &quot;#story-caption&quot;&gt;&gt;
				&lt;&lt;include &quot;StoryCaption&quot;&gt;&gt;
			&lt;&lt;/replace&gt;&gt;
		&lt;&lt;/silently&gt;&gt;
	&lt;&lt;/widget&gt;&gt; */

	&lt;&lt;widget &quot;speech&quot;&gt;&gt;
		&lt;&lt;set _character = _args[0].toLowerCase()&gt;&gt;
		&lt;&lt;set _text = _args[1]&gt;&gt;
		&lt;&lt;set _posture = _args[2] ?? &#39;default&#39;&gt;&gt;
		&lt;&lt;set _posture = (_posture == &#39;undefined&#39;) ? &#39;default&#39; : _posture&gt;&gt;
		&lt;&lt;set _character_name_specific = _args[3] &gt;&gt;
		
		&lt;&lt;if _character_name_specific&gt;&gt;
			&lt;&lt;= `&lt;div class=&quot;speech&quot; data-character=&quot;${_character}&quot; data-text=&quot;${_text}&quot; data-posture=&quot;${_posture}&quot; data-specname=&quot;${_character_name_specific}&quot;&gt;&lt;/div&gt;`&gt;&gt;
		&lt;&lt;/if&gt;&gt;

		&lt;&lt;if !_character_name_specific&gt;&gt;
			&lt;&lt;= `&lt;div class=&quot;speech&quot; data-character=&quot;${_character}&quot; data-text=&quot;${_text}&quot; data-posture=&quot;${_posture}&quot;&gt;&lt;/div&gt;`&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;/widget&gt;&gt;

	&lt;&lt;widget &quot;text&quot;&gt;&gt;
		&lt;&lt;set _text = _args[0]&gt;&gt;
		&lt;&lt;set _text_type = _args[1] ?? &#39;default&#39;&gt;&gt;

		&lt;&lt;if _text_type == &#39;default&#39;&gt;&gt;
			&lt;div class=&quot;text-block&quot;&gt;			
				&lt;div class=&quot;narration-block&quot;&gt;
					&lt;img class=&quot;narration-block_img&quot; src=&quot;media/icons/sketch/narration.png&quot; alt=&quot;narration&quot; data-thelper=&quot;narration&quot; /&gt;
					&lt;span class=&quot;text narration-block_text&quot; @data-string=_text&gt;&lt;/span&gt;
				&lt;/div&gt;
			&lt;/div&gt; &lt;br&gt;
		&lt;&lt;/if&gt;&gt;

		&lt;&lt;if _text_type == &#39;gesture&#39;&gt;&gt;
			&lt;div class=&quot;text-block&quot;&gt;
				&lt;div class=&quot;gesture-block&quot;&gt;
					&lt;img class=&quot;gesture-block_img&quot; src=&quot;media/icons/sketch/gesture.png&quot; alt=&quot;gesture&quot; data-thelper=&quot;gesture&quot; /&gt;
					&lt;span class=&quot;text gesture-block_text&quot; @data-string=_text&gt;&lt;/span&gt;
				&lt;/div&gt;
			&lt;/div&gt; &lt;br&gt;
		&lt;&lt;/if&gt;&gt;

		&lt;&lt;if _text_type == &#39;thought&#39;&gt;&gt;
			&lt;div class=&quot;text-block&quot;&gt;
				&lt;div class=&quot;thought-block&quot;&gt;
					&lt;img class=&quot;thought-block_img&quot; src=&quot;media/icons/sketch/thought.png&quot; alt=&quot;thought&quot; data-thelper=&quot;thought&quot; /&gt;
					&lt;span class=&quot;text thought-block_text&quot; @data-string=_text&gt;&lt;/span&gt;
				&lt;/div&gt;
			&lt;/div&gt; &lt;br&gt;
		&lt;&lt;/if&gt;&gt;

	&lt;&lt;/widget&gt;&gt;

	
	&lt;&lt;widget &#39;getName&#39;&gt;&gt;
		&lt;&lt;set _character = _args[0]&gt;&gt;
		&lt;&lt;set _result = setup.getNameSC(_character)&gt;&gt;

		&lt;&lt;= _result&gt;&gt;&lt;&lt;/widget&gt;&gt; /* I should be that way to remove extra space after the name */
	


	
	/* Extra spaces otherwise */
	&lt;&lt;widget &quot;text_system&quot;&gt;&gt;&lt;&lt;set _text_list = $args[0]&gt;&gt;&lt;&lt;set _text = $args[1]&gt;&gt;&lt;&lt;set _text_class = &quot;text--&quot;+_text_list&gt;&gt;&lt;span @class=&quot;`passage-text-system ${_text_class}`&quot; @data-list=_text_list @data-string=_text&gt;&lt;/span&gt;&lt;&lt;/widget&gt;&gt;

	&lt;&lt;widget &#39;br&#39;&gt;&gt;
		&lt;&lt;set _br_num = $args[0] ?? 1&gt;&gt;

		&lt;&lt;for _b=0; _b &lt; _br_num; _b++&gt;&gt;   
			&lt;br&gt;
		&lt;&lt;/for&gt;&gt;	
	&lt;&lt;/widget&gt;&gt;

	
	&lt;&lt;widget &#39;passage&#39; container&gt;&gt;
		&lt;&lt;set _text_list = _args[0]&gt;&gt;
		&lt;&lt;set _text = _args[1]&gt;&gt;
		&lt;&lt;set _passage = _args[2]&gt;&gt;
		&lt;&lt;set _icon_class = _args[3] ?? &#39;location&#39;&gt;&gt;
		&lt;&lt;set _is_blocked = _args[4] ?? false&gt;&gt;
		&lt;&lt;set _has_tip = _args[5] ?? false&gt;&gt;

		&lt;&lt;if !_is_blocked&gt;&gt;
			&lt;div class=&quot;link-icon__container&quot;&gt;
				&lt;a data-passage=_passage class=&quot;link-icon link-contents link-pixel-border link-underline link-internal macro-link&quot; tabindex=&quot;0&quot;&gt;

					&lt;&lt;linkreplace &#39;&lt;&lt;text_system _text_list _text&gt;&gt;&#39;&gt;&gt;_contents &lt;&lt;/linkreplace&gt;&gt;

					&lt;div class=&quot;link-content-wrapper&quot;&gt;
						&lt;div class=&quot;link-content-container link-underline-container&quot;&gt;
							&lt;&lt;if _icon_class != &#39;none&#39;&gt;&gt; 
								&lt;i @class=&quot;`ra ra-${_icon_class}`&quot;&gt;&lt;/i&gt;
							&lt;&lt;/if&gt;&gt;
							
							&lt;&lt;text_system _text_list _text&gt;&gt;
						&lt;/div&gt;
					&lt;/div&gt;
				&lt;/a&gt;

				&lt;&lt;if typeof _has_tip === &#39;boolean&#39; and _has_tip&gt;&gt; 
					&lt;&lt;info_tip &#39;tip_location_blocked&#39;&gt;&gt;
				&lt;&lt;elseif typeof _has_tip === &#39;string&#39;&gt;&gt;
					&lt;&lt;info_tip _has_tip&gt;&gt;
				&lt;&lt;/if&gt;&gt;

			&lt;/div&gt;
		&lt;&lt;/if&gt;&gt; 

		&lt;&lt;if _is_blocked&gt;&gt;
			&lt;div class=&quot;link-icon__container  link-icon__container--disabled &quot; &gt;
				&lt;a inert class=&quot;link-icon link-contents link-pixel-border link-underline link-internal macro-link&quot; tabindex=&quot;0&quot;  data-thelper=&quot;location_blocked&quot;&gt;

					&lt;div class=&quot;link-content-wrapper&quot;&gt;
						&lt;div class=&quot;link-content-container link-underline-container&quot;&gt;
							&lt;&lt;if _icon_class != &#39;none&#39;&gt;&gt; 
								&lt;i @class=&quot;`ra ra-${_icon_class}`&quot;&gt;&lt;/i&gt;
							&lt;&lt;/if&gt;&gt;
							
							&lt;&lt;text_system _text_list _text&gt;&gt;
						&lt;/div&gt;
					&lt;/div&gt;
				&lt;/a&gt;

				&lt;&lt;if typeof _has_tip === &#39;boolean&#39; and _has_tip&gt;&gt; 
					&lt;&lt;info_tip &#39;tip_location_blocked&#39;&gt;&gt;
				&lt;&lt;elseif typeof _has_tip === &#39;string&#39;&gt;&gt;
					&lt;&lt;info_tip _has_tip&gt;&gt;
				&lt;&lt;/if&gt;&gt;

			&lt;/div&gt;
		&lt;&lt;/if&gt;&gt;

	&lt;&lt;/widget&gt;&gt;




	/* &lt;&lt;widget &#39;activity&#39; container&gt;&gt;	
		&lt;&lt;set _text = _args[0]&gt;&gt;
		&lt;&lt;set _passage = _args[1]&gt;&gt;
		&lt;&lt;set _icon_class = _args[2] ?? &#39;default&#39;&gt;&gt;
		&lt;&lt;set _is_br = _args[3] ?? true&gt;&gt;

		&lt;&lt;set _conditions_met = true&gt;&gt;
		&lt;&lt;if _text == &#39;rest&#39;&gt;&gt;
			&lt;&lt;if ($player.stamina &gt;= ($player.stamina_max - $player.stamina_max/10))&gt;&gt;
				&lt;&lt;set _conditions_met = false &gt;&gt;				
			&lt;&lt;/if &gt;&gt;
		&lt;&lt;/if &gt;&gt;

		&lt;&lt;set _conditions_class = (_conditions_met) ? &#39;&#39; : &#39;link-activity--fake&#39;&gt;&gt;
		
		&lt;&lt;if _conditions_met&gt;&gt;
			&lt;a data-passage=_passage class=&quot;link-activity link-contents link-internal macro-link&quot; tabindex=&quot;0&quot;&gt;
				
				Workaround to run command written in widget body
				&lt;&lt;linkreplace &#39;&lt;&lt;text_system &quot;activities&quot; _text&gt;&gt;&#39;&gt;&gt;	_contents &lt;&lt;/linkreplace &gt;&gt;  

				&lt;div class=&quot;link-content-wrapper&quot;&gt;
					&lt;div class=&quot;link-content-container link-underline-container&quot;&gt;
						&lt;&lt;if _icon_class != &#39;none&#39;&gt;&gt;
							&lt;i @class=&quot;`ra ra-${_icon_class}`&quot;&gt;&lt;/i&gt;
						&lt;&lt;/if&gt;&gt;
						
						&lt;&lt;text_system &#39;activities&#39; _text&gt;&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/a&gt;

			&lt;&lt;if _is_br &gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;/if&gt;&gt;
		&lt;&lt;/if&gt;&gt;

		
		&lt;&lt;if !_conditions_met&gt;&gt;
			&lt;&lt;set _reason = &#39;time&#39;&gt;&gt;
			&lt;div class=&quot;link-activity link-contents link-activity--fake&quot;&gt;
				&lt;p class=&quot;link-fake__tip-text tip_gen&quot;&gt;&lt;&lt;text_system &quot;activity_reasons&quot; _reason&gt;&gt;&lt;/p&gt;

				&lt;div class=&quot;link-content-wrapper&quot;&gt;
					&lt;div class=&quot;link-content-container link-underline-container&quot;&gt;
						&lt;&lt;if _icon_class != &#39;none&#39;&gt;&gt;
							&lt;i @class=&quot;`ra ra-${_icon_class}`&quot;&gt;&lt;/i&gt;
						&lt;&lt;/if&gt;&gt;
						
						&lt;&lt;text_system &#39;activities&#39; _text&gt;&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;

			&lt;&lt;if _is_br &gt;&gt; &lt;&lt;br&gt;&gt; &lt;&lt;/if&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;/widget&gt;&gt; */


	&lt;&lt;widget &#39;system_return&#39;&gt;&gt;	
		&lt;&lt;if !$temp.menu_tab || $temp.menu_tab == 1 &gt;&gt;
			&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
				&lt;&lt;link &quot;&lt;&lt;text_system &#39;misc&#39; &#39;return&#39;&gt;&gt;&quot; $return_passage&gt;&gt;
					&lt;&lt;if $temp.menu_tab != 1&gt;&gt; &lt;&lt;set $temp.menu_tab = 1&gt;&gt; &lt;&lt;/if&gt;&gt;
				&lt;&lt;/link&gt;&gt;
			&lt;/button&gt; &lt;&lt;br 2&gt;&gt;
		&lt;&lt;else&gt;&gt;
			&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
				&lt;&lt;link &quot;&lt;&lt;text_system &#39;misc&#39; &#39;return_main&#39;&gt;&gt;&quot; `passage()`&gt;&gt;
					&lt;&lt;if $temp.menu_tab != 1&gt;&gt; &lt;&lt;set $temp.menu_tab = 1&gt;&gt; &lt;&lt;/if&gt;&gt;
				&lt;&lt;/link&gt;&gt;
			&lt;/button&gt; &lt;&lt;br 2&gt;&gt;
		&lt;&lt;/if&gt;&gt;
	&lt;&lt;/widget&gt;&gt;


	
	&lt;&lt;widget &#39;info_tip&#39;&gt;&gt;
		&lt;&lt;set _string_idn = $args[0]&gt;&gt;
		&lt;&lt;set _size = $args[1] ?? false&gt;&gt;

		&lt;&lt;= setup.getInfoTipContent(_string_idn, _size)&gt;&gt;
	&lt;&lt;/widget&gt;&gt;

	/* Old version, temporary undeleted in order to check workability of new version for all places later on  */
	/* &lt;&lt;widget &#39;info_tip&#39;&gt;&gt;
		&lt;&lt;set _string_idn = $args[0]&gt;&gt;
		&lt;&lt;set _string = &#39;&lt;&lt;text_system &quot;tips&quot; _string_idn&gt;&gt;&#39;&gt;&gt;
		&lt;&lt;set _size = $args[1] ?? false&gt;&gt;
		&lt;&lt;set _extra_tip_class = (_size == &#39;large&#39;) ? &#39;info_tip-container--large&#39; : &#39;&#39;&gt;&gt;

		&lt;div class=&quot;info_tip-wrapper&quot;&gt;
			&lt;div @class=&quot;`info_tip-container ${_extra_tip_class}`&quot;&gt;
				&lt;img class=&quot;info_tip-icon&quot; src=&quot;media/icons/info_tip.png&quot; alt=&quot;info_tip&quot;&gt;
				&lt;img class=&quot;info_tip-icon--hover&quot; src=&quot;media/icons/info_tip_hover.png&quot; alt=&quot;info_tip&quot;&gt;
				&lt;span class=&quot;info_tip-text tip_gen&quot;&gt;_string&lt;/span&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;&lt;/widget&gt;&gt; */


	&lt;&lt;widget &#39;space&#39;&gt;&gt;
		&lt;&lt;set _space_num = $args[0] ?? 1&gt;&gt;

		&lt;&lt;for _b=0; _b &lt; _br_num; _b++&gt;&gt;   
			&amp;nbsp;
		&lt;&lt;/for&gt;&gt;	
	&lt;&lt;/widget&gt;&gt;


	&lt;&lt;widget &#39;shadowed_img&#39;&gt;&gt;
		&lt;&lt;set _shadowed_img = `${$args[0]}`&gt;&gt;
		&lt;&lt;set _src_path = `media/${_shadowed_img}`&gt;&gt;
		&lt;&lt;set _width = ($args[1]) ? `${$args[1]}px` : &#39;fit-content&#39;&gt;&gt;
		&lt;&lt;set _heigth = ($args[2]) ? `${$args[2]}px` : &#39;auto&#39;&gt;&gt;
		&lt;&lt;set _style = `width: ${_width}; height: ${_heigth};` &gt;&gt;

		&lt;div class=&quot;shadowed-img__container sketch__image&quot; @style=_style &gt;
			&lt;img class=&quot;shadowed-img__img-1&quot; @src=_src_path &gt;
			&lt;span class=&quot;shadowed-img__overlay&quot;&gt;&lt;/span&gt;
			&lt;img class=&quot;shadowed-img__img-2&quot; @src=_src_path &gt;
		&lt;/div&gt;
	&lt;&lt;/widget&gt;&gt;
	

	&lt;&lt;widget &#39;menu_tabs&#39;&gt;&gt;
		&lt;&lt;set _amount = $args[0]&gt;&gt;
		&lt;&lt;set _category = $args[1]&gt;&gt;
		&lt;&lt;set _key = $args[2] ?? &#39;menu_item&#39;&gt;&gt;

		&lt;div class=&quot;menu-tabs&quot;&gt;&lt;/div&gt;
		&lt;&lt;run setup.addMenuTabs(_amount, _category, _key)&gt;&gt;
		&lt;&lt;br&gt;&gt;
	&lt;&lt;/widget&gt;&gt;

	&lt;&lt;widget &#39;mirror_passage&#39;&gt;&gt;
    	&lt;&lt;set _is_tasks = setup.isAnyTaskAvailableForCharacter(&quot;player&quot;)&gt;&gt;
    	&lt;&lt;set _is_quests = setup.isAnyQuestAvailable(&quot;Mirror_Room&quot;, &quot;player&quot;)&gt;&gt;
		&lt;a data-passage=&#39;Mirror_Room&#39; class=&quot;passage-special passage-special--mirror link-internal&quot; data-thelper=&quot;mirror&quot; tabindex=&quot;0&quot;&gt;
			&lt;img src=&quot;media/icons/mirror.png&quot;&gt;
			&lt;&lt;text_system &#39;misc&#39; &#39;mirror_reflect&#39;&gt;&gt;
			&lt;&lt;if _is_tasks &gt;&gt; &lt;&lt;= setup.getQuestMarkContent(&#39;task&#39;)&gt;&gt; &lt;&lt;/if&gt;&gt;
			&lt;&lt;if _is_quests &gt;&gt; &lt;&lt;= setup.getQuestMarkContent()&gt;&gt; &lt;&lt;/if&gt;&gt;
		&lt;/a&gt;&lt;&lt;br&gt;&gt;
	&lt;&lt;/widget&gt;&gt;

	
	&lt;&lt;widget &#39;menu_item_arrow&#39;&gt;&gt;
		&lt;&lt;set _tab_index = $args[0] ?? 1&gt;&gt;
		&lt;&lt;set _category = $args[1]&gt;&gt;
		&lt;&lt;set _item_name = $args[2]&gt;&gt;		
		&lt;&lt;set _item_status = $args[3]&gt;&gt;

		&lt;&lt;= setup.getMenuItemArrow(passage(), _tab_index, _category, _item_name, _item_status)&gt;&gt;

		/* &lt;div class=&quot;list-arrow__container&quot;&gt;
			&lt;div class=&quot;list-arrow__start&quot;&gt;
				&lt;div class=&quot;list-arrow__arrow-down&quot;&gt;&lt;/div&gt;
				&lt;div class=&quot;list-arrow__arrow-up&quot;&gt;&lt;/div&gt;
			&lt;/div&gt;
			&lt;div class=&quot;list-arrow__body&quot;&gt;
				&lt;a data-passage=_passage data-setter=&quot;$temp.menu_tab to _tab_index&quot;&gt;
					&lt;&lt;text_system &#39;info_interface&#39; &#39;info_main_list_item_1&#39;&gt;&gt;
				&lt;/a&gt; 
				&lt;&lt;text_system &#39;info_interface&#39; &#39;info_main_list_item_status_2&#39;&gt;&gt;
			&lt;/div&gt;
			&lt;div class=&quot;list-arrow__arrow-right&quot;&gt;&lt;/div&gt;
		&lt;/div&gt; */

	&lt;&lt;/widget&gt;&gt;



	

&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="93" name="index" tags="System nobr" position="1200,101.66666666666667" size="100,100">&lt;div class=&quot;disclaimer-title&quot;&gt;
  &lt;p&gt;&lt;&lt;text_system &#39;index&#39; &#39;index_title_welcome&#39;&gt;&gt; &lt;h1 class=&quot;story-title&quot;&gt;&lt;&lt;text_system &#39;misc&#39; &#39;game_title&#39;&gt;&gt;&lt;/h1&gt; &lt;/p&gt;
&lt;/div&gt; &lt;&lt;br&gt;&gt;

&lt;&lt;text_system &#39;index&#39; &#39;index_select_lang&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;div class=&quot;language-select__container&quot; @data-lang=$settings.lang&gt;&lt;/div&gt; &lt;&lt;br 3&gt;&gt;

&lt;div class=&quot;disclaimer-subtitle&quot;&gt; &lt;&lt;text_system &#39;index&#39; &#39;index_introduction_title&#39;&gt;&gt; &lt;/div&gt;
&lt;&lt;text_system &#39;index&#39; &#39;index_introduction_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;index&#39; &#39;index_introduction_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-subtitle&quot;&gt; &lt;&lt;text_system &#39;info_project&#39; &#39;project_1&#39;&gt;&gt; &lt;/div&gt;
&lt;&lt;text_system &#39;info_project&#39; &#39;project_3&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

&lt;div class=&quot;disclaimer-subtitle&quot;&gt; &lt;&lt;text_system &#39;info_project&#39; &#39;project_story_title&#39;&gt;&gt; &lt;/div&gt; 
&lt;&lt;text_system &#39;info_project&#39; &#39;project_story_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;info_project&#39; &#39;project_story_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

&lt;&lt;text_system &#39;index&#39; &#39;index_info_project_text&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_info_in_help_menu&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_project&#39;&gt;&gt;&quot; &#39;Info_Project&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 3&gt;&gt;


&lt;div class=&quot;disclaimer-subtitle&quot;&gt; &lt;&lt;text_system &#39;index&#39; &#39;index_game_details_title&#39;&gt;&gt; &lt;/div&gt; 
&lt;&lt;text_system &#39;index&#39; &#39;index_game_details_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;text_system &#39;index&#39; &#39;index_game_details_2&#39;&gt;&gt; &lt;&lt;br 2&gt;&gt;

&lt;&lt;text_system &#39;index&#39; &#39;index_info_interface_text&#39;&gt;&gt; &lt;&lt;info_tip &#39;tip_info_in_help_menu&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_interface&#39;&gt;&gt;&quot; &#39;Info_Interface&#39;&gt;&gt;&lt;&lt;/link&gt;&gt; 
&lt;/button&gt; &lt;&lt;br 5&gt;&gt;


&lt;div class=&quot;disclaimer-title&quot;&gt; &lt;&lt;text_system &#39;index&#39; &#39;index_to_disclaimer_title&#39;&gt;&gt; &lt;/div&gt; 
&lt;&lt;text_system &#39;index&#39; &#39;index_to_disclaimer_1&#39;&gt;&gt; &lt;&lt;br&gt;&gt;
&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
	&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_info_disclaimer&#39;&gt;&gt;&quot; &#39;Info_Disclaimer&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;/button&gt; &lt;&lt;br 3&gt;&gt;
 

&lt;&lt;if $settings.debug == 1&gt;&gt;
	&lt;&lt;br 2&gt;&gt;
	&lt;button class=&quot;custom-btn btn-apply&quot;&gt;	
		&lt;&lt;link &quot;&lt;&lt;text_system &#39;passages&#39; &#39;passage_menu_debug&#39;&gt;&gt;&quot; &#39;Menu_Debug&#39;&gt;&gt;&lt;&lt;/link&gt;&gt;
	&lt;/button&gt; &lt;&lt;br&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){(function(window,document,jQuery,undefined){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function mesg(where,error,isFatal,isUncaught){var mesg="Error",nice="A".concat(isFatal?" fatal":"n"," error has occurred.");nice+=isFatal?" Aborting.":" You may be able to continue, but some parts may not work properly.";var isObject=null!==error&&"object"===_typeof(error),what=(isObject&&"message"in error?String(error.message).replace(errorPrologRegExp,""):String(error)).trim()||"unknown error";null!=where&&(mesg+=" [".concat(where,"]")),mesg+=": ".concat(what,"."),isObject&&"stack"in error&&(mesg+="\n\nStack Trace:\n".concat(error.stack)),mesg&&(nice+="\n\n".concat(mesg)),isUncaught||console[isFatal?"error":"warn"](mesg),window.alert(nice)}var origOnError;return origOnError=window.onerror,window.onerror=function(what,source,lineNum,colNum,error){"complete"===document.readyState?mesg(null,null!=error?error:what,!1,!0):(mesg(null,null!=error?error:what,!0,!0),window.onerror=origOnError,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))},Object.freeze(Object.defineProperties({},{error:{value:function(where,error){mesg(where,error)}},fatal:{value:function(where,error){mesg(where,error,!0)}}}))}(),Patterns=(wsMap=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),wsRe=/^\s$/,missing="",wsMap.forEach((function(pat,char){wsRe.test(char)||(missing+=pat)})),space=missing?"[\\s".concat(missing,"]"):"\\s",spaceNoTerminator="[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",notSpace="\\s"===space?"\\S":space.replace(/^\[/,"[^"),anyChar="(?:.|".concat("[\\n\\r\\u2028\\u2029]",")"),anyLetter="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",anyLetterStrict=anyLetter.replace("\\-",""),identifier="".concat("[$A-Z_a-z]").concat("[$0-9A-Z_a-z]","*"),variable="[$_]"+identifier,htmlTagName="[A-Za-z](?:".concat(cENChar="(?:[\\x2D.0-9A-Z_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])","*-").concat(cENChar,"*|[0-9A-Za-z]*)"),twStyle="(".concat(anyLetter,"+)\\(([^\\)\\|\\n]+)\\):"),cssStyle="".concat(spaceNoTerminator,"*(").concat(anyLetter,"+)").concat(spaceNoTerminator,"*:([^;\\|\\n]+);"),idOrClass="".concat(spaceNoTerminator,"*((?:").concat("[#.]").concat(anyLetter,"+").concat(spaceNoTerminator,"*)+);"),inlineCss="".concat(twStyle,"|").concat(cssStyle,"|").concat(idOrClass),Object.freeze({space:space,spaceNoTerminator:spaceNoTerminator,lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:notSpace,anyChar:anyChar,anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:identifier,variableSigil:"[$_]",variable:variable,macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",htmlTagName:htmlTagName,cssIdOrClassSigil:"[#.]",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:inlineCss,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})),wsMap,wsRe,missing,cENChar,twStyle,cssStyle,idOrClass,space,spaceNoTerminator,notSpace,anyChar,anyLetter,anyLetterStrict,identifier,variable,htmlTagName,inlineCss;!function(){var startWSRe,endWSRe,_trimString=(startWSRe=new RegExp("^".concat(Patterns.space).concat(Patterns.space,"*")),endWSRe=new RegExp("".concat(Patterns.space).concat(Patterns.space,"*$")),function(str,where){var val=String(str);if(!val)return val;switch(where){case"start":return startWSRe.test(val)?val.replace(startWSRe,""):val;case"end":return endWSRe.test(val)?val.replace(endWSRe,""):val;default:throw new Error('_trimString called with incorrect where parameter value: "'.concat(where,'"'))}});function _createPadString(length,padding){var targetLength=Number.parseInt(length,10)||0;if(targetLength<1)return"";var padString=void 0===padding?"":String(padding);for(""===padString&&(padString=" ");padString.length<targetLength;){var curPadLength=padString.length,remainingLength=targetLength-curPadLength;padString+=curPadLength>remainingLength?padString.slice(0,remainingLength):padString}return padString.length>targetLength&&(padString=padString.slice(0,targetLength)),padString}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function flat(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var depth=0===arguments.length?1:Number(arguments[0])||0;return depth<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,(function(acc,cur){return cur instanceof Array?acc.push.apply(acc,_toConsumableArray(flat.call(cur,depth-1))):acc.push(cur),acc}),[])}}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var length=this.length>>>0;if(0===length)return!1;var needle=arguments[0],i=Number(arguments[1])||0;for(i<0&&(i=Math.max(0,length+i));i<length;++i){var value=this[i];if(value===needle||value!=value&&needle!=needle)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(obj).map((function(key){return[key,obj[key]]}))}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(iter){return Array.from(iter).reduce((function(acc,pair){if(Object(pair)!==pair)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return pair[0]in acc?Object.defineProperty(acc,pair[0],{configurable:!0,enumerable:!0,writable:!0,value:pair[1]}):acc[pair[0]]=pair[1],acc}),{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(obj){if(null==obj)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var O=Object(obj);return Reflect.ownKeys(O).reduce((function(acc,key){var desc=Object.getOwnPropertyDescriptor(O,key);return void 0!==desc&&(key in acc?Object.defineProperty(acc,key,{configurable:!0,enumerable:!0,writable:!0,value:desc}):acc[key]=desc),acc}),{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(obj){if("object"!==_typeof(obj)||null===obj)throw new TypeError("Object.values object parameter must be an object");return Object.keys(obj).map((function(key){return obj[key]}))}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:_createPadString(targetLength-baseLength,padding)+baseString}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(length,padding){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var baseString=String(this),baseLength=baseString.length,targetLength=Number.parseInt(length,10);return targetLength<=baseLength?baseString:baseString+_createPadString(targetLength-baseLength,padding)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return _trimString(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return _trimString(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return _trimString(this,"end")}})}(),function(){var _nativeMathRandom=Math.random,_regExpMetaCharsRe,_hasRegExpMetaCharsRe,_formatRegExp,_hasFormatRegExp;function _random(){var min,max;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:min=0,max=arguments[0];break;default:min=arguments[0],max=arguments[1]}if(min>max){var _ref=[max,min];min=_ref[0],max=_ref[1]}return Math.floor(_nativeMathRandom()*(max-min+1))+min}function _randomIndex(length,boundsArgs){var min,max;switch(boundsArgs.length){case 1:min=0,max=length-1;break;case 2:min=0,max=Math.trunc(boundsArgs[1]);break;default:min=Math.trunc(boundsArgs[1]),max=Math.trunc(boundsArgs[2])}return Number.isNaN(min)?min=0:!Number.isFinite(min)||min>=length?min=length-1:min<0&&(min=length+min)<0&&(min=0),Number.isNaN(max)?max=0:(!Number.isFinite(max)||max>=length||max<0&&(max=length+max)<0)&&(max=length-1),_random(min,max)}function _getCodePointStartAndEnd(str,pos){var code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};if(code<55296||code>57343)return{char:str.charAt(pos),start:pos,end:pos};if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)throw new Error("high surrogate without trailing low surrogate");var nextCode=str.charCodeAt(nextPos);if(nextCode<56320||nextCode>57343)throw new Error("high surrogate without trailing low surrogate");return{char:str.charAt(pos)+str.charAt(nextPos),start:pos,end:nextPos}}if(0===pos)throw new Error("low surrogate without leading high surrogate");var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);if(prevCode<55296||prevCode>56319)throw new Error("low surrogate without leading high surrogate");return{char:str.charAt(prevPos)+str.charAt(pos),start:prevPos,end:pos}}Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(array){if("object"!==_typeof(array)||null===array||!Object.prototype.hasOwnProperty.call(array,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var length=array.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments,1));return array[index]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var result=Array.from(this);if(0===arguments.length)return result;var items=Array.prototype.reduce.call(arguments,(function(prev,cur){return prev.concat(cur)}),[]),addSize=items.length;if(0===addSize)return result;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=items[i];-1===indexOf.call(result,value)&&push.call(result,value)}return result}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var indexOf=Array.prototype.indexOf,needle=arguments[0],pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,++pos;return count}}),Object.defineProperty(Array.prototype,"countWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.countWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.countWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return 0;for(var count=0,i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&++count;return count}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var needles=Array.prototype.concat.apply([],arguments),needlesLength=needles.length,indices=[],i=0;i<length;++i)for(var value=this[i],j=0;j<needlesLength;++j){var needle=needles[j];if(value===needle||value!=value&&needle!=needle){indices.push(i);break}}for(var result=[],_i=0,iend=indices.length;_i<iend;++_i)result[_i]=this[indices[_i]];for(var splice=Array.prototype.splice,_i2=indices.length-1;_i2>=0;--_i2)splice.call(this,indices[_i2],1);return result}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,cpyIndices=_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map((function(x){return x<0?Math.max(0,length+x):x}))).values()),delIndices=_toConsumableArray(cpyIndices).sort((function(a,b){return b-a})),result=[],i=0,iend=cpyIndices.length;i<iend;++i)result[i]=this[cpyIndices[i]];for(var _i3=0,_iend=delIndices.length;_i3<_iend;++_i3)splice.call(this,delIndices[_i3],1);return result}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(predicate,thisArg){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof predicate)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var length=this.length>>>0;if(0===length)return[];for(var splice=Array.prototype.splice,indices=[],result=[],i=0;i<length;++i)predicate.call(thisArg,this[i],i,this)&&(result.push(this[i]),indices.push(i));for(var _i4=indices.length-1;_i4>=0;--_i4)splice.call(this,indices[_i4],1);return result}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!==this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(!Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var i=0,iend=arguments.length;i<iend;++i)if(Array.prototype.some.call(this,(function(val){return val===this.val||val!=val&&this.val!=this.val}),{val:arguments[i]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var length=this.length>>>0;if(0!==length)return this[length-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return Array.prototype.splice.call(this,index,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var splice=Array.prototype.splice,result=[],max=length-1;do{result.push(splice.call(this,_random(0,max--),1)[0])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,push=Array.prototype.push,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&push.call(this,value)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var length=this.length>>>0;if(0!==length){var index=0===arguments.length?_random(0,length-1):_randomIndex(length,Array.prototype.slice.call(arguments));return this[index]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(wantSize){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var length=this.length>>>0;if(0===length)return[];var want=Math.trunc(wantSize);if(!Number.isInteger(want))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(want<1)return[];want>length&&(want=length);var picked=new Map,result=[],max=length-1;do{var i=void 0;do{i=_random(0,max)}while(picked.has(i));picked.set(i,!0),result.push(this[i])}while(result.length<want);return result}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var length=this.length>>>0;if(0===length)return this;for(var i=length-1;i>0;--i){var j=Math.floor(_nativeMathRandom()*(i+1));if(i!==j){var swap=this[i];this[i]=this[j],this[j]=swap}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var addSize=arguments.length;if(0===addSize)return this.length>>>0;for(var indexOf=Array.prototype.indexOf,unshift=Array.prototype.unshift,i=0;i<addSize;++i){var value=arguments[i];-1===indexOf.call(this,value)&&unshift.call(this,value)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var slice=Array.prototype.slice,fn=this,bound=slice.call(arguments,0);return function(){for(var applied=[],argc=0,i=0;i<bound.length;++i)applied.push(bound[i]===undefined?arguments[argc++]:bound[i]);return fn.apply(this,applied.concat(slice.call(arguments,argc)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(num,min,max){var value=Number(num);return Number.isNaN(value)?NaN:value.clamp(min,max)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(num){return 1-(Math.cos(Number(num)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var min=Number(arguments[0]),max=Number(arguments[1]);if(min>max){var _ref2=[max,min];min=_ref2[0],max=_ref2[1]}return Math.min(Math.max(this,min),max)}}),RegExp.escape||(_regExpMetaCharsRe=/[\\^$*+?.()|[\]{}]/g,_hasRegExpMetaCharsRe=new RegExp(_regExpMetaCharsRe.source),Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(str){var val=String(str);return val&&_hasRegExpMetaCharsRe.test(val)?val.replace(_regExpMetaCharsRe,"\\$&"):val}})),_formatRegExp=/{(\d+)(?:,([+-]?\d+))?}/g,_hasFormatRegExp=new RegExp(_formatRegExp.source),Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(format){function padString(str,align,pad){if(!align)return str;var plen=Math.abs(align)-str.length;if(plen<1)return str;var padding=String(pad).repeat(plen);return align<0?str+padding:padding+str}if(arguments.length<2)return 0===arguments.length?"":format;var args=2===arguments.length&&Array.isArray(arguments[1])?_toConsumableArray(arguments[1]):Array.prototype.slice.call(arguments,1);return 0===args.length?format:_hasFormatRegExp.test(format)?(_formatRegExp.lastIndex=0,format.replace(_formatRegExp,(function(match,index,align){var retval=args[index];if(null==retval)return"";for(;"function"==typeof retval;)retval=retval();switch(_typeof(retval)){case"string":break;case"object":retval=JSON.stringify(retval);break;default:retval=String(retval)}return padString(retval,align?Number.parseInt(align,10):0," ")}))):format}}),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var needle=String(arguments[0]||"");if(""===needle)return 0;for(var indexOf=String.prototype.indexOf,step=needle.length,pos=Number(arguments[1])||0,count=0;-1!==(pos=indexOf.call(this,needle,pos));)++count,pos+=step;return count}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var str=String(this);return _getCodePointStartAndEnd(str,str.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(startAt,delCount,replacement){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var length=this.length>>>0;if(0===length)return"";var start=Number(startAt);Number.isSafeInteger(start)?start<0&&(start+=length)<0&&(start=0):start=0,start>length&&(start=length);var count=Number(delCount);(!Number.isSafeInteger(count)||count<0)&&(count=0);var res=this.slice(0,start);return void 0!==replacement&&(res+=replacement),start+count<length&&(res+=this.slice(start+count)),res}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd3=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd3.char,end=_getCodePointStartAnd3.end;return-1===end?"":char.toLocaleUpperCase()+str.slice(end+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var str=String(this),_getCodePointStartAnd4=_getCodePointStartAndEnd(str,0),char=_getCodePointStartAnd4.char,end=_getCodePointStartAnd4.end;return-1===end?"":char.toUpperCase()+str.slice(end+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","(".concat(this.toString(),")")]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",_toConsumableArray(this)]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",_toConsumableArray(this)]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(code,data){if("string"!=typeof code)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[code,data]]}}),Object.defineProperty(JSON,"_real_stringify",{value:JSON.stringify}),Object.defineProperty(JSON,"stringify",{configurable:!0,writable:!0,value:function(_value,replacer,space){return JSON._real_stringify(_value,(function(key,val){var value=val;if("function"==typeof replacer)try{value=replacer(key,value)}catch(ex){}return void 0===value&&(value=["(revive:eval)","undefined"]),value}),space)}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,(function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(ex){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(ex){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(ex){}return value}))}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var match,re=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),names=[];null!==(match=re.exec(this));)match[1]?names.push(match[1]):match[2]&&names.push(match[2]);return names}})}();var Browser=(userAgent=navigator.userAgent.toLowerCase(),winPhone=userAgent.includes("windows phone"),isMobile=Object.freeze({Android:!winPhone&&userAgent.includes("android"),BlackBerry:/blackberry|bb10/.test(userAgent),iOS:!winPhone&&/ip(?:hone|ad|od)/.test(userAgent),Opera:!winPhone&&("object"===_typeof(window.operamini)||userAgent.includes("opera mini")),Windows:winPhone||/iemobile|wpdesktop/.test(userAgent),any:function(){return isMobile.Android||isMobile.BlackBerry||isMobile.iOS||isMobile.Opera||isMobile.Windows}}),isGecko=!isMobile.Windows&&!/khtml|trident|edge/.test(userAgent)&&userAgent.includes("gecko"),isIE=!userAgent.includes("opera")&&/msie|trident/.test(userAgent),ieVersion=isIE?(ver=/(?:msie\s+|rv:)(\d+\.\d)/.exec(userAgent))?Number(ver[1]):0:null,isOpera=userAgent.includes("opera")||userAgent.includes(" opr/"),operaVersion=isOpera?function(){var ver=new RegExp("".concat(/khtml|chrome/.test(userAgent)?"opr":"version","\\/(\\d+\\.\\d+)")).exec(userAgent);return ver?Number(ver[1]):0}():null,isVivaldi=userAgent.includes("vivaldi"),Object.freeze({userAgent:userAgent,isMobile:isMobile,isGecko:isGecko,isIE:isIE,ieVersion:ieVersion,isOpera:isOpera,operaVersion:operaVersion,isVivaldi:isVivaldi})),ver,userAgent,winPhone,isMobile,isGecko,isIE,ieVersion,isOpera,operaVersion,isVivaldi,Has=(hasAudioElement=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(ex){}return!1}(),hasFile=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(ex){}return!1}(),hasGeolocation=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(ex){}return!1}(),hasMutationObserver=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(ex){}return!1}(),hasPerformance=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(ex){}return!1}(),hasTouch=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(ex){}return!1}(),hasTransitionEndEvent=function(){try{for(var teMap=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),teKeys=_toConsumableArray(teMap.keys()),el=document.createElement("div"),i=0;i<teKeys.length;++i)if(el.style[teKeys[i]]!==undefined)return teMap.get(teKeys[i])}catch(ex){}return!1}(),Object.freeze({audio:hasAudioElement,fileAPI:hasFile,geolocation:hasGeolocation,mutationObserver:hasMutationObserver,performance:hasPerformance,touch:hasTouch,transitionEndEvent:hasTransitionEndEvent})),hasAudioElement,hasFile,hasGeolocation,hasMutationObserver,hasPerformance,hasTouch,hasTransitionEndEvent,Visibility=(vendor=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find((function(vnd){return vnd.hiddenProperty in document})))}catch(ex){}return undefined}(),Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},state:{get:function(){return vendor&&document[vendor.stateProperty]||"visible"}},isEnabled:{value:function(){return Boolean(vendor)}},isHidden:{value:function(){return Boolean(vendor&&document[vendor.hiddenProperty])}},hiddenProperty:{value:vendor&&vendor.hiddenProperty},stateProperty:{value:vendor&&vendor.stateProperty},changeEvent:{value:vendor&&vendor.changeEvent}}))),vendor,Fullscreen=function(){var _hasPromise,vendor=function(){try{return Object.freeze([{isEnabled:"fullscreenEnabled",element:"fullscreenElement",requestFn:"requestFullscreen",exitFn:"exitFullscreen",changeEvent:"fullscreenchange",errorEvent:"fullscreenerror"},{isEnabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",requestFn:"webkitRequestFullscreen",exitFn:"webkitExitFullscreen",changeEvent:"webkitfullscreenchange",errorEvent:"webkitfullscreenerror"},{isEnabled:"mozFullScreenEnabled",element:"mozFullScreenElement",requestFn:"mozRequestFullScreen",exitFn:"mozCancelFullScreen",changeEvent:"mozfullscreenchange",errorEvent:"mozfullscreenerror"},{isEnabled:"msFullscreenEnabled",element:"msFullscreenElement",requestFn:"msRequestFullscreen",exitFn:"msExitFullscreen",changeEvent:"MSFullscreenChange",errorEvent:"MSFullscreenError"}].find((function(vnd){return vnd.isEnabled in document})))}catch(ex){}return undefined}(),_returnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,vendor)try{var value=document.exitFullscreen();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise});function _selectElement(requestedEl){var selectedEl=requestedEl||document.documentElement;return selectedEl===document.documentElement&&("msRequestFullscreen"===vendor.requestFn||Browser.isOpera&&Browser.operaVersion<15)&&(selectedEl=document.body),selectedEl}function isFullscreen(){return Boolean(vendor&&document[vendor.element])}function requestFullscreen(options,requestedEl){var _this=this;if(!vendor)return Promise.reject(new Error("fullscreen not supported"));var element=_selectElement(requestedEl);if("function"!=typeof element[vendor.requestFn])return Promise.reject(new Error("fullscreen not supported"));if(isFullscreen())return Promise.resolve();if(_returnsPromise())return element[vendor.requestFn](options);var namespace=".Fullscreen_requestFullscreen";return new Promise((function(resolve,reject){jQuery(element).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen request error")):resolve()})),element[vendor.requestFn](options)}))}function exitFullscreen(){var _this2=this;if(!vendor||"function"!=typeof document[vendor.exitFn])return Promise.reject(new TypeError("fullscreen not supported"));if(!isFullscreen())return Promise.reject(new TypeError("fullscreen mode not active"));if(_returnsPromise())return document[vendor.exitFn]();var namespace=".Fullscreen_exitFullscreen";return new Promise((function(resolve,reject){jQuery(document).off(namespace).one("".concat(vendor.errorEvent).concat(namespace," ").concat(vendor.changeEvent).concat(namespace),(function(ev){jQuery(_this2).off(namespace),ev.type===vendor.errorEvent?reject(new Error("unknown fullscreen exit error")):resolve()})),document[vendor.exitFn]()}))}return Object.freeze(Object.defineProperties({},{vendor:{get:function(){return vendor}},element:{get:function(){return vendor?document[vendor.element]:null}},isEnabled:{value:function(){return Boolean(vendor&&document[vendor.isEnabled])}},isFullscreen:{value:isFullscreen},request:{value:requestFullscreen},exit:{value:exitFullscreen},toggle:{value:function(options,requestedEl){return isFullscreen()?exitFullscreen():requestFullscreen(options,requestedEl)}},onChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.changeEvent,handlerFn)}}},offChange:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.changeEvent,handlerFn):$(element).off(vendor.changeEvent)}}},onError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);$(element).on(vendor.errorEvent,handlerFn)}}},offError:{value:function(handlerFn,requestedEl){if(vendor){var element=_selectElement(requestedEl);handlerFn?$(element).off(vendor.errorEvent,handlerFn):$(element).off(vendor.errorEvent)}}}}))}(),_ref3=Object.freeze(Object.defineProperties({},{clone:{value:function clone(orig){return"object"!==_typeof(orig)||null===orig?orig:orig instanceof String?String(orig):orig instanceof Number?Number(orig):orig instanceof Boolean?Boolean(orig):"function"==typeof orig.clone?orig.clone(!0):orig.nodeType&&"function"==typeof orig.cloneNode?orig.cloneNode(!0):(orig instanceof Array?copy=new Array(orig.length):orig instanceof Date?copy=new Date(orig.getTime()):orig instanceof Map?(copy=new Map,orig.forEach((function(val,key){return copy.set(key,clone(val))}))):orig instanceof RegExp?copy=new RegExp(orig):orig instanceof Set?(copy=new Set,orig.forEach((function(val){return copy.add(clone(val))}))):copy=Object.create(Object.getPrototypeOf(orig)),Object.keys(orig).forEach((function(name){return copy[name]=clone(orig[name])})),copy);var copy}},convertBreaks:{value:function(source){for(var node,output=document.createDocumentFragment(),para=document.createElement("p");null!==(node=source.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":if(null!==node.nextSibling&&node.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===node.nextSibling.nodeName.toUpperCase()){source.removeChild(node.nextSibling),source.removeChild(node),output.appendChild(para),para=document.createElement("p");continue}if(!para.hasChildNodes()){source.removeChild(node);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":para.hasChildNodes()&&(output.appendChild(para),para=document.createElement("p")),output.appendChild(node);continue}para.appendChild(node)}para.hasChildNodes()&&output.appendChild(para),source.appendChild(output)}},safeActiveElement:{value:function(){try{return document.activeElement||null}catch(ex){return null}}},setDisplayTitle:{value:function(title){if("string"!=typeof title)throw new TypeError("story display title must be a string (received: ".concat(Util.getType(title),")"));var render=document.createDocumentFragment();new Wikifier(render,title);var text=function(source){for(var node,copy=source.cloneNode(!0),frag=document.createDocumentFragment();null!==(node=copy.firstChild);){if(node.nodeType===Node.ELEMENT_NODE)switch(node.nodeName.toUpperCase()){case"BR":case"DIV":case"P":frag.appendChild(document.createTextNode(" "))}frag.appendChild(node)}return frag.textContent}(render).trim();document.title=Config.passages.displayTitles&&""!==State.passage&&State.passage!==Config.passages.start?"".concat(State.passage," | ").concat(text):text;var storyTitle=document.getElementById("story-title");null!==storyTitle&&jQuery(storyTitle).empty().append(render)}},setPageElement:{value:function(idOrElement,titles,defaultText){var el="object"===_typeof(idOrElement)?idOrElement:document.getElementById(idOrElement);if(null==el)return null;var ids=Array.isArray(titles)?titles:[titles];jQuery(el).empty();for(var i=0,iend=ids.length;i<iend;++i)if(Story.has(ids[i]))return new Wikifier(el,Story.get(ids[i]).processText().trim()),el;if(null!=defaultText){var text=String(defaultText).trim();""!==text&&new Wikifier(el,text)}return el}},throwError:{value:function(place,message,source){var $wrapper=jQuery(document.createElement("div")),$toggle=jQuery(document.createElement("button")),$source=jQuery(document.createElement("pre")),mesg="".concat(L10n.get("errorTitle"),": ").concat(message||"unknown error");return $toggle.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},(function(){$toggle.hasClass("enabled")?($toggle.removeClass("enabled"),$source.attr({"aria-hidden":!0,hidden:"hidden"})):($toggle.addClass("enabled"),$source.removeAttr("aria-hidden hidden"))})).appendTo($wrapper),jQuery(document.createElement("span")).addClass("error").text(mesg).appendTo($wrapper),jQuery(document.createElement("code")).text(source).appendTo($source),$source.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo($wrapper),$wrapper.addClass("error-view").appendTo(place),console.warn("".concat(mesg,"\n\t").concat(source.replace(/\n/g,"\n\t"))),!1}},stringFrom:{value:function stringFrom(value){switch(_typeof(value)){case"function":return"[function]";case"number":if(Number.isNaN(value))return"[number NaN]";break;case"object":if(null===value)return"[null]";if(value instanceof Array)return value.map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Set)return Array.from(value).map((function(val){return stringFrom(val)})).join(", ");if(value instanceof Map){var result=Array.from(value).map((function(_ref4){var _ref5=_slicedToArray(_ref4,2),key=_ref5[0],val=_ref5[1];return"".concat(stringFrom(key)," → ").concat(stringFrom(val))}));return"{ ".concat(result.join(", ")," }")}if(value instanceof Date)return value.toLocaleString();if(value instanceof Element){if(value===document.documentElement||value===document.head||value===document.body)throw new Error("illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed");return value.outerHTML}return value instanceof Node?value.textContent:"function"==typeof value.toString?value.toString():Object.prototype.toString.call(value);case"symbol":var desc=void 0!==value.description?' "'.concat(value.description,'"'):"";return"[symbol".concat(desc,"]");case"undefined":return"[undefined]"}return String(value)}}})),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setDisplayTitle=_ref3.setDisplayTitle,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,stringFrom=_ref3.stringFrom;!function(){function onKeypressFn(ev){13!==ev.which&&32!==ev.which||(ev.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function onClickFnWrapper(fn){return function(){var $this=jQuery(this);$this.ariaIsDisabled()||($this.is("[aria-pressed]")&&$this.attr("aria-pressed","true"===$this.attr("aria-pressed")?"false":"true"),fn.apply(this,arguments))}}function oneClickFnWrapper(fn){return onClickFnWrapper((function(){jQuery(this).off(".aria-clickable").removeAttr("role tabindex aria-controls aria-pressed").filter("button").prop("disabled",!0),fn.apply(this,arguments)}))}jQuery.fn.extend({ariaClick:function(options,handler){if(0===this.length||0===arguments.length)return this;var opts=options,fn=handler;return null==fn&&(fn=opts,opts=undefined),"string"!=typeof(opts=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,role:undefined,controls:undefined,pressed:undefined,label:undefined},opts)).namespace?opts.namespace="":"."!==opts.namespace[0]&&(opts.namespace=".".concat(opts.namespace)),"boolean"==typeof opts.pressed&&(opts.pressed=opts.pressed?"true":"false"),this.filter("button").prop("type","button"),null!=opts.role?this.attr("role",opts.role):this.not("[role]").filter("a,[data-passage]").attr("role","link").end().not("a").not("[data-passage]").attr("role","button").end().end().end(),this.attr("tabindex",0),null!=opts.controls&&this.attr("aria-controls",opts.controls),null!=opts.pressed&&this.attr("aria-pressed",opts.pressed),null!=opts.label&&this.attr({"aria-label":opts.label,title:opts.label}),this.not("button").on("keypress.aria-clickable".concat(opts.namespace),opts.selector,onKeypressFn),this.on("click.aria-clickable".concat(opts.namespace),opts.selector,opts.data,opts.one?oneClickFnWrapper(fn):onClickFnWrapper(fn)),this},ariaDisabled:function(disable){if(0===this.length||0===arguments.length)return this;var $nonDisableable=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),$disableable=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return disable?($nonDisableable.each((function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","true")})),$disableable.each((function(){this.disabled=!0,this.setAttribute("aria-disabled","true")}))):($nonDisableable.each((function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")})),$disableable.each((function(){this.disabled=!1,this.removeAttribute("aria-disabled")}))),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),jQuery.extend({wikiWithOptions:function(options){for(var _len=arguments.length,sources=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)sources[_key-1]=arguments[_key];if(0!==sources.length){var frag=document.createDocumentFragment();sources.forEach((function(content){return new Wikifier(frag,content,options)}));var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "))}},wiki:function(){for(var _len2=arguments.length,sources=new Array(_len2),_key2=0;_key2<_len2;_key2++)sources[_key2]=arguments[_key2];this.wikiWithOptions.apply(this,[undefined].concat(sources))}}),jQuery.fn.extend({wikiWithOptions:function(options){for(var _len3=arguments.length,sources=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)sources[_key3-1]=arguments[_key3];if(0===this.length||0===sources.length)return this;var frag=document.createDocumentFragment();return sources.forEach((function(content){return new Wikifier(frag,content,options)})),this.append(frag),this},wiki:function(){for(var _len4=arguments.length,sources=new Array(_len4),_key4=0;_key4<_len4;_key4++)sources[_key4]=arguments[_key4];return this.wikiWithOptions.apply(this,[undefined].concat(sources))}});var Util=function(){var toString,utilGetType="[object Object]"===(toString=Object.prototype.toString).call(new Map)?function(O){if(null===O)return"null";if(O instanceof Map)return"Map";if(O instanceof Set)return"Set";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType}:function(O){if(null===O)return"null";var baseType=_typeof(O);return"object"===baseType?toString.call(O).slice(8,-1):baseType};function utilToEnum(obj){var pEnum=Object.create(null);if(obj instanceof Array)obj.forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Set)Array.from(obj).forEach((function(val,i){return pEnum[String(val)]=i}));else if(obj instanceof Map)obj.forEach((function(val,key){return pEnum[String(key)]=val}));else{if("object"!==_typeof(obj)||null===obj||Object.getPrototypeOf(obj)!==Object.prototype)throw new TypeError("Util.toEnum obj parameter must be an Array, Map, Set, or generic object");Object.assign(pEnum,obj)}return Object.freeze(pEnum)}function utilToStringTag(obj){return Object.prototype.toString.call(obj).slice(8,-1)}var _illegalSlugCharsRe=/[\x00-\x20!-/:-@[-^`{-\x9f]+/g,_isInvalidSlugRe=/^-*$/;var _illegalFilenameCharsRE=/[\x00-\x1f"#$%&'*+,/:;<=>?\\^`|\x7f-\x9f]+/g;var _markupCharsRe=/[!"#$&'*\-/<=>?@[\\\]^_`{|}~]/g,_hasMarkupCharsRe=new RegExp(_markupCharsRe.source),_markupCharsMap=utilToEnum({"!":"&#33;",'"':"&quot;","#":"&#35;",$:"&#36;","&":"&amp;","'":"&#39;","*":"&#42;","-":"&#45;","/":"&#47;","<":"&lt;","=":"&#61;",">":"&gt;","?":"&#63;","@":"&#64;","[":"&#91;","\\":"&#92;","]":"&#93;","^":"&#94;",_:"&#95;","`":"&#96;","{":"&#123;","|":"&#124;","}":"&#125;","~":"&#126;"});var _htmlCharsRe=/[&<>"'`]/g,_hasHtmlCharsRe=new RegExp(_htmlCharsRe.source),_htmlCharsMap=utilToEnum({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"});function utilEscape(str){if(null==str)return"";var val=String(str);return val&&_hasHtmlCharsRe.test(val)?val.replace(_htmlCharsRe,(function(ch){return _htmlCharsMap[ch]})):val}var _escapedHtmlRe=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,_hasEscapedHtmlRe=new RegExp(_escapedHtmlRe.source,"i"),_escapedHtmlMap=utilToEnum({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"});function utilUnescape(str){if(null==str)return"";var val=String(str);return val&&_hasEscapedHtmlRe.test(val)?val.replace(_escapedHtmlRe,(function(entity){return _escapedHtmlMap[entity.toLowerCase()]})):val}var _nowSource=Has.performance?performance:Date;var _cssTimeRe=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;var utilScrubEventKey=function(){var separatorKey,decimalKey;if("undefined"!=typeof Intl&&"function"==typeof Intl.NumberFormat){var match=(new Intl.NumberFormat).format(111111.5).match(/(\D*)\d+(\D*)/);match&&(separatorKey=match[1],decimalKey=match[2])}return separatorKey||decimalKey||(separatorKey=",",decimalKey="."),function(key){switch(key){case"Scroll":return"ScrollLock";case"Spacebar":return" ";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Up":return"ArrowUp";case"Down":return"ArrowDown";case"Del":return"Delete";case"Crsel":return"CrSel";case"Exsel":return"ExSel";case"Esc":return"Escape";case"Apps":return"ContextMenu";case"Nonconvert":return"NonConvert";case"MediaNextTrack":return"MediaTrackNext";case"MediaPreviousTrack":return"MediaTrackPrevious";case"VolumeUp":return"AudioVolumeUp";case"VolumeDown":return"AudioVolumeDown";case"VolumeMute":return"AudioVolumeMute";case"Zoom":return"ZoomToggle";case"SelectMedia":case"MediaSelect":return"LaunchMediaPlayer";case"Add":return"+";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Decimal":return decimalKey;case"Separator":return separatorKey}return key}}(),utilHasMediaQuery="function"!=typeof window.matchMedia?function(){return!1}:function(mediaQuery){return window.matchMedia(mediaQuery).matches};return Object.freeze(Object.defineProperties({},{getType:{value:utilGetType},isBoolean:{value:function(obj){return"boolean"==typeof obj||"string"==typeof obj&&("true"===obj||"false"===obj)}},isIterable:{value:function(obj){return null!=obj&&"function"==typeof obj[Symbol.iterator]}},isNumeric:{value:function(obj){var num;switch(_typeof(obj)){case"number":num=obj;break;case"string":num=Number(obj);break;default:return!1}return!Number.isNaN(num)&&Number.isFinite(num)}},sameValueZero:{value:function(a,b){return a===b||a!=a&&b!=b}},toEnum:{value:utilToEnum},toStringTag:{value:utilToStringTag},slugify:{value:function(str){var base=String(str).trim(),_legacy=base.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return _isInvalidSlugRe.test(_legacy)?base.replace(_illegalSlugCharsRe,"").replace(/[_\s\u2013\u2014-]+/g,"-"):_legacy}},sanitizeFilename:{value:function(str){return String(str).trim().replace(_illegalFilenameCharsRE,"")}},escapeMarkup:{value:function(str){if(null==str)return"";var val=String(str);return val&&_hasMarkupCharsRe.test(val)?val.replace(_markupCharsRe,(function(ch){return _markupCharsMap[ch]})):val}},escape:{value:utilEscape},unescape:{value:utilUnescape},charAndPosAt:{value:function(text,position){var str=String(text),pos=Math.trunc(position),code=str.charCodeAt(pos);if(Number.isNaN(code))return{char:"",start:-1,end:-1};var retval={char:str.charAt(pos),start:pos,end:pos};if(code<55296||code>57343)return retval;if(code>=55296&&code<=56319){var nextPos=pos+1;if(nextPos>=str.length)return retval;var nextCode=str.charCodeAt(nextPos);return nextCode<56320||nextCode>57343||(retval.char=retval.char+str.charAt(nextPos),retval.end=nextPos),retval}if(0===pos)return retval;var prevPos=pos-1,prevCode=str.charCodeAt(prevPos);return prevCode<55296||prevCode>56319||(retval.char=str.charAt(prevPos)+retval.char,retval.start=prevPos),retval}},now:{value:function(){return _nowSource.now()}},fromCssTime:{value:function(cssTime){var match=_cssTimeRe.exec(String(cssTime));if(null===match)throw new SyntaxError('invalid time value syntax: "'.concat(cssTime,'"'));var msec=Number(match[1]);if(1===match[2].length&&(msec*=1e3),Number.isNaN(msec)||!Number.isFinite(msec))throw new RangeError('invalid time value: "'.concat(cssTime,'"'));return msec}},toCssTime:{value:function(msec){if("number"!=typeof msec||Number.isNaN(msec)||!Number.isFinite(msec)){var what;switch(_typeof(msec)){case"string":what='"'.concat(msec,'"');break;case"number":what=String(msec);break;default:what=utilToStringTag(msec)}throw new Error("invalid milliseconds: ".concat(what))}return"".concat(msec,"ms")}},fromCssProperty:{value:function(cssName){if(!cssName.includes("-"))switch(cssName){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return cssName}return("-ms-"===cssName.slice(0,4)?cssName.slice(1):cssName).split("-").map((function(part,i){return 0===i?part:part.toUpperFirst()})).join("")}},parseUrl:{value:function(url){var el=document.createElement("a"),queryObj=Object.create(null);el.href=url,el.search&&el.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach((function(query){var _query$split2=_slicedToArray(query.split("="),2),key=_query$split2[0],value=_query$split2[1];queryObj[key]=value}));var pathname=el.host&&"/"!==el.pathname[0]?"/".concat(el.pathname):el.pathname;return{href:el.href,protocol:el.protocol,host:el.host,hostname:el.hostname,port:el.port,path:"".concat(pathname).concat(el.search),pathname:pathname,query:el.search,search:el.search,queries:queryObj,searches:queryObj,hash:el.hash}}},newExceptionFrom:{value:function(original,exceptionType,override){if("object"!==_typeof(original)||null===original)throw new Error("Util.newExceptionFrom original parameter must be an object");if("function"!=typeof exceptionType)throw new Error("Util.newExceptionFrom exceptionType parameter must be an error type constructor");var ex=new exceptionType(original.message);void 0!==original.name&&(ex.name=original.name),void 0!==original.code&&(ex.code=original.code),void 0!==original.columnNumber&&(ex.columnNumber=original.columnNumber),void 0!==original.description&&(ex.description=original.description),void 0!==original.fileName&&(ex.fileName=original.fileName),void 0!==original.lineNumber&&(ex.lineNumber=original.lineNumber),void 0!==original.number&&(ex.number=original.number),void 0!==original.stack&&(ex.stack=original.stack);var overrideType=_typeof(override);if("undefined"!==overrideType)if("object"===overrideType&&null!==override)Object.assign(ex,override);else{if("string"!==overrideType)throw new Error("Util.newExceptionFrom override parameter must be an object or string");ex.message=override}return ex}},scrubEventKey:{value:utilScrubEventKey},hasMediaQuery:{value:utilHasMediaQuery},random:{value:Math.random},entityEncode:{value:utilEscape},entityDecode:{value:utilUnescape},evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleStore=(_adapters=[],_initialized=null,Object.freeze(Object.defineProperties({},{adapters:{value:_adapters},create:{value:function(storageId,persistent){if(_initialized)return _initialized.create(storageId,persistent);for(var i=0;i<_adapters.length;++i)if(_adapters[i].init(storageId,persistent))return(_initialized=_adapters[i]).create(storageId,persistent);throw new Error("no valid storage adapters found")}}}))),_adapters,_initialized,_ok,_WebStorageAdapter;SimpleStore.adapters.push((_ok=!1,_WebStorageAdapter=function(){function _WebStorageAdapter(storageId,persistent){_classCallCheck(this,_WebStorageAdapter);var prefix="".concat(storageId,"."),engine=null,name=null;persistent?(engine=window.localStorage,name="localStorage"):(engine=window.sessionStorage,name="sessionStorage"),Object.defineProperties(this,{_engine:{value:engine},_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:name},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_WebStorageAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var keys=[],i=0;i<this._engine.length;++i){var key=this._engine.key(i);this._prefixRe.test(key)&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&this._engine.hasOwnProperty(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=this._engine.getItem(this._prefix+key);return null==value?null:_WebStorageAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{this._engine.setItem(this._prefix+key,_WebStorageAdapter._serialize(value))}catch(ex){if(/quota.?(?:exceeded|reached)/i.test(ex.name+ex.message))throw Util.newExceptionFrom(ex,Error,"".concat(this.name," quota exceeded"));throw ex}return!0}},{key:"delete",value:function(key){return!("string"!=typeof key||!key||(this._engine.removeItem(this._prefix+key),0))}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_serialize",value:function(obj){return LZString.compressToUTF16(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromUTF16(str))}}]),_WebStorageAdapter}(),Object.freeze(Object.defineProperties({},{init:{value:function(){function hasWebStorage(storeId){try{var store=window[storeId],tid="_sc_".concat(String(Date.now()));store.setItem(tid,tid);var result=store.getItem(tid)===tid;return store.removeItem(tid),result}catch(ex){}return!1}return _ok=hasWebStorage("localStorage")&&hasWebStorage("sessionStorage")}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _WebStorageAdapter(storageId,persistent)}}})))),SimpleStore.adapters.push(function(){var _MAX_EXPIRY="Tue, 19 Jan 2038 03:14:07 GMT",_MIN_EXPIRY="Thu, 01 Jan 1970 00:00:00 GMT",_ok=!1,_CookieAdapter=function(){function _CookieAdapter(storageId,persistent){_classCallCheck(this,_CookieAdapter);var prefix="".concat(storageId).concat(persistent?"!":"*",".");Object.defineProperties(this,{_prefix:{value:prefix},_prefixRe:{value:new RegExp("^".concat(RegExp.escape(prefix)))},name:{value:"cookie"},id:{value:storageId},persistent:{value:!!persistent}})}return _createClass(_CookieAdapter,[{key:"length",get:function(){return this.keys().length}},{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var cookies=document.cookie.split(/;\s*/),keys=[],i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(this._prefixRe.test(key))""!==decodeURIComponent(kvPair[1])&&keys.push(key.replace(this._prefixRe,""))}return keys}},{key:"has",value:function(key){return!("string"!=typeof key||!key)&&null!==_CookieAdapter._getCookie(this._prefix+key)}},{key:"get",value:function(key){if("string"!=typeof key||!key)return null;var value=_CookieAdapter._getCookie(this._prefix+key);return null===value?null:_CookieAdapter._deserialize(value)}},{key:"set",value:function(key,value){if("string"!=typeof key||!key)return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,_CookieAdapter._serialize(value),this.persistent?"Tue, 19 Jan 2038 03:14:07 GMT":undefined),!this.has(key))throw new Error("unknown validation error during set")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"delete",value:function(key){if("string"!=typeof key||!key||!this.has(key))return!1;try{if(_CookieAdapter._setCookie(this._prefix+key,undefined,_MIN_EXPIRY),this.has(key))throw new Error("unknown validation error during delete")}catch(ex){throw Util.newExceptionFrom(ex,Error,"cookie error: ".concat(ex.message))}return!0}},{key:"clear",value:function(){for(var keys=this.keys(),i=0,iend=keys.length;i<iend;++i)this.delete(keys[i]);return!0}}],[{key:"_getCookie",value:function(prefixedKey){if(!prefixedKey||""===document.cookie)return null;for(var cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("=");if(prefixedKey===decodeURIComponent(kvPair[0]))return decodeURIComponent(kvPair[1])||null}return null}},{key:"_setCookie",value:function(prefixedKey,value,expiry){if(prefixedKey){var payload="".concat(encodeURIComponent(prefixedKey),"=");null!=value&&(payload+=encodeURIComponent(value)),null!=expiry&&(payload+="; expires=".concat(expiry)),payload+="; path=/",document.cookie=payload}}},{key:"_serialize",value:function(obj){return LZString.compressToBase64(JSON.stringify(obj))}},{key:"_deserialize",value:function(str){return JSON.parse(LZString.decompressFromBase64(str))}}]),_CookieAdapter}();return Object.freeze(Object.defineProperties({},{init:{value:function(storageId){try{var tid="_sc_".concat(String(Date.now()));_CookieAdapter._setCookie(tid,_CookieAdapter._serialize(tid),undefined),_ok=_CookieAdapter._deserialize(_CookieAdapter._getCookie(tid))===tid,_CookieAdapter._setCookie(tid,undefined,_MIN_EXPIRY)}catch(ex){_ok=!1}return _ok&&function(storageId){if(""===document.cookie)return;for(var oldPrefix="".concat(storageId,"."),oldPrefixRe=new RegExp("^".concat(RegExp.escape(oldPrefix))),persistPrefix="".concat(storageId,"!."),sessionPrefix="".concat(storageId,"*."),sessionTestRe=/\.(?:state|rcWarn)$/,cookies=document.cookie.split(/;\s*/),i=0;i<cookies.length;++i){var kvPair=cookies[i].split("="),key=decodeURIComponent(kvPair[0]);if(oldPrefixRe.test(key)){var value=decodeURIComponent(kvPair[1]);""!==value&&function(){var persist=!sessionTestRe.test(key);_CookieAdapter._setCookie(key,undefined,_MIN_EXPIRY),_CookieAdapter._setCookie(key.replace(oldPrefixRe,(function(){return persist?persistPrefix:sessionPrefix})),value,persist?_MAX_EXPIRY:undefined)}()}}}(storageId),_ok}},create:{value:function(storageId,persistent){if(!_ok)throw new Error("adapter not initialized");return new _CookieAdapter(storageId,persistent)}}}))}());var DebugView=function(){function DebugView(parent,type,name,title){_classCallCheck(this,DebugView),Object.defineProperties(this,{parent:{value:parent},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:title,"aria-label":title,"data-type":null!=type?type:"","data-name":null!=name?name:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(DebugView,[{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(type){this.view.setAttribute("data-type",null!=type?type:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(name){this.view.setAttribute("data-name",null!=name?name:"")}},{key:"title",get:function(){return this.view.title},set:function(title){this.view.title=title}},{key:"append",value:function(el){return jQuery(this.view).append(el),this}},{key:"modes",value:function(options){if(null==options){var current={};return this.view.className.splitOrEmpty(/\s+/).forEach((function(name){"debug"!==name&&(current[name]=!0)})),current}if("object"===_typeof(options))return Object.keys(options).forEach((function(name){this[options[name]?"addClass":"removeClass"](name)}),jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var $view=jQuery(this.view);this.view.hasChildNodes()&&$view.contents().appendTo(this.parent),$view.remove(),jQuery(this.break).remove()}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?DebugView.disable():DebugView.enable()}}]),DebugView}(),NodeTyper=function(){var NodeTyper=function(){function NodeTyper(config){if(_classCallCheck(this,NodeTyper),"object"!==_typeof(config)||null===config)throw new Error("config parameter must be an object (received: ".concat(Util.getType(config),")"));if(!(config.hasOwnProperty("targetNode")&&config.targetNode instanceof Node))throw new Error('config parameter object "targetNode" property must be a node');Object.defineProperties(this,{node:{value:config.targetNode},childNodes:{value:[]},nodeValue:{writable:!0,value:""},appendTo:{writable:!0,value:config.parentNode||null},classNames:{writable:!0,value:config.classNames||null},finished:{writable:!0,value:!1}});var childNode,node=this.node;for(node.nodeValue&&(this.nodeValue=node.nodeValue,node.nodeValue="");null!==(childNode=node.firstChild);)this.childNodes.push(new NodeTyper({targetNode:childNode,parentNode:node,classNames:this.classNames})),node.removeChild(childNode)}return _createClass(NodeTyper,[{key:"finish",value:function(){for(;this.type(!0););return!1}},{key:"type",value:function(flush){if(this.finished)return!1;if(this.appendTo){if(this.appendTo.appendChild(this.node),this.appendTo=null,this.node.nodeType!==Node.ELEMENT_NODE&&this.node.nodeType!==Node.TEXT_NODE||"none"===jQuery(this.node.parentNode).css("display"))return this.finish();this.node.parentNode&&this.classNames&&jQuery(this.node.parentNode).addClass(this.classNames)}if(this.nodeValue){if(flush)this.node.nodeValue+=this.nodeValue,this.nodeValue="";else{var _Util$charAndPosAt=Util.charAndPosAt(this.nodeValue,0),char=_Util$charAndPosAt.char,start=_Util$charAndPosAt.start,end=_Util$charAndPosAt.end;this.node.nodeValue+=char,this.nodeValue=this.nodeValue.slice(1+end-start)}return!0}this.classNames&&(jQuery(this.node.parentNode).removeClass(this.classNames),this.classNames=null);for(var childNodes=this.childNodes;childNodes.length>0;){if(childNodes[0].type())return!0;childNodes.shift()}return this.finished=!0,!1}}]),NodeTyper}();return NodeTyper}(),PRNGWrapper=function(){function PRNGWrapper(seed,useEntropy){_classCallCheck(this,PRNGWrapper),Object.defineProperties(this,new Math.seedrandom(seed,useEntropy,(function(prng,seed){return{_prng:{value:prng},seed:{writable:!0,value:seed},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}})))}return _createClass(PRNGWrapper,null,[{key:"marshal",value:function(prng){if(!prng||!prng.hasOwnProperty("seed")||!prng.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:prng.seed,pull:prng.pull}}},{key:"unmarshal",value:function(prngObj){if(!prngObj||!prngObj.hasOwnProperty("seed")||!prngObj.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var prng=new PRNGWrapper(prngObj.seed,!1),i=prngObj.pull;i>0;--i)prng.random();return prng}}]),PRNGWrapper}(),StyleWrapper=(_imageMarkupRe=new RegExp(Patterns.cssImage,"g"),_hasImageMarkupRe=new RegExp(Patterns.cssImage),function(){function StyleWrapper(style){if(_classCallCheck(this,StyleWrapper),null==style)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:style}})}return _createClass(StyleWrapper,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(rawCss){this.clear(),this.add(rawCss)}},{key:"add",value:function(rawCss){var css=rawCss;_hasImageMarkupRe.test(css)&&(_imageMarkupRe.lastIndex=0,css=css.replace(_imageMarkupRe,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text.trim())}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),this.style.styleSheet?this.style.styleSheet.cssText+=css:this.style.appendChild(document.createTextNode(css))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),StyleWrapper}()),_imageMarkupRe,_hasImageMarkupRe,Diff=(Op=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3}),Object.freeze(Object.defineProperties({},{Op:{value:Op},diff:{value:function diff(orig,dest){for(var aOpRef,objToString=Object.prototype.toString,origIsArray=orig instanceof Array,keys=[].concat(Object.keys(orig),Object.keys(dest)).sort().filter((function(val,i,arr){return 0===i||arr[i-1]!==val})),diffed={},keyIsAOpRef=function(key){return key===aOpRef},i=0,klen=keys.length;i<klen;++i){var key=keys[i],origP=orig[key],destP=dest[key];if(orig.hasOwnProperty(key))if(dest.hasOwnProperty(key)){if(origP===destP)continue;if(_typeof(origP)===_typeof(destP))if("function"==typeof origP)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,destP]);else if("object"!==_typeof(origP)||null===origP)diffed[key]=[Op.Copy,destP];else{var origPType=objToString.call(origP);if(origPType===objToString.call(destP))if(origP instanceof Date)Number(origP)!==Number(destP)&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Map)diffed[key]=[Op.Copy,clone(destP)];else if(origP instanceof RegExp)origP.toString()!==destP.toString()&&(diffed[key]=[Op.Copy,clone(destP)]);else if(origP instanceof Set)diffed[key]=[Op.Copy,clone(destP)];else if("[object Object]"!==origPType)diffed[key]=[Op.Copy,clone(destP)];else{var recurse=diff(origP,destP);null!==recurse&&(diffed[key]=recurse)}else diffed[key]=[Op.Copy,clone(destP)]}else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}else if(origIsArray&&Util.isNumeric(key)){var nKey=Number(key);if(!aOpRef){aOpRef="";do{aOpRef+="~"}while(keys.some(keyIsAOpRef));diffed[aOpRef]=[Op.SpliceArray,nKey,nKey]}nKey<diffed[aOpRef][1]&&(diffed[aOpRef][1]=nKey),nKey>diffed[aOpRef][2]&&(diffed[aOpRef][2]=nKey)}else diffed[key]=Op.Delete;else diffed[key]=[Op.Copy,"object"!==_typeof(destP)||null===destP?destP:clone(destP)]}return Object.keys(diffed).length>0?diffed:null}},patch:{value:function patch(orig,diffed){for(var keys=Object.keys(diffed||{}),patched=clone(orig),i=0,klen=keys.length;i<klen;++i){var key=keys[i],diffedP=diffed[key];if(diffedP===Op.Delete)delete patched[key];else if(diffedP instanceof Array)switch(diffedP[0]){case Op.SpliceArray:patched.splice(diffedP[1],diffedP[2]-diffedP[1]+1);break;case Op.Copy:patched[key]=clone(diffedP[1]);break;case Op.CopyDate:patched[key]=new Date(diffedP[1])}else patched[key]=patch(patched[key],diffedP)}return patched}}}))),Op,L10n=(_patternRe=/\{\w+\}/g,_hasPatternRe=new RegExp(_patternRe.source),Object.freeze(Object.defineProperties({},{init:{value:function(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach((function(id){try{var value;switch(id){case"identity":value=strings.identity;break;case"aborting":value=strings.aborting;break;case"cancel":value=strings.cancel;break;case"close":value=strings.close;break;case"ok":value=strings.ok;break;case"errorTitle":value=strings.errors.title;break;case"errorNonexistentPassage":value=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":value=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":value=strings.errors.saveIdMismatch;break;case"warningDegraded":value=strings.warnings.degraded;break;case"debugViewTitle":value=strings.debugView.title;break;case"debugViewToggle":value=strings.debugView.toggle;break;case"uiBarToggle":value=strings.uiBar.toggle;break;case"uiBarBackward":value=strings.uiBar.backward;break;case"uiBarForward":value=strings.uiBar.forward;break;case"uiBarJumpto":value=strings.uiBar.jumpto;break;case"jumptoTitle":value=strings.jumpto.title;break;case"jumptoTurn":value=strings.jumpto.turn;break;case"jumptoUnavailable":value=strings.jumpto.unavailable;break;case"savesTitle":value=strings.saves.title;break;case"savesDisallowed":value=strings.saves.disallowed;break;case"savesIncapable":value=strings.saves.incapable;break;case"savesLabelAuto":value=strings.saves.labelAuto;break;case"savesLabelDelete":value=strings.saves.labelDelete;break;case"savesLabelExport":value=strings.saves.labelExport;break;case"savesLabelImport":value=strings.saves.labelImport;break;case"savesLabelLoad":value=strings.saves.labelLoad;break;case"savesLabelClear":value=strings.saves.labelClear;break;case"savesLabelSave":value=strings.saves.labelSave;break;case"savesLabelSlot":value=strings.saves.labelSlot;break;case"savesUnavailable":value=strings.saves.unavailable;break;case"savesUnknownDate":value=strings.saves.unknownDate;break;case"settingsTitle":value=strings.settings.title;break;case"settingsOff":value=strings.settings.off;break;case"settingsOn":value=strings.settings.on;break;case"settingsReset":value=strings.settings.reset;break;case"restartTitle":value=strings.restart.title;break;case"restartPrompt":value=strings.restart.prompt;break;case"shareTitle":value=strings.share.title;break;case"alertTitle":break;case"autoloadTitle":value=strings.autoload.title;break;case"autoloadCancel":value=strings.autoload.cancel;break;case"autoloadOk":value=strings.autoload.ok;break;case"autoloadPrompt":value=strings.autoload.prompt;break;case"macroBackText":value=strings.macros.back.text;break;case"macroReturnText":value=strings.macros.return.text}value&&(l10nStrings[id]=value.replace(/%\w+%/g,(function(pat){return"{".concat(pat.slice(1,-1),"}")})))}catch(ex){}}))}},get:{value:function(ids,overrides){if(!ids)return"";var selectedId,id=((Array.isArray(ids)?ids:[ids]).some((function(id){return!!l10nStrings.hasOwnProperty(id)&&(selectedId=id,!0)})),selectedId);if(!id)return"";for(var processed=l10nStrings[id],iteration=0;_hasPatternRe.test(processed);){if(++iteration>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");_patternRe.lastIndex=0,processed=processed.replace(_patternRe,(function(pat){var subId=pat.slice(1,-1);return overrides&&overrides.hasOwnProperty(subId)?overrides[subId]:l10nStrings.hasOwnProperty(subId)?l10nStrings[subId]:void 0}))}return processed}}}))),_patternRe,_hasPatternRe,strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveDiskLoadFailed:"failed to load save file from disk",errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",alertTitle:"Alert",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=(_debug=!1,_addVisitedLinkClass=!1,_cleanupWikifierOutput=!1,_loadDelay=0,_audioPauseOnFadeToZero=!0,_audioPreloadMetadata=!0,_historyControls=!0,_historyMaxStates=40,_macrosIfAssignmentError=!0,_macrosMaxLoopIterations=1e3,_macrosTypeSkipKey=" ",_macrosTypeVisitedPassages=!0,_passagesDisplayTitles=!1,_passagesNobr=!1,_savesId="untitled-story",_savesSlots=8,_savesTryDiskOnMobile=!0,_uiStowBarInitially=800,_uiUpdateStoryElements=!0,_errHistoryModeDeprecated="Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code",Object.freeze({get debug(){return _debug},set debug(value){_debug=Boolean(value)},get addVisitedLinkClass(){return _addVisitedLinkClass},set addVisitedLinkClass(value){_addVisitedLinkClass=Boolean(value)},get cleanupWikifierOutput(){return _cleanupWikifierOutput},set cleanupWikifierOutput(value){_cleanupWikifierOutput=Boolean(value)},get loadDelay(){return _loadDelay},set loadDelay(value){if(!Number.isSafeInteger(value)||value<0)throw new RangeError("Config.loadDelay must be a non-negative integer");_loadDelay=value},audio:Object.freeze({get pauseOnFadeToZero(){return _audioPauseOnFadeToZero},set pauseOnFadeToZero(value){_audioPauseOnFadeToZero=Boolean(value)},get preloadMetadata(){return _audioPreloadMetadata},set preloadMetadata(value){_audioPreloadMetadata=Boolean(value)}}),history:Object.freeze({get controls(){return _historyControls},set controls(value){var controls=Boolean(value);if(1===_historyMaxStates&&controls)throw new Error("Config.history.controls must be false when Config.history.maxStates is 1");_historyControls=controls},get maxStates(){return _historyMaxStates},set maxStates(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.history.maxStates must be a positive integer");_historyMaxStates=value,_historyControls&&1===value&&(_historyControls=!1)},get mode(){throw new Error(_errHistoryModeDeprecated)},set mode(_){throw new Error(_errHistoryModeDeprecated)},get tracking(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")},set tracking(_){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}}),macros:Object.freeze({get ifAssignmentError(){return _macrosIfAssignmentError},set ifAssignmentError(value){_macrosIfAssignmentError=Boolean(value)},get maxLoopIterations(){return _macrosMaxLoopIterations},set maxLoopIterations(value){if(!Number.isSafeInteger(value)||value<1)throw new RangeError("Config.macros.maxLoopIterations must be a positive integer");_macrosMaxLoopIterations=value},get typeSkipKey(){return _macrosTypeSkipKey},set typeSkipKey(value){_macrosTypeSkipKey=String(value)},get typeVisitedPassages(){return _macrosTypeVisitedPassages},set typeVisitedPassages(value){_macrosTypeVisitedPassages=Boolean(value)}}),navigation:Object.freeze({get override(){return _navigationOverride},set override(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_navigationOverride=value}}),passages:Object.freeze({get descriptions(){return _passagesDescriptions},set descriptions(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"Object"!==valueType&&"function"!==valueType)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: ".concat(valueType,")"))}_passagesDescriptions=value},get displayTitles(){return _passagesDisplayTitles},set displayTitles(value){_passagesDisplayTitles=Boolean(value)},get nobr(){return _passagesNobr},set nobr(value){_passagesNobr=Boolean(value)},get onProcess(){return _passagesOnProcess},set onProcess(value){if(null!=value){var valueType=Util.getType(value);if("function"!==valueType)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: ".concat(valueType,")"))}_passagesOnProcess=value},get start(){return _passagesStart},set start(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType)throw new TypeError("Config.passages.start must be a string or null/undefined (received: ".concat(valueType,")"))}_passagesStart=value},get transitionOut(){return _passagesTransitionOut},set transitionOut(value){if(null!=value){var valueType=Util.getType(value);if("string"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: ".concat(valueType,")"))}_passagesTransitionOut=value}}),saves:Object.freeze({get autoload(){return _savesAutoload},set autoload(value){if(null!=value){var valueType=Util.getType(value);if("boolean"!==valueType&&"string"!==valueType&&"function"!==valueType)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: ".concat(valueType,")"))}_savesAutoload=value},get autosave(){return _savesAutosave},set autosave(value){if(null!=value){var valueType=Util.getType(value);if("string"===valueType)return void(_savesAutosave=[value]);if("boolean"!==valueType&&("Array"!==valueType||!value.every((function(item){return"string"==typeof item})))&&"function"!==valueType)throw new TypeError("Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: ".concat(valueType).concat("Array"===valueType?"<any>":"",")"))}_savesAutosave=value},get id(){return _savesId},set id(value){if("string"!=typeof value||""===value)throw new TypeError("Config.saves.id must be a non-empty string (received: ".concat(Util.getType(value),")"));_savesId=value},get isAllowed(){return _savesIsAllowed},set isAllowed(value){if(!(null==value||value instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: ".concat(Util.getType(value),")"));_savesIsAllowed=value},get slots(){return _savesSlots},set slots(value){if(!Number.isSafeInteger(value)||value<0)throw new TypeError("Config.saves.slots must be a non-negative integer (received: ".concat(Util.getType(value),")"));_savesSlots=value},get tryDiskOnMobile(){return _savesTryDiskOnMobile},set tryDiskOnMobile(value){_savesTryDiskOnMobile=Boolean(value)},get version(){return _savesVersion},set version(value){_savesVersion=value},get onLoad(){throw new Error("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead")},set onLoad(value){console.warn("Config.saves.onLoad has been deprecated, use the Save.onLoad API instead"),Save.onLoad.add(value)},get onSave(){throw new Error("Config.saves.onSave has been deprecated, use the Save.onSave API instead")},set onSave(value){console.warn("Config.saves.onSave has been deprecated, use the Save.onSave API instead"),Save.onSave.add(value)}}),ui:Object.freeze({get stowBarInitially(){return _uiStowBarInitially},set stowBarInitially(value){var valueType=Util.getType(value);if("boolean"!==valueType&&("number"!==valueType||!Number.isSafeInteger(value)||value<0))throw new TypeError("Config.ui.stowBarInitially must be a boolean or non-negative integer (received: ".concat(valueType,")"));_uiStowBarInitially=value},get updateStoryElements(){return _uiUpdateStoryElements},set updateStoryElements(value){_uiUpdateStoryElements=Boolean(value)}})})),_navigationOverride,_passagesDescriptions,_passagesStart,_passagesOnProcess,_passagesTransitionOut,_savesAutoload,_savesAutosave,_savesIsAllowed,_savesVersion,_debug,_addVisitedLinkClass,_cleanupWikifierOutput,_loadDelay,_audioPauseOnFadeToZero,_audioPreloadMetadata,_historyControls,_historyMaxStates,_macrosIfAssignmentError,_macrosMaxLoopIterations,_macrosTypeSkipKey,_macrosTypeVisitedPassages,_passagesDisplayTitles,_passagesNobr,_savesId,_savesSlots,_savesTryDiskOnMobile,_uiStowBarInitially,_uiUpdateStoryElements,_errHistoryModeDeprecated,SimpleAudio=function(){var _hasPromise,_gestureEventNames=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),_specialIds=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),_formatSpecRe=/^([\w-]+)\s*\|\s*(\S.*)$/,_badIdRe=/[:\s]/,_tracks=new Map,_groups=new Map,_lists=new Map,_subscribers=new Map,_masterRate=1,_masterVolume=1,_masterMute=!1,_masterMuteOnHidden=!1,_playReturnsPromise=(_hasPromise=null,function(){if(null!==_hasPromise)return _hasPromise;if(_hasPromise=!1,Has.audio)try{var audio=document.createElement("audio");audio.muted=!0;var value=audio.play();value.catch((function(){})),_hasPromise=value instanceof Promise}catch(ex){}return _hasPromise}),AudioTrack=function(){function AudioTrack(obj){if(_classCallCheck(this,AudioTrack),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioTrack))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioTrack,[{key:"_create",value:function(sourceList){var dataUriRe=/^data:\s*audio\/(?:x-)?([^;,]+)\s*[;,]/i,extRe=/\.([^./\\]+)$/,formats=AudioTrack.formats,usedSources=[],audio=document.createElement("audio");audio.preload="none",sourceList.forEach((function(src){var srcUri=null;switch(_typeof(src)){case"string":var match;if("data:"===src.slice(0,5)){if(null===(match=dataUriRe.exec(src)))throw new Error("source data URI missing media type")}else if(null===(match=extRe.exec(Util.parseUrl(src).pathname)))throw new Error("source URL missing file extension");formats[match[1]]&&(srcUri=src);break;case"object":if(null===src)throw new Error("source object cannot be null");if(!src.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!src.hasOwnProperty("format"))throw new Error('source object missing required "format" property');formats[src.format]&&(srcUri=src.src);break;default:throw new Error("invalid source value (type: ".concat(_typeof(src),")"))}if(null!==srcUri){var source=document.createElement("source");source.src=srcUri,audio.appendChild(source),usedSources.push(srcUri)}})),audio.hasChildNodes()&&Config.audio.preloadMetadata&&(audio.preload="metadata"),this._finalize(audio,usedSources,clone(sourceList))}},{key:"_copy",value:function(obj){this._finalize(obj.audio.cloneNode(!0),clone(obj.sources),clone(obj.originals))}},{key:"_finalize",value:function(audio,sources,originals){var _this3=this;Object.defineProperties(this,{audio:{configurable:!0,value:audio},sources:{value:Object.freeze(sources)},originals:{value:Object.freeze(originals)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",(function(){return _this3._error=!1})).on("error.AudioTrack",(function(){return _this3._error=!0})).find("source:last-of-type").on("error.AudioTrack",(function(){return _this3._trigger("error")})),function(id,callback){if("function"!=typeof callback)throw new Error("callback parameter must be a function");_subscribers.set(id,callback)}(this,(function(mesg){if(_this3.audio)switch(mesg){case"loadwithscreen":if(_this3.hasSource()){var lockId=LoadScreen.lock();_this3.one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",(function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(lockId)})).load()}break;case"load":_this3.load();break;case"mute":_this3._updateAudioMute();break;case"rate":_this3._updateAudioRate();break;case"stop":_this3.stop();break;case"volume":_this3._updateAudioVolume();break;case"unload":_this3.unload()}else unsubscribe(_this3)})),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(eventName){jQuery(this.audio).triggerHandler(eventName)}},{key:"_destroy",value:function(){unsubscribe(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new AudioTrack(this)}},{key:"load",value:function(){var _this4=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach((function(srcUri){var source=document.createElement("source");source.src=srcUri,_this4.audio.appendChild(source)}))}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var audio=this.audio;for(audio.preload="none";audio.hasChildNodes();)audio.removeChild(audio.firstChild);audio.load()}},{key:"play",value:function(){var _this5=this;if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));"auto"!==this.audio.preload&&(this.audio.preload="auto");var namespace=".AudioTrack_play";return _playReturnsPromise()?this.audio.play():new Promise((function(resolve,reject){_this5.isPlaying()?resolve():(jQuery(_this5.audio).off(namespace).one("error".concat(namespace," playing").concat(namespace," timeupdate").concat(namespace),(function(ev){jQuery(_this5).off(namespace),"error"===ev.type?reject(new Error("unknown audio play error")):resolve()})),_this5.audio.play())}))}},{key:"playWhenAllowed",value:function(){var _this6=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioTrack_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),_this6.audio.play()}))}))}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(duration,toVol,fromVol){var _this7=this;if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var from=Math.clamp(null==fromVol?this.volume():fromVol,0,1),to=Math.clamp(toVol,0,1);return from!==to?(this.volume(from),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",(function(){var min,max;from<to?(min=from,max=to):(min=to,max=from);var time=Math.max(duration,1),delta=(to-from)/(time/.025);_this7._trigger(":fading"),_this7._faderId=setInterval((function(){_this7.isPlaying()?(_this7.volume(Math.clamp(_this7.volume()+delta,min,max)),Config.audio.pauseOnFadeToZero&&0===_this7.volume()&&_this7.pause(),_this7.volume()===to&&(_this7.fadeStop(),_this7._trigger(":faded"))):_this7.fadeStop()}),25)})),this.play()):void 0}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(_loop){return null==_loop?this.audio.loop:(this.audio.loop=!!_loop,this)}},{key:"mute",value:function(_mute){return null==_mute?this._mute:(this._mute=!!_mute,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||_masterMute}},{key:"rate",value:function(_rate){if(null==_rate)return this._rate;if("number"!=typeof _rate)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*_masterRate,.2,5)}},{key:"time",value:function(_time){var _this8=this;if(null==_time)return this.audio.currentTime;if("number"!=typeof _time)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=_time:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",(function(){return _this8.audio.currentTime=_time})),this}},{key:"volume",value:function(_volume){if(null==_volume)return this._volume;if("number"!=typeof _volume)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*_masterVolume,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return jQuery.fn.on.apply(jQuery(this.audio),args),this}},{key:"one",value:function(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return jQuery.fn.one.apply(jQuery(this.audio),args),this}},{key:"off",value:function(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return jQuery.fn.off.apply(jQuery(this.audio),args),this}}]),AudioTrack}();Object.defineProperties(AudioTrack,{formats:{value:function(){var audio=document.createElement("audio"),types=new Map;function canPlay(mimeType){return types.has(mimeType)||types.set(mimeType,""!==audio.canPlayType(mimeType).replace(/^no$/i,"")),types.get(mimeType)}return Object.assign(Object.create(null),{aac:canPlay("audio/aac"),caf:canPlay("audio/x-caf")||canPlay("audio/caf"),flac:canPlay("audio/x-flac")||canPlay("audio/flac"),mp3:canPlay('audio/mpeg; codecs="mp3"')||canPlay("audio/mpeg")||canPlay("audio/mp3")||canPlay("audio/mpa"),mpeg:canPlay("audio/mpeg"),m4a:canPlay("audio/x-m4a")||canPlay("audio/m4a")||canPlay("audio/aac"),mp4:canPlay("audio/x-mp4")||canPlay("audio/mp4")||canPlay("audio/aac"),ogg:canPlay("audio/ogg"),oga:canPlay("audio/ogg"),opus:canPlay('audio/ogg; codecs="opus"')||canPlay("audio/opus"),wav:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),wave:canPlay('audio/wave; codecs="1"')||canPlay('audio/wav; codecs="1"')||canPlay("audio/wave")||canPlay("audio/wav"),weba:canPlay("audio/webm"),webm:canPlay("audio/webm")})}()}});var AudioList=function(){function AudioList(obj){if(_classCallCheck(this,AudioList),obj instanceof Array)this._create(obj);else{if(!(obj instanceof AudioList))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(obj)}}return _createClass(AudioList,[{key:"_create",value:function(trackList){var _this9=this;this._finalize(trackList.map((function(trackObj){if("object"!==_typeof(trackObj))throw new Error("tracks parameter array members must be objects");var own,rate,track,volume;if(trackObj instanceof AudioTrack)own=!0,rate=trackObj.rate(),track=trackObj.clone(),volume=trackObj.volume();else{if(!trackObj.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(trackObj.track instanceof AudioTrack))throw new Error('track object\'s "track" property must be an AudioTrack object');own=trackObj.hasOwnProperty("own")&&trackObj.own,rate=trackObj.hasOwnProperty("rate")?trackObj.rate:trackObj.track.rate(),track=trackObj.track,volume=trackObj.hasOwnProperty("volume")?trackObj.volume:trackObj.track.volume()}return track.stop(),track.loop(!1),track.mute(!1),track.rate(rate),track.volume(volume),track.on("ended.AudioList",(function(){return _this9._onEnd()})),{own:own,track:track,volume:volume,rate:rate}})))}},{key:"_copy",value:function(obj){this._finalize(clone(obj.tracks))}},{key:"_finalize",value:function(tracks){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(tracks)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter((function(trackObj){return trackObj.own})).forEach((function(trackObj){return trackObj.track._destroy()})),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach((function(trackObj){return trackObj.track.load()}))}},{key:"unload",value:function(){this.stop(),this.tracks.forEach((function(trackObj){return trackObj.track.unload()}))}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var _this10=this;this.play().catch((function(){var gestures=_gestureEventNames.map((function(name){return"".concat(name,".AudioList_playWhenAllowed")})).join(" ");jQuery(document).one(gestures,(function(){jQuery(document).off(".AudioList_playWhenAllowed"),_this10.play()}))}))}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(duration,toVol,fromVol){if("number"!=typeof duration)throw new TypeError("duration parameter must be a number");if("number"!=typeof toVol)throw new TypeError("toVolume parameter must be a number");if(null!=fromVol&&"number"!=typeof fromVol)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var adjFromVol,adjToVol=Math.clamp(toVol,0,1)*this.current.volume;return null!=fromVol&&(adjFromVol=Math.clamp(fromVol,0,1)*this.current.volume),this._volume=toVol,this.current.track.fade(duration,adjToVol,adjFromVol)}}},{key:"fadeIn",value:function(duration,fromVol){return this.fade(duration,1,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){return this.fade(duration,0,fromVol)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(_loop2){return null==_loop2?this._loop:(this._loop=!!_loop2,this)}},{key:"mute",value:function(_mute2){return null==_mute2?this._mute:(this._mute=!!_mute2,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(_rate2){if(null==_rate2)return this._rate;if("number"!=typeof _rate2)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(_rate2,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(_shuffle){var _this11=this;if(null==_shuffle)return this._shuffle;if(this._shuffle=!!_shuffle,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var _this$queue,firstIdx=this.queue.findIndex((function(trackObj){return trackObj===_this11.current}));if(-1!==firstIdx)(_this$queue=this.queue).push.apply(_this$queue,_toConsumableArray(this.queue.splice(0,firstIdx+1)))}return this}},{key:"volume",value:function(_volume2){if(null==_volume2)return this._volume;if("number"!=typeof _volume2)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(_volume2,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var remainingTime=this.queue.map((function(trackObj){return trackObj.track.duration()})).reduce((function(prev,cur){return prev+cur}),0);return null!==this.current&&(remainingTime+=this.current.track.remaining()),remainingTime}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){var nextTrack;for(null!==this.current&&(this.current.track.stop(),this.current=null);nextTrack=this.queue.shift();)if(!nextTrack.track.isUnavailable()){this.current=nextTrack;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var _this$queue2;this._drainQueue(),(_this$queue2=this.queue).push.apply(_this$queue2,_toConsumableArray(this.tracks.filter((function(trackObj){return!trackObj.track.isUnavailable()})))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),AudioList}(),AudioRunner=function(){function AudioRunner(list){if(_classCallCheck(this,AudioRunner),!(list instanceof Set||list instanceof AudioRunner))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(list instanceof AudioRunner?list.trackIds:list)}})}return _createClass(AudioRunner,[{key:"load",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.load)}},{key:"unload",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.unload)}},{key:"play",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.play)}},{key:"playWhenAllowed",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.playWhenAllowed)}},{key:"pause",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.pause)}},{key:"stop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.stop)}},{key:"fade",value:function(duration,toVol,fromVol){if(null==duration||null==toVol)throw new Error("fade requires parameters");AudioRunner._run(this.trackIds,AudioTrack.prototype.fade,duration,toVol,fromVol)}},{key:"fadeIn",value:function(duration,fromVol){if(null==duration)throw new Error("fadeIn requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeIn,duration,fromVol)}},{key:"fadeOut",value:function(duration,fromVol){if(null==duration)throw new Error("fadeOut requires a parameter");AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeOut,duration,fromVol)}},{key:"fadeStop",value:function(){AudioRunner._run(this.trackIds,AudioTrack.prototype.fadeStop)}},{key:"loop",value:function(_loop3){if(null==_loop3)throw new Error("loop requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.loop,_loop3),this}},{key:"mute",value:function(_mute3){if(null==_mute3)throw new Error("mute requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.mute,_mute3),this}},{key:"rate",value:function(_rate3){if(null==_rate3)throw new Error("rate requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.rate,_rate3),this}},{key:"time",value:function(_time2){if(null==_time2)throw new Error("time requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.time,_time2),this}},{key:"volume",value:function(_volume3){if(null==_volume3)throw new Error("volume requires a parameter");return AudioRunner._run(this.trackIds,AudioTrack.prototype.volume,_volume3),this}},{key:"on",value:function(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.on].concat(args)),this}},{key:"one",value:function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.one].concat(args)),this}},{key:"off",value:function(){for(var _len10=arguments.length,args=new Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];return AudioRunner._run.apply(AudioRunner,[this.trackIds,AudioTrack.prototype.off].concat(args)),this}}],[{key:"_run",value:function(ids,fn){for(var _len11=arguments.length,args=new Array(_len11>2?_len11-2:0),_key11=2;_key11<_len11;_key11++)args[_key11-2]=arguments[_key11];ids.forEach((function(id){var track=_tracks.get(id);track&&fn.apply(track,args)}))}}]),AudioRunner}();var _runnerParseSelector=function(){var notWsRe=/\S/g,parenRe=/[()]/g;function processNegation(str,startPos){var match;if(notWsRe.lastIndex=startPos,null===(match=notWsRe.exec(str))||"("!==match[0])throw new Error('invalid ":not()" syntax: missing parentheticals');parenRe.lastIndex=notWsRe.lastIndex;for(var start=notWsRe.lastIndex,result={str:"",nextMatch:-1},depth=1;null!==(match=parenRe.exec(str));)if("("===match[0]?++depth:--depth,depth<1){result.nextMatch=parenRe.lastIndex,result.str=str.slice(start,result.nextMatch-1);break}return result}return function parseSelector(idArg){for(var match,ids=[],idRe=/:?[^\s:()]+/g;null!==(match=idRe.exec(idArg));){var id=match[0];if(":not"===id){if(0===ids.length)throw new Error('invalid negation: no group ID preceded ":not()"');var parent=ids[ids.length-1];if(":"!==parent.id[0])throw new Error('invalid negation of track "'.concat(parent.id,'": only groups may be negated with ":not()"'));var negation=processNegation(idArg,idRe.lastIndex);if(-1===negation.nextMatch)throw new Error('unknown error parsing ":not()"');idRe.lastIndex=negation.nextMatch,parent.not=parseSelector(negation.str)}else ids.push({id:id})}return ids}}();function masterMute(mute){if(null==mute)return _masterMute;publish("mute",_masterMute=!!mute)}function unsubscribe(id){_subscribers.delete(id)}function publish(mesg,data){_subscribers.forEach((function(fn){return fn(mesg,data)}))}function _newTrack(sources){return new AudioTrack(sources.map((function(source){if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);if(passage.tags.includes("Twine.audio"))return passage.text.trim()}var match=_formatSpecRe.exec(source);return null===match?source:{format:match[1],src:match[2]}})))}return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("track ID"),arguments.length<2&&errors.push("sources"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='track ID "'.concat(id,'"');if(_badIdRe.test(id))throw new Error("invalid ".concat(what,": track IDs must not contain colons or whitespace"));var track,sources=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{track=_newTrack(sources)}catch(ex){throw new Error("".concat(what,": error during track initialization: ").concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("".concat(what,": no supported audio sources found"));_tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.set(id,track)}},delete:{value:function(id){return _tracks.has(id)&&_tracks.get(id)._destroy(),_tracks.delete(id)}},clear:{value:function(){_tracks.forEach((function(track){return track._destroy()})),_tracks.clear()}},has:{value:function(id){return _tracks.has(id)}},get:{value:function(id){return _tracks.get(id)||null}}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("group ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='group ID "'.concat(id,'"');if(":"!==id[0]||_badIdRe.test(id.slice(1)))throw new Error("invalid ".concat(what,": group IDs must start with a colon and must not contain colons or whitespace"));if(_specialIds.includes(id))throw new Error("cannot clobber special ".concat(what));var group,trackIds=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{group=new Set(trackIds.map((function(trackId){if(!_tracks.has(trackId))throw new Error('track "'.concat(trackId,'" does not exist'));return trackId})))}catch(ex){throw new Error("".concat(what,": error during group initialization: ").concat(ex.message))}_groups.set(id,Object.freeze(Array.from(group)))}},delete:{value:function(id){return _groups.delete(id)}},clear:{value:function(){_groups.clear()}},has:{value:function(id){return _groups.has(id)}},get:{value:function(id){return _groups.get(id)||null}}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:function(){if(arguments.length<2){var errors=[];throw arguments.length<1&&errors.push("list ID"),arguments.length<2&&errors.push("track IDs"),new Error("no ".concat(errors.join(" or ")," specified"))}var id=String(arguments[0]).trim(),what='list ID "'.concat(id,'"');if(_badIdRe.test(id))return this.error("invalid ".concat(what,": list IDs must not contain colons or whitespace"));var list,descriptors=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1);try{list=new AudioList(descriptors.map((function(desc){if(null===desc)throw new Error("track descriptor must be a string or object (type: null)");switch(_typeof(desc)){case"string":desc={id:desc};break;case"object":if(!desc.hasOwnProperty("id")&&!desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(desc.hasOwnProperty("id")&&desc.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: ".concat(_typeof(desc),")"))}var own,track,volume;if(desc.hasOwnProperty("id")){if("string"!=typeof desc.id)throw new Error('"id" property must be a string');if(!_tracks.has(desc.id))throw new Error('track "'.concat(desc.id,'" does not exist'));track=_tracks.get(desc.id)}else if(desc.hasOwnProperty("sources")){if(!Array.isArray(desc.sources)||0===desc.sources.length)throw new Error('"sources" property must be a non-empty array');if(desc.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{track=_newTrack(desc.sources),own=!0}catch(ex){throw new Error("error during track initialization: ".concat(ex.message))}if(Config.debug&&!track.hasSource())throw new Error("no supported audio sources found")}if(desc.hasOwnProperty("own")){if("boolean"!=typeof desc.own)throw new Error('"own" property must be a boolean');(own=desc.own)&&(track=track.clone())}if(desc.hasOwnProperty("volume")){if("number"!=typeof desc.volume||Number.isNaN(desc.volume)||!Number.isFinite(desc.volume)||desc.volume<0)throw new Error('"volume" property must be a non-negative finite number');volume=desc.volume}return{own:null!=own&&own,track:track,volume:null!=volume?volume:track.volume()}})))}catch(ex){throw new Error("".concat(what,": error during playlist initialization: ").concat(ex.message))}_lists.has(id)&&_lists.get(id)._destroy(),_lists.set(id,list)}},delete:{value:function(id){return _lists.has(id)&&_lists.get(id)._destroy(),_lists.delete(id)}},clear:{value:function(){_lists.forEach((function(list){return list._destroy()})),_lists.clear()}},has:{value:function(id){return _lists.has(id)}},get:{value:function(id){return _lists.get(id)||null}}}))},select:{value:function(){if(0===arguments.length)throw new Error("no track selector specified");var selector=String(arguments[0]).trim(),trackIds=new Set;try{var renderIds=function renderIds(idObj){var ids,id=idObj.id;switch(id){case":all":ids=allIds;break;case":looped":ids=allIds.filter((function(id){return _tracks.get(id).loop()}));break;case":muted":ids=allIds.filter((function(id){return _tracks.get(id).mute()}));break;case":paused":ids=allIds.filter((function(id){return _tracks.get(id).isPaused()}));break;case":playing":ids=allIds.filter((function(id){return _tracks.get(id).isPlaying()}));break;default:ids=":"===id[0]?_groups.get(id):[id]}if(idObj.hasOwnProperty("not")){var negated=idObj.not.map((function(idObj){return renderIds(idObj)})).flat(1/0);ids=ids.filter((function(id){return!negated.includes(id)}))}return ids},allIds=Array.from(_tracks.keys());_runnerParseSelector(selector).forEach((function(idObj){return renderIds(idObj).forEach((function(id){if(!_tracks.has(id))throw new Error('track "'.concat(id,'" does not exist'));trackIds.add(id)}))}))}catch(ex){throw new Error("error during runner initialization: ".concat(ex.message))}return new AudioRunner(trackIds)}},load:{value:function(){publish("load")}},loadWithScreen:{value:function(){publish("loadwithscreen")}},mute:{value:masterMute},muteOnHidden:{value:function(mute){if(!Visibility.isEnabled())return!1;if(null==mute)return _masterMuteOnHidden;var namespace=".SimpleAudio_masterMuteOnHidden";if(_masterMuteOnHidden=!!mute){var visibilityChange="".concat(Visibility.changeEvent).concat(namespace);jQuery(document).off(namespace).on(visibilityChange,(function(){return masterMute(Visibility.isHidden())})),Visibility.isHidden()&&masterMute(!0)}else jQuery(document).off(namespace)}},rate:{value:function(rate){if(null==rate)return _masterRate;if("number"!=typeof rate||Number.isNaN(rate)||!Number.isFinite(rate))throw new Error("rate must be a finite number");publish("rate",_masterRate=Math.clamp(rate,.2,5))}},stop:{value:function(){publish("stop")}},unload:{value:function(){publish("unload")}},volume:{value:function(volume){if(null==volume)return _masterVolume;if("number"!=typeof volume||Number.isNaN(volume)||!Number.isFinite(volume))throw new Error("volume must be a finite number");publish("volume",_masterVolume=Math.clamp(volume,0,1))}}}))}(),State=function(){var _history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null,_tempVariables={};function stateMarshal(noDelta){var stateObj={index:_activeIndex};return noDelta?stateObj.history=clone(_history):stateObj.delta=historyDeltaEncode(_history),_expired.length>0&&(stateObj.expired=_toConsumableArray(_expired)),null!==_prng&&(stateObj.seed=_prng.seed),stateObj}function stateUnmarshal(stateObj,noDelta){if(null==stateObj)throw new Error("state object is null or undefined");if(!stateObj.hasOwnProperty(noDelta?"history":"delta")||0===stateObj[noDelta?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!stateObj.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==_prng&&!stateObj.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===_prng&&stateObj.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");_history=noDelta?clone(stateObj.history):historyDeltaDecode(stateObj.delta),_activeIndex=stateObj.index,_expired=stateObj.hasOwnProperty("expired")?_toConsumableArray(stateObj.expired):[],stateObj.hasOwnProperty("seed")&&(_prng.seed=stateObj.seed),momentActivate(_activeIndex)}function momentCreate(title,variables){return{title:null==title?"":String(title),variables:null==variables?{}:clone(variables)}}function momentActivate(moment){if(null==moment)throw new Error("moment activation attempted with null or undefined");switch(_typeof(moment)){case"object":_active=clone(moment);break;case"number":if(historyIsEmpty())throw new Error("moment activation attempted with index on empty history");if(moment<0||moment>=historySize())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, ".concat(historySize()-1,"], got ").concat(moment));_active=clone(_history[moment]);break;default:throw new TypeError('moment activation attempted with a "'.concat(_typeof(moment),'"; must be an object or valid history stack index'))}return null!==_prng&&(_prng=PRNGWrapper.unmarshal({seed:_prng.seed,pull:_active.pull})),session.set("state",stateMarshal()),jQuery.event.trigger(":historyupdate"),_active}function historyLength(){return _activeIndex+1}function historySize(){return _history.length}function historyIsEmpty(){return 0===_history.length}function historyTop(){return _history.length>0?_history[_history.length-1]:null}function historyGoTo(index){return!(null==index||index<0||index>=historySize()||index===_activeIndex)&&(momentActivate(_activeIndex=index),!0)}function historyDeltaEncode(historyArr){if(!Array.isArray(historyArr))return null;if(0===historyArr.length)return[];for(var delta=[historyArr[0]],i=1,iend=historyArr.length;i<iend;++i)delta.push(Diff.diff(historyArr[i-1],historyArr[i]));return delta}function historyDeltaDecode(delta){if(!Array.isArray(delta))return null;if(0===delta.length)return[];for(var historyArr=[clone(delta[0])],i=1,iend=delta.length;i<iend;++i)historyArr.push(Diff.patch(historyArr[i-1],delta[i]));return historyArr}function prngInit(seed,useEntropy){var scriptSection;if(!historyIsEmpty())throw scriptSection="the Story JavaScript",new Error("State.prng.init must be called during initialization, within either ".concat(scriptSection," or the StoryInit special passage"));_prng=new PRNGWrapper(seed,useEntropy),_active.pull=_prng.pull}function metadataDelete(key){if("string"!=typeof key)throw new TypeError("State.metadata.delete key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");store&&store.hasOwnProperty(key)&&(1===Object.keys(store).length?storage.delete("metadata"):(delete store[key],storage.set("metadata",store)))}return Object.freeze(Object.defineProperties({},{reset:{value:function(){session.delete("state"),_history=[],_active=momentCreate(),_activeIndex=-1,_expired=[],_prng=null===_prng?null:new PRNGWrapper(_prng.seed,!1)}},restore:{value:function(){if(session.has("state")){var stateObj=session.get("state");return null!=stateObj&&(stateUnmarshal(stateObj),!0)}return!1}},marshalForSave:{value:function(){return stateMarshal(!0)}},unmarshalForSave:{value:function(stateObj){return stateUnmarshal(stateObj,!0)}},expired:{get:function(){return _expired}},turns:{get:function(){return _expired.length+historyLength()}},passages:{get:function(){return _expired.concat(_history.slice(0,historyLength()).map((function(moment){return moment.title})))}},hasPlayed:{value:function(title){return null!=title&&""!==title&&(!!_expired.includes(title)||!!_history.slice(0,historyLength()).some((function(moment){return moment.title===title})))}},active:{get:function(){return _active}},activeIndex:{get:function(){return _activeIndex}},passage:{get:function(){return _active.title}},variables:{get:function(){return _active.variables}},history:{get:function(){return _history}},length:{get:historyLength},size:{get:historySize},isEmpty:{value:historyIsEmpty},current:{get:function(){return _history.length>0?_history[_activeIndex]:null}},top:{get:historyTop},bottom:{get:function(){return _history.length>0?_history[0]:null}},index:{value:function(index){return historyIsEmpty()||index<0||index>_activeIndex?null:_history[index]}},peek:{value:function(offset){if(historyIsEmpty())return null;var lengthOffset=1+(offset?Math.abs(offset):0);return lengthOffset>historyLength()?null:_history[historyLength()-lengthOffset]}},has:{value:function(title){if(historyIsEmpty()||null==title||""===title)return!1;for(var i=_activeIndex;i>=0;--i)if(_history[i].title===title)return!0;return!1}},create:{value:function(title){for(0,historyLength()<historySize()&&_history.splice(historyLength(),historySize()-historyLength()),_history.push(momentCreate(title,_active.variables)),_prng&&(historyTop().pull=_prng.pull);historySize()>Config.history.maxStates;)_expired.push(_history.shift().title);return momentActivate(_activeIndex=historySize()-1),historyLength()}},goTo:{value:historyGoTo},go:{value:function(offset){return null!=offset&&0!==offset&&historyGoTo(_activeIndex+offset)}},deltaEncode:{value:historyDeltaEncode},deltaDecode:{value:historyDeltaDecode},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:prngInit},isEnabled:{value:function(){return null!==_prng}},pull:{get:function(){return _prng?_prng.pull:NaN}},seed:{get:function(){return _prng?_prng.seed:null}}}))},random:{value:function(){return _prng?_prng.random():Math.random()}},clearTemporary:{value:function(){TempVariables=_tempVariables={}}},temporary:{get:function(){return _tempVariables}},getVar:{value:function(varExpression){try{return Scripting.evalTwineScript(varExpression)}catch(ex){}}},setVar:{value:function(varExpression,value){try{return Scripting.evalTwineScript("".concat(varExpression," = evalTwineScript$Data$"),null,value),!0}catch(ex){}return!1}},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:function(){storage.delete("metadata")}},delete:{value:metadataDelete},entries:{value:function(){var store=storage.get("metadata");return store&&Object.entries(store)}},get:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.get key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)?store[key]:undefined}},has:{value:function(key){if("string"!=typeof key)throw new TypeError("State.metadata.has key parameter must be a string (received: ".concat(_typeof(key),")"));var store=storage.get("metadata");return store&&store.hasOwnProperty(key)}},keys:{value:function(){var store=storage.get("metadata");return store&&Object.keys(store)}},set:{value:function(key,value){if("string"!=typeof key)throw new TypeError("State.metadata.set key parameter must be a string (received: ".concat(_typeof(key),")"));if(void 0===value)metadataDelete(key);else{var store=storage.get("metadata")||{};store[key]=value,storage.set("metadata",store)}}},size:{get:function(){var store=storage.get("metadata");return store?Object.keys(store).length:0}}}))},initPRNG:{value:prngInit},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(targets,selector,handler,one,namespace){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var fn,opts;if("function"==typeof selector?(fn=selector,opts={namespace:one,one:!!handler}):(fn=handler,opts={namespace:namespace,one:!!one,selector:selector}),"function"!=typeof fn)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(targets).ariaClick(opts,fn)}function insertElement(place,type,id,classNames,text,title){var $el=jQuery(document.createElement(type));return id&&$el.attr("id",id),classNames&&$el.addClass(classNames),title&&$el.attr("title",title),text&&$el.text(text),place&&$el.appendTo(place),$el[0]}function insertText(place,text){jQuery(place).append(document.createTextNode(text))}function removeChildren(node){jQuery(node).empty()}function removeElement(node){jQuery(node).remove()}function fade(el,options){var current,intervalId,direction="in"===options.fade?1:-1,proxy=el.cloneNode(!0);function setOpacity(el,opacity){el.style.zoom=1,el.style.filter="alpha(opacity=".concat(Math.floor(100*opacity),")"),el.style.opacity=opacity}el.parentNode.replaceChild(proxy,el),"in"===options.fade?(current=0,proxy.style.visibility="visible"):current=1,setOpacity(proxy,current),intervalId=window.setInterval((function(){current+=.05*direction,setOpacity(proxy,Math.easeInOut(current)),(1===direction&&current>=1||-1===direction&&current<=0)&&(el.style.visibility="in"===options.fade?"visible":"hidden",proxy.parentNode.replaceChild(el,proxy),proxy=null,window.clearInterval(intervalId),options.onComplete&&options.onComplete())}),25)}function scrollWindowTo(el,incrementBy){var increment=null!=incrementBy?Number(incrementBy):.1;Number.isNaN(increment)||!Number.isFinite(increment)||increment<0?increment=.1:increment>1&&(increment=1);var intervalId,start=window.scrollY?window.scrollY:document.body.scrollTop,end=function(el){var posTop=function(el){var curtop=0;for(;el.offsetParent;)curtop+=el.offsetTop,el=el.offsetParent;return curtop}(el),posBottom=posTop+el.offsetHeight,winTop=window.scrollY?window.scrollY:document.body.scrollTop,winHeight=window.innerHeight?window.innerHeight:document.body.clientHeight,winBottom=winTop+winHeight;return posTop>=winTop&&posBottom>winBottom&&el.offsetHeight<winHeight?posTop-(winHeight-el.offsetHeight)+20:posTop}(el),distance=Math.abs(start-end),direction=start>end?-1:1,progress=0;intervalId=window.setInterval((function(){progress+=increment,window.scroll(0,start+direction*(distance*Math.easeInOut(progress))),progress>=1&&window.clearInterval(intervalId)}),25)}function toStringOrDefault(value){return stringFrom(value)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(key){if("string"!=typeof key)throw new TypeError("forget key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.delete(key)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,i=0,iend=needles.length;i<iend;++i)if(!played.includes(needles[i]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var needles=Array.prototype.concat.apply([],arguments),played=State.passages,uBound=played.length-1,turns=State.turns,i=0,iend=needles.length;i<iend&&turns>-1;++i){var lastIndex=played.lastIndexOf(needles[i]);turns=Math.min(turns,-1===lastIndex?-1:uBound-lastIndex)}return turns}function memorize(key,value){if("string"!=typeof key)throw new TypeError("memorize key parameter must be a string (received: ".concat(Util.getType(key),")"));State.metadata.set(key,value)}function passage(){return State.passage}function previous(){var passages=State.passages;if(arguments.length>0){var offset=Number(arguments[0]);if(!Number.isSafeInteger(offset)||offset<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return passages.length>offset?passages[passages.length-1-offset]:""}for(var i=passages.length-2;i>=0;--i)if(passages[i]!==State.passage)return passages[i];return""}function random(){var min,max;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:min=0,max=Math.trunc(arguments[0]);break;default:min=Math.trunc(arguments[0]),max=Math.trunc(arguments[1])}if(!Number.isInteger(min))throw new Error("random min parameter must be an integer");if(!Number.isInteger(max))throw new Error("random max parameter must be an integer");if(min>max){var _ref6=[max,min];min=_ref6[0],max=_ref6[1]}return Math.floor(State.random()*(max-min+1))+min}function randomFloat(){var min,max;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:min=0,max=Number(arguments[0]);break;default:min=Number(arguments[0]),max=Number(arguments[1])}if(Number.isNaN(min)||!Number.isFinite(min))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(max)||!Number.isFinite(max))throw new Error("randomFloat max parameter must be a number");if(min>max){var _ref7=[max,min];min=_ref7[0],max=_ref7[1]}return State.random()*(max-min)+min}function recall(key,defaultValue){if("string"!=typeof key)throw new TypeError("recall key parameter must be a string (received: ".concat(Util.getType(key),")"));return State.metadata.has(key)?State.metadata.get(key):defaultValue}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var passages=Array.prototype.concat.apply([],arguments),tags=[],i=0,iend=passages.length;i<iend;++i)tags=tags.concat(Story.get(passages[i]).tags);return tags}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),played=State.passages,count=State.turns,i=0,iend=needles.length;i<iend&&count>0;++i)count=Math.min(count,played.count(needles[i]));return count}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var needles=Array.prototype.concat.apply([],arguments),nLength=needles.length,played=State.passages,seen=new Map,count=0,i=0,iend=played.length;i<iend;++i){var title=played[i];if(seen.has(title))seen.get(title)&&++count;else{var _tags2=Story.get(title).tags;if(_tags2.length>0){for(var found=0,j=0;j<nLength;++j)_tags2.includes(needles[j])&&++found;found===nLength?(++count,seen.set(title,!0)):seen.set(title,!1)}}}return count}var _ref8=function(){function slugifyUrl(url){return Util.parseUrl(url).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function addScript(url){return new Promise((function(resolve,reject){jQuery(document.createElement("script")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importScripts failed to load the script "'.concat(url,'".')))})).appendTo(document.head).attr({id:"script-imported-".concat(slugifyUrl(url)),type:"text/javascript",src:url})}))}function addStyle(url){return new Promise((function(resolve,reject){jQuery(document.createElement("link")).one("load abort error",(function(ev){jQuery(ev.target).off(),"load"===ev.type?resolve(ev.target):reject(new Error('importStyles failed to load the stylesheet "'.concat(url,'".')))})).appendTo(document.head).attr({id:"style-imported-".concat(slugifyUrl(url)),rel:"stylesheet",href:url})}))}function sequence(callbacks){return callbacks.reduce((function(seq,fn){return seq.then(fn)}),Promise.resolve())}return{importScripts:function(){for(var _len12=arguments.length,urls=new Array(_len12),_key12=0;_key12<_len12;_key12++)urls[_key12]=arguments[_key12];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addScript(url)}}))):addScript(oneOrSeries)})))},importStyles:function(){for(var _len13=arguments.length,urls=new Array(_len13),_key13=0;_key13<_len13;_key13++)urls[_key13]=arguments[_key13];return Promise.all(urls.map((function(oneOrSeries){return Array.isArray(oneOrSeries)?sequence(oneOrSeries.map((function(url){return function(){return addStyle(url)}}))):addStyle(oneOrSeries)})))}}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){var tokenTable=Util.toEnum({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),parseRe=new RegExp(["(?:\"\"|''|``)",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(`(?:\\\\.|[^`\\\\])+`)","(?:[=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),notSpaceRe=/\S/,varTest=new RegExp("^".concat(Patterns.variable)),withColonTestRe=/^\s*:/,withNotTestRe=/^\s+not\b/;function parse(rawCodeString){if(0!==parseRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var match,code=rawCodeString;null!==(match=parseRe.exec(code));)if(match[1]){var rawTemplate=match[1],parsedTemplate=parseTemplate(rawTemplate);parsedTemplate!==rawTemplate&&(code=code.splice(match.index,rawTemplate.length,parsedTemplate),parseRe.lastIndex+=parsedTemplate.length-rawTemplate.length)}else if(match[2]){var token=match[2];if("$"===token||"_"===token)continue;if(varTest.test(token))token=token[0];else if("is"===token){var start=parseRe.lastIndex,ahead=code.slice(start);withNotTestRe.test(ahead)&&(code=code.splice(start,ahead.search(notSpaceRe)),token="isnot")}else{var _ahead=code.slice(parseRe.lastIndex);if(withColonTestRe.test(_ahead))continue}tokenTable[token]&&(code=code.splice(match.index,token.length,tokenTable[token]),parseRe.lastIndex+=tokenTable[token].length-token.length)}return code}var templateGroupStartRe=/\$\{/g,templateGroupParseRe=new RegExp(["(?:\"\"|'')",'(?:"(?:\\\\.|[^"\\\\])+")',"(?:'(?:\\\\.|[^'\\\\])+')","(\\{)","(\\})"].join("|"),"g");function parseTemplate(rawTemplateLiteral){if(0!==templateGroupStartRe.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start of template literal");for(var startMatch,template=rawTemplateLiteral;null!==(startMatch=templateGroupStartRe.exec(template));){var startIdx=startMatch.index+2,endIdx=startIdx,depth=1,endMatch=void 0;for(templateGroupParseRe.lastIndex=startIdx;null!==(endMatch=templateGroupParseRe.exec(template));)if(endMatch[1]?++depth:endMatch[2]&&--depth,0===depth){endIdx=endMatch.index;break}if(endIdx>startIdx){var parseIndex=parseRe.lastIndex,rawGroup=template.slice(startIdx,endIdx);parseRe.lastIndex=0;var parsedGroup=parse(rawGroup);parseRe.lastIndex=parseIndex,template=template.splice(startIdx,rawGroup.length,parsedGroup),templateGroupStartRe.lastIndex+=parsedGroup.length-rawGroup.length}}return template}return parse}();function evalJavaScript(code,output,data){return function(code,output,evalJavaScript$Data$){return eval(code)}.call(output?{output:output}:null,String(code),output,data)}function evalTwineScript(code,output,data){return function(code,output,evalTwineScript$Data$){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output,data)}return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref9=function(){var Lexer=function(){function Lexer(source,initialState){if(_classCallCheck(this,Lexer),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:source},initial:{value:initialState},state:{writable:!0,value:initialState},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(Lexer,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(num){this.pos-=num||1}},{key:"forward",value:function(num){this.pos+=num||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(valid){var ch=this.next();return-1!==ch&&(!!valid.includes(ch)||(this.backup(),!1))}},{key:"acceptRe",value:function(validRe){var ch=this.next();return-1!==ch&&(!!validRe.test(ch)||(this.backup(),!1))}},{key:"acceptRun",value:function(valid){for(;;){var ch=this.next();if(-1===ch)return;if(!valid.includes(ch))break}this.backup()}},{key:"acceptRunRe",value:function(validRe){for(;;){var ch=this.next();if(-1===ch)return;if(!validRe.test(ch))break}this.backup()}},{key:"emit",value:function(type){this.items.push({type:type,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(type,message){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:type,message:message,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(names){var obj=names.reduce((function(obj,name,i){return obj[name]=i,obj}),{});return Object.freeze(Object.assign(Object.create(null),obj))}}]),Lexer}();return{EOF:-1,Lexer:Lexer}}(),EOF=_ref9.EOF,Lexer=_ref9.Lexer,Wikifier=function(){var _optionsStack,lookaheadRe,idOrClassRe,_callDepth=0,Wikifier=function(){function Wikifier(destination,source,options){_classCallCheck(this,Wikifier),Wikifier.Parser.Profile.isEmpty()&&Wikifier.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(source)},options:{writable:!0,value:Object.assign({profile:"all"},options)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==destination?this.output=document.createDocumentFragment():destination.jquery?this.output=destination[0]:this.output=destination;try{++_callDepth,this.subWikify(this.output),1===_callDepth&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--_callDepth}}return _createClass(Wikifier,[{key:"subWikify",value:function(output,terminator,options){var newOptions,oldOptions,oldOutput=this.output;this.output=output,Wikifier.Option.length>0&&(newOptions=Object.assign(newOptions||{},Wikifier.Option.options)),null!==options&&"object"===_typeof(options)&&(newOptions=Object.assign(newOptions||{},options)),newOptions&&(oldOptions=this.options,this.options=Object.assign({},this.options,newOptions));var terminatorMatch,parserMatch,parsersProfile=Wikifier.Parser.Profile.get(this.options.profile),terminatorRegExp=terminator?new RegExp("(?:".concat(terminator,")"),this.options.ignoreTerminatorCase?"gim":"gm"):null;do{if(parsersProfile.parserRegExp.lastIndex=this.nextMatch,terminatorRegExp&&(terminatorRegExp.lastIndex=this.nextMatch),parserMatch=parsersProfile.parserRegExp.exec(this.source),(terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null)&&(!parserMatch||terminatorMatch.index<=parserMatch.index))return terminatorMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,terminatorMatch.index),this.matchStart=terminatorMatch.index,this.matchLength=terminatorMatch[0].length,this.matchText=terminatorMatch[0],this.nextMatch=terminatorRegExp.lastIndex,this.output=oldOutput,void(oldOptions&&(this.options=oldOptions));if(parserMatch){parserMatch.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,parserMatch.index),this.matchStart=parserMatch.index,this.matchLength=parserMatch[0].length,this.matchText=parserMatch[0],this.nextMatch=parsersProfile.parserRegExp.lastIndex;for(var matchingParser=void 0,i=1,iend=parserMatch.length;i<iend;++i)if(parserMatch[i]){matchingParser=i-1;break}if(parsersProfile.parsers[matchingParser].handler(this),null!=TempState.break)break}}while(terminatorMatch||parserMatch);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=oldOutput,oldOptions&&(this.options=oldOptions)}},{key:"outputText",value:function(destination,startPos,endPos){jQuery(destination).append(document.createTextNode(this.source.substring(startPos,endPos)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(text){var output=document.createDocumentFragment();new Wikifier(output,text);var errors=output.querySelector(".error");if(null!==errors)throw new Error(errors.textContent.replace(errorPrologRegExp,""));return output}},{key:"createInternalLink",value:function(destination,passage,text,callback){var $link=jQuery(document.createElement("a"));return null!=passage&&($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken"),$link.ariaClick({one:!0},(function(){"function"==typeof callback&&callback(),Engine.play(passage)}))),text&&$link.append(document.createTextNode(text)),destination&&$link.appendTo(destination),$link[0]}},{key:"createExternalLink",value:function(destination,url,text){var $link=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(text).appendTo(destination);return null!=url&&$link.attr({href:url,tabindex:0}),$link[0]}},{key:"isExternalLink",value:function(link){return!Story.has(link)&&(new RegExp("^".concat(Patterns.url),"gim").test(link)||/[/.?#]/.test(link))}}]),Wikifier}();return Object.defineProperty(Wikifier,"Option",{value:(_optionsStack=[],Object.freeze(Object.defineProperties({},{length:{get:function(){return _optionsStack.length}},options:{get:function(){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(_optionsStack)))}},clear:{value:function(){_optionsStack=[]}},get:{value:function(idx){return _optionsStack[idx]}},pop:{value:function(){return _optionsStack.pop()}},push:{value:function(options){if("object"!==_typeof(options)||null===options)throw new TypeError("Wikifier.Option.push options parameter must be an object (received: ".concat(Util.getType(options),")"));return _optionsStack.push(options)}}})))}),Object.defineProperty(Wikifier,"Parser",{value:function(){var _profiles,_parsers=[];function parsersHas(name){return!!_parsers.find((function(parser){return parser.name===name}))}return Object.freeze(Object.defineProperties({},{parsers:{get:function(){return _parsers}},add:{value:function(parser){if("object"!==_typeof(parser))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!parser.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof parser.name)throw new Error('parser object "name" property must be a string');if(!parser.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof parser.match)throw new Error('parser object "match" property must be a string');if(!parser.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof parser.handler)throw new Error('parser object "handler" property must be a function');if(parser.hasOwnProperty("profiles")&&!Array.isArray(parser.profiles))throw new Error('parser object "profiles" property must be an array');if(parsersHas(parser.name))throw new Error('cannot clobber existing parser "'.concat(parser.name,'"'));_parsers.push(parser)}},delete:{value:function(name){var parser=_parsers.find((function(parser){return parser.name===name}));parser&&_parsers.delete(parser)}},isEmpty:{value:function(){return 0===_parsers.length}},has:{value:parsersHas},get:{value:function(name){return _parsers.find((function(parser){return parser.name===name}))||null}},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:function(){return _profiles}},compile:{value:function(){var all=_parsers,core=all.filter((function(parser){return!Array.isArray(parser.profiles)||parser.profiles.includes("core")}));return _profiles=Object.freeze({all:{parsers:all,parserRegExp:new RegExp(all.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")},core:{parsers:core,parserRegExp:new RegExp(core.map((function(parser){return"(".concat(parser.match,")")})).join("|"),"gm")}})}},isEmpty:{value:function(){return"object"!==_typeof(_profiles)||0===Object.keys(_profiles).length}},has:{value:function(profile){return"object"===_typeof(_profiles)&&_profiles.hasOwnProperty(profile)}},get:{value:function(profile){if("object"!==_typeof(_profiles)||!_profiles.hasOwnProperty(profile))throw new Error('nonexistent parser profile "'.concat(profile,'"'));return _profiles[profile]}}}))}}))}()}),Object.defineProperties(Wikifier,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(Wikifier.helpers,{inlineCss:{value:(lookaheadRe=new RegExp(Patterns.inlineCss,"gm"),idOrClassRe=new RegExp("(".concat(Patterns.cssIdOrClassSigil,")(").concat(Patterns.anyLetter,"+)"),"g"),function(w){var matched,css={classes:[],id:"",styles:{}};do{lookaheadRe.lastIndex=w.nextMatch;var match=lookaheadRe.exec(w.source);if(matched=match&&match.index===w.nextMatch){if(match[1])css.styles[Util.fromCssProperty(match[1])]=match[2].trim();else if(match[3])css.styles[Util.fromCssProperty(match[3])]=match[4].trim();else if(match[5]){var subMatch=void 0;for(idOrClassRe.lastIndex=0;null!==(subMatch=idOrClassRe.exec(match[5]));)"."===subMatch[1]?css.classes.push(subMatch[2]):css.id=subMatch[2]}w.nextMatch=lookaheadRe.lastIndex}}while(matched);return css})},evalText:{value:function(text){var result;try{switch(_typeof(result=Scripting.evalTwineScript(text))){case"string":""===result.trim()&&(result=text);break;case"number":result=String(result);break;default:result=text}}catch(ex){result=text}return result}},evalPassageId:{value:function(passage){return null==passage||Story.has(passage)?passage:Wikifier.helpers.evalText(passage)}},hasBlockContext:{value:function(nodes){for(var hasGCS="function"==typeof window.getComputedStyle,i=nodes.length-1;i>=0;--i){var node=nodes[i];switch(node.nodeType){case Node.ELEMENT_NODE:var tagName=node.nodeName.toUpperCase();if("BR"===tagName)return!0;var styles=hasGCS?window.getComputedStyle(node,null):node.currentStyle;if(styles&&styles.display){if("none"===styles.display)continue;return"block"===styles.display}switch(tagName){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){var macroParser=null;function getMacroContextShadowView(){for(var macro=macroParser||function(){if(!macroParser&&!(macroParser=Wikifier.Parser.get("macro")))throw new Error('cannot find "macro" parser');return macroParser}(),view=new Set,context=macro.context;null!==context;context=context.parent)context._shadows&&context._shadows.forEach((function(name){return view.add(name)}));return _toConsumableArray(view)}return function(code){var shadowStore={};return getMacroContextShadowView().forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]})),function(){var shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null;try{return shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),Scripting.evalJavaScript(code)}finally{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}}()},parseSquareBracketedMarkup:{value:function(){var Item=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),Delim=Lexer.enumFromNames(["None","LTR","RTL"]);function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexLeftMeta(lexer){if(!lexer.accept("["))return lexer.error(Item.Error,"malformed square-bracketed markup");if(lexer.accept("["))lexer.data.isLink=!0,lexer.emit(Item.LinkMeta);else{if(lexer.accept("<>"),!(lexer.accept("Ii")&&lexer.accept("Mm")&&lexer.accept("Gg")&&lexer.accept("[")))return lexer.error(Item.Error,"malformed square-bracketed markup");lexer.data.isLink=!1,lexer.emit(Item.ImageMeta)}return lexer.depth=2,lexCoreComponents}function lexCoreComponents(lexer){for(var what=lexer.data.isLink?"link":"image",delim=Delim.None;;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup"));break;case"|":delim===Delim.None&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(),lexer.emit(Item.DelimLTR));break;case"-":delim===Delim.None&&">"===lexer.peek()&&(delim=Delim.LTR,lexer.backup(),lexer.emit(Item.Text),lexer.forward(2),lexer.emit(Item.DelimLTR));break;case"<":delim===Delim.None&&"-"===lexer.peek()&&(delim=Delim.RTL,lexer.backup(),lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.DelimRTL));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.InnerMeta),lexer.data.isLink?lexSetter:lexImageLink;case"]":return--lexer.depth,lexer.backup(),delim===Delim.RTL?lexer.emit(Item.Text):lexer.emit(lexer.data.isLink?Item.Link:Item.Source),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexImageLink(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup link component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)switch(lexer.peek()){case"[":return++lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.InnerMeta),lexSetter;case"]":return--lexer.depth,lexer.backup(),lexer.emit(Item.Link),lexer.forward(2),lexer.emit(Item.RightMeta),null;default:return lexer.error(Item.Error,"malformed ".concat(what," markup"))}}}function lexSetter(lexer){for(var what=lexer.data.isLink?"link":"image";;)switch(lexer.next()){case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case'"':if(slurpQuote(lexer,'"')===EOF)return lexer.error(Item.Error,"unterminated double quoted string in ".concat(what," markup setter component"));break;case"'":if(slurpQuote(lexer,"'")===EOF)return lexer.error(Item.Error,"unterminated single quoted string in ".concat(what," markup setter component"));break;case"[":++lexer.depth;break;case"]":if(--lexer.depth,1===lexer.depth)return"]"!==lexer.peek()?lexer.error(Item.Error,"malformed ".concat(what," markup")):(--lexer.depth,lexer.backup(),lexer.emit(Item.Setter),lexer.forward(2),lexer.emit(Item.RightMeta),null)}}return function(w){var lexer=new Lexer(w.source,lexLeftMeta);lexer.start=lexer.pos=w.matchStart;var markup={},items=lexer.run(),last=items.last();return last&&last.type===Item.Error?markup.error=last.message:items.forEach((function(item){var text=item.text.trim();switch(item.type){case Item.ImageMeta:markup.isImage=!0,"<"===text[1]?markup.align="left":">"===text[1]&&(markup.align="right");break;case Item.LinkMeta:markup.isLink=!0;break;case Item.Link:"~"===text[0]?(markup.forceInternal=!0,markup.link=text.slice(1)):markup.link=text;break;case Item.Setter:markup.setter=text;break;case Item.Source:markup.source=text;break;case Item.Text:markup.text=text}})),markup.pos=lexer.pos,markup}}()}}),Wikifier}();!function(){function _verbatimTagHandler(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("blockquote")).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,i,destStack=[w.output],curLevel=0,newLevel=w.matchLength;do{if(newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement("blockquote")).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();curLevel=newLevel,w.subWikify(destStack[destStack.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(destStack[destStack.length-1]),this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);(matched=match&&match.index===w.nextMatch)&&(newLevel=match[0].length,w.nextMatch+=match[0].length)}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?".concat(Patterns.macroName,")(?:\\s*)((?:(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/)|(?://.*\\n)|(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>"),"gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(w){var matchStart=this.lookahead.lastIndex=w.matchStart;if(this.parseTag(w)){var macro,nextMatch=w.nextMatch,name=this.working.name,rawArgs=this.working.arguments;try{if(!(macro=Macro.get(name))){if(Macro.tags.has(name)){var tags=Macro.tags.get(name);return throwError(w.output,"child tag <<".concat(name,">> was found outside of a call to its parent macro").concat(1===tags.length?"":"s"," <<").concat(tags.join(">>, <<"),">>"),w.source.slice(matchStart,w.nextMatch))}return throwError(w.output,"macro <<".concat(name,">> does not exist"),w.source.slice(matchStart,w.nextMatch))}var payload=null;if(void 0!==macro.tags&&!(payload=this.parseBody(w,macro)))return w.nextMatch=nextMatch,throwError(w.output,"cannot find a closing tag for macro <<".concat(name,">>"),"".concat(w.source.slice(matchStart,w.nextMatch),"…"));if("function"!=typeof macro.handler)return throwError(w.output,"macro <<".concat(name,">> handler function ").concat(void 0===macro.handler?"does not exist":"is not a function"),w.source.slice(matchStart,w.nextMatch));var args=payload?payload[0].args:this.createArgs(rawArgs,this.skipArgs(macro,macro.name));if(void 0!==macro._MACRO_API){this.context=new MacroContext({macro:macro,name:name,args:args,payload:payload,source:w.source.slice(matchStart,w.nextMatch),parent:this.context,parser:w});try{macro.handler.call(this.context)}finally{this.context=this.context.parent}}else{var prevRawArgs=w._rawArgs;w._rawArgs=rawArgs;try{macro.handler(w.output,name,args,w,payload)}finally{w._rawArgs=prevRawArgs}}}catch(ex){return throwError(w.output,"cannot execute ".concat(macro&&macro.isWidget?"widget":"macro"," <<").concat(name,">>: ").concat(ex.message),w.source.slice(matchStart,w.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else w.outputText(w.output,w.matchStart,w.nextMatch)},parseTag:function(w){var match=this.lookahead.exec(w.source);return!(!match||match.index!==w.matchStart||!match[1])&&(w.nextMatch=this.lookahead.lastIndex,this.working.source=w.source.slice(match.index,this.lookahead.lastIndex),this.working.name=match[1],this.working.arguments=match[2],this.working.index=match.index,!0)},parseBody:function(w,macro){for(var openTag=this.working.name,closeTag="/".concat(openTag),closeAlt="end".concat(openTag),bodyTags=!!Array.isArray(macro.tags)&&macro.tags,payload=[],end=-1,opened=1,curSource=this.working.source,curTag=this.working.name,curArgument=this.working.arguments,contentStart=w.nextMatch;-1!==(w.matchStart=w.source.indexOf(this.match,w.nextMatch));)if(this.parseTag(w)){var tagSource=this.working.source,tagName=this.working.name,tagArgs=this.working.arguments,tagBegin=this.working.index,tagEnd=w.nextMatch,hasArgs=""!==tagArgs.trim();switch(tagName){case openTag:++opened;break;case closeAlt:case closeTag:if(hasArgs)throw w.nextMatch=tagBegin+2+tagName.length,new Error('malformed closing tag: "'.concat(tagSource,'"'));--opened;break;default:if(hasArgs&&(tagName.startsWith("/")||tagName.startsWith("end"))){this.lookahead.lastIndex=w.nextMatch=tagBegin+2+tagName.length;continue}if(1===opened&&bodyTags)for(var i=0,iend=bodyTags.length;i<iend;++i)tagName===bodyTags[i]&&(payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),curSource=tagSource,curTag=tagName,curArgument=tagArgs,contentStart=tagEnd)}if(0===opened){payload.push({source:curSource,name:curTag,arguments:curArgument,args:this.createArgs(curArgument,this.skipArgs(macro,curTag)),contents:w.source.slice(contentStart,tagBegin)}),end=tagEnd;break}}else this.lookahead.lastIndex=w.nextMatch=w.matchStart+this.match.length;return-1!==end?(w.nextMatch=end,payload):null},createArgs:function(rawArgsString,skipArgs){var args=skipArgs?[]:this.parseArgs(rawArgsString);return Object.defineProperties(args,{raw:{value:rawArgsString},full:{value:Scripting.parse(rawArgsString)}}),args},skipArgs:function(macro,tagName){if(void 0!==macro.skipArgs){var sa=macro.skipArgs;return"boolean"==typeof sa&&sa||Array.isArray(sa)&&sa.includes(tagName)}return void 0!==macro.skipArg0&&(macro.skipArg0&&macro.name===tagName)},parseArgs:function(){var Item=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),spaceRe=new RegExp(Patterns.space),notSpaceRe=new RegExp(Patterns.notSpace),varTest=new RegExp("^".concat(Patterns.variable));function slurpQuote(lexer,endQuote){loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return EOF;case endQuote:break loop}return lexer.pos}function lexSpace(lexer){var offset=lexer.source.slice(lexer.pos).search(notSpaceRe);if(offset===EOF)return null;switch(0!==offset&&(lexer.pos+=offset,lexer.ignore()),lexer.next()){case"`":return lexExpression;case'"':return lexDoubleQuote;case"'":return lexSingleQuote;case"[":return lexSquareBracket;default:return lexBareword}}function lexExpression(lexer){return slurpQuote(lexer,"`")===EOF?lexer.error(Item.Error,"unterminated backquote expression"):(lexer.emit(Item.Expression),lexSpace)}function lexDoubleQuote(lexer){return slurpQuote(lexer,'"')===EOF?lexer.error(Item.Error,"unterminated double quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSingleQuote(lexer){return slurpQuote(lexer,"'")===EOF?lexer.error(Item.Error,"unterminated single quoted string"):(lexer.emit(Item.String),lexSpace)}function lexSquareBracket(lexer){var what;if(lexer.accept("<>IiMmGg")?(what="image",lexer.acceptRun("<>IiMmGg")):what="link",!lexer.accept("["))return lexer.error(Item.Error,"malformed ".concat(what," markup"));lexer.depth=2;loop:for(;;)switch(lexer.next()){case"\\":var ch=lexer.next();if(ch!==EOF&&"\n"!==ch)break;case EOF:case"\n":return lexer.error(Item.Error,"unterminated ".concat(what," markup"));case"[":++lexer.depth;break;case"]":if(--lexer.depth,lexer.depth<0)return lexer.error(Item.Error,"unexpected right square bracket ']'");if(1===lexer.depth){if("]"===lexer.next()){--lexer.depth;break loop}lexer.backup()}}return lexer.emit(Item.SquareBracket),lexSpace}function lexBareword(lexer){var offset=lexer.source.slice(lexer.pos).search(spaceRe);return lexer.pos=offset===EOF?lexer.source.length:lexer.pos+offset,lexer.emit(Item.Bareword),offset===EOF?null:lexSpace}return function(rawArgsString){var lexer=new Lexer(rawArgsString,lexSpace),args=[];return lexer.run().forEach((function(item){var arg=item.text;switch(item.type){case Item.Error:throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(item.message));case Item.Bareword:if(varTest.test(arg))arg=State.getVar(arg);else if(/^(?:settings|setup)[.[]/.test(arg))try{arg=Scripting.evalTwineScript(arg)}catch(ex){throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(ex.message))}else if("null"===arg)arg=null;else if("undefined"===arg)arg=undefined;else if("true"===arg)arg=!0;else if("false"===arg)arg=!1;else if("NaN"===arg)arg=NaN;else{var argAsNum=Number(arg);Number.isNaN(argAsNum)||(arg=argAsNum)}break;case Item.Expression:if(""===(arg=arg.slice(1,-1).trim()))arg=undefined;else try{arg=Scripting.evalTwineScript("(".concat(arg,")"))}catch(ex){throw new Error('unable to parse macro argument expression "'.concat(arg,'": ').concat(ex.message))}break;case Item.String:try{arg=Scripting.evalJavaScript(arg)}catch(ex){throw new Error('unable to parse macro argument string "'.concat(arg,'": ').concat(ex.message))}break;case Item.SquareBracket:var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:arg,matchStart:0});if(markup.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'.concat(arg,'": ').concat(markup.error));if(markup.pos<arg.length)throw new Error('unable to parse macro argument "'.concat(arg,'": unexpected character(s) "').concat(arg.slice(markup.pos),'" (pos: ').concat(markup.pos,")"));markup.isLink?((arg={isLink:!0}).count=markup.hasOwnProperty("text")?2:1,arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):arg.link,arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null):markup.isImage&&(arg=function(source){var imgObj={source:source,isImage:!0};if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(imgObj.source=passage.text,imgObj.passage=passage.title)}return imgObj}(Wikifier.helpers.evalPassageId(markup.source)),markup.hasOwnProperty("align")&&(arg.align=markup.align),markup.hasOwnProperty("text")&&(arg.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("link")&&(arg.link=Wikifier.helpers.evalPassageId(markup.link),arg.external=!markup.forceInternal&&Wikifier.isExternalLink(arg.link)),arg.setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null)}args.push(arg)})),args}}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{w.nextMatch=markup.pos;var link=Wikifier.helpers.evalPassageId(markup.link),text=markup.hasOwnProperty("text")?Wikifier.helpers.evalText(markup.text):link,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,output=(Config.debug?new DebugView(w.output,"link-markup","[[link]]",w.source.slice(w.matchStart,w.nextMatch)):w).output;markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(output,link,text,setFn):Wikifier.createExternalLink(output,link,text)}}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(w){w.outputText(Wikifier.createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(w){var markup=Wikifier.helpers.parseSquareBracketedMarkup(w);if(markup.hasOwnProperty("error"))w.outputText(w.output,w.matchStart,w.nextMatch);else{var debugView;w.nextMatch=markup.pos,Config.debug&&(debugView=new DebugView(w.output,"image-markup",markup.hasOwnProperty("link")?"[img[][link]]":"[img[]]",w.source.slice(w.matchStart,w.nextMatch))).modes({block:!0});var source,setFn=markup.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(markup.setter)):null,el=(Config.debug?debugView:w).output;if(markup.hasOwnProperty("link")){var link=Wikifier.helpers.evalPassageId(markup.link);(el=markup.forceInternal||!Wikifier.isExternalLink(link)?Wikifier.createInternalLink(el,link,null,setFn):Wikifier.createExternalLink(el,link)).classList.add("link-image")}if(el=jQuery(document.createElement("img")).appendTo(el).get(0),"data:"!==(source=Wikifier.helpers.evalPassageId(markup.source)).slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(el.setAttribute("data-passage",passage.title),source=passage.text.trim())}el.src=source,markup.hasOwnProperty("text")&&(el.title=Wikifier.helpers.evalText(markup.text)),markup.hasOwnProperty("align")&&(el.align=markup.align)}}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){var pre=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(match[1]).appendTo(pre),pre.appendTo(w.output),w.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(w){switch(w.matchText){case"''":w.subWikify(jQuery(document.createElement("strong")).appendTo(w.output).get(0),"''");break;case"//":w.subWikify(jQuery(document.createElement("em")).appendTo(w.output).get(0),"//");break;case"__":w.subWikify(jQuery(document.createElement("u")).appendTo(w.output).get(0),"__");break;case"^^":w.subWikify(jQuery(document.createElement("sup")).appendTo(w.output).get(0),"\\^\\^");break;case"~~":w.subWikify(jQuery(document.createElement("sub")).appendTo(w.output).get(0),"~~");break;case"==":w.subWikify(jQuery(document.createElement("s")).appendTo(w.output).get(0),"==");break;case"{{{":var lookahead=/\{\{\{((?:.|\n)*?)\}\}\}/gm;lookahead.lastIndex=w.matchStart;var match=lookahead.exec(w.source);match&&match.index===w.matchStart&&(jQuery(document.createElement("code")).text(match[1]).appendTo(w.output),w.nextMatch=lookahead.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(w){var css=Wikifier.helpers.inlineCss(w);this.blockRe.lastIndex=w.nextMatch;var blockMatch=this.blockRe.exec(w.source),blockLevel=blockMatch&&blockMatch.index===w.nextMatch,$el=jQuery(document.createElement(blockLevel?"div":"span")).appendTo(w.output);0===css.classes.length&&""===css.id&&0===Object.keys(css.styles).length?$el.addClass("marked"):(css.classes.forEach((function(className){return $el.addClass(className)})),""!==css.id&&$el.attr("id",css.id),$el.css(css.styles)),blockLevel?(w.nextMatch+=blockMatch[0].length,w.subWikify($el[0],"\\n?".concat(this.terminator))):w.subWikify($el[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(match[1]||match[2]).appendTo(w.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(w){jQuery(document.createElement("hr")).appendTo(w.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(w){jQuery(document.createTextNode("—")).appendTo(w.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(w){jQuery(document.createTextNode("$")).appendTo(w.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:"".concat(Patterns.variable,"(?:(?:\\.").concat(Patterns.identifier,")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\[").concat(Patterns.variable,"\\]))*"),handler:function(w){var result=State.getVar(w.matchText);null==result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"variable",w.matchText,w.matchText):w).output,stringFrom(result))}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?".concat(Patterns.templateName),handler:function(w){var name=w.matchText.slice(1),template=Template.get(name),result=null;switch(template instanceof Array&&(template=template.random()),_typeof(template)){case"function":try{result=stringFrom(template.call({name:name}))}catch(ex){return throwError(w.output,"cannot execute function template ?".concat(name,": ").concat(ex.message),w.source.slice(w.matchStart,w.nextMatch))}break;case"string":result=template}null===result?jQuery(document.createTextNode(w.matchText)).appendTo(w.output):new Wikifier((Config.debug?new DebugView(w.output,"template",w.matchText,w.matchText):w).output,result)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(w){Wikifier.helpers.hasBlockContext(w.output.childNodes)?w.subWikify(jQuery(document.createElement("h".concat(w.matchLength))).appendTo(w.output).get(0),this.terminator):jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){var matched,table=jQuery(document.createElement("table")).appendTo(w.output).get(0),prevColumns=[],curRowType=null,$rowContainer=null,rowCount=0;w.nextMatch=w.matchStart;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var nextRowType=match[2];"k"===nextRowType?(table.className=match[1],w.nextMatch+=match[0].length+1):(nextRowType!==curRowType&&(curRowType=nextRowType,$rowContainer=jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table)),"c"===curRowType?($rowContainer.css("caption-side",0===rowCount?"top":"bottom"),w.nextMatch+=1,w.subWikify($rowContainer[0],this.rowTerminator)):this.rowHandler(w,jQuery(document.createElement("tr")).appendTo($rowContainer).get(0),prevColumns),++rowCount)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))},rowHandler:function(w,rowEl,prevColumns){var matched,_this12=this,cellRe=new RegExp(this.cellPattern,"gm"),col=0,curColCount=1;do{cellRe.lastIndex=w.nextMatch;var cellMatch=cellRe.exec(w.source);if(matched=cellMatch&&cellMatch.index===w.nextMatch){if("~"===cellMatch[1]){var last=prevColumns[col];last&&(++last.rowCount,last.$element.attr("rowspan",last.rowCount).css("vertical-align","middle")),w.nextMatch=cellMatch.index+cellMatch[0].length-1}else if(">"===cellMatch[1])++curColCount,w.nextMatch=cellMatch.index+cellMatch[0].length-1;else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}!function(){++w.nextMatch;for(var css=Wikifier.helpers.inlineCss(w),spaceLeft=!1,spaceRight=!1,$cell=void 0;" "===w.source.substr(w.nextMatch,1);)spaceLeft=!0,++w.nextMatch;"!"===w.source.substr(w.nextMatch,1)?($cell=jQuery(document.createElement("th")).appendTo(rowEl),++w.nextMatch):$cell=jQuery(document.createElement("td")).appendTo(rowEl),prevColumns[col]={rowCount:1,$element:$cell},curColCount>1&&($cell.attr("colspan",curColCount),curColCount=1),w.subWikify($cell[0],_this12.cellTerminator)," "===w.matchText.substr(w.matchText.length-2,1)&&(spaceRight=!0),css.classes.forEach((function(className){return $cell.addClass(className)})),""!==css.id&&$cell.attr("id",css.id),spaceLeft&&spaceRight?css.styles["text-align"]="center":spaceLeft?css.styles["text-align"]="right":spaceRight&&(css.styles["text-align"]="left"),$cell.css(css.styles),w.nextMatch=w.nextMatch-1}()}++col}}while(matched)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(w){if(Wikifier.helpers.hasBlockContext(w.output.childNodes)){w.nextMatch=w.matchStart;var matched,i,destStack=[w.output],curType=null,curLevel=0;do{this.lookahead.lastIndex=w.nextMatch;var match=this.lookahead.exec(w.source);if(matched=match&&match.index===w.nextMatch){var newType=match[2]?"ol":"ul",newLevel=match[0].length;if(w.nextMatch+=match[0].length,newLevel>curLevel)for(i=curLevel;i<newLevel;++i)destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0));else if(newLevel<curLevel)for(i=curLevel;i>newLevel;--i)destStack.pop();else newLevel===curLevel&&newType!==curType&&(destStack.pop(),destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length-1]).get(0)));curLevel=newLevel,curType=newType,w.subWikify(jQuery(document.createElement("li")).appendTo(destStack[destStack.length-1]).get(0),this.terminator)}}while(matched)}else jQuery(w.output).append(document.createTextNode(w.matchText))}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);match&&match.index===w.matchStart&&(w.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\".concat(Patterns.spaceNoTerminator,"*\\n|\\n").concat(Patterns.spaceNoTerminator,"*\\\\|\\n?\\\\").concat(Patterns.spaceNoTerminator,"*$|^").concat(Patterns.spaceNoTerminator,"*\\\\\\n?"),handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(w){w.options.nobr||jQuery(document.createElement("br")).appendTo(w.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(w){jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(w){w.nextMatch=w.matchStart+w.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:_verbatimTagHandler}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(w){this.lookahead.lastIndex=w.matchStart;var match=this.lookahead.exec(w.source);if(match&&match.index===w.matchStart){w.nextMatch=this.lookahead.lastIndex;var css=match[2];this.hasImageMarkup.test(css)&&(this.imageMarkup.lastIndex=0,css=css.replace(this.imageMarkup,(function(wikiImage){var markup=Wikifier.helpers.parseSquareBracketedMarkup({source:wikiImage,matchStart:0});if(markup.hasOwnProperty("error")||markup.pos<wikiImage.length)return wikiImage;var source=markup.source;if("data:"!==source.slice(0,5)&&Story.has(source)){var passage=Story.get(source);passage.tags.includes("Twine.image")&&(source=passage.text)}return'url("'.concat(source.replace(/"/g,"%22"),'")')}))),jQuery(document.createDocumentFragment()).append(match[1]+css+match[3]).appendTo(w.output)}}}),Wikifier.Parser.add({name:"svgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/<(\/?)[Ss][Vv][Gg][^>]*>/gm,namespace:"http://www.w3.org/2000/svg",handler:function(w){var _this13=this;this.lookahead.lastIndex=w.nextMatch;for(var match,depth=1;depth>0&&null!==(match=this.lookahead.exec(w.source));)depth+="/"===match[1]?-1:1;if(0===depth){w.nextMatch=this.lookahead.lastIndex;var svgTag=w.source.slice(w.matchStart,this.lookahead.lastIndex),$frag=jQuery(document.createDocumentFragment()).append(svgTag);$frag.find("a[data-passage],image[data-passage]").each((function(_,el){var tagName=el.tagName.toLowerCase();try{_this13.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"svg|<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}el.hasAttribute("data-passage")&&_this13.processDataAttributes(el,tagName)})),$frag.appendTo(w.output)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref10){var name=_ref10.name,value=_ref10.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if("image"===tagName)"data:"!==passage.slice(0,5)&&Story.has(passage)&&(passage=Story.get(passage)).tags.includes("Twine.image")&&el.setAttribute("href",passage.text.trim());else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<".concat(Patterns.htmlTagName,"(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>"),tagRe:new RegExp("^<(".concat(Patterns.htmlTagName,")")),mediaTags:["audio","img","source","track","video"],nobrTags:["audio","colgroup","datalist","dl","figure","meter","ol","optgroup","picture","progress","ruby","select","table","tbody","tfoot","thead","tr","ul","video"],voidTags:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(w){var tagMatch=this.tagRe.exec(w.matchText),tag=tagMatch&&tagMatch[1],tagName=tag&&tag.toLowerCase();if(tagName){var terminator,terminatorMatch,isVoid=this.voidTags.includes(tagName)||w.matchText.endsWith("/>"),isNobr=this.nobrTags.includes(tagName);if(!isVoid){terminator="<\\/".concat(tagName,"\\s*>");var terminatorRe=new RegExp(terminator,"gim");terminatorRe.lastIndex=w.matchStart,terminatorMatch=terminatorRe.exec(w.source)}if(!isVoid&&!terminatorMatch)return throwError(w.output,"cannot find a closing tag for HTML <".concat(tag,">"),"".concat(w.matchText,"…"));var debugView,output=w.output,el=document.createElement(w.output.tagName);for(el.innerHTML=w.matchText;el.firstChild;)el=el.firstChild;try{this.processAttributeDirectives(el)}catch(ex){return throwError(w.output,"<".concat(tagName,">: ").concat(ex.message),"".concat(w.matchText,"…"))}if(el.hasAttribute("data-passage")&&(this.processDataAttributes(el,tagName),Config.debug&&((debugView=new DebugView(w.output,"html-".concat(tagName),tagName,w.matchText)).modes({block:"img"===tagName,nonvoid:terminatorMatch}),output=debugView.output)),terminatorMatch){try{Wikifier.Option.push({nobr:isNobr}),w.subWikify(el,terminator,{ignoreTerminatorCase:!0})}finally{Wikifier.Option.pop()}debugView&&jQuery(el).find(".debug.block").length>0&&debugView.modes({block:!0})}output.appendChild("track"===tagName?el.cloneNode(!0):el)}},processAttributeDirectives:function(el){_toConsumableArray(el.attributes).forEach((function(_ref11){var name=_ref11.name,value=_ref11.value,evalShorthand="@"===name[0];if(evalShorthand||name.startsWith("sc-eval:")){var result,newName=name.slice(evalShorthand?1:8);if("data-setter"===newName)throw new Error('evaluation directive is not allowed on the data-setter attribute: "'.concat(name,'"'));try{result=Scripting.evalTwineScript(value)}catch(ex){throw new Error('bad evaluation from attribute directive "'.concat(name,'": ').concat(ex.message))}try{el.setAttribute(newName,result),el.removeAttribute(name)}catch(ex){throw new Error('cannot transform attribute directive "'.concat(name,'" into attribute "').concat(newName,'"'))}}}))},processDataAttributes:function(el,tagName){var passage=el.getAttribute("data-passage");if(null!=passage){var evaluated=Wikifier.helpers.evalPassageId(passage);if(evaluated!==passage&&(passage=evaluated,el.setAttribute("data-passage",evaluated)),""!==passage)if(this.mediaTags.includes(tagName)){if("data:"!==passage.slice(0,5)&&Story.has(passage)){var parentName,twineTag;switch(passage=Story.get(passage),tagName){case"audio":case"video":twineTag="Twine.".concat(tagName);break;case"img":twineTag="Twine.image";break;case"track":twineTag="Twine.vtt";break;case"source":var $parent=$(el).closest("audio,picture,video");$parent.length&&(parentName=$parent.get(0).tagName.toLowerCase(),twineTag="Twine.".concat("picture"===parentName?"image":parentName))}passage.tags.includes(twineTag)&&(el["picture"===parentName?"srcset":"src"]=passage.text.trim())}}else{var setFn,setter=el.getAttribute("data-setter");null!=setter&&""!==(setter=String(setter).trim())&&(setFn=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(setter))),Story.has(passage)?(el.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&el.classList.add("link-visited")):el.classList.add("link-broken"),jQuery(el).ariaClick({one:!0},(function(){"function"==typeof setFn&&setFn.call(this),Engine.play(passage)}))}}}})}();var Template=(_templates=new Map,_validNameRe=new RegExp("^(?:".concat(Patterns.templateName,")$")),_validType=function(template){var templateType=_typeof(template);return"function"===templateType||"string"===templateType},Object.freeze(Object.defineProperties({},{add:{value:function(name,template){if(!(_validType(template)||template instanceof Array&&template.length>0&&template.every(_validType)))throw new TypeError("invalid template type (".concat(name,"); templates must be: functions, strings, or an array of either"));(name instanceof Array?name:[name]).forEach((function(name){if(!_validNameRe.test(name))throw new Error('invalid template name "'.concat(name,'"'));if(_templates.has(name))throw new Error("cannot clobber existing template ?".concat(name));_templates.set(name,template)}))}},delete:{value:function(name){(name instanceof Array?name:[name]).forEach((function(name){return _templates.delete(name)}))}},get:{value:function(name){return _templates.has(name)?_templates.get(name):null}},has:{value:function(name){return _templates.has(name)}},size:{get:function(){return _templates.size}}}))),_templates,_validNameRe,_validType,Macro=function(){var _macros={},_tags={},_validNameRe=new RegExp("^(?:".concat(Patterns.macroName,")$"));function macrosHas(name){return _macros.hasOwnProperty(name)}function tagsRegister(parent,bodyTags){if(!parent)throw new Error("no parent specified");for(var endTags=["/".concat(parent),"end".concat(parent)],allTags=[].concat(endTags,Array.isArray(bodyTags)?bodyTags:[]),i=0;i<allTags.length;++i){var tag=allTags[i];if(macrosHas(tag))throw new Error("cannot register tag for an existing macro");tagsHas(tag)?_tags[tag].includes(parent)||(_tags[tag].push(parent),_tags[tag].sort()):_tags[tag]=[parent]}}function tagsUnregister(parent){if(!parent)throw new Error("no parent specified");Object.keys(_tags).forEach((function(tag){var i=_tags[tag].indexOf(parent);-1!==i&&(1===_tags[tag].length?delete _tags[tag]:_tags[tag].splice(i,1))}))}function tagsHas(name){return _tags.hasOwnProperty(name)}return Object.freeze(Object.defineProperties({},{add:{value:function macrosAdd(name,def){if(Array.isArray(name))name.forEach((function(name){return macrosAdd(name,def)}));else{if(!_validNameRe.test(name))throw new Error('invalid macro name "'.concat(name,'"'));if(macrosHas(name))throw new Error("cannot clobber existing macro <<".concat(name,">>"));if(tagsHas(name))throw new Error("cannot clobber child tag <<".concat(name,">> of parent macro").concat(1===_tags[name].length?"":"s"," <<").concat(_tags[name].join(">>, <<"),">>"));try{if("object"===_typeof(def))_macros[name]=Object.assign(Object.create(null),def,{_MACRO_API:!0});else{if(!macrosHas(def))throw new Error("cannot create alias of nonexistent macro <<".concat(def,">>"));_macros[name]=Object.create(_macros[def],{_ALIAS_OF:{enumerable:!0,value:def}})}Object.defineProperty(_macros,name,{writable:!1})}catch(ex){throw"TypeError"===ex.name?new Error("cannot clobber protected macro <<".concat(name,">>")):new Error("unknown error when attempting to add macro <<".concat(name,">>: [").concat(ex.name,"] ").concat(ex.message))}if(void 0!==_macros[name].tags)if(null==_macros[name].tags)tagsRegister(name);else{if(!Array.isArray(_macros[name].tags))throw new Error('bad value for "tags" property of macro <<'.concat(name,">>"));tagsRegister(name,_macros[name].tags)}}}},delete:{value:function macrosDelete(name){if(Array.isArray(name))name.forEach((function(name){return macrosDelete(name)}));else if(macrosHas(name)){void 0!==_macros[name].tags&&tagsUnregister(name);try{Object.defineProperty(_macros,name,{writable:!0}),delete _macros[name]}catch(ex){throw new Error("unknown error removing macro <<".concat(name,">>: ").concat(ex.message))}}else if(tagsHas(name))throw new Error("cannot remove child tag <<".concat(name,">> of parent macro <<").concat(_tags[name],">>"))}},isEmpty:{value:function(){return 0===Object.keys(_macros).length}},has:{value:macrosHas},get:{value:function(name){var macro=null;return macrosHas(name)&&"function"==typeof _macros[name].handler?macro=_macros[name]:macros.hasOwnProperty(name)&&"function"==typeof macros[name].handler&&(macro=macros[name]),macro}},init:{value:function(){var handler=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(_macros).forEach((function(name){"function"==typeof _macros[name][handler]&&_macros[name][handler](name)})),Object.keys(macros).forEach((function(name){"function"==typeof macros[name][handler]&&macros[name][handler](name)}))}},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:tagsRegister},unregister:{value:tagsUnregister},has:{value:tagsHas},get:{value:function(name){return tagsHas(name)?_tags[name]:null}}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){var MacroContext=function(){function MacroContext(contextData){_classCallCheck(this,MacroContext);var context=Object.assign({parent:null,macro:null,name:"",displayName:"",args:null,payload:null,parser:null,source:""},contextData);if(null===context.macro||""===context.name||null===context.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:context.macro},name:{value:void 0===context.macro._ALIAS_OF?context.name:context.macro._ALIAS_OF},displayName:{value:context.name},args:{value:context.args},payload:{value:context.payload},source:{value:context.source},parent:{value:context.parent},parser:{value:context.parser},_output:{value:context.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(MacroContext,[{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return _toConsumableArray(this._shadows)}},{key:"shadowView",get:function(){var view=new Set;return this.contextSelectAll((function(ctx){return ctx._shadows})).forEach((function(ctx){return ctx._shadows.forEach((function(name){return view.add(name)}))})),_toConsumableArray(view)}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}},{key:"contextHas",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return!0;return!1}},{key:"contextSelect",value:function(filter){for(var context=this;null!==(context=context.parent);)if(filter(context))return context;return null}},{key:"contextSelectAll",value:function(filter){for(var result=[],context=this;null!==(context=context.parent);)filter(context)&&result.push(context);return result}},{key:"addShadow",value:function(){var _this14=this;this._shadows||(this._shadows=new Set);for(var varRe=new RegExp("^".concat(Patterns.variable,"$")),_len14=arguments.length,names=new Array(_len14),_key14=0;_key14<_len14;_key14++)names[_key14]=arguments[_key14];names.flat(1/0).forEach((function(name){if("string"!=typeof name)throw new TypeError("variable name must be a string; type: ".concat(_typeof(name)));if(!varRe.test(name))throw new Error('invalid variable name "'.concat(name,'"'));_this14._shadows.add(name)}))}},{key:"createShadowWrapper",value:function(callback,doneCallback,startCallback){var shadowStore,shadowContext=this;return"function"==typeof callback&&(shadowStore={},this.shadowView.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey]}))),function(){for(var _len15=arguments.length,args=new Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];if("function"==typeof startCallback&&startCallback.apply(this,args),"function"==typeof callback){var contextCache,shadowNames=Object.keys(shadowStore),valueCache=shadowNames.length>0?{}:null,macroParser=Wikifier.Parser.get("macro");try{shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),store[varKey]=shadowStore[varName]})),contextCache=macroParser.context,macroParser.context=shadowContext,callback.apply(this,args)}finally{contextCache!==undefined&&(macroParser.context=contextCache),shadowNames.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;shadowStore[varName]=store[varKey],valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}"function"==typeof doneCallback&&doneCallback.apply(this,args)}}},{key:"createDebugView",value:function(name,title){return this._debugView=new DebugView(this._output,"macro",name||this.displayName,title||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(message,source){return throwError(this._output,"<<".concat(this.displayName,">>: ").concat(message),source||this.source)}}]),MacroContext}();return MacroContext}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,tsVarRe:new RegExp("(".concat(Patterns.variable,")"),"g"),handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var valueCache={};try{for(var match,tsVarRe=this.self.tsVarRe;null!==(match=tsVarRe.exec(this.args.raw));){var varName=match[1],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;store.hasOwnProperty(varKey)&&(valueCache[varKey]=store[varKey]),this.addShadow(varName)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach((function(varName){var varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary;valueCache.hasOwnProperty(varKey)?store[varKey]=valueCache[varKey]:delete store[varKey]}))}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,jsVarRe:new RegExp("State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var match,jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var store=State[match[1]],name=match[2];store.hasOwnProperty(name)&&delete store[name]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}for(var match,remember=storage.get("remember")||{},jsVarRe=this.self.jsVarRe;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];remember[name]=State.variables[name]}if(!storage.set("remember",remember))return this.error("unknown error, cannot remember: ".concat(this.args.raw));Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var remember=storage.get("remember");remember&&Object.keys(remember).forEach((function(name){return State.variables[name]=remember[name]}))}}),Macro.add("forget",{skipArgs:!0,jsVarRe:new RegExp("State\\.variables\\.(".concat(Patterns.identifier,")"),"g"),handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var match,remember=storage.get("remember"),jsVarRe=this.self.jsVarRe,needStore=!1;null!==(match=jsVarRe.exec(this.args.full));){var name=match[1];State.variables.hasOwnProperty(name)&&delete State.variables[name],remember&&remember.hasOwnProperty(name)&&(needStore=!0,delete remember[name])}if(needStore)if(0===Object.keys(remember).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",remember))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var output=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,output)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}Config.debug&&this.createDebugView(),output.hasChildNodes()&&this.output.appendChild(output)}}),Macro.add("include",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?(Config.debug&&this.debugView.modes({block:!0}),passage=Story.get(passage),void(this.args[1]?jQuery(document.createElement(this.args[1])).addClass("".concat(passage.domId," macro-").concat(this.name)).attr("data-passage",passage.title).appendTo(this.output):jQuery(this.output)).wiki(passage.processText())):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var result=stringFrom(Scripting.evalJavaScript(this.args.full));null!==result&&new Wikifier(this.output,"-"===this.name?Util.escape(result):result)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var frag=document.createDocumentFragment();if(new Wikifier(frag,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({block:!0,hidden:!0}),this.output.appendChild(frag);else{var errList=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent}));if(errList.length>0)return this.error("error".concat(1===errList.length?"":"s"," within contents (").concat(errList.join("; "),")"))}}}),Macro.add("type",{isAsync:!0,tags:null,typeId:0,handler:function(){if(0===this.args.length)return this.error("no speed specified");var cursor,speed=Util.fromCssTime(this.args[0]);if(speed<0)return this.error("speed time value must be non-negative (received: ".concat(this.args[0],")"));for(var elClass="",elId="",elTag="div",skipKey=Config.macros.typeSkipKey,start=400,options=this.args.slice(1);options.length>0;){var option=options.shift();switch(option){case"class":if(0===options.length)return this.error("class option missing required class name(s)");if(""===(elClass=options.shift()))throw new Error('class option class name(s) must be non-empty (received: "")');break;case"element":if(0===options.length)return this.error("element option missing required element tag name");if(""===(elTag=options.shift()))throw new Error('element option tag name must be non-empty (received: "")');break;case"id":if(0===options.length)return this.error("id option missing required ID");if(""===(elId=options.shift()))throw new Error('id option ID must be non-empty (received: "")');break;case"keep":cursor="keep";break;case"none":cursor="none";break;case"skipkey":if(0===options.length)return this.error("skipkey option missing required key value");if(""===(skipKey=options.shift()))throw new Error('skipkey option key value must be non-empty (received: "")');break;case"start":if(0===options.length)return this.error("start option missing required time value");var value=options.shift();if((start=Util.fromCssTime(value))<0)throw new Error("start option time value must be non-negative (received: ".concat(value,")"));break;default:return this.error("unknown option: ".concat(option))}}var contents=this.payload[0].contents;if(""!==contents.trim()){Config.debug&&this.debugView.modes({block:!0});var className="macro-".concat(this.name),namespace=".".concat(className),$target=jQuery(document.createElement(elTag)).addClass("".concat(className," ").concat(className,"-target")).appendTo(this.output);TempState.macroTypeQueue||(TempState.macroTypeQueue=[],$(document).off(namespace).one(":passageinit".concat(namespace),(function(){return $(document).off(namespace)})));var startTyping=0===TempState.macroTypeQueue.length,selfId=++this.self.typeId;TempState.macroTypeQueue.push({id:selfId,handler:function(){var $wrapper=jQuery(document.createElement(elTag)).addClass(className);elId&&$wrapper.attr("id",elId),elClass&&$wrapper.addClass(elClass),new Wikifier($wrapper,contents);var passage=State.passage,turn=State.turns;if(!Config.macros.typeVisitedPassages&&State.passages.slice(0,-1).some((function(title){return title===passage}))||$wrapper.find(".error").length>0)return $target.replaceWith($wrapper),TempState.macroTypeQueue.shift(),void(TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().handler());var typer=new NodeTyper({targetNode:$wrapper.get(0),classNames:"none"===cursor?null:"".concat(className,"-cursor")});$target.replaceWith($wrapper);var keydownAndNS="keydown".concat(namespace),typingStopAndNS="".concat(":typingstop").concat(namespace);$(document).off(keydownAndNS).on(keydownAndNS,(function(ev){Util.scrubEventKey(ev.key)!==skipKey||ev.target!==document.body&&ev.target!==document.documentElement||(ev.preventDefault(),$(document).off(keydownAndNS),typer.finish())})).one(typingStopAndNS,(function(){TempState.macroTypeQueue&&(0===TempState.macroTypeQueue.length?jQuery.event.trigger(":typingcomplete"):TempState.macroTypeQueue.first().handler())}));var typeNode=function(){var typeNodeMember=function(typeIntervalId){State.passage===passage&&State.turns===turn&&typer.type()||(typeIntervalId&&clearInterval(typeIntervalId),TempState.macroTypeQueue&&TempState.macroTypeQueue.length>0&&TempState.macroTypeQueue.first().id===selfId&&TempState.macroTypeQueue.shift(),$wrapper.trigger(":typingstop"),$wrapper.addClass("".concat(className,"-done")),"keep"===cursor&&$wrapper.addClass("".concat(className,"-cursor")))};$wrapper.trigger(":typingstart"),typeNodeMember();var typeNodeMemberId=setInterval((function(){return typeNodeMember(typeNodeMemberId)}),speed)};start?setTimeout(typeNode,start):typeNode()}}),startTyping&&(Engine.isPlaying()?$(document).one(":passageend".concat(namespace),(function(){return TempState.macroTypeQueue.first().handler()})):TempState.macroTypeQueue.first().handler())}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],elseifWsRe:/^\s*if\b/i,ifAssignRe:/[^!=&^|<>*/%+-]=[^=>]/,handler:function(){var i;try{var len=this.payload.length,elseifWsRe=this.self.elseifWsRe,ifAssignRe=this.self.ifAssignRe;for(i=0;i<len;++i)if("else"===this.payload[i].name){if(this.payload[i].args.raw.length>0)return elseifWsRe.test(this.payload[i].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'.concat(i>0?" (#"+i+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<else>> must be the final clause")}else{if(0===this.payload[i].args.full.length)return this.error("no conditional expression specified for <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""));if(Config.macros.ifAssignmentError&&ifAssignRe.test(this.payload[i].args.full))return this.error("assignment operator found within <<".concat(this.payload[i].name,">> clause").concat(i>0?" (#"+i+")":""," (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: ").concat(this.payload[i].args.raw))}var evalJavaScript=Scripting.evalJavaScript,success=!1;for(i=0;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"else"===this.payload[i].name||evalJavaScript(this.payload[i].args.full)){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!success,invalid:!success})}}catch(ex){return this.error("bad conditional expression in <<".concat(0===i?"if":"elseif",">> clause").concat(i>0?" (#"+i+")":"",": ").concat("object"===_typeof(ex)?ex.message:ex))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var i,result,len=this.payload.length;if(1===len)return this.error("no cases specified");for(i=1;i<len;++i)if("default"===this.payload[i].name){if(this.payload[i].args.length>0)return this.error("<<default>> does not accept values, invalid: ".concat(this.payload[i].args.raw));if(i+1!==len)return this.error("<<default>> must be the final case")}else if(0===this.payload[i].args.length)return this.error("no value(s) specified for <<".concat(this.payload[i].name,">> (#").concat(i,")"));try{result=Scripting.evalJavaScript(this.args.full)}catch(ex){return this.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}var debugView=this.debugView,success=!1;for(Config.debug&&debugView.modes({nonvoid:!1,hidden:!0}),i=1;i<len;++i){if(Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1}),"default"===this.payload[i].name||this.payload[i].args.some((function(val){return val===result}))){success=!0,new Wikifier(this.output,this.payload[i].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++i;i<len;++i)this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0,invalid:!0});debugView.modes({nonvoid:!1,hidden:!0,invalid:!success}),this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0,invalid:!success})}}}),Macro.add("for",{skipArgs:!0,tags:null,hasRangeRe:new RegExp("^\\S".concat(Patterns.anyChar,"*?\\s+range\\s+\\S").concat(Patterns.anyChar,"*?$")),rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.(".concat(Patterns.identifier,")\\s*,\\s*)?State\\.(variables|temporary)\\.(").concat(Patterns.identifier,")\\s+range\\s+(\\S").concat(Patterns.anyChar,"*?)$")),threePartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,forInRe:/^\S+\s+in\s+\S+/i,forOfRe:/^\S+\s+of\s+\S+/i,handler:function(){var argsStr=this.args.full.trim(),payload=this.payload[0].contents.replace(/\n$/,"");if(0===argsStr.length)this.self.handleFor.call(this,payload,null,!0,null);else if(this.self.hasRangeRe.test(argsStr)){var parts=argsStr.match(this.self.rangeRe);if(null===parts)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self.handleForRange.call(this,payload,{type:parts[1],name:parts[2]},{type:parts[3],name:parts[4]},parts[5])}else{var init,condition,post;if(-1===argsStr.indexOf(";")){if(this.self.forInRe.test(argsStr))return this.error("invalid syntax, for…in is not supported; see: for…range");if(this.self.forOfRe.test(argsStr))return this.error("invalid syntax, for…of is not supported; see: for…range");condition=argsStr}else{var _parts=argsStr.match(this.self.threePartRe);if(null===_parts)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");init=_parts[1],condition=_parts[2].trim(),post=_parts[3],0===condition.length&&(condition=!0)}this.self.handleFor.call(this,payload,init,condition,post)}},handleFor:function(payload,init,condition,post){var evalJavaScript=Scripting.evalJavaScript,first=!0,safety=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,init)try{evalJavaScript(init)}catch(ex){return this.error("bad init expression: ".concat("object"===_typeof(ex)?ex.message:ex))}for(;evalJavaScript(condition);){if(--safety<0)return this.error("exceeded configured maximum loop iterations (".concat(Config.macros.maxLoopIterations,")"));if(new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(post)try{evalJavaScript(post)}catch(ex){return this.error("bad post expression: ".concat("object"===_typeof(ex)?ex.message:ex))}}}catch(ex){return this.error("bad conditional expression: ".concat("object"===_typeof(ex)?ex.message:ex))}finally{TempState.break=null}},handleForRange:function(payload,indexVar,valueVar,rangeExp){var rangeList,first=!0;try{rangeList=this.self.toRangeList(rangeExp)}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var i=0;i<rangeList.length;++i)if(indexVar.name&&(State[indexVar.type][indexVar.name]=rangeList[i][0]),State[valueVar.type][valueVar.name]=rangeList[i][1],new Wikifier(this.output,first?payload.replace(/^\n/,""):payload),first&&(first=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(ex){return this.error("object"===_typeof(ex)?ex.message:ex)}finally{TempState.break=null}},toRangeList:function(rangeExp){var value,list,evalJavaScript=Scripting.evalJavaScript;try{value=evalJavaScript("{"===rangeExp[0]?"(".concat(rangeExp,")"):rangeExp)}catch(ex){if("object"!==_typeof(ex))throw new Error("bad range expression: ".concat(ex));throw ex.message="bad range expression: ".concat(ex.message),ex}switch(_typeof(value)){case"string":list=[];for(var i=0;i<value.length;){var obj=Util.charAndPosAt(value,i);list.push([i,obj.char]),i=1+obj.end}break;case"object":if(Array.isArray(value))list=value.map((function(val,i){return[i,val]}));else if(value instanceof Set)list=_toConsumableArray(value).map((function(val,i){return[i,val]}));else if(value instanceof Map)list=_toConsumableArray(value.entries());else{if("Object"!==Util.toStringTag(value))throw new Error("unsupported range expression type: ".concat(Util.toStringTag(value)));list=Object.keys(value).map((function(key){return[key,value[key]]}))}break;default:throw new Error("unsupported range expression type: ".concat(_typeof(value)))}return list}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas((function(ctx){return"for"===ctx.name})))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var _this15=this;if(0===this.args.length)return this.error("no ".concat("button"===this.name?"button":"link"," text specified"));var passage,$link=jQuery(document.createElement("button"===this.name?"button":"a"));if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var $image=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo($link);$link.addClass("link-image"),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link}else $link.append(document.createTextNode(this.args[0].text)),passage=this.args[0].link;else $link.wikiWithOptions({profile:"core"},this.args[0]),passage=this.args.length>1?this.args[1]:undefined;null!=passage?($link.attr("data-passage",passage),Story.has(passage)?($link.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(passage)&&$link.addClass("link-visited")):$link.addClass("link-broken")):$link.addClass("link-internal"),$link.addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:null!=passage?"link":"button",one:null!=passage},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(_this15.payload[0].contents.trim())}:null,null!=passage?function(){return Engine.play(passage)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("unchecked value"),this.args.length<3&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),uncheckValue=this.args[1],checkValue=this.args[2],el=document.createElement("input");switch(jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:"checkbox",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.checked?checkValue:uncheckValue)}))).appendTo(this.output),this.args[3]){case"autocheck":State.getVar(varName)===checkValue?el.checked=!0:State.setVar(varName,uncheckValue);break;case"checked":el.checked=!0,State.setVar(varName,checkValue);break;default:State.setVar(varName,uncheckValue)}}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var _this16=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),len=this.payload.length;if(1===len)return this.error("no options specified");for(var config={autoselect:!1,once:!1},i=1;i<this.args.length;++i){var arg=this.args[i];switch(arg){case"once":config.once=!0;break;case"autoselect":config.autoselect=!0;break;default:return this.error("unknown argument: ".concat(arg))}}for(var options=[],tagCount={option:0,optionsfrom:0},selectedIdx=-1,_i5=1;_i5<len;++_i5){var payload=this.payload[_i5];if("option"===payload.name){if(++tagCount.option,0===payload.args.length)return this.error("no arguments specified for <<".concat(payload.name,">> (#").concat(tagCount.option,")"));var option={label:String(payload.args[0])},isSelected=!1;switch(payload.args.length){case 1:option.value=payload.args[0];break;case 2:"selected"===payload.args[1]?(option.value=payload.args[0],isSelected=!0):option.value=payload.args[1];break;default:option.value=payload.args[1],"selected"===payload.args[2]&&(isSelected=!0)}if(options.push(option),isSelected){if(config.autoselect)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==selectedIdx)return this.error("multiple selected keywords specified for <<".concat(payload.name,">> (#").concat(selectedIdx+1," & #").concat(tagCount.option,")"));selectedIdx=options.length-1}}else{var _ret=function(){if(++tagCount.optionsfrom,0===payload.args.full.length)return{v:_this16.error("no expression specified for <<".concat(payload.name,">> (#").concat(tagCount.optionsfrom,")"))};var result=void 0;try{var exp=payload.args.full;result=Scripting.evalJavaScript("{"===exp[0]?"(".concat(exp,")"):exp)}catch(ex){return{v:_this16.error("bad evaluation: ".concat("object"===_typeof(ex)?ex.message:ex))}}if("object"!==_typeof(result)||null===result)return{v:_this16.error("expression must yield a supported collection or generic object (type: ".concat(null===result?"null":_typeof(result),")"))};if(result instanceof Array||result instanceof Set)result.forEach((function(val){return options.push({label:String(val),value:val})}));else if(result instanceof Map)result.forEach((function(val,key){return options.push({label:String(key),value:val})}));else{var oType=Util.toStringTag(result);if("Object"!==oType)return{v:_this16.error("expression must yield a supported collection or generic object (object type: ".concat(oType,")"))};Object.keys(result).forEach((function(key){return options.push({label:key,value:result[key]})}))}}();if("object"===_typeof(_ret))return _ret.v}}if(-1===selectedIdx)if(config.autoselect){var sameValueZero=Util.sameValueZero,curValue=State.getVar(varName),curValueIdx=options.findIndex((function(opt){return sameValueZero(opt.value,curValue)}));selectedIdx=-1===curValueIdx?0:curValueIdx}else selectedIdx=0;if("cycle"===this.name){var lastIdx=options.length-1;if(config.once&&selectedIdx===lastIdx)jQuery(this.output).wikiWithOptions({profile:"core"},options[selectedIdx].label);else{var cycleIdx=selectedIdx;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},options[selectedIdx].label).attr("id","".concat(this.name,"-").concat(varId)).addClass("macro-".concat(this.name)).ariaClick({namespace:".macros",role:"button"},this.createShadowWrapper((function(){var $this=$(this);cycleIdx=(cycleIdx+1)%options.length,State.setVar(varName,options[cycleIdx].value),$this.empty().wikiWithOptions({profile:"core"},options[cycleIdx].label),config.once&&cycleIdx===lastIdx&&$this.off().contents().unwrap()}))).appendTo(this.output)}}else{var $select=jQuery(document.createElement("select"));options.forEach((function(opt,i){jQuery(document.createElement("option")).val(i).text(opt.label).appendTo($select)})),$select.attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),tabindex:0}).addClass("macro-".concat(this.name)).val(selectedIdx).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,options[Number(this.value)].value)}))).appendTo(this.output)}State.setVar(varName,options[selectedIdx].value)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this17=this;if(0===this.args.length)return this.error("no link text specified");var $link=jQuery(document.createElement("a")),$insert=jQuery(document.createElement("span")),transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]);$link.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-".concat(this.name)).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper((function(){if("linkreplace"===_this17.name?$link.remove():$link.wrap('<span class="macro-'.concat(_this17.name,'"></span>')).replaceWith((function(){return $link.html()})),""!==_this17.payload[0].contents){var frag=document.createDocumentFragment();new Wikifier(frag,_this17.payload[0].contents),$insert.append(frag)}transition&&setTimeout((function(){return $insert.removeClass("macro-".concat(_this17.name,"-in"))}),Engine.minDomActionDelay)}))).appendTo(this.output),$insert.addClass("macro-".concat(this.name,"-insert")),transition&&$insert.addClass("macro-".concat(this.name,"-in")),"linkprepend"===this.name?$insert.insertBefore($link):$insert.insertAfter($link)}}),Macro.add(["numberbox","textbox"],{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var asNumber="numberbox"===this.name,defaultValue=asNumber?Number(this.args[1]):this.args[1];if(asNumber&&Number.isNaN(defaultValue))return this.error('default value "'.concat(this.args[1],'" is neither a number nor can it be parsed into a number'));var passage,varId=Util.slugify(varName),el=document.createElement("input"),autofocus=!1;this.args.length>3?(passage=this.args[2],autofocus="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?autofocus=!0:passage=this.args[2]),"object"===_typeof(passage)&&(passage=passage.link),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),type:asNumber?"number":"text",inputmode:asNumber?"decimal":"text",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,asNumber?Number(this.value):this.value)}))).on("keypress.macros",this.createShadowWrapper((function(ev){13===ev.which&&(ev.preventDefault(),State.setVar(varName,asNumber?Number(this.value):this.value),null!=passage&&Engine.play(passage))}))).appendTo(this.output),asNumber&&(el.step="any"),State.setVar(varName,defaultValue),el.value=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("checked value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));var varId=Util.slugify(varName),checkValue=this.args[1],el=document.createElement("input");switch(TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(varId)||(TempState[this.name][varId]=0),jQuery(el).attr({id:"".concat(this.name,"-").concat(varId,"-").concat(TempState[this.name][varId]++),name:"".concat(this.name,"-").concat(varId),type:"radio",tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){this.checked&&State.setVar(varName,checkValue)}))).appendTo(this.output),this.args[2]){case"autocheck":State.getVar(varName)===checkValue&&(el.checked=!0);break;case"checked":el.checked=!0,State.setVar(varName,checkValue)}}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("variable name"),this.args.length<2&&errors.push("default value"),this.error("no ".concat(errors.join(" or ")," specified"))}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var varName=this.args[0].trim();if("$"!==varName[0]&&"_"!==varName[0])return this.error('variable name "'.concat(this.args[0],'" is missing its sigil ($ or _)'));Config.debug&&this.debugView.modes({block:!0});var varId=Util.slugify(varName),defaultValue=this.args[1],autofocus="autofocus"===this.args[2],el=document.createElement("textarea");jQuery(el).attr({id:"".concat(this.name,"-").concat(varId),name:"".concat(this.name,"-").concat(varId),rows:4,tabindex:0}).addClass("macro-".concat(this.name)).on("change.macros",this.createShadowWrapper((function(){State.setVar(varName,this.value)}))).appendTo(this.output),State.setVar(varName,defaultValue),el.textContent=defaultValue,autofocus&&(el.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:".concat(el.id)]=function(task){delete postdisplay[task],setTimeout((function(){return el.focus()}),Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var $list=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),i=0;i<this.args.length;++i){var passage=void 0,text=void 0,$image=void 0,setFn=void 0;if("object"===_typeof(this.args[i])?this.args[i].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[i].source),this.args[i].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[i].passage),this.args[i].hasOwnProperty("title")&&$image.attr("title",this.args[i].title),this.args[i].hasOwnProperty("align")&&$image.attr("align",this.args[i].align),passage=this.args[i].link,setFn=this.args[i].setFn):(text=this.args[i].text,passage=this.args[i].link,setFn=this.args[i].setFn):text=passage=this.args[i],!(State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(passage)&&State.variables["#actions"][passage])){var $link=jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo($list),passage,null,function(passage,fn){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][passage]=!0,"function"==typeof fn&&fn()}}(passage,setFn))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text));$image&&$link.addClass("link-image")}}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var passage,text,$image,$link,momentIndex=-1;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(passage=this.args[0].link)):(1===this.args[0].count||(text=this.args[0].text),passage=this.args[0].link):1===this.args.length&&(text=this.args[0])),null==passage){for(var i=State.length-2;i>=0;--i)if(State.history[i].title!==State.passage){momentIndex=i,passage=State.history[i].title;break}if(null==passage&&"return"===this.name)for(var _i6=State.expired.length-1;_i6>=0;--_i6)if(State.expired[_i6]!==State.passage){passage=State.expired[_i6];break}}else{if(!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));if("back"===this.name){for(var _i7=State.length-2;_i7>=0;--_i7)if(State.history[_i7].title===passage){momentIndex=_i7;break}if(-1===momentIndex)return this.error('cannot find passage "'.concat(passage,'" in the current story history'))}}if(null==passage)return this.error("cannot find passage");"back"!==this.name||-1!==momentIndex?($link=jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(passage)}:function(){return Engine.goTo(momentIndex)}),$image&&$link.addClass("link-image")):$link=jQuery(document.createElement("span")).addClass("link-disabled"),$link.addClass("macro-".concat(this.name)).append($image||document.createTextNode(text||L10n.get("macro".concat(this.name.toUpperFirst(),"Text")))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var passage,text,$image,setFn,$link,choiceId=State.passage;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?($image=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&$image.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&$image.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&$image.attr("align",this.args[0].align),passage=this.args[0].link,setFn=this.args[0].setFn):(text=this.args[0].text,passage=this.args[0].link,setFn=this.args[0].setFn):text=passage=this.args[0]:(passage=this.args[0],text=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(choiceId)&&State.variables["#choice"][choiceId])return $link=jQuery(document.createElement("span")).addClass("link-disabled macro-".concat(this.name)).attr("tabindex",-1).append($image||document.createTextNode(text)).appendTo(this.output),void($image&&$link.addClass("link-image"));$link=jQuery(Wikifier.createInternalLink(this.output,passage,null,(function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][choiceId]=!0,"function"==typeof setFn&&setFn()}))).addClass("macro-".concat(this.name)).append($image||document.createTextNode(text)),$image&&$link.addClass("link-image")}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("selector"),this.args.length<2&&errors.push("class names"),this.error("no ".concat(errors.join(" or ")," specified"))}var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));switch(this.name){case"addclass":$targets.addClass(this.args[1].trim());break;case"toggleclass":$targets.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));this.args.length>1?$targets.removeClass(this.args[1].trim()):$targets.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));jQuery(this.output).append($targets.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,t8nRe:/^(?:transition|t8n)$/,handler:function(){var _this18=this;if(0===this.args.length)return this.error("no selector specified");var $insert,$targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));if(""!==this.payload[0].contents)switch(this.args.length>1&&this.self.t8nRe.test(this.args[1])?(($insert=jQuery(document.createElement("span"))).addClass("macro-".concat(this.name,"-insert macro-").concat(this.name,"-in")),setTimeout((function(){return $insert.removeClass("macro-".concat(_this18.name,"-in"))}),Engine.minDomActionDelay)):$insert=jQuery(document.createDocumentFragment()),$insert.wiki(this.payload[0].contents),this.name){case"replace":$targets.empty();case"append":$targets.append($insert);break;case"prepend":$targets.prepend($insert)}else"replace"===this.name&&$targets.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var $targets=jQuery(this.args[0]);if(0===$targets.length)return this.error('no elements matched the selector "'.concat(this.args[0],'"'));$targets.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){var errorOnePlaybackAction=function(cur,prev){return'only one playback action allowed per invocation, "'.concat(cur,'" cannot be combined with "').concat(prev,'"')};Macro.add("audio",{handler:function(){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track and/or group IDs"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var selected;try{selected=SimpleAudio.select(this.args[0])}catch(ex){return this.error(ex.message)}for(var action,fadeTo,loop,mute,passage,time,volume,args=this.args.slice(1),fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors=[];return args.length<1&&_errors.push("seconds"),args.length<2&&_errors.push("level"),this.error("fadeoverto missing required ".concat(_errors.join(" and ")," value").concat(_errors.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"time":if(0===args.length)return this.error("time missing required seconds value");if(raw=args.shift(),time=Number.parseFloat(raw),Number.isNaN(time)||!Number.isFinite(time))return this.error("cannot parse time: ".concat(raw));break;case"loop":case"unloop":loop="loop"===arg;break;case"goto":if(0===args.length)return this.error("goto missing required passage title");if(raw=args.shift(),passage="object"===_typeof(raw)?raw.link:raw,!Story.has(passage))return this.error('passage "'.concat(passage,'" does not exist'));break;default:return this.error("unknown action: ".concat(arg))}}try{if(null!=volume&&selected.volume(volume),null!=time&&selected.time(time),null!=mute&&selected.mute(mute),null!=loop&&selected.loop(loop),null!=passage){var nsEnded="ended.macros.macro-".concat(this.name,"_goto");selected.off(nsEnded).one(nsEnded,(function(){selected.off(nsEnded),Engine.play(passage)}))}switch(action){case"fade":selected.fade(fadeOver,fadeTo);break;case"load":selected.load();break;case"pause":selected.pause();break;case"play":selected.playWhenAllowed();break;case"stop":selected.stop();break;case"unload":selected.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("cacheaudio",{handler:function(){var _this19=this;if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("track ID"),this.args.length<2&&errors.push("sources"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim(),oldFmtRe=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(id,this.args.slice(1).map((function(source){if(oldFmtRe.test(source)){if(Config.debug)return _this19.error('track ID "'.concat(id,'": format specifier migration required, "format:formatId;" → "formatId|"'));source=source.replace(oldFmtRe,"$1|")}return source})))}catch(ex){return this.error(ex.message)}if(Config.debug&&!SimpleAudio.tracks.get(id).hasSource())return this.error('track ID "'.concat(id,'": no supported audio sources found'));Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var groupId=String(this.args[0]).trim(),trackIds=[],i=1,len=this.payload.length;i<len;++i){if(this.payload[i].args.length<1)return this.error("no track ID specified");trackIds.push(String(this.payload[i].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(groupId,trackIds)}catch(ex){return this.error(ex.message)}Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var playlist=Macro.get("playlist");if(null!==playlist.from&&"createplaylist"!==playlist.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var listId=String(this.args[0]).trim(),trackObjs=[],i=1,len=this.payload.length;i<len;++i){if(0===this.payload[i].args.length)return this.error("no track ID specified");for(var trackObj={id:String(this.payload[i].args[0]).trim()},args=this.payload[i].args.slice(1);args.length>0;){var arg=args.shift(),raw=void 0,parsed=void 0;switch(arg){case"copy":case"own":trackObj.own=!0;break;case"rate":args.length>0&&args.shift();break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),parsed=Number.parseFloat(raw),Number.isNaN(parsed)||!Number.isFinite(parsed))return this.error("cannot parse volume: ".concat(raw));trackObj.volume=parsed;break;default:return this.error("unknown action: ".concat(arg))}}trackObjs.push(trackObj),Config.debug&&this.createDebugView(this.payload[i].name,this.payload[i].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(listId,trackObjs)}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="createplaylist"),Config.debug&&this.createDebugView("/".concat(this.name),"<</".concat(this.name,">>")).modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var action,mute,muteOnHide,volume,args=this.args.slice(0);args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"mute":case"unmute":mute="mute"===arg;break;case"muteonhide":case"nomuteonhide":muteOnHide="muteonhide"===arg;break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=mute&&SimpleAudio.mute(mute),null!=muteOnHide&&SimpleAudio.muteOnHidden(muteOnHide),null!=volume&&SimpleAudio.volume(volume),action){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("playlist",{from:null,handler:function(){var list,args,action,from=this.self.from;if(null===from)return this.error("no playlists have been created");if("createplaylist"===from){if(this.args.length<2){var errors=[];return this.args.length<1&&errors.push("list ID"),this.args.length<2&&errors.push("actions"),this.error("no ".concat(errors.join(" or ")," specified"))}var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));list=SimpleAudio.lists.get(id),args=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");list=SimpleAudio.lists.get("setplaylist"),args=this.args.slice(0)}for(var fadeTo,loop,mute,shuffle,volume,fadeOver=5;args.length>0;){var arg=args.shift(),raw=void 0;switch(arg){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(action)return this.error(errorOnePlaybackAction(arg,action));action=arg;break;case"fadein":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=1;break;case"fadeout":if(action)return this.error(errorOnePlaybackAction(arg,action));action="fade",fadeTo=0;break;case"fadeto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(0===args.length)return this.error("fadeto missing required level value");if(action="fade",raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeto: ".concat(raw));break;case"fadeoverto":if(action)return this.error(errorOnePlaybackAction(arg,action));if(args.length<2){var _errors2=[];return args.length<1&&_errors2.push("seconds"),args.length<2&&_errors2.push("level"),this.error("fadeoverto missing required ".concat(_errors2.join(" and ")," value").concat(_errors2.length>1?"s":""))}if(action="fade",raw=args.shift(),fadeOver=Number.parseFloat(raw),Number.isNaN(fadeOver)||!Number.isFinite(fadeOver))return this.error("cannot parse fadeoverto: ".concat(raw));if(raw=args.shift(),fadeTo=Number.parseFloat(raw),Number.isNaN(fadeTo)||!Number.isFinite(fadeTo))return this.error("cannot parse fadeoverto: ".concat(raw));break;case"volume":if(0===args.length)return this.error("volume missing required level value");if(raw=args.shift(),volume=Number.parseFloat(raw),Number.isNaN(volume)||!Number.isFinite(volume))return this.error("cannot parse volume: ".concat(raw));break;case"mute":case"unmute":mute="mute"===arg;break;case"loop":case"unloop":loop="loop"===arg;break;case"shuffle":case"unshuffle":shuffle="shuffle"===arg;break;default:return this.error("unknown action: ".concat(arg))}}try{switch(null!=volume&&list.volume(volume),null!=mute&&list.mute(mute),null!=loop&&list.loop(loop),null!=shuffle&&list.shuffle(shuffle),action){case"fade":list.fade(fadeOver,fadeTo);break;case"load":list.load();break;case"pause":list.pause();break;case"play":list.playWhenAllowed();break;case"skip":list.skip();break;case"stop":list.stop();break;case"unload":list.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error("error executing action: ".concat(ex.message))}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.groups.has(id))return this.error('group "'.concat(id,'" does not exist'));SimpleAudio.groups.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var id=String(this.args[0]).trim();if(!SimpleAudio.lists.has(id))return this.error('playlist "'.concat(id,'" does not exist'));SimpleAudio.lists.delete(id),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}}),Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var playlist=Macro.get("playlist");if(null!==playlist.from&&"setplaylist"!==playlist.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(ex){return this.error(ex.message)}null===playlist.from&&(playlist.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var contents=this.payload[0].contents.trim();""!==contents&&setTimeout(this.createShadowWrapper((function(){return $.wiki(contents)})),Engine.minDomActionDelay)}}),Macro.add("goto",{handler:function(){return 0===this.args.length?this.error("no passage specified"):(passage="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],Story.has(passage)?void setTimeout((function(){return Engine.play(passage)}),Engine.minDomActionDelay):this.error('passage "'.concat(passage,'" does not exist')));var passage}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){var delay,_this20=this;if(0===this.args.length)return this.error("no time value specified");try{delay=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(ex){return this.error(ex.message)}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper((function(){var frag=document.createDocumentFragment();new Wikifier(frag,_this20.payload[0].contents);var $output=$wrapper;transition&&($output=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-repeat-in")}),Engine.minDomActionDelay)})),delay)},registerInterval:function(callback,delay){var _this21=this;if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null;timerId=setInterval((function(){if(State.passage!==passage||State.turns!==turn)return clearInterval(timerId),void timers.delete(timerId);var timerIdCache;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(timerIdCache=TempState.repeatTimerId),TempState.repeatTimerId=timerId,callback.call(_this21)}finally{void 0!==timerIdCache?TempState.repeatTimerId=timerIdCache:delete TempState.repeatTimerId,TempState.break=null}}),delay),timers.add(timerId),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearInterval(timerId)})),timers.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var timers=Macro.get("repeat").timers,timerId=TempState.repeatTimerId;clearInterval(timerId),timers.delete(timerId),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,t8nRe:/^(?:transition|t8n)$/,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var i,items=[];try{items.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(ex){return this.error("".concat(ex.message," in <<timed>>"))}if(this.payload.length>1)try{var len;for(i=1,len=this.payload.length;i<len;++i)items.push({name:this.payload[i].name,source:this.payload[i].source,delay:0===this.payload[i].args.length?items[items.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[i].args[0])),content:this.payload[i].contents})}catch(ex){return this.error("".concat(ex.message," in <<next>> (#").concat(i,")"))}Config.debug&&this.debugView.modes({block:!0});var transition=this.args.length>1&&this.self.t8nRe.test(this.args[1]),$wrapper=jQuery(document.createElement("span")).addClass("macro-".concat(this.name)).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper((function(item){var frag=document.createDocumentFragment();new Wikifier(frag,item.content);var $output=$wrapper;Config.debug&&"next"===item.name&&($output=jQuery(new DebugView($output[0],"macro",item.name,item.source).output)),transition&&($output=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo($output)),$output.append(frag),transition&&setTimeout((function(){return $output.removeClass("macro-timed-in")}),Engine.minDomActionDelay)})),items)},registerTimeout:function(callback,items){if("function"!=typeof callback)throw new TypeError("callback parameter must be a function");var passage=State.passage,turn=State.turns,timers=this.timers,timerId=null,nextItem=items.shift();timerId=setTimeout((function worker(){if(timers.delete(timerId),State.passage===passage&&State.turns===turn){var curItem=nextItem;null!=(nextItem=items.shift())&&(timerId=setTimeout(worker,nextItem.delay),timers.add(timerId)),callback.call(this,curItem)}}),nextItem.delay),timers.add(timerId),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(task){delete prehistory[task],timers.forEach((function(timerId){return clearTimeout(timerId)})),timers.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var widgetCode,widgetName=this.args[0],isNonVoid=this.args.length>1&&"container"===this.args[1];if(Macro.has(widgetName)){if(!Macro.get(widgetName).isWidget)return this.error('cannot clobber existing macro "'.concat(widgetName,'"'));Macro.delete(widgetName)}try{var widgetDef={isWidget:!0,handler:(widgetCode=this.payload[0].contents,function(){var shadowStore={};State.temporary.hasOwnProperty("args")&&(shadowStore._args=State.temporary.args),State.temporary.args=_toConsumableArray(this.args),State.temporary.args.raw=this.args.raw,State.temporary.args.full=this.args.full,this.addShadow("_args"),isNonVoid&&(State.temporary.hasOwnProperty("contents")&&(shadowStore._contents=State.temporary.contents),State.temporary.contents=this.payload[0].contents,this.addShadow("_contents")),State.variables.hasOwnProperty("args")&&(shadowStore.$args=State.variables.args),State.variables.args=State.temporary.args,this.addShadow("$args");try{var resFrag=document.createDocumentFragment(),errList=[];if(new Wikifier(resFrag,widgetCode),Array.from(resFrag.querySelectorAll(".error")).forEach((function(errEl){errList.push(errEl.textContent)})),0!==errList.length)return this.error("error".concat(errList.length>1?"s":""," within widget code (").concat(errList.join("; "),")"));this.output.appendChild(resFrag)}catch(ex){return this.error("cannot execute widget: ".concat(ex.message))}finally{shadowStore.hasOwnProperty("_args")?State.temporary.args=shadowStore._args:delete State.temporary.args,isNonVoid&&(shadowStore.hasOwnProperty("_contents")?State.temporary.contents=shadowStore._contents:delete State.temporary.contents),shadowStore.hasOwnProperty("$args")?State.variables.args=shadowStore.$args:delete State.variables.args}})};isNonVoid&&(widgetDef.tags=[]),Macro.add(widgetName,widgetDef),Config.debug&&this.debugView.modes({hidden:!0})}catch(ex){return this.error('cannot create widget macro "'.concat(widgetName,'": ').concat(ex.message))}}})}();var Dialog=function(){var _$overlay=null,_$dialog=null,_$dialogTitle=null,_$dialogBody=null,_lastActive=null,_scrollbarWidth=0,_dialogObserver=null;function dialogClose(ev){return _$dialogBody.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),_dialogObserver?(_dialogObserver.disconnect(),_dialogObserver=null):_$dialogBody.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),_$dialog.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),_$overlay.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),_$dialogTitle.empty(),_$dialogBody.empty().removeClass(),null!==_lastActive&&(jQuery(_lastActive).focus(),_lastActive=null),ev&&ev.data&&"function"==typeof ev.data.closeFn&&ev.data.closeFn(ev),_$dialogBody.trigger(":dialogclose"),_$dialogBody.trigger(":dialogclosed"),Dialog}function dialogIsOpen(classNames){return _$dialog.hasClass("open")&&(!classNames||classNames.splitOrEmpty(/\s+/).every((function(cn){return _$dialogBody.hasClass(cn)})))}function dialogOpen(options,closeFn){_$dialogBody.trigger(":dialogopening");var top=jQuery.extend({top:50},options).top;return dialogIsOpen()||(_lastActive=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),_$overlay.addClass("open"),null!==_$dialogBody[0].querySelector("img")&&_$dialogBody.imagesLoaded().always((function(){return _resizeHandler({data:{top:top}})})),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),_$dialog.css(_calcPosition(top)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),Has.mutationObserver?(_dialogObserver=new MutationObserver((function(mutations){for(var i=0;i<mutations.length;++i)if("childList"===mutations[i].type){_resizeHandler({data:{top:top}});break}}))).observe(_$dialogBody[0],{childList:!0,subtree:!0}):_$dialogBody.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:top},jQuery.throttle(40,_resizeHandler)),jQuery(document).one("click.dialog-close",".ui-close",{closeFn:closeFn},(function(ev){dialogClose(ev)})).one("keypress.dialog-close",".ui-close",(function(ev){13!==ev.which&&32!==ev.which||jQuery(this).trigger("click")})),_$dialogBody.trigger(":dialogopen"),_$dialogBody.trigger(":dialogopened"),Dialog}function _calcPosition(topPos){var top=null!=topPos?topPos:50,$parent=jQuery(window),dialogPos={left:"",right:"",top:"",bottom:""};_$dialog.css(dialogPos);var horzSpace=$parent.width()-_$dialog.outerWidth(!0)-1,vertSpace=$parent.height()-_$dialog.outerHeight(!0)-1;return horzSpace<=32+_scrollbarWidth&&(vertSpace-=_scrollbarWidth),vertSpace<=32+_scrollbarWidth&&(horzSpace-=_scrollbarWidth),dialogPos.left=dialogPos.right=horzSpace<=32?16:horzSpace/2>>0,dialogPos.top=vertSpace<=32?dialogPos.bottom=16:vertSpace/2>top?top:dialogPos.bottom=vertSpace/2>>0,Object.keys(dialogPos).forEach((function(key){""!==dialogPos[key]&&(dialogPos[key]+="px")})),dialogPos}function _resizeHandler(ev){var top=ev&&ev.data&&void 0!==ev.data.top?ev.data.top:50;"block"===_$dialog.css("display")&&(_$dialog.css({display:"none"}),_$dialog.css(jQuery.extend({display:""},_calcPosition(top))))}return Object.freeze(Object.defineProperties({},{append:{value:function(){var _$dialogBody2;return(_$dialogBody2=_$dialogBody).append.apply(_$dialogBody2,arguments),Dialog}},body:{value:function(){return _$dialogBody.get(0)}},close:{value:dialogClose},init:{value:function(){if(!document.getElementById("ui-dialog")){_scrollbarWidth=function(){var scrollbarWidth;try{var inner=document.createElement("p"),outer=document.createElement("div");inner.style.width="100%",inner.style.height="200px",outer.style.position="absolute",outer.style.left="0px",outer.style.top="0px",outer.style.width="100px",outer.style.height="100px",outer.style.visibility="hidden",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="auto";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),document.body.removeChild(outer),scrollbarWidth=w1-w2}catch(ex){}return scrollbarWidth||17}();var $elems=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1>'+'<button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'.concat(L10n.get("close"),'"></button>')+'</div><div id="ui-dialog-body"></div></div>');_$overlay=jQuery($elems.find("#ui-overlay").get(0)),_$dialog=jQuery($elems.find("#ui-dialog").get(0)),_$dialogTitle=jQuery($elems.find("#ui-dialog-title").get(0)),_$dialogBody=jQuery($elems.find("#ui-dialog-body").get(0)),$elems.insertBefore("body>script#script-sugarcube")}}},isOpen:{value:dialogIsOpen},open:{value:dialogOpen},resize:{value:function(data){return _resizeHandler("object"===_typeof(data)?{data:data}:undefined)}},setup:{value:function(title,classNames){return _$dialogBody.empty().removeClass(),null!=classNames&&_$dialogBody.addClass(classNames),_$dialogTitle.empty().append((null!=title?String(title):"")||" "),_$dialogBody.get(0)}},wiki:{value:function(){var _$dialogBody3;return(_$dialogBody3=_$dialogBody).wiki.apply(_$dialogBody3,arguments),Dialog}},addClickHandler:{value:function(targets,options,startFn,doneFn,closeFn){return jQuery(targets).ariaClick((function(ev){ev.preventDefault(),"function"==typeof startFn&&startFn(ev),dialogOpen(options,closeFn),"function"==typeof doneFn&&doneFn(ev)}))}}}))}(),Engine=function(){var States=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),_initDebugViews=[],_state=States.Idle,_lastPlay=null,_outlinePatch=null,_updating=null;function engineGo(offset){var succeded=State.go(offset);return succeded&&engineShow(),succeded}function engineShow(){return enginePlay(State.passage,!0)}function enginePlay(title,noHistory){var passageReadyOutput,passageDoneOutput,passageTitle=title;if(_state=States.Playing,TempState={},State.clearTemporary(),"function"==typeof Config.navigation.override)try{var overrideTitle=Config.navigation.override(passageTitle);overrideTitle&&(passageTitle=overrideTitle)}catch(ex){}var passage=Story.get(passageTitle);if(jQuery.event.trigger({type:":passageinit",passage:passage}),Object.keys(prehistory).forEach((function(task){"function"==typeof prehistory[task]&&prehistory[task].call(passage,task)})),noHistory||State.create(passage.title),document.body.className&&(document.body.className=""),_lastPlay=Util.now(),Object.keys(predisplay).forEach((function(task){"function"==typeof predisplay[task]&&predisplay[task].call(passage,task)})),Story.has("PassageReady"))try{passageReadyOutput=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(ex){console.error(ex),Alert.error("PassageReady",ex.message)}_state=States.Rendering;var dataTags=passage.tags.length>0?passage.tags.join(" "):null,passageEl=document.createElement("div");jQuery(passageEl).attr({id:passage.domId,"data-passage":passage.title,"data-tags":dataTags}).addClass("passage ".concat(passage.className)),jQuery(document.body).attr("data-tags",dataTags).addClass(passage.className),jQuery(document.documentElement).attr("data-tags",dataTags),jQuery.event.trigger({type:":passagestart",content:passageEl,passage:passage}),Object.keys(prerender).forEach((function(task){"function"==typeof prerender[task]&&prerender[task].call(passage,passageEl,task)})),Story.has("PassageHeader")&&new Wikifier(passageEl,Story.get("PassageHeader").processText()),passageEl.appendChild(passage.render()),Story.has("PassageFooter")&&new Wikifier(passageEl,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:passageEl,passage:passage}),Object.keys(postrender).forEach((function(task){"function"==typeof postrender[task]&&postrender[task].call(passage,passageEl,task)}));var debugView,containerEl=document.getElementById("passages");if(containerEl.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?_toConsumableArray(containerEl.childNodes).forEach((function(outgoing){var $outgoing=jQuery(outgoing);if(outgoing.nodeType===Node.ELEMENT_NODE&&$outgoing.hasClass("passage")){if($outgoing.hasClass("passage-out"))return;$outgoing.attr({id:"out-".concat($outgoing.attr("id")),"aria-live":"off"}).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?$outgoing.on(Has.transitionEndEvent,(function(ev){ev.propertyName===Config.passages.transitionOut&&$outgoing.remove()})):setTimeout((function(){return $outgoing.remove()}),Math.max(40,Config.passages.transitionOut))}else $outgoing.remove()})):jQuery(containerEl).empty()),jQuery(passageEl).addClass("passage-in").appendTo(containerEl),setTimeout((function(){return jQuery(passageEl).removeClass("passage-in")}),40),Story.has("StoryDisplayTitle")?null===_updating&&Config.ui.updateStoryElements||setDisplayTitle(Story.get("StoryDisplayTitle").processText()):Config.passages.displayTitles&&passage.title!==Config.passages.start&&(document.title="".concat(passage.title," | ").concat(Story.title)),window.scroll(0,0),_state=States.Playing,Story.has("PassageDone"))try{passageDoneOutput=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(ex){console.error(ex),Alert.error("PassageDone",ex.message)}(jQuery.event.trigger({type:":passagedisplay",content:passageEl,passage:passage}),Object.keys(postdisplay).forEach((function(task){"function"==typeof postdisplay[task]&&postdisplay[task].call(passage,task)})),null!==_updating?_updating.forEach((function(pair){jQuery(pair.element).empty(),new Wikifier(pair.element,Story.get(pair.passage).processText().trim())})):Config.ui.updateStoryElements&&UIBar.update(),Config.debug)&&(null!=passageReadyOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady")).modes({hidden:!0}),debugView.append(passageReadyOutput),jQuery(passageEl).prepend(debugView.output)),null!=passageDoneOutput&&((debugView=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone")).modes({hidden:!0}),debugView.append(passageDoneOutput),jQuery(passageEl).append(debugView.output)),1===State.turns&&_initDebugViews.length>0&&jQuery(passageEl).prepend(_initDebugViews));switch(jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":passage.tags.some((function(tag){return Config.saves.autosave.includes(tag)}))&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",content:passageEl,passage:passage}),_state=States.Idle,_lastPlay=Util.now(),passageEl}function _hideOutlines(){_outlinePatch.set("*:focus{outline:none;}")}return Object.freeze(Object.defineProperties({},{States:{value:States},minDomActionDelay:{value:40},init:{value:function(){var _lastOutlineEvent;jQuery("#init-no-js,#init-lacking").remove(),function(){var $elems=jQuery(document.createDocumentFragment()),markup=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(markup){UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),$elems.append(markup);var $passages=$elems.find("#passages");if(0===$passages.length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');$passages.empty().not("[aria-live]").attr("aria-live","polite").end(),$elems.find("[data-init-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-init-passage" content attribute'));var passage=el.getAttribute("data-init-passage").trim();if(el.hasAttribute("data-passage"))throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> must not contain a "data-passage" content attribute'));if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-init-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&jQuery(el).empty().wiki(Story.get(passage).processText().trim())}));var updating=[];$elems.find("[data-passage]").each((function(i,el){if("passages"===el.id)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' id="passages"> must not contain a "data-passage" content attribute'));var passage=el.getAttribute("data-passage").trim();if(null!==el.firstElementChild)throw new Error('"StoryInterface" element <'.concat(el.nodeName.toLowerCase(),' data-passage="').concat(passage,'"> contains child elements'));Story.has(passage)&&updating.push({passage:passage,element:el})})),updating.length>0&&(_updating=updating),Config.ui.updateStoryElements=!1}else $elems.append('<div id="story" role="main"><div id="passages" aria-live="polite"></div></div>');$elems.insertBefore("body>script#script-sugarcube")}(),_outlinePatch=new StyleWrapper(jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)),_hideOutlines(),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",(function(ev){ev.type!==_lastOutlineEvent&&(_lastOutlineEvent=ev.type,"keydown"===ev.type?_outlinePatch.clear():_hideOutlines())}))}},start:{value:function(){if(Story.getAllInit().forEach((function(passage){try{var debugBuffer=Wikifier.wikifyEval(passage.text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","".concat(passage.title," [init-tagged]"),"".concat(passage.title," [init-tagged]"));debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("".concat(passage.title," [init-tagged]"),"object"===_typeof(ex)?ex.message:ex)}})),Story.has("StoryInit"))try{var debugBuffer=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var debugView=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");debugView.modes({hidden:!0}),debugView.append(debugBuffer),_initDebugViews.push(debugView.output)}}catch(ex){console.error(ex),Alert.error("StoryInit","object"===_typeof(ex)?ex.message:ex)}if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'.concat(Config.passages.start,'") not found'));if(jQuery(document.documentElement).focus(),State.restore())engineShow();else{var loadStart=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(loadStart=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(loadStart=!Save.autosave.load())}loadStart&&enginePlay(Config.passages.start)}}},restart:{value:function(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}},state:{get:function(){return _state}},isIdle:{value:function(){return _state===States.Idle}},isPlaying:{value:function(){return _state!==States.Idle}},isRendering:{value:function(){return _state===States.Rendering}},lastPlay:{get:function(){return _lastPlay}},goTo:{value:function(idx){var succeded=State.goTo(idx);return succeded&&engineShow(),succeded}},go:{value:engineGo},backward:{value:function(){return engineGo(-1)}},forward:{value:function(){return engineGo(1)}},show:{value:engineShow},play:{value:enginePlay},display:{value:function(title,link,option){var noHistory=!1;switch(option){case undefined:break;case"replace":case"back":noHistory=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'.concat(option,'"; please notify the developer'))}enginePlay(title,noHistory)}}}))}(),Passage=(_tagsToSkip=/^(?:debug|nobr|passage|widget|twine\..*)$/i,function(){function Passage(title,el){var _this22=this;_classCallCheck(this,Passage),Object.defineProperties(this,{title:{value:Util.unescape(title)},element:{value:el||null},tags:{value:Object.freeze(el&&el.hasAttribute("tags")?Array.from(new Set(el.getAttribute("tags").trim().splitOrEmpty(/\s+/))):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-".concat(Util.slugify(this.title))},classes:{value:Object.freeze(0===this.tags.length?[]:_this22.tags.filter((function(tag){return!_tagsToSkip.test(tag)})).map((function(tag){return Util.slugify(tag)})))}})}return _createClass(Passage,[{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var passage=Util.escapeMarkup(this.title),mesg="".concat(L10n.get("errorTitle"),": ").concat(L10n.get("errorNonexistentPassage",{passage:passage}));return'<div class="error-view"><span class="error">'.concat(mesg,"</span></div>")}return this.element.textContent.replace(/\r/g,"")}},{key:"description",value:function(){var descriptions=Config.passages.descriptions;switch(_typeof(descriptions)){case"boolean":if(descriptions)return this.title;break;case"object":if(descriptions.hasOwnProperty(this.title))return descriptions[this.title];break;case"function":var result=descriptions.call(this);if(result)return result}return null===this._excerpt&&(this._excerpt=Passage.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img[".concat(this.text,"]]");var processed=this.text;return Config.passages.onProcess&&(processed=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:processed})),(Config.passages.nobr||this.tags.includes("nobr"))&&(processed=processed.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),processed}},{key:"render",value:function(options){var frag=document.createDocumentFragment();return new Wikifier(frag,this.processText(),options),this._excerpt=Passage.getExcerptFromNode(frag),frag}}],[{key:"getExcerptFromNode",value:function(node,count){if(!node.hasChildNodes())return"";var excerpt=node.textContent.trim();if(""!==excerpt){var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})"));excerpt=excerpt.replace(/\s+/g," ").match(excerptRe)}return excerpt?"".concat(excerpt[1],"…"):"…"}},{key:"getExcerptFromText",value:function(text,count){if(""===text)return"";var excerptRe=new RegExp("(\\S+(?:\\s+\\S+){0,".concat(count>0?count-1:7,"})")),excerpt=text.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(excerptRe);return excerpt?"".concat(excerpt[1],"…"):"…"}}]),Passage}()),_tagsToSkip,Save=function(){var Type=Util.toEnum({Autosave:"autosave",Disk:"disk",Serialize:"serialize",Slot:"slot"}),_slotsUBound=-1,_onLoadHandlers=new Set,_onSaveHandlers=new Set;function savesObjGet(){var saves=storage.get("saves");return null===saves?{autosave:null,slots:_appendSlots([],Config.saves.slots)}:saves}function savesObjClear(){return storage.delete("saves"),!0}function autosaveOk(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function slotsOk(){return"cookie"!==storage.name&&-1!==_slotsUBound}function slotsCount(){if(!slotsOk())return 0;for(var saves=savesObjGet(),count=0,i=0,iend=saves.slots.length;i<iend;++i)null!==saves.slots[i]&&++count;return count}function _appendSlots(array,num){for(var i=0;i<num;++i)array.push(null);return array}function _savesObjIsEmpty(saves){for(var slots=saves.slots,isSlotsEmpty=!0,i=0,iend=slots.length;i<iend;++i)if(null!==slots[i]){isSlotsEmpty=!1;break}return null===saves.autosave&&isSlotsEmpty}function _savesObjSave(saves){return _savesObjIsEmpty(saves)?(storage.delete("saves"),!0):storage.set("saves",saves)}function _savesObjUpdate(saveObj){if(null==saveObj||"object"!==_typeof(saveObj))return!1;var updated=!1;return saveObj.hasOwnProperty("state")&&saveObj.state.hasOwnProperty("delta")&&saveObj.state.hasOwnProperty("index")||(saveObj.hasOwnProperty("data")?(delete saveObj.mode,saveObj.state={delta:State.deltaEncode(saveObj.data)},delete saveObj.data):saveObj.state.hasOwnProperty("delta")?saveObj.state.hasOwnProperty("index")||delete saveObj.state.mode:(delete saveObj.state.mode,saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history),saveObj.state.index=saveObj.state.delta.length-1,updated=!0),saveObj.state.hasOwnProperty("rseed")&&(saveObj.state.seed=saveObj.state.rseed,delete saveObj.state.rseed,saveObj.state.delta.forEach((function(_,i,delta){delta[i].hasOwnProperty("rcount")&&(delta[i].pull=delta[i].rcount,delete delta[i].rcount)})),updated=!0),(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired||saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.hasOwnProperty("expired")&&"number"==typeof saveObj.state.expired&&delete saveObj.state.expired,(saveObj.state.hasOwnProperty("unique")||saveObj.state.hasOwnProperty("last"))&&(saveObj.state.expired=[],saveObj.state.hasOwnProperty("unique")&&(saveObj.state.expired.push(saveObj.state.unique),delete saveObj.state.unique),saveObj.state.hasOwnProperty("last")&&(saveObj.state.expired.push(saveObj.state.last),delete saveObj.state.last)),updated=!0),updated}function _marshal(supplemental,details){if(null!=supplemental&&"object"!==_typeof(supplemental))throw new Error("supplemental parameter must be an object");var saveObj=Object.assign({},supplemental,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(saveObj.version=Config.saves.version),_onSaveHandlers.forEach((function(fn){return fn(saveObj,details)})),saveObj.state.delta=State.deltaEncode(saveObj.state.history),delete saveObj.state.history,saveObj}function _unmarshal(saveObj){try{if(_savesObjUpdate(saveObj),!saveObj||!saveObj.hasOwnProperty("id")||!saveObj.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(saveObj.state.history=State.deltaDecode(saveObj.state.delta),delete saveObj.state.delta,_onLoadHandlers.forEach((function(fn){return fn(saveObj)})),saveObj.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(saveObj.state),Engine.show()}catch(ex){return UI.alert("".concat(ex.message.toUpperFirst(),".</p><p>").concat(L10n.get("aborting"),".")),!1}return!0}return Object.freeze(Object.defineProperties({},{init:{value:function(){if("cookie"===storage.name)return savesObjClear(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.slots=0,!1;var saves=savesObjGet(),updated=!1;Array.isArray(saves)&&(saves={autosave:null,slots:saves},updated=!0),Config.saves.slots!==saves.slots.length&&(Config.saves.slots<saves.slots.length?(saves.slots.reverse(),saves.slots=saves.slots.filter((function(val){return!(null===val&&this.count>0)||(--this.count,!1)}),{count:saves.slots.length-Config.saves.slots}),saves.slots.reverse()):Config.saves.slots>saves.slots.length&&_appendSlots(saves.slots,Config.saves.slots-saves.slots.length),updated=!0),_savesObjUpdate(saves.autosave)&&(updated=!0);for(var i=0;i<saves.slots.length;++i)_savesObjUpdate(saves.slots[i])&&(updated=!0);return _savesObjIsEmpty(saves)&&(storage.delete("saves"),updated=!1),updated&&_savesObjSave(saves),_slotsUBound=saves.slots.length-1,!0}},get:{value:savesObjGet},clear:{value:savesObjClear},ok:{value:function(){return autosaveOk()||slotsOk()}},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:autosaveOk},has:{value:function(){return null!==savesObjGet().autosave}},get:{value:function(){return savesObjGet().autosave}},load:{value:function(){var saves=savesObjGet();return null!==saves.autosave&&_unmarshal(saves.autosave)}},save:{value:function(title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var saves=savesObjGet(),supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.autosave=_marshal(supplemental,{type:Type.Autosave}),_savesObjSave(saves)}},delete:{value:function(){var saves=savesObjGet();return saves.autosave=null,_savesObjSave(saves)}}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:slotsOk},length:{get:function(){return _slotsUBound+1}},isEmpty:{value:function(){return 0===slotsCount()}},count:{value:slotsCount},has:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])}},get:{value:function(slot){if(slot<0||slot>_slotsUBound)return null;var saves=savesObjGet();return slot>=saves.slots.length?null:saves.slots[slot]}},load:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length||null===saves.slots[slot])&&_unmarshal(saves.slots[slot])}},save:{value:function(slot,title,metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),!1;if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();if(slot>=saves.slots.length)return!1;var supplemental={title:title||Story.get(State.passage).description(),date:Date.now()};return null!=metadata&&(supplemental.metadata=metadata),saves.slots[slot]=_marshal(supplemental,{type:Type.Slot}),_savesObjSave(saves)}},delete:{value:function(slot){if(slot<0||slot>_slotsUBound)return!1;var saves=savesObjGet();return!(slot>=saves.slots.length)&&(saves.slots[slot]=null,_savesObjSave(saves))}}}))},export:{value:function(filename,metadata){if("function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed()){var str,now,MM,DD,hh,mm,ss,baseName=null==filename?Story.domId:(str=filename,Util.sanitizeFilename(str).replace(/[_\s\u2013\u2014-]+/g,"-")),saveName="".concat(baseName,"-").concat((now=new Date,MM=now.getMonth()+1,DD=now.getDate(),hh=now.getHours(),mm=now.getMinutes(),ss=now.getSeconds(),MM<10&&(MM="0".concat(MM)),DD<10&&(DD="0".concat(DD)),hh<10&&(hh="0".concat(hh)),mm<10&&(mm="0".concat(mm)),ss<10&&(ss="0".concat(ss)),"".concat(now.getFullYear()).concat(MM).concat(DD,"-").concat(hh).concat(mm).concat(ss)),".save"),supplemental=null==metadata?{}:{metadata:metadata},saveObj=LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Disk})));saveAs(new Blob([saveObj],{type:"text/plain;charset=UTF-8"}),saveName)}else Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed"))}},import:{value:function(event){var file=event.target.files[0],reader=new FileReader;jQuery(reader).one("loadend",(function(){if(reader.error){var ex=reader.error;UI.alert("".concat(L10n.get("errorSaveDiskLoadFailed").toUpperFirst()," (").concat(ex.name,": ").concat(ex.message,").</p><p>").concat(L10n.get("aborting"),"."))}else{var saveObj;try{saveObj=JSON.parse(/\.json$/i.test(file.name)||/^\{/.test(reader.result)?reader.result:LZString.decompressFromBase64(reader.result))}catch(ex){}_unmarshal(saveObj)}})),reader.readAsText(file)}},serialize:{value:function(metadata){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",(function(){return UI.alert(L10n.get("savesDisallowed"))})):UI.alert(L10n.get("savesDisallowed")),null;var supplemental=null==metadata?{}:{metadata:metadata};return LZString.compressToBase64(JSON.stringify(_marshal(supplemental,{type:Type.Serialize})))}},deserialize:{value:function(base64Str){var saveObj;try{saveObj=JSON.parse(LZString.decompressFromBase64(base64Str))}catch(ex){}return _unmarshal(saveObj)?saveObj.metadata:null}},onLoad:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onLoad.add handler parameter must be a function (received: ".concat(valueType,")"));_onLoadHandlers.add(handler)}},clear:{value:function(){_onLoadHandlers.clear()}},delete:{value:function(handler){return _onLoadHandlers.delete(handler)}},size:{get:function(){return _onLoadHandlers.size}}}))},onSave:{value:Object.freeze(Object.defineProperties({},{add:{value:function(handler){var valueType=Util.getType(handler);if("function"!==valueType)throw new TypeError("Save.onSave.add handler parameter must be a function (received: ".concat(valueType,")"));_onSaveHandlers.add(handler)}},clear:{value:function(){_onSaveHandlers.clear()}},delete:{value:function(handler){return _onSaveHandlers.delete(handler)}},size:{get:function(){return _onSaveHandlers.size}}}))}}))}(),Setting=function(){var Types=Util.toEnum({Header:0,Toggle:1,List:2,Range:3}),_definitions=[];function settingsCreate(){return Object.create(null)}function settingsSave(){var savedSettings=settingsCreate();return Object.keys(settings).length>0&&_definitions.filter((function(def){return def.type!==Types.Header&&settings[def.name]!==def.default})).forEach((function(def){return savedSettings[def.name]=settings[def.name]})),0===Object.keys(savedSettings).length?(storage.delete("settings"),!0):storage.set("settings",savedSettings)}function settingsLoad(){var defaultSettings=settingsCreate(),loadedSettings=storage.get("settings")||settingsCreate();_definitions.filter((function(def){return def.type!==Types.Header})).forEach((function(def){return defaultSettings[def.name]=def.default})),window.SugarCube.settings=settings=Object.assign(defaultSettings,loadedSettings)}function settingsClear(){return window.SugarCube.settings=settings=settingsCreate(),storage.delete("settings"),!0}function definitionsAdd(type,name,def){if(arguments.length<3){var errors=[];throw arguments.length<1&&errors.push("type"),arguments.length<2&&errors.push("name"),arguments.length<3&&errors.push("definition"),new Error("missing parameters, no ".concat(errors.join(" or ")," specified"))}if("object"!==_typeof(def))throw new TypeError("definition parameter must be an object");if(definitionsHas(name))throw new Error('cannot clobber existing setting "'.concat(name,'"'));var str,pos,definition={type:type,name:name,label:"string"==typeof def.label?def.label.trim():""};if("string"==typeof def.desc){var desc=def.desc.trim();""!==desc&&(definition.desc=desc)}switch(type){case Types.Header:break;case Types.Toggle:definition.default=!!def.default;break;case Types.List:if(!def.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(def.list))throw new TypeError("list must be an array");if(0===def.list.length)throw new Error("list must not be empty");if(definition.list=Object.freeze(def.list),null==def.default)definition.default=def.list[0];else{var defaultIndex=def.list.indexOf(def.default);if(-1===defaultIndex)throw new Error("list does not contain default");definition.default=def.list[defaultIndex]}break;case Types.Range:if(!def.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof def.min||Number.isNaN(def.min)||!Number.isFinite(def.min))throw new TypeError("min must be a finite number");if(!def.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof def.max||Number.isNaN(def.max)||!Number.isFinite(def.max))throw new TypeError("max must be a finite number");if(!def.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof def.step||Number.isNaN(def.step)||!Number.isFinite(def.step)||def.step<=0)throw new TypeError("step must be a finite number greater than zero");var stepValidate=function(value){if(fracDigits>0){var ma=Number("".concat(def.min,"e").concat(fracDigits)),sa=Number("".concat(def.step,"e").concat(fracDigits)),_va=Number("".concat(value,"e").concat(fracDigits))-ma;return Number("".concat(_va-_va%sa+ma,"e-").concat(fracDigits))}var va=value-def.min;return va-va%def.step+def.min},fracDigits=(str=String(def.step),-1===(pos=str.lastIndexOf("."))?0:str.length-pos-1);if(stepValidate(def.max)!==def.max)throw new RangeError("max (".concat(def.max,") is not a multiple of the step (").concat(def.step,") plus the min (").concat(def.min,")"));if(definition.max=def.max,definition.min=def.min,definition.step=def.step,null==def.default)definition.default=def.max;else{if("number"!=typeof def.default||Number.isNaN(def.default)||!Number.isFinite(def.default))throw new TypeError("default must be a finite number");if(def.default<def.min)throw new RangeError("default (".concat(def.default,") is less than min (").concat(def.min,")"));if(def.default>def.max)throw new RangeError("default (".concat(def.default,") is greater than max (").concat(def.max,")"));definition.default=def.default}break;default:throw new Error("unknown Setting type: ".concat(type))}"function"==typeof def.onInit&&(definition.onInit=Object.freeze(def.onInit)),"function"==typeof def.onChange&&(definition.onChange=Object.freeze(def.onChange)),_definitions.push(Object.freeze(definition))}function definitionsHas(name){return _definitions.some((function(definition){return definition.name===name}))}function definitionsGet(name){return _definitions.find((function(definition){return definition.name===name}))}return Object.freeze(Object.defineProperties({},{Types:{value:Types},init:{value:function(){if(storage.has("options")){var old=storage.get("options");null!==old&&(window.SugarCube.settings=settings=Object.assign(settingsCreate(),old)),settingsSave(),storage.delete("options")}settingsLoad(),_definitions.forEach((function(def){if(def.hasOwnProperty("onInit")){var thisArg={name:def.name,value:settings[def.name],default:def.default};def.hasOwnProperty("list")&&(thisArg.list=def.list),def.onInit.call(thisArg)}}))}},create:{value:settingsCreate},save:{value:settingsSave},load:{value:settingsLoad},clear:{value:settingsClear},reset:{value:function(name){if(0===arguments.length)settingsClear(),settingsLoad();else{if(null==name||!definitionsHas(name))throw new Error('nonexistent setting "'.concat(name,'"'));var def=definitionsGet(name);def.type!==Types.Header&&(settings[name]=def.default)}return settingsSave()}},forEach:{value:function(callback,thisArg){_definitions.forEach(callback,thisArg)}},add:{value:definitionsAdd},addHeader:{value:function(name,desc){definitionsAdd(Types.Header,name,{desc:desc})}},addToggle:{value:function(){for(var _len16=arguments.length,args=new Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];definitionsAdd.apply(void 0,[Types.Toggle].concat(args))}},addList:{value:function(){for(var _len17=arguments.length,args=new Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];definitionsAdd.apply(void 0,[Types.List].concat(args))}},addRange:{value:function(){for(var _len18=arguments.length,args=new Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];definitionsAdd.apply(void 0,[Types.Range].concat(args))}},isEmpty:{value:function(){return 0===_definitions.length}},has:{value:definitionsHas},get:{value:definitionsGet},delete:{value:function definitionsDelete(name){definitionsHas(name)&&delete settings[name];for(var i=0;i<_definitions.length;++i)if(_definitions[i].name===name){_definitions.splice(i,1),definitionsDelete(name);break}}}}))}(),Story=function(){var _passages={},_inits=[],_scripts=[],_styles=[],_widgets=[],_title="",_ifId="",_domId="";function _storySetTitle(rawTitle){if(null==rawTitle)throw new Error("story title must not be null or undefined");var title=Util.unescape(String(rawTitle)).trim();if(""===title)throw new Error("story title must not be empty or consist solely of whitespace");if(document.title=_title=title,""===(_domId=Util.slugify(_title)))if(""!==_ifId)_domId=_ifId;else for(var i=0,len=_title.length;i<len;++i){var _Util$charAndPosAt2=Util.charAndPosAt(_title,i),char=_Util$charAndPosAt2.char,start=_Util$charAndPosAt2.start,end=_Util$charAndPosAt2.end;_domId+=char.codePointAt(0).toString(16),i+=end-start}}return Object.freeze(Object.defineProperties({},{load:{value:function(){var validationCodeTags=["init","widget"],validationNoCodeTagPassages=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"];function validateStartingPassage(passage){if(passage.tags.includesAny(validationCodeTags))throw new Error('starting passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(passage.tags.filter((function(tag){return validationCodeTags.includes(tag)})).sort().join('", "'),'"'))}function validateSpecialPassages(passage){if(validationNoCodeTagPassages.includes(passage.title)){for(var _len19=arguments.length,tags=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++)tags[_key19-1]=arguments[_key19];throw new Error('special passage "'.concat(passage.title,'" contains special tags; invalid: "').concat(tags.sort().join('", "'),'"'))}var codeTags=[].concat(validationCodeTags),foundTags=[];if(passage.tags.forEach((function(tag){codeTags.includes(tag)&&foundTags.push.apply(foundTags,_toConsumableArray(codeTags.delete(tag)))})),foundTags.length>1)throw new Error('passage "'.concat(passage.title,'" contains multiple special tags; invalid: "').concat(foundTags.sort().join('", "'),'"'))}var $storydata=jQuery("tw-storydata"),startNode=$storydata.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test($storydata.attr("options")),$storydata.children("style").each((function(i){_styles.push(new Passage("tw-user-style-".concat(i),this))})),$storydata.children("script").each((function(i){_scripts.push(new Passage("tw-user-script-".concat(i),this))})),$storydata.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each((function(){var $this=jQuery(this),pid=$this.attr("pid")||"",passage=new Passage($this.attr("name"),this);pid===startNode&&""!==startNode?(Config.passages.start=passage.title,validateStartingPassage(passage),_passages[passage.title]=passage):passage.tags.includes("init")?(validateSpecialPassages(passage,"init"),_inits.push(passage)):passage.tags.includes("widget")?(validateSpecialPassages(passage,"widget"),_widgets.push(passage)):_passages[passage.title]=passage})),_ifId=$storydata.attr("ifid"),_storySetTitle("Fanthira Tales: wRight on cue"),Config.saves.id=Story.domId}},init:{value:function(){var storyStyle;storyStyle=document.createElement("style"),new StyleWrapper(storyStyle).add(_styles.map((function(style){return style.text.trim()})).join("\n")),jQuery(storyStyle).appendTo(document.head).attr({id:"style-story",type:"text/css"});for(var i=0;i<_scripts.length;++i)try{Scripting.evalJavaScript(_scripts[i].text)}catch(ex){console.error(ex),Alert.error(_scripts[i].title,"object"===_typeof(ex)?ex.message:ex)}for(var _i8=0;_i8<_widgets.length;++_i8)try{Wikifier.wikifyEval(_widgets[_i8].processText())}catch(ex){console.error(ex),Alert.error(_widgets[_i8].title,"object"===_typeof(ex)?ex.message:ex)}}},title:{get:function(){return _title}},domId:{get:function(){return _domId}},ifId:{get:function(){return _ifId}},add:{value:function(passage){if(!(passage instanceof Passage))throw new TypeError("Story.add passage parameter must be an instance of Passage");var title=passage.title;return!_passages.hasOwnProperty(title)&&(_passages[title]=passage,!0)}},has:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":return _passages.hasOwnProperty(String(title));case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.has title parameter cannot be ".concat(type))}},get:{value:function(title){var type=_typeof(title);switch(type){case"number":case"string":var id=String(title);return _passages.hasOwnProperty(id)?_passages[id]:new Passage(id||"(unknown)");case"undefined":break;case"object":type=null===title?"null":"an object";break;default:type="a ".concat(type)}throw new TypeError("Story.get title parameter cannot be ".concat(type))}},getAllInit:{value:function(){return Object.freeze(Array.from(_inits))}},getAllRegular:{value:function(){return Object.freeze(Object.assign({},_passages))}},getAllScript:{value:function(){return Object.freeze(Array.from(_scripts))}},getAllStylesheet:{value:function(){return Object.freeze(Array.from(_styles))}},getAllWidget:{value:function(){return Object.freeze(Array.from(_widgets))}},lookup:{value:function(key,value){var sortKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];"object"===_typeof(passage[key])&&null!==passage[key]?passage[key]instanceof Array&&passage[key].some((function(m){return Util.sameValueZero(m,value)}))&&results.push(passage):Util.sameValueZero(passage[key],value)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}},lookupWith:{value:function(predicate){var sortKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof predicate)throw new TypeError("Story.lookupWith predicate parameter must be a function");var results=[];return Object.keys(_passages).forEach((function(name){var passage=_passages[name];predicate(passage)&&results.push(passage)})),results.sort((function(a,b){return a[sortKey]==b[sortKey]?0:a[sortKey]<b[sortKey]?-1:1})),results}}}))}(),UI=function(){function uiAssembleLinkList(passage,listEl){var list=listEl,debugState=Config.debug,cleanState=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==list&&(list=document.createElement("ul"));var frag=document.createDocumentFragment();new Wikifier(frag,Story.get(passage).processText().trim());var errors=_toConsumableArray(frag.querySelectorAll(".error")).map((function(errEl){return errEl.textContent.replace(errorPrologRegExp,"")}));if(errors.length>0)throw new Error(errors.join("; "));for(;frag.hasChildNodes();){var node=frag.firstChild;if(node.nodeType===Node.ELEMENT_NODE&&"A"===node.nodeName.toUpperCase()){var li=document.createElement("li");list.appendChild(li),li.appendChild(node)}else frag.removeChild(node)}}finally{Config.cleanupWikifierOutput=cleanState,Config.debug=debugState}return list}function uiOpenAlert(message){jQuery(Dialog.setup(L10n.get("alertTitle"),"alert")).append("<p>".concat(message,'</p><ul class="buttons">')+'<li><button id="alert-ok" class="ui-close">'.concat(L10n.get(["alertOk","ok"]),"</button></li>")+"</ul>");for(var _len20=arguments.length,args=new Array(_len20>1?_len20-1:0),_key20=1;_key20<_len20;_key20++)args[_key20-1]=arguments[_key20];Dialog.open.apply(Dialog,args)}function uiBuildAutoload(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>".concat(L10n.get("autoloadPrompt"),'</p><ul class="buttons">')+'<li><button id="autoload-ok" class="ui-close">'.concat(L10n.get(["autoloadOk","ok"]),"</button></li>")+'<li><button id="autoload-cancel" class="ui-close">'.concat(L10n.get(["autoloadCancel","cancel"]),"</button></li>")+"</ul>"),jQuery(document).one("click.autoload",".ui-close",(function(ev){var isAutoloadOk="autoload-ok"===ev.target.id;jQuery(document).one(":dialogclosed",(function(){isAutoloadOk&&Save.autosave.load()||Engine.play(Config.passages.start)}))})),!0}function uiBuildJumpto(){var list=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(list);for(var expired=State.expired.length,i=State.size-1;i>=0;--i)if(i!==State.activeIndex){var passage=Story.get(State.history[i].title);passage&&passage.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(idx){return function(){return jQuery(document).one(":dialogclosed",(function(){return Engine.goTo(idx)}))}}(i)).addClass("ui-close").text("".concat(L10n.get("jumptoTurn")," ").concat(expired+i+1,": ").concat(passage.description()))).appendTo(list)}list.hasChildNodes()||jQuery(list).append("<li><a><em>".concat(L10n.get("jumptoUnavailable"),"</em></a></li>"))}function uiBuildRestart(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>".concat(L10n.get("restartPrompt"),'</p><ul class="buttons">')+'<li><button id="restart-ok">'.concat(L10n.get(["restartOk","ok"]),"</button></li>")+'<li><button id="restart-cancel" class="ui-close">'.concat(L10n.get(["restartCancel","cancel"]),"</button></li>")+"</ul>").find("#restart-ok").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){return Engine.restart()})),Dialog.close()})),!0}function uiBuildSaves(){var savesAllowed="function"!=typeof Config.saves.isAllowed||Config.saves.isAllowed();function createActionItem(bId,bClass,bText,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId)).html(bText);return bClass&&$btn.addClass(bClass),bAction?$btn.ariaClick(bAction):$btn.ariaDisabled(!0),jQuery(document.createElement("li")).append($btn)}var $dialogBody=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),savesOk=Save.ok(),fileOk=Has.fileAPI&&(Config.saves.tryDiskOnMobile||!Browser.isMobile.any());if(savesOk&&$dialogBody.append(function(){function createButton(bId,bClass,bText,bSlot,bAction){var $btn=jQuery(document.createElement("button")).attr("id","saves-".concat(bId,"-").concat(bSlot)).addClass(bId).html(bText);return bClass&&$btn.addClass(bClass),bAction?"auto"===bSlot?$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelAuto"))},(function(){return bAction()})):$btn.ariaClick({label:"".concat(bText," ").concat(L10n.get("savesLabelSlot")," ").concat(bSlot+1)},(function(){return bAction(bSlot)})):$btn.ariaDisabled(!0),$btn}var saves=Save.get(),$tbody=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var $tdSlot=jQuery(document.createElement("td")),$tdLoad=jQuery(document.createElement("td")),$tdDesc=jQuery(document.createElement("td")),$tdDele=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo($tdSlot),saves.autosave?($tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),"auto",(function(){jQuery(document).one(":dialogclosed",(function(){return Save.autosave.load()}))}))),jQuery(document.createElement("div")).text(saves.autosave.title).appendTo($tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.autosave.date?"".concat(new Date(saves.autosave.date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo($tdDesc),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto",(function(){Save.autosave.delete(),uiBuildSaves()})))):($tdLoad.append(createButton("load",null,L10n.get("savesLabelLoad"),"auto")),$tdDesc.addClass("empty").text("•  •  •"),$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append($tdSlot).append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody)}for(var i=0,iend=saves.slots.length;i<iend;++i){var _$tdSlot=jQuery(document.createElement("td")),_$tdLoad=jQuery(document.createElement("td")),_$tdDesc=jQuery(document.createElement("td")),_$tdDele=jQuery(document.createElement("td"));_$tdSlot.append(document.createTextNode(i+1)),saves.slots[i]?(_$tdLoad.append(createButton("load","ui-close",L10n.get("savesLabelLoad"),i,(function(slot){jQuery(document).one(":dialogclosed",(function(){return Save.slots.load(slot)}))}))),jQuery(document.createElement("div")).text(saves.slots[i].title).appendTo(_$tdDesc),jQuery(document.createElement("div")).addClass("datestamp").html(saves.slots[i].date?"".concat(new Date(saves.slots[i].date).toLocaleString()):"<em>".concat(L10n.get("savesUnknownDate"),"</em>")).appendTo(_$tdDesc),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i,(function(slot){Save.slots.delete(slot),uiBuildSaves()})))):(_$tdLoad.append(createButton("save","ui-close",L10n.get("savesLabelSave"),i,savesAllowed?Save.slots.save:null)),_$tdDesc.addClass("empty").text("•  •  •"),_$tdDele.append(createButton("delete",null,L10n.get("savesLabelDelete"),i))),jQuery(document.createElement("tr")).append(_$tdSlot).append(_$tdLoad).append(_$tdDesc).append(_$tdDele).appendTo($tbody)}return jQuery(document.createElement("table")).attr("id","saves-list").append($tbody)}()),savesOk||fileOk){var $btnBar=jQuery(document.createElement("ul")).addClass("buttons").appendTo($dialogBody);return fileOk&&($btnBar.append(createActionItem("export","ui-close",L10n.get("savesLabelExport"),savesAllowed?function(){return Save.export()}:null)),$btnBar.append(createActionItem("import",null,L10n.get("savesLabelImport"),(function(){return $dialogBody.find("#saves-import-file").trigger("click")}))),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",(function(ev){jQuery(document).one(":dialogclosed",(function(){return Save.import(ev)})),Dialog.close()})).appendTo($dialogBody)),savesOk&&$btnBar.append(createActionItem("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),uiBuildSaves()}:null)),!0}return uiOpenAlert(L10n.get("savesIncapable")),!1}function uiBuildSettings(){var $dialogBody=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach((function(control){if(control.type===Setting.Types.Header){var _name=control.name,_id=Util.slugify(_name),$header=jQuery(document.createElement("div")),$heading=jQuery(document.createElement("h2"));return $header.attr("id","header-body-".concat(_id)).append($heading).appendTo($dialogBody),$heading.attr("id","header-heading-".concat(_id)).wiki(_name),void(control.desc&&jQuery(document.createElement("p")).attr("id","header-desc-".concat(_id)).wiki(control.desc).appendTo($header))}var $control,name=control.name,id=Util.slugify(name),$setting=jQuery(document.createElement("div")),$label=jQuery(document.createElement("label")),$controlBox=jQuery(document.createElement("div"));switch(jQuery(document.createElement("div")).append($label).append($controlBox).appendTo($setting),control.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-".concat(id)).wiki(control.desc).appendTo($setting),$label.attr({id:"setting-label-".concat(id),for:"setting-control-".concat(id)}).wiki(control.label),null==settings[name]&&(settings[name]=control.default),control.type){case Setting.Types.Toggle:$control=jQuery(document.createElement("button")),settings[name]?$control.addClass("enabled").text(L10n.get("settingsOn")):$control.text(L10n.get("settingsOff")),$control.ariaClick((function(){settings[name]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[name]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[name]=!0),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default})}));break;case Setting.Types.List:$control=jQuery(document.createElement("select"));for(var i=0,iend=control.list.length;i<iend;++i)jQuery(document.createElement("option")).val(i).text(control.list[i]).appendTo($control);$control.val(control.list.indexOf(settings[name])).attr("tabindex",0).on("change",(function(){settings[name]=control.list[Number(this.value)],Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,list:control.list})}));break;case Setting.Types.Range:($control=jQuery(document.createElement("input"))).attr({type:"range",min:control.min,max:control.max,step:control.step,value:settings[name],tabindex:0}).on("change input",(function(){settings[name]=Number(this.value),Setting.save(),control.hasOwnProperty("onChange")&&control.onChange.call({name:name,value:settings[name],default:control.default,min:control.min,max:control.max,step:control.step})})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$control.trigger("change"))}))}$control.attr("id","setting-control-".concat(id)).appendTo($controlBox),$setting.attr("id","setting-body-".concat(id)).appendTo($dialogBody)})),$dialogBody.append('<ul class="buttons">'+'<li><button id="settings-ok" class="ui-close">'.concat(L10n.get(["settingsOk","ok"]),"</button></li>")+'<li><button id="settings-reset">'.concat(L10n.get("settingsReset"),"</button></li>")+"</ul>").find("#settings-reset").ariaClick({one:!0},(function(){jQuery(document).one(":dialogclosed",(function(){Setting.reset(),window.location.reload()})),Dialog.close()})),!0}function uiBuildShare(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(uiAssembleLinkList("StoryShare"))}catch(ex){return console.error(ex),Alert.error("StoryShare",ex.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:uiAssembleLinkList},alert:{value:uiOpenAlert},jumpto:{value:function(){uiBuildJumpto(),Dialog.open.apply(Dialog,arguments)}},restart:{value:function(){uiBuildRestart(),Dialog.open.apply(Dialog,arguments)}},saves:{value:function(){uiBuildSaves(),Dialog.open.apply(Dialog,arguments)}},settings:{value:function(){uiBuildSettings(),Dialog.open.apply(Dialog,arguments)}},share:{value:function(){uiBuildShare(),Dialog.open.apply(Dialog,arguments)}},buildAutoload:{value:uiBuildAutoload},buildJumpto:{value:uiBuildJumpto},buildRestart:{value:uiBuildRestart},buildSaves:{value:uiBuildSaves},buildSettings:{value:uiBuildSettings},buildShare:{value:uiBuildShare},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:uiBuildAutoload},buildDialogJumpto:{value:uiBuildJumpto},buildDialogRestart:{value:uiBuildRestart},buildDialogSaves:{value:uiBuildSaves},buildDialogSettings:{value:uiBuildSettings},buildDialogShare:{value:uiBuildShare},buildLinkListFromPassage:{value:uiAssembleLinkList}}))}(),UIBar=function(){var _$uiBar=null;function uiBarStow(noAnimation){var $story;_$uiBar&&!_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.addClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay));return this}function uiBarUpdate(){if(Story.has("StoryDisplayTitle")&&setDisplayTitle(Story.get("StoryDisplayTitle").processText()),_$uiBar){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var menuStory=document.getElementById("menu-story");if(null!==menuStory&&(jQuery(menuStory).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",menuStory)}catch(ex){console.error(ex),Alert.error("StoryMenu",ex.message)}}}return Object.freeze(Object.defineProperties({},{destroy:{value:function(){_$uiBar&&(_$uiBar.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),_$uiBar.remove(),_$uiBar=null)}},hide:{value:function(){return _$uiBar&&_$uiBar.hide(),this}},init:{value:function(){if(!document.getElementById("ui-bar")){var toggleLabel,backwardLabel,jumptoLabel,forwardLabel,$backward,$forward,$elems=(toggleLabel=L10n.get("uiBarToggle"),backwardLabel=L10n.get("uiBarBackward"),jumptoLabel=L10n.get("uiBarJumpto"),forwardLabel=L10n.get("uiBarForward"),jQuery(document.createDocumentFragment()).append('<div id="ui-bar" aria-live="polite"><div id="ui-bar-tray">'+'<button id="ui-bar-toggle" tabindex="0" title="'.concat(toggleLabel,'" aria-label="').concat(toggleLabel,'"></button>')+'<div id="ui-bar-history">'+'<button id="history-backward" tabindex="0" title="'.concat(backwardLabel,'" aria-label="').concat(backwardLabel,'"></button>')+'<button id="history-jumpto" tabindex="0" title="'.concat(jumptoLabel,'" aria-label="').concat(jumptoLabel,'"></button>')+'<button id="history-forward" tabindex="0" title="'.concat(forwardLabel,'" aria-label="').concat(forwardLabel,'"></button>')+'</div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core">'+'<li id="menu-item-saves"><a tabindex="0">'.concat(L10n.get("savesTitle"),"</a></li>")+'<li id="menu-item-settings"><a tabindex="0">'.concat(L10n.get("settingsTitle"),"</a></li>")+'<li id="menu-item-restart"><a tabindex="0">'.concat(L10n.get("restartTitle"),"</a></li>")+'<li id="menu-item-share"><a tabindex="0">'.concat(L10n.get("shareTitle"),"</a></li>")+"</ul></nav></div></div>"));_$uiBar=jQuery($elems.find("#ui-bar").get(0)),$elems.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",($backward=jQuery("#history-backward"),$forward=jQuery("#history-forward"),function(){$backward.ariaDisabled(State.length<2),$forward.ariaDisabled(State.length===State.size)}))}}},isHidden:{value:function(){return _$uiBar&&"none"===_$uiBar.css("display")}},isStowed:{value:function(){return _$uiBar&&_$uiBar.hasClass("stowed")}},show:{value:function(){return _$uiBar&&_$uiBar.show(),this}},start:{value:function(){_$uiBar&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&uiBarStow(!0),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},(function(){return _$uiBar.toggleClass("stowed")})),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},(function(){return Engine.backward()})),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},(function(){return UI.jumpto()})):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},(function(){return Engine.forward()}))):jQuery("#ui-bar-history").remove(),Story.has("StoryDisplayTitle")?setDisplayTitle(Story.get("StoryDisplayTitle").processText()):jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||uiBarUpdate(),jQuery("#menu-item-saves a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSaves(),Dialog.open()})).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildSettings(),Dialog.open()})).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildRestart(),Dialog.open()})).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick({role:"button"},(function(ev){ev.preventDefault(),UI.buildShare(),Dialog.open()})).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}},stow:{value:uiBarStow},unstow:{value:function(noAnimation){var $story;return _$uiBar&&_$uiBar.hasClass("stowed")&&(noAnimation&&(($story=jQuery("#story")).addClass("no-transition"),_$uiBar.addClass("no-transition")),_$uiBar.removeClass("stowed"),noAnimation&&setTimeout((function(){$story.removeClass("no-transition"),_$uiBar.removeClass("no-transition")}),Engine.minDomActionDelay)),this}},update:{value:uiBarUpdate},setStoryElements:{value:uiBarUpdate}}))}(),DebugBar=function(){var _variableRe=new RegExp("^".concat(Patterns.variable,"$")),_numericKeyRe=/^\d+$/,_watchList=[],_$debugBar=null,_$watchBody=null,_$watchList=null,_$turnSelect=null,_stowed=!0;function debugBarStow(){_$debugBar.css("right","-".concat(_$debugBar.outerWidth(),"px")),_stowed=!0,_updateSession()}function debugBarUnstow(){_$debugBar.css("right",0),_stowed=!1,_updateSession()}function debugBarToggle(){_stowed?debugBarUnstow():debugBarStow()}function debugBarWatchAdd(varName){_variableRe.test(varName)&&(_watchList.pushUnique(varName),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession())}function debugBarWatchAddAll(){Object.keys(State.variables).map((function(name){return _watchList.pushUnique("$".concat(name))})),Object.keys(State.temporary).map((function(name){return _watchList.pushUnique("_".concat(name))})),_watchList.sort(),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchClear(){for(var i=_watchList.length-1;i>=0;--i)_watchList.pop();_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDelete(varName){_watchList.delete(varName),_updateWatchBody(),_updateWatchList(),_updateSession()}function debugBarWatchDisable(){_debugBarWatchDisableNoUpdate(),_updateSession()}function debugBarWatchEnable(){_debugBarWatchEnableNoUpdate(),_updateSession()}function debugBarWatchIsEnabled(){return!_$watchBody.attr("hidden")}function debugBarWatchToggle(){_$watchBody.attr("hidden")?debugBarWatchEnable():debugBarWatchDisable()}function _debugBarWatchDisableNoUpdate(){_$watchBody.attr({"aria-hidden":!0,hidden:"hidden"})}function _debugBarWatchEnableNoUpdate(){_$watchBody.removeAttr("aria-hidden hidden")}function _clearSession(){session.delete("debugState")}function _hasSession(){return session.has("debugState")}function _updateSession(){session.set("debugState",{stowed:_stowed,watchList:_watchList,watchEnabled:debugBarWatchIsEnabled(),viewsEnabled:DebugView.isEnabled()})}function _updateWatchBody(){if(0!==_watchList.length){for(var delLabel=L10n.get("debugBarDeleteWatch"),$table=jQuery(document.createElement("table")),$tbody=jQuery(document.createElement("tbody")),_loop4=function(i,len){var varName=_watchList[i],varKey=varName.slice(1),store="$"===varName[0]?State.variables:State.temporary,$row=jQuery(document.createElement("tr")),$delBtn=jQuery(document.createElement("button")),$code=jQuery(document.createElement("code"));$delBtn.addClass("watch-delete").attr("data-name",varName).ariaClick({one:!0,label:delLabel},(function(){return debugBarWatchDelete(varName)})),$code.text(_toWatchString(store[varKey])),jQuery(document.createElement("td")).append($delBtn).appendTo($row),jQuery(document.createElement("td")).text(varName).appendTo($row),jQuery(document.createElement("td")).append($code).appendTo($row),$row.appendTo($tbody)},i=0,len=_watchList.length;i<len;++i)_loop4(i);$table.append($tbody),_$watchBody.empty().append($table)}else _$watchBody.empty().append("<div>".concat(L10n.get("debugBarNoWatches"),"</div>"))}function _updateWatchList(){var svn=Object.keys(State.variables),tvn=Object.keys(State.temporary);if(0!==svn.length||0!==tvn.length){var names=[].concat(_toConsumableArray(svn.map((function(name){return"$".concat(name)}))),_toConsumableArray(tvn.map((function(name){return"_".concat(name)})))).sort(),options=document.createDocumentFragment();names.delete(_watchList);for(var i=0,len=names.length;i<len;++i)jQuery(document.createElement("option")).val(names[i]).appendTo(options);_$watchList.empty().append(options)}else _$watchList.empty()}function _updateTurnSelect(){for(var histLen=State.size,expLen=State.expired.length,options=document.createDocumentFragment(),i=0;i<histLen;++i)jQuery(document.createElement("option")).val(i).text("".concat(expLen+i+1,". ").concat(Util.escape(State.history[i].title))).appendTo(options);_$turnSelect.empty().ariaDisabled(histLen<2).append(options).val(State.activeIndex)}function _toWatchString(value){if(null===value)return"null";switch(_typeof(value)){case"number":if(Number.isNaN(value))return"NaN";if(!Number.isFinite(value))return"Infinity";case"boolean":case"symbol":case"undefined":return String(value);case"string":return JSON.stringify(value);case"function":return"Function"}var objType=Util.toStringTag(value);if("Date"===objType)return"Date {".concat(value.toLocaleString(),"}");if("RegExp"===objType)return"RegExp ".concat(value.toString());var result=[];if(value instanceof Array||value instanceof Set){for(var list=value instanceof Array?value:Array.from(value),i=0,len=list.length;i<len;++i)result.push(list.hasOwnProperty(i)?_toWatchString(list[i]):"<empty>");return Object.keys(list).filter((function(key){return!_numericKeyRe.test(key)})).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(list[key])))})),"".concat(objType,"(").concat(list.length,") [").concat(result.join(", "),"]")}return value instanceof Map?(value.forEach((function(val,key){return result.push("".concat(_toWatchString(key)," → ").concat(_toWatchString(val)))})),"".concat(objType,"(").concat(value.size,") {").concat(result.join(", "),"}")):(Object.keys(value).forEach((function(key){return result.push("".concat(_toWatchString(key),": ").concat(_toWatchString(value[key])))})),"".concat(objType," {").concat(result.join(", "),"}"))}return Object.freeze(Object.defineProperties({},{init:{value:function(){var barToggleLabel=L10n.get("debugBarToggle"),watchAddLabel=L10n.get("debugBarAddWatch"),watchAllLabel=L10n.get("debugBarWatchAll"),watchNoneLabel=L10n.get("debugBarWatchNone"),watchToggleLabel=L10n.get("debugBarWatchToggle"),viewsToggleLabel=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch">'+"<div>".concat(L10n.get("debugBarNoWatches"),"</div>>")+"</div><div>"+'<button id="debug-bar-watch-toggle" tabindex="0" title="'.concat(watchToggleLabel,'" aria-label="').concat(watchToggleLabel,'">').concat(L10n.get("debugBarLabelWatch"),"</button>")+'<label id="debug-bar-watch-label" for="debug-bar-watch-input">'.concat(L10n.get("debugBarLabelAdd"),"</label>")+'<input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist>'+'<button id="debug-bar-watch-add" tabindex="0" title="'.concat(watchAddLabel,'" aria-label="').concat(watchAddLabel,'"></button>')+'<button id="debug-bar-watch-all" tabindex="0" title="'.concat(watchAllLabel,'" aria-label="').concat(watchAllLabel,'"></button>')+'<button id="debug-bar-watch-none" tabindex="0" title="'.concat(watchNoneLabel,'" aria-label="').concat(watchNoneLabel,'"></button>')+"</div><div>"+'<button id="debug-bar-views-toggle" tabindex="0" title="'.concat(viewsToggleLabel,'" aria-label="').concat(viewsToggleLabel,'">').concat(L10n.get("debugBarLabelViews"),"</button>")+'<label id="debug-bar-turn-label" for="debug-bar-turn-select">'.concat(L10n.get("debugBarLabelTurn"),"</label>")+'<select id="debug-bar-turn-select" tabindex="0"></select></div>'+'<button id="debug-bar-toggle" tabindex="0" title="'.concat(barToggleLabel,'" aria-label="').concat(barToggleLabel,'"></button>')+'</div><div id="debug-bar-hint"></div>').appendTo("body"),_$debugBar=jQuery("#debug-bar"),_$watchBody=jQuery(_$debugBar.find("#debug-bar-watch").get(0)),_$watchList=jQuery(_$debugBar.find("#debug-bar-watch-list").get(0)),_$turnSelect=jQuery(_$debugBar.find("#debug-bar-turn-select").get(0));var $barToggle=jQuery(_$debugBar.find("#debug-bar-toggle").get(0)),$watchToggle=jQuery(_$debugBar.find("#debug-bar-watch-toggle").get(0)),$watchInput=jQuery(_$debugBar.find("#debug-bar-watch-input").get(0)),$watchAdd=jQuery(_$debugBar.find("#debug-bar-watch-add").get(0)),$watchAll=jQuery(_$debugBar.find("#debug-bar-watch-all").get(0)),$watchNone=jQuery(_$debugBar.find("#debug-bar-watch-none").get(0)),$viewsToggle=jQuery(_$debugBar.find("#debug-bar-views-toggle").get(0));$barToggle.ariaClick(debugBarToggle),$watchToggle.ariaClick(debugBarWatchToggle),$watchInput.on(":addwatch",(function(){debugBarWatchAdd(this.value.trim()),this.value=""})).on("keypress",(function(ev){13===ev.which&&(ev.preventDefault(),$watchInput.trigger(":addwatch"))})),$watchAdd.ariaClick((function(){return $watchInput.trigger(":addwatch")})),$watchAll.ariaClick(debugBarWatchAddAll),$watchNone.ariaClick(debugBarWatchClear),_$turnSelect.on("change",(function(){Engine.goTo(Number(this.value))})),$viewsToggle.ariaClick((function(){DebugView.toggle(),_updateSession()})),jQuery(document).on(":historyupdate.debug-bar",_updateTurnSelect).on(":passageend.debug-bar",(function(){_updateWatchBody(),_updateWatchList()})).on(":enginerestart.debug-bar",_clearSession),_hasSession()||DebugView.enable()}},isStowed:{value:function(){return _stowed}},start:{value:function(){(function(){if(!_hasSession())return!1;var debugState=session.get("debugState");_stowed=debugState.stowed,_watchList.push.apply(_watchList,_toConsumableArray(debugState.watchList)),debugState.watchEnabled?_debugBarWatchEnableNoUpdate():_debugBarWatchDisableNoUpdate();debugState.viewsEnabled?DebugView.enable():DebugView.disable()})(),_stowed?debugBarStow():debugBarUnstow(),_updateTurnSelect(),_updateWatchBody(),_updateWatchList()}},stow:{value:debugBarStow},toggle:{value:debugBarToggle},unstow:{value:debugBarUnstow},watch:{value:Object.freeze(Object.defineProperties({},{add:{value:debugBarWatchAdd},all:{value:debugBarWatchAddAll},clear:{value:debugBarWatchClear},delete:{value:debugBarWatchDelete},disable:{value:debugBarWatchDisable},enable:{value:debugBarWatchEnable},isEnabled:{value:debugBarWatchIsEnabled},toggle:{value:debugBarWatchToggle}}))}}))}(),LoadScreen=function(){var _locks=new Set,_autoId=0;function loadScreenHide(){jQuery(document.documentElement).removeAttr("data-init")}function loadScreenShow(){jQuery(document.documentElement).attr("data-init","loading")}return Object.freeze(Object.defineProperties({},{init:{value:function(){jQuery(document).on("readystatechange.SugarCube",(function(){_locks.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout((function(){0===_locks.size&&loadScreenHide()}),Math.max(Engine.minDomActionDelay,Config.loadDelay)):loadScreenHide()):loadScreenShow())}))}},clear:{value:function(){jQuery(document).off("readystatechange.SugarCube"),_locks.clear(),loadScreenHide()}},hide:{value:loadScreenHide},show:{value:loadScreenShow},lock:{value:function(){return++_autoId,_locks.add(_autoId),loadScreenShow(),_autoId}},unlock:{value:function(id){if(null==id)throw new Error("LoadScreen.unlock called with a null or undefined ID");_locks.has(id)&&_locks.delete(id),0===_locks.size&&jQuery(document).trigger("readystatechange")}}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:36,patch:1,prerelease:null,build:9717,date:new Date("2021-12-22T05:37:33.467Z"),extensions:{},toString:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,"+").concat(this.build)},short:function(){var prerelease=this.prerelease?"-".concat(this.prerelease):"";return"".concat(this.title," (v").concat(this.major,".").concat(this.minor,".").concat(this.patch).concat(prerelease,")")},long:function(){return"".concat(this.title," v").concat(this.toString()," (").concat(this.date.toUTCString(),")")}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery((function(){try{var lockId=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();var $window=$(window),vprCheckId=setInterval((function(){$window.width()&&(clearInterval(vprCheckId),UIBar.start(),Config.debug&&DebugBar.start(),jQuery.event.trigger({type:":storyready"}),setTimeout((function(){return LoadScreen.unlock(lockId)}),2*Engine.minDomActionDelay))}),Engine.minDomActionDelay);Object.defineProperty(window,"SugarCube",{value:Object.seal(Object.assign(Object.create(null),{Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Fullscreen:Fullscreen,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}))})}catch(ex){return console.error(ex),LoadScreen.clear(),Alert.fatal(null,ex.message,ex)}}))})(window,window.document,jQuery);}
	</script>
</body>
</html>
